     1  000000             CHIP		SN8P2501D
     2  000000             //{{SONIX_CODE_OPTION
     3  000000             	.Code_Option	Noise_Filter	Enable
     4  000000             	.Code_Option	Reset_Pin	P11
     5  000000             	.Code_Option	Watch_Dog	Disable
     6  000000             	.Code_Option	High_Clk	IHRC_RTC	;
     7  000000             	.Code_Option	Fcpu		#3     ; Fcpu = Fosc/8
     8  000000             	.Code_Option	Security	Enable
     9  000000             	.Code_Option	LVD		LVD_L		;
    10  000000             //}}SONIX_CODE_OPTION
    11  000000             
    12  E 0000002F         	END_RAM_ADDR	EQU	0X2F
    13  E 000000A1         	EER_ADD			EQU	0XA1	;10100001B
    14  E 000000A0         	EEW_ADD			EQU	0XA0	;10100000B
    15  E 00000030         	RAM_COUNT		EQU	48
    16  E 00000034         	TM_DATA_H		EQU	0X34	;ADDR OF THE TEMPEATURE	OF TM
    17  E 00000000         	TM_DATA_L		EQU	0X00
    18  E 0000000A         	TIME_GAP		EQU	0X0A	;10S
    19  E 00000001         	T0_TDR			EQU	0X01
    20  E 0000003D         	TMR_ADD 		EQU	0X3D
    21  E 0000003C         	TMW_ADD			EQU	0X3C
    22  E 0000001F         	MAX_MEMH		EQU	0X1F
    23  E 000000DE         	MAX_MEML		EQU	0XDE
    24  E 0000001F         	LAST_TIME_EE_ADD_H EQU 0X1F
    25  E 000000FE         	LAST_TIME_EE_ADD_L EQU 0XFE
    26  E 0000001F         	LIVE_TIME_ADD_H		EQU	0X1F
    27  E 000000FC         	LIVE_TIME_ADD_L		EQU	0XFC
    28  E 00000001         	DEFAULT_FRONT_TIME_DELAY	EQU	0X01
    29  E 00000001         	DEFAULT_TIME_GAP	EQU	0X01
    30  E 00000030         	TM_INITIAL_TIME_ADD_H	EQU 0X30
    31  E 00000000         	TM_INITIAL_TIME_ADD_L	EQU 0X00
    32  E 00000031         	TM_TIME_H		EQU	0X31
    33  E 00000000         	TM_TIME_L		EQU	0X00
    34  E 0000001F         	EE_DELAY_ADD_H	EQU	0X1F
    35  E 000000F8         	EE_GAP_ADD_L	EQU	0XF8
    36  E 0000001F         	EE_INITIAL_TIME_ADD_H	EQU	0X1F
    37  E 000000FA         	EE_INITIAL_TIME_ADD_L	EQU	0XFA
    38  E 00000001         	WRITE_FLAG_H	EQU 0X01
    39  E 00000000         	WRITE_FLAG_L	EQU	0X00
    40  E 00000002         	DEFAULT_GAP_TIME_FLAGH EQU 0X02
    41  E 00000000         	DEFAULT_GAP_TIME_FLAGL EQU	0X00
    42  000000             .DATA
    43  000000             			ORG	0H
    44  0000 D             	DELAYTIME1	DS	1
    45  0001 D             	DELAYTIME2	DS	1
    46  0002 D             	TIMEOUT		DS	1
    47  0003 D             	TLC0		DS	1
    48  0004 D             	TLC1		DS	1
    49  0005 D             	TLC2		DS	1
    50  0006 D             	FLAG1		DS	1
    51  0007 D             	FLAG2		DS	1
    52  0008 D             	TIMEH		DS	1
    53  0009 D             	TIMEG		DS	1
    54  000A D             	DATA_IN		DS	1
    55  000B D             	DATA_OUT	DS	1
    56  000C D             	DATAH		DS	1
    57  000D D             	DATAL		DS	1
    58  000E D             	ADDRESSH	DS	1
    59  000F D             	ADDRESSL	DS	1
    60  0010 D             	CRCT1		DS	1
    61  0011 D             	CRCT2		DS	1
    62  0012 D             	COUNT		DS	1
    63  0013 D             	MAC_H		DS	1
    64  0014 D             	MAC_L		DS	1
    65  0015 D             	FRONT_DELAY	DS	1
    66  0016 D             	TIME_DELAY_GAP	DS	1
    67  0017 D             	STARTADDRH		DS	1
    68  0018 D             	STARTADDRL		DS	1
    69  0019 D             	INITIAL_TIMEH	DS	1
    70  001A D             	INITIAL_TIMEL	DS	1
    71  00001B             ;**************BIT_VARIABLES_DEFINNITIONS*******
    72  E 00000006         	READTM_FLAG	EQU	FLAG1.0
    73  E 00030006         	TIME_FLAG	EQU	FLAG1.3
    74  E 00010006         	RESET_FLAG	EQU	FLAG1.1
    75  E 00020006         	TM_EE_FLAG	EQU FLAG1.2
    76  E 00040006         	DEFAULT_GAP_FLAG	EQU	FLAG1.4
    77  E 00050006         	FILLOUT_FLAG	EQU	FLAG1.5
    78  E 00060006         	I2CERROR_FLAG	EQU	FLAG1.6
    79  E 00070006         	ASK_FLAG	EQU	FLAG1.7
    80  E 00010007         	READ_LED_FLAG	EQU	FLAG2.1
    81  E 00020007         	NOT_UPLOAD_FLAG	EQU	FLAG2.2
    82  E 00030007         	HAVE_UPLOAD_FLAG EQU FLAG2.3
    83  E 00040007         	NOT_QUICK_MODE_FLAG EQU FLAG2.4
    84  E 00050007         	TM_I2C_EEROR	EQU FLAG2.5
    85  E 00060007         	BLE_FLAG		EQU FLAG2.6
    86  E 000200D2         	CLED_IO			EQU	P2.2
    87  E 000100D2         	SDATA_IO		EQU	P2.1
    88  E 000000D2         	SCL_IO			EQU	P2.0
    89  E 000300D2         	S_TM_EE_IO		EQU	P2.3
    90  E 000400D2         	BLEF	EQU	P2.4
    91  E 000500D2         	SDA_IO			EQU	P2.5
    92  E 000400D5         	VTM_IO			EQU	P5.4
    93  E 000000D0         	VSR_IO			EQU	P0.0
    94  E 000200C2         	CLED_CONT		EQU	P2M.2
    95  E 000100C2         	SDATA_CONT		EQU	P2M.1
    96  E 000000C2         	SCL_CONT		EQU	P2M.0
    97  E 000300C2         	S_TM_EE_CONT	EQU	P2M.3
    98  E 000500C2         	SDA_CONT		EQU	P2M.5
    99  E 000400C5         	VTM_CONT		EQU	P5M.4
   100  E 000000B8         	VSR_CONT		EQU	P0M.0
   101  00001B             ;***************************************
   102  E 000100D1         	VDDF			EQU	P1.1
   103  E 000000D1         	S_VDD_VCC_IO		EQU	P1.0
   104  E 000000C1         	S_VDD_VCC_CONT		EQU	P1M.0
   105  00001B             ;*************CODE_SECTION**********************	
   106  000000             .CODE
   107  000000             
   108  000000             		ORG	0
   109  000000   8030(2)  	JMP		START
   110  000008             		ORG	8H
   111  000008   8009(2)  	JMP		INT_SERVICE
   112  000009             INT_SERVICE:
   113  000009             ;KEEP ACC AND PFLAG
   114  000009   0400(1)  	PUSH
   115  00000A             ;T0 INTERRUPT
   116  00000A             JUST_T0:
   117  00000A   74C9(1+S)  	B0BTS0	FT0IEN
   118  00000B   7CC8(1+S)  	B0BTS1	FT0IRQ
   119  00000C   8025(2)  	JMP		JUST_TC0
   120  00000D   64C8(1)  	B0BCLR	FT0IRQ
   121  00000E             ;T0 INTERRUPT SERVISE PROGRESS
   122  00000E   71D1(1+S)  	B0BTS0	VDDF
   123  00000F   4A07(1)  	BSET 	NOT_UPLOAD_FLAG
   124  000010   71D1(1+S)  	B0BTS0	VDDF
   125  000011   4307(1)  	BCLR    HAVE_UPLOAD_FLAG
   126  000012             ;///////////////////////////////
   127  000012   5B07(1+S)  	BTS1	HAVE_UPLOAD_FLAG
   128  000013   8016(2)  	JMP		$+3
   129  000014   79D1(1+S)  	B0BTS1	VDDF
   130  000015   4C07(1)  	BSET	NOT_QUICK_MODE_FLAG
   131  000016   79D1(1+S)  	B0BTS1	VDDF
   132  000017   4B07(1)  	BSET    HAVE_UPLOAD_FLAG
   133  000018             ;//////////////////////////////////
   134  000018   1608(1+S)  	INCMS	TIMEH ;TIMEH=TIMEH+1,
   135  000019   2D0A(1)  	MOV		A,#TIME_GAP
   136  00001A   0708(1+S)  	CMPRS	A,TIMEH
   137  00001B   802E(2)  	JMP		EXIT_INT
   138  00001C   2B08(1)  	CLR		TIMEH
   139  00001D   4B06(1)  	BSET	TIME_FLAG
   140  00001E   1609(1+S)  	INCMS	TIMEG
   141  00001F   1E16(1)  	MOV		A,TIME_DELAY_GAP
   142  000020   0709(1+S)  	CMPRS	A,TIMEG
   143  000021   802E(2)  	JMP		EXIT_INT
   144  000022   2B09(1)  	CLR		TIMEG
   145  000023   4806(1)  	BSET	READTM_FLAG
   146  000024   802E(2)  	JMP		EXIT_INT
   147  000025             JUST_TC0:
   148  000025   75C9(1+S)  	B0BTS0	FTC0IEN
   149  000026   7DC8(1+S)  	B0BTS1	FTC0IRQ
   150  000027   802A(2)  	JMP		JUST_INT0
   151  000028   65C8(1)  	B0BCLR	FTC0IRQ
   152  000029             ;TC0 INTERRUPT SERVICE PROGRESS
   153  000029   802E(2)  	JMP		EXIT_INT
   154  00002A             JUST_INT0:
   155  00002A   70C9(1+S)  	B0BTS0	FP00IEN
   156  00002B   78C8(1+S)  	B0BTS1	FP00IRQ
   157  00002C   802E(2)  	JMP EXIT_INT
   158  00002D   60C8(1)  	B0BCLR	FP00IRQ
   159  00002E             ;INT0 INTERRUPT SERVISE PROGRESS
   160  00002E             EXIT_INT:
   161  00002E   0500(1)  	POP
   162  00002F   0F00(2)  	RETI
   163  000030             ;*********************************************************
   164  000030             ;***********************STARRT**********************
   165  000030             START:
   166  000030   2D7F(1)  	MOV		A,#07FH
   167  000031   2FDF(1)  	B0MOV		STKP,A		;DISABLE GLOBAL INTERRUPT
   168  000032   2B86(1)  	CLR		PFLAG
   169  000033   2D00(1)  	MOV		A,#00H
   170  000034   2FCA(1)  	B0MOV		OSCM,A
   171  000035   2D5A(1)  	MOV		A,#0X5A
   172  000036   2FCC(1)  	B0MOV		WDTR,A	
   173  000037   C17F(2)  	CALL		CLRRAM
   174  000038             STATE_INITIAL:
   175  000038   C32F(2)  	CALL		SYS_INIT_FUN
   176  000039   67DF(1)  	B0BCLR		FGIE
   177  00003A             ;******************************************
   178  00003A   2D01(1)  	MOV		A,#DEFAULT_FRONT_TIME_DELAY
   179  00003B   1F15(1)  	MOV		FRONT_DELAY,A
   180  00003C   2D01(1)  	MOV		A,#DEFAULT_TIME_GAP
   181  00003D   1F16(1)  	MOV		TIME_DELAY_GAP,A
   182  00003E             ;////////////////////////////////
   183  00003E   5607(1+S)  	BTS0		BLE_FLAG
   184  00003F   805C(2)  	JMP			GET_INITIAL_DATA_FROM_EE
   185  000040             GET_TIME_INITIAL_TM:
   186  000040   6BD2(1)  	B0BSET	S_TM_EE_IO
   187  000041             ;Get initial time from tm
   188  000041   2D30(1)  	MOV		A,#TM_INITIAL_TIME_ADD_H
   189  000042   1F13(1)  	MOV		MAC_H,A
   190  000043   2D00(1)  	MOV		A,#TM_INITIAL_TIME_ADD_L
   191  000044   1F14(1)  	MOV		MAC_L,A
   192  000045   C1EA(2)  	CALL	GET_DATA_FROM_TM_FUN
   193  000046   1E0C(1)  	MOV		A,DATAH
   194  000047   0600(1+S)  	CMPRS	A,#0X00
   195  000048   1F19(1)  	MOV		INITIAL_TIMEH,A
   196  000049   1E0D(1)  	MOV		A,DATAL
   197  00004A   0600(1+S)  	CMPRS	A,#0X00
   198  00004B   1F1A(1)  	MOV		INITIAL_TIMEL,A
   199  00004C   C30B(2)  	CALL	DELAY_SHORT
   200  00004D             ;GET TIME DELAY AND GAP FROM TM
   201  00004D   2D31(1)  	MOV		A,#TM_TIME_H
   202  00004E   1F13(1)  	MOV		MAC_H,A
   203  00004F   2D00(1)  	MOV		A,#TM_TIME_L
   204  000050   1F14(1)  	MOV		MAC_L,A
   205  000051   C1EA(2)  	CALL	GET_DATA_FROM_TM_FUN
   206  000052             ;the 2bit in front of DATAH is useness
   207  000052   2D3F(1)  	MOV		A,#0X3F
   208  000053   290C(1)  	AND		DATAH,A
   209  000054   1E0C(1)  	MOV			A,DATAH
   210  000055   0600(1+S)  	CMPRS		A,#0X00
   211  000056   1F15(1)  	MOV			FRONT_DELAY,A
   212  000057   1E0D(1)  	MOV			A,DATAL
   213  000058   0600(1+S)  	CMPRS		A,#0X00
   214  000059   1F16(1)  	MOV			TIME_DELAY_GAP,A		
   215  00005A   63D2(1)  	B0BCLR		S_TM_EE_IO
   216  00005B   C311(2)  	CALL		DELAY_LONG
   217  00005C             ;*******************************************
   218  00005C             GET_INITIAL_DATA_FROM_EE:
   219  00005C             ;*******************************************
   220  00005C   2D1F(1)  	MOV			A,#LAST_TIME_EE_ADD_H
   221  00005D   1F13(1)  	MOV			MAC_H,A
   222  00005E   2DFE(1)  	MOV			A,#LAST_TIME_EE_ADD_L
   223  00005F   1F14(1)  	MOV			MAC_L,A
   224  000060   5106(1+S)  	BTS0		RESET_FLAG
   225  000061   80C5(2)  	JMP			RESET_EEPROM
   226  000062   C23E(2)  	CALL		GET_DATA_FROM_EE_FUN
   227  000063   1E0F(1)  	MOV			A,ADDRESSL
   228  000064   1F18(1)  	MOV			STARTADDRL,A
   229  000065   1E0E(1)  	MOV			A,ADDRESSH
   230  000066   1F17(1)  	MOV			STARTADDRH,A
   231  000067   1E0E(1)  	MOV			A,ADDRESSH
   232  000068   06FF(1+S)  	CMPRS		A,#0XFF
   233  000069   806C(2)  	JMP			$+3
   234  00006A   2B17(1)  	CLR			STARTADDRH
   235  00006B   2B18(1)  	CLR			STARTADDRL
   236  00006C   C311(2)  	CALL		DELAY_LONG
   237  00006D   2D1F(1)  	MOV			A,#LIVE_TIME_ADD_H
   238  00006E   1F13(1)  	MOV			MAC_H,A
   239  00006F   2DFC(1)  	MOV			A,#LIVE_TIME_ADD_L
   240  000070   1F14(1)  	MOV			MAC_L,A
   241  000071   C23E(2)  	CALL		GET_DATA_FROM_EE_FUN
   242  000072             ;;;;;;;;;;;;;;LAST READ TM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   243  000072   6BD2(1)  	B0BSET		S_TM_EE_IO
   244  000073   60D0(1)  	B0BCLR		VSR_IO
   245  000074   2D34(1)  	MOV			A,#TM_DATA_H
   246  000075   1F13(1)  	MOV			MAC_H,A
   247  000076   2D00(1)  	MOV			A,#TM_DATA_L
   248  000077   1F14(1)  	MOV			MAC_L,A
   249  000078   C1EA(2)  	CALL		GET_DATA_FROM_TM_FUN
   250  000079             ;	B0BCLR		VTM_IO
   251  000079   C30B(2)  	CALL		DELAY_SHORT
   252  00007A   63D2(1)  	B0BCLR		S_TM_EE_IO
   253  00007B             ;	B0BCLR		VTM_CONT
   254  00007B             ;////////////////////READ BLE INITIAL TIME /////////////////
   255  00007B   5E07(1+S)  	BTS1		BLE_FLAG
   256  00007C   80AA(2)  	JMP			WRITE_INITIAL_DATA_TO_EE
   257  00007D             GET_INITIAL_TIME_FROM_EE:
   258  00007D   C30B(2)  	CALL		DELAY_SHORT
   259  00007E   2D1F(1)  	MOV		A,#EE_INITIAL_TIME_ADD_H
   260  00007F   1F13(1)  	MOV		MAC_H,A
   261  000080   2DFA(1)  	MOV		A,#EE_INITIAL_TIME_ADD_L
   262  000081   1F14(1)  	MOV		MAC_L,A
   263  000082   C23E(2)  	CALL		GET_DATA_FROM_EE_FUN
   264  000083   1E0E(1)  	MOV		A,ADDRESSH
   265  000084   1F19(1)  	MOV		INITIAL_TIMEH,A
   266  000085   1E0F(1)  	MOV		A,ADDRESSL
   267  000086   1F1A(1)  	MOV		INITIAL_TIMEL,A
   268  000087   C311(2)  	CALL	DELAY_LONG
   269  000088   2D1F(1)  	MOV		A,#EE_DELAY_ADD_H
   270  000089   1F13(1)  	MOV		MAC_H,A
   271  00008A   2DF8(1)  	MOV		A,#EE_GAP_ADD_L
   272  00008B   1F14(1)  	MOV		MAC_L,A
   273  00008C   C23E(2)  	CALL		GET_DATA_FROM_EE_FUN
   274  00008D   1E0E(1)  	MOV		A,ADDRESSH
   275  00008E   1F15(1)  	MOV		FRONT_DELAY,A
   276  00008F   1E0F(1)  	MOV		A,ADDRESSL
   277  000090   1F16(1)  	MOV		TIME_DELAY_GAP,A
   278  000091   C311(2)  	CALL	DELAY_LONG
   279  000092             ;/////////////////WRITE TO TM//////////////////////////////
   280  000092             WRITE_INITIAL_DATA_TO_TM:
   281  000092   6BD2(1)  	B0BSET	S_TM_EE_IO
   282  000093             ;PUT initial time TO tm
   283  000093   2D30(1)  	MOV		A,#TM_INITIAL_TIME_ADD_H
   284  000094   1F13(1)  	MOV		MAC_H,A
   285  000095   2D00(1)  	MOV		A,#TM_INITIAL_TIME_ADD_L
   286  000096   1F14(1)  	MOV		MAC_L,A
   287  000097   1E19(1)  	MOV		A,INITIAL_TIMEH
   288  000098   1F0C(1)  	MOV		DATAH,A
   289  000099   1E1A(1)  	MOV		A,INITIAL_TIMEL
   290  00009A   1F0D(1)  	MOV		DATAL,A
   291  00009B   C1AA(2)  	CALL	PUT_DATA_INTO_TM_FUN
   292  00009C             ;PUT TIME DELAY AND GAP TO TM
   293  00009C   2D31(1)  	MOV		A,#TM_TIME_H
   294  00009D   1F13(1)  	MOV		MAC_H,A
   295  00009E   2D00(1)  	MOV		A,#TM_TIME_L
   296  00009F   1F14(1)  	MOV		MAC_L,A
   297  0000A0             ;the 2bit in front of DATAH is useness
   298  0000A0   2D3F(1)  	MOV		A,#0X3F
   299  0000A1   2815(1)  	AND		A,FRONT_DELAY
   300  0000A2   1F0C(1)  	MOV		DATAH,A
   301  0000A3   1E16(1)  	MOV		A,TIME_DELAY_GAP
   302  0000A4   1F0D(1)  	MOV		DATAL,A	
   303  0000A5   C1AA(2)  	CALL	PUT_DATA_INTO_TM_FUN
   304  0000A6             ;the 2bit in front of DATAH is useness
   305  0000A6   63D2(1)  	B0BCLR		S_TM_EE_IO
   306  0000A7   C311(2)  	CALL		DELAY_LONG
   307  0000A8             ;///////////////////////////////
   308  0000A8   5607(1+S)  	BTS0	BLE_FLAG
   309  0000A9   80BF(2)  	JMP		SET_WRITE_EE_START_ADD
   310  0000AA             ;/////////////////WRITE TO EE//////////////////////////////
   311  0000AA             WRITE_INITIAL_DATA_TO_EE:
   312  0000AA             ;///////////INITIAL TIME/////////////////////
   313  0000AA   C30B(2)  	CALL		DELAY_SHORT
   314  0000AB   2D1F(1)  	MOV		A,#EE_INITIAL_TIME_ADD_H
   315  0000AC   1F13(1)  	MOV		MAC_H,A
   316  0000AD   2DFA(1)  	MOV		A,#EE_INITIAL_TIME_ADD_L
   317  0000AE   1F14(1)  	MOV		MAC_L,A
   318  0000AF   1E19(1)  	MOV		A,INITIAL_TIMEH
   319  0000B0   1F0C(1)  	MOV		DATAH,A
   320  0000B1   1E1A(1)  	MOV		A,INITIAL_TIMEL
   321  0000B2   1F0D(1)  	MOV		DATAL,A
   322  0000B3   C187(2)  	CALL		DATA_TO_EEPROM_FUN
   323  0000B4   C311(2)  	CALL	DELAY_LONG
   324  0000B5   2D1F(1)  	MOV		A,#EE_DELAY_ADD_H
   325  0000B6   1F13(1)  	MOV		MAC_H,A
   326  0000B7   2DF8(1)  	MOV		A,#EE_GAP_ADD_L
   327  0000B8   1F14(1)  	MOV		MAC_L,A
   328  0000B9   1E15(1)  	MOV		A,FRONT_DELAY
   329  0000BA   1F0C(1)  	MOV		DATAH,A
   330  0000BB   1E16(1)  	MOV		A,TIME_DELAY_GAP
   331  0000BC   1F0D(1)  	MOV		DATAL,A
   332  0000BD   C187(2)  	CALL		DATA_TO_EEPROM_FUN
   333  0000BE   C311(2)  	CALL	DELAY_LONG
   334  0000BF             
   335  0000BF             
   336  0000BF             SET_WRITE_EE_START_ADD:
   337  0000BF   1E17(1)  	MOV			A,STARTADDRH
   338  0000C0   1F0E(1)  	MOV			ADDRESSH,A
   339  0000C1   1E18(1)  	MOV			A,STARTADDRL
   340  0000C2   1F0F(1)  	MOV			ADDRESSL,A
   341  0000C3             	
   342  0000C3   5906(1+S)  	BTS1		RESET_FLAG
   343  0000C4   80E5(2)  	JMP			FRONT_DELAY_MODE
   344  0000C5             RESET_EEPROM:
   345  0000C5   2DFF(1)  	MOV		A,#0XFF
   346  0000C6   1F0C(1)  	MOV		DATAH,A
   347  0000C7   2DFF(1)  	MOV		A,#0XFF
   348  0000C8   1F0D(1)  	MOV		DATAL,A
   349  0000C9   2D00(1)  	MOV		A,#0X00
   350  0000CA   1F13(1)  	MOV		MAC_H,A
   351  0000CB             RESET_EE_LOOP_H:
   352  0000CB   2D00(1)  	MOV		A,#0X00
   353  0000CC   1F14(1)  	MOV		MAC_L,A
   354  0000CD             RESET_EE_LOOP_L:
   355  0000CD   C187(2)  	CALL		DATA_TO_EEPROM_FUN
   356  0000CE   1614(1+S)  	INCMS	MAC_L
   357  0000CF   80CD(2)  	JMP		RESET_EE_LOOP_L
   358  0000D0   1613(1+S)  	INCMS	MAC_H
   359  0000D1   1E13(1)  	MOV		A,MAC_H
   360  0000D2   0620(1+S)  	CMPRS	A,#0X20
   361  0000D3   80CB(2)  	JMP		RESET_EE_LOOP_H
   362  0000D4   2B0F(1)  	CLR		ADDRESSL
   363  0000D5   2B0E(1)  	CLR		ADDRESSH
   364  0000D6   2D1F(1)  	MOV		A,#LAST_TIME_EE_ADD_H
   365  0000D7   1F13(1)  	MOV		MAC_H,A
   366  0000D8   2DFE(1)  	MOV		A,#LAST_TIME_EE_ADD_L
   367  0000D9   1F14(1)  	MOV		MAC_L,A
   368  0000DA   1E0E(1)  	MOV		A,ADDRESSH
   369  0000DB   1F0C(1)  	MOV		DATAH,A
   370  0000DC   1E0F(1)  	MOV		A,ADDRESSL
   371  0000DD   1F0D(1)  	MOV		DATAL,A
   372  0000DE   C187(2)  	CALL		DATA_TO_EEPROM_FUN
   373  0000DF   2D1F(1)  	MOV			A,#LIVE_TIME_ADD_H
   374  0000E0   1F13(1)  	MOV			MAC_H,A
   375  0000E1   2DFC(1)  	MOV			A,#LIVE_TIME_ADD_L
   376  0000E2   1F14(1)  	MOV			MAC_L,A
   377  0000E3   C187(2)  	CALL		DATA_TO_EEPROM_FUN
   378  0000E4   4106(1)  	BCLR		RESET_FLAG
   379  0000E5             ;******************************************
   380  0000E5             FRONT_DELAY_MODE:
   381  0000E5   6FDF(1)  	B0BSET		FGIE
   382  0000E6   C364(2)  	CALL		SET_LOW_POWER_FUN
   383  0000E7             ;DELAY WAIT_FOR_SEAVAL_MINITE_FUN
   384  0000E7             ;/////////////////////////////////////////	
   385  0000E7   1E15(1)  	MOV   	A,FRONT_DELAY
   386  0000E8   1F10(1)  	MOV		CRCT1,A
   387  0000E9             FRONT_DELAY_LOOP:
   388  0000E9             	GreenMode
   389  0000E9   6CCA(1)  		B0BSET	FCPUM1
   390  0000EA   0000(1)  		NOP
   391  0000EB   0000(1)  		NOP
   392  0000EC   5407(1+S)  	BTS0	NOT_QUICK_MODE_FLAG
   393  0000ED   C35C(2)  	CALL	SET_EE_TM_FUN
   394  0000EE   5207(1+S)  	BTS0	NOT_UPLOAD_FLAG
   395  0000EF   C364(2)  	CALL	SET_LOW_POWER_FUN
   396  0000F0   5B06(1+S)  	BTS1	TIME_FLAG
   397  0000F1   80E9(2)  	JMP		FRONT_DELAY_LOOP
   398  0000F2   4306(1)  	BCLR	TIME_FLAG
   399  0000F3   2610(1+S)  	DECMS	CRCT1
   400  0000F4   80E9(2)  	JMP		FRONT_DELAY_LOOP
   401  0000F5             	;///////////////////////////
   402  0000F5   4207(1)  	BCLR		NOT_UPLOAD_FLAG
   403  0000F6   4307(1)  	BCLR		HAVE_UPLOAD_FLAG
   404  0000F7   4607(1)  	BCLR		BLE_FLAG
   405  0000F8             ;//////////////////////////////////////
   406  0000F8             MAIN:
   407  0000F8             	;close tc0 interrupt until the recording finished 
   408  0000F8             	GreenMode
   409  0000F8   6CCA(1)  		B0BSET	FCPUM1
   410  0000F9   0000(1)  		NOP
   411  0000FA   0000(1)  		NOP
   412  0000FB             	
   413  0000FB             JUST_I2CSLAVE_MODE:
   414  0000FB   5806(1+S)  	BTS1	READTM_FLAG
   415  0000FC   813D(2)  	JMP		JUST_UPLOAD_MODE
   416  0000FD   5506(1+S)  	BTS0	FILLOUT_FLAG
   417  0000FE   815B(2)  	JMP		MEM_FILLOUT_MODE
   418  0000FF   7CC9(1+S)  	B0BTS1	FT0IEN
   419  000100   813D(2)  	JMP		JUST_UPLOAD_MODE
   420  000101             ;*****START TM I2C SLAVE MODE***********
   421  000101             I2CSLAVE_MODE:
   422  000101   4006(1)  	BCLR 	READTM_FLAG
   423  000102   59D1(1+S)  	BTS1	VDDF
   424  000103   812F(2)  	JMP		ADDRESS_CHANGE
   425  000104   5CD2(1+S)  	BTS1	BLEF
   426  000105   812F(2)  	JMP		ADDRESS_CHANGE
   427  000106   4607(1)  	BCLR	BLE_FLAG
   428  000107   67DF(1)  	B0BCLR 	FGIE
   429  000108             ;	B0BSET	VTM_CONT
   430  000108   6BD2(1)  	B0BSET	S_TM_EE_IO
   431  000109   60D0(1)  	B0BCLR	VSR_IO
   432  00010A   2D34(1)  	MOV		A,#TM_DATA_H
   433  00010B   1F13(1)  	MOV		MAC_H,A
   434  00010C   2D00(1)  	MOV		A,#TM_DATA_L
   435  00010D   1F14(1)  	MOV		MAC_L,A
   436  00010E   C1EA(2)  	CALL	GET_DATA_FROM_TM_FUN
   437  00010F             ;	B0BCLR		VTM_IO
   438  00010F   C30B(2)  	CALL		DELAY_SHORT
   439  000110   63D2(1)  	B0BCLR		S_TM_EE_IO
   440  000111             ;	B0BCLR		VTM_CONT
   441  000111   C30B(2)  	CALL		DELAY_SHORT
   442  000112             ;***************************************
   443  000112             ;***************************************
   444  000112             ;***************************************
   445  000112                 ;B0BSET	S_TM_EE_IO
   446  000112             	;CALL	TM_I2C_EXIST_FUN
   447  000112             	;B0BCLR	S_TM_EE_IO
   448  000112             ;****************************************
   449  000112             ;***************************************
   450  000112             ;***************************************
   451  000112   1E0E(1)  	MOV		A,ADDRESSH
   452  000113   1F13(1)  	MOV		MAC_H,A
   453  000114   1E0F(1)  	MOV		A,ADDRESSL
   454  000115   1F14(1)  	MOV		MAC_L,A
   455  000116   C187(2)  	CALL		DATA_TO_EEPROM_FUN
   456  000117   2D1F(1)  	MOV		A,#LAST_TIME_EE_ADD_H
   457  000118   1F13(1)  	MOV		MAC_H,A
   458  000119   2DFE(1)  	MOV		A,#LAST_TIME_EE_ADD_L
   459  00011A   1F14(1)  	MOV		MAC_L,A
   460  00011B   1E0E(1)  	MOV		A,ADDRESSH
   461  00011C   1F0C(1)  	MOV		DATAH,A
   462  00011D   1E0F(1)  	MOV		A,ADDRESSL
   463  00011E   1F0D(1)  	MOV		DATAL,A
   464  00011F   C187(2)  	CALL		DATA_TO_EEPROM_FUN
   465  000120   74C8(1+S)  	B0BTS0		FT0IRQ
   466  000121   1608(1+S)  	INCMS		TIMEH
   467  000122   64C8(1)  	B0BCLR		FT0IRQ
   468  000123   6FDF(1)  	B0BSET		FGIE
   469  000124   2D0A(1)  	MOV			A,#TIME_GAP
   470  000125   0708(1+S)  	CMPRS		A,TIMEH
   471  000126   812F(2)  	JMP			ADDRESS_CHANGE
   472  000127   2B08(1)  	CLR			TIMEH
   473  000128   4B06(1)  	BSET		TIME_FLAG
   474  000129   1609(1+S)  	INCMS		TIMEG
   475  00012A   1E16(1)  	MOV			A,TIME_DELAY_GAP
   476  00012B   0709(1+S)  	CMPRS		A,TIMEG
   477  00012C   812F(2)  	JMP			ADDRESS_CHANGE
   478  00012D   2B09(1)  	CLR			TIMEG
   479  00012E   4806(1)  	BSET		READTM_FLAG
   480  00012F             ADDRESS_CHANGE:
   481  00012F   2D02(1)  	MOV			A,#0X02
   482  000130   130F(1)  	ADD			ADDRESSL,A
   483  000131   2D00(1)  	MOV			A,#0X00
   484  000132   110E(1)  	ADC			ADDRESSH,A
   485  000133   2D1F(1)  	MOV			A,#MAX_MEMH
   486  000134   070E(1+S)  	CMPRS		A,ADDRESSH
   487  000135   80FB(2)  	JMP			JUST_I2CSLAVE_MODE
   488  000136   2DDE(1)  	MOV			A,#MAX_MEML
   489  000137   070F(1+S)  	CMPRS		A,ADDRESSL
   490  000138   80FB(2)  	JMP			JUST_I2CSLAVE_MODE
   491  000139   4D06(1)  	BSET		FILLOUT_FLAG
   492  00013A   67D8(1)  	B0BCLR		FT0ENB
   493  00013B   64C9(1)  	B0BCLR		FT0IEN
   494  00013C   815B(2)  	JMP			MEM_FILLOUT_MODE
   495  00013D             ;*****************************************
   496  00013D             JUST_UPLOAD_MODE:
   497  00013D   62C2(1)  	B0BCLR		CLED_CONT
   498  00013E   C30B(2)  	CALL		DELAY_SHORT
   499  00013F   C30B(2)  	CALL		DELAY_SHORT
   500  000140   7AD2(1+S)  	B0BTS1		CLED_IO
   501  000141   8171(2)  	JMP			RESET_MODE
   502  000142             BLE_EE_UPLOAD_MODE:
   503  000142   5607(1+S)  	BTS0		BLE_FLAG
   504  000143   8149(2)  	JMP			END_BLE_EE_MODE
   505  000144   54D2(1+S)  	BTS0		BLEF
   506  000145   814D(2)  	JMP			TM_EE_UPLOAD_MODE
   507  000146   4E07(1)  	BSET		BLE_FLAG
   508  000147   C364(2)  	CALL		SET_LOW_POWER_FUN
   509  000148   815B(2)  	JMP			MEM_FILLOUT_MODE
   510  000149             END_BLE_EE_MODE:
   511  000149   5CD2(1+S)  	BTS1		BLEF
   512  00014A   815B(2)  	JMP			MEM_FILLOUT_MODE
   513  00014B   C364(2)  	CALL		SET_LOW_POWER_FUN
   514  00014C   4607(1)  	BCLR		BLE_FLAG
   515  00014D             TM_EE_UPLOAD_MODE:
   516  00014D   5206(1+S)  	BTS0		TM_EE_FLAG
   517  00014E   8155(2)  	JMP			END_TM_EE_MODE
   518  00014F   51D1(1+S)  	BTS0		VDDF
   519  000150   815B(2)  	JMP			MEM_FILLOUT_MODE
   520  000151             TM_EE_MODE:
   521  000151   4307(1)  	BCLR		HAVE_UPLOAD_FLAG
   522  000152   5206(1+S)  	BTS0		TM_EE_FLAG
   523  000153   8155(2)  	JMP			END_TM_EE_MODE
   524  000154   C35C(2)  	CALL		SET_EE_TM_FUN
   525  000155             END_TM_EE_MODE:
   526  000155             	;BTS0		FILLOUT_FLAG
   527  000155             	;JMP			MEM_FILLOUT_MODE	
   528  000155   59D1(1+S)  	BTS1		VDDF
   529  000156   815B(2)  	JMP			MEM_FILLOUT_MODE
   530  000157   C364(2)  	CALL		SET_LOW_POWER_FUN
   531  000158   5506(1+S)  	BTS0		FILLOUT_FLAG
   532  000159   815B(2)  	JMP			MEM_FILLOUT_MODE
   533  00015A             	;we should keep rtc function 
   534  00015A   8168(2)  	JMP		ON_LED_MODE
   535  00015B             ;*************************************
   536  00015B             MEM_FILLOUT_MODE:
   537  00015B   5D06(1+S)  	BTS1	FILLOUT_FLAG
   538  00015C   8168(2)  	JMP		ON_LED_MODE
   539  00015D             ;***************************
   540  00015D             	;B0BTS1	VDDF
   541  00015D             	;JMP		$+4
   542  00015D             	;BTS0	TM_EE_FLAG
   543  00015D             	;CALL	SET_LOW_POWER_FUN
   544  00015D             	;JMP		$+3
   545  00015D             	;BTS1	TM_EE_FLAG
   546  00015D             	;CALL	SET_EE_TM_FUN
   547  00015D             ;********************************
   548  00015D   7FD8(1+S)  	B0BTS1		FT0ENB
   549  00015E   8162(2)  	JMP			$+4
   550  00015F   2BD9(1)  	CLR			T0C
   551  000160   64C8(1)  	B0BCLR		FT0IRQ
   552  000161   64C9(1)  	B0BCLR		FT0IEN
   553  000162   67D8(1)  	B0BCLR		FT0ENB
   554  000163             	SleepMode
   555  000163   6BCA(1)  		B0BSET	FCPUM0
   556  000164             END_FILLOUT_MODE:
   557  000164   6AC2(1)  	B0BSET		CLED_CONT
   558  000165   6AD2(1)  	B0BSET		CLED_IO
   559  000166   C306(2)  	CALL		DELAY_MINI
   560  000167   813D(2)  	JMP		JUST_UPLOAD_MODE
   561  000168             ON_LED_MODE:
   562  000168   6AC2(1)  	B0BSET	CLED_CONT
   563  000169   6AD2(1)  	B0BSET	CLED_IO
   564  00016A   5107(1+S)  	BTS0	READ_LED_FLAG
   565  00016B   C176(2)  	CALL	READ_LED_FUN
   566  00016C   4107(1)  	BCLR   	READ_LED_FLAG
   567  00016D   6AD2(1)  	B0BSET	CLED_IO
   568  00016E   5506(1+S)  	BTS0	FILLOUT_FLAG
   569  00016F   813D(2)  	JMP		JUST_UPLOAD_MODE
   570  000170   80F8(2)  	JMP		MAIN
   571  000171             RESET_MODE:
   572  000171   4906(1)  	BSET	RESET_FLAG
   573  000172   4506(1)  	BCLR	FILLOUT_FLAG
   574  000173   2B08(1)  	CLR		TIMEH
   575  000174   2B09(1)  	CLR		TIMEG
   576  000175   8038(2)  	JMP		STATE_INITIAL
   577  000176             	
   578  000176             ;******************************************************************************	
   579  000176             READ_LED_FUN:
   580  000176   2D01(1)     	MOV  	   	A,#1
   581  000177   1F05(1)     	MOV  	   	TLC2,A
   582  000178             LED_MODEL1:	
   583  000178   6AD2(1)     	B0BSET   	CLED_IO
   584  000179   C31B(2)     	CALL   	   	DELAY_LED
   585  00017A   62D2(1)     	B0BCLR   	CLED_IO
   586  00017B   C31B(2)     	CALL   	   	DELAY_LED
   587  00017C   2605(1+S)     	DECMS   	TLC2
   588  00017D   8178(2)     	JMP   	   	LED_MODEL1
   589  00017E   0E00(2)     	RET
   590  00017F             ;*******************************************************
   591  00017F             ;***************************************
   592  00017F             	
   593  00017F             	
   594  00017F             	
   595  00017F             	
   596  00017F             	
   597  00017F             	
   598  00017F             	
   599  00017F             	
   600  00017F             	
   601  00017F             	
   602  00017F             	
   603  00017F             	
   604  00017F             	
   605  00017F             	
   606  00017F             	
   607  00017F             	
   608  00017F             CLRRAM:
   609  00017F             	
   610  00017F   2B84(1)  	CLR			Y
   611  000180   2D2F(1)  	MOV			A,#END_RAM_ADDR
   612  000181   2F83(1)  	B0MOV		Z,A
   613  000182             CLRRAM10:
   614  000182   2BE7(1)  	CLR			@YZ
   615  000183   2683(1+S)  	DECMS		Z
   616  000184   8182(2)  	JMP			CLRRAM10
   617  000185   2BE7(1)  	CLR			@YZ
   618  000186   0E00(2)  	RET
   619  000187             ;***********************************
   620  000187             ;***************************************
   621  000187             ;*************WRITE TMEPERATURE INTO EEPROM*************
   622  000187             ;*************RECORDING ADDRESS THE LAST TIME STORAGE THE TMPERATURE VALUE************
   623  000187             ;**************************************
   624  000187             DATA_TO_EEPROM_FUN:
   625  000187   6DC2(1)  	B0BSET		SDA_CONT
   626  000188   6DD2(1)  	B0BSET		SDA_IO
   627  000189   68C2(1)  	B0BSET		SCL_CONT
   628  00018A   68D2(1)  	B0BSET		SCL_IO
   629  00018B   1E14(1)  	MOV			A,MAC_L
   630  00018C   1F11(1)  	MOV			CRCT2,A
   631  00018D   1E0C(1)  	MOV			A,DATAH
   632  00018E   1F10(1)  	MOV			CRCT1,A
   633  00018F   2D02(1)  	MOV			A,#0X02
   634  000190   1F05(1)  	MOV			TLC2,A
   635  000191             MOVE_DATA_TO_EEPROM:
   636  000191   C26A(2)  	CALL		I2C_START_EE
   637  000192   2DA0(1)  	MOV			A,#EEW_ADD
   638  000193   1F0A(1)  	MOV			DATA_IN,A
   639  000194   C2CF(2)  	CALL		EEADDRESS_ASK
   640  000195   1E13(1)  	MOV			A,MAC_H
   641  000196   1F0A(1)  	MOV			DATA_IN,A
   642  000197   C2CF(2)  	CALL		EEADDRESS_ASK
   643  000198   1E11(1)  	MOV			A,CRCT2
   644  000199   1F0A(1)  	MOV			DATA_IN,A
   645  00019A   C2CF(2)  	CALL		EEADDRESS_ASK
   646  00019B   C306(2)  	CALL		DELAY_MINI
   647  00019C   1E10(1)  	MOV			A,CRCT1
   648  00019D   1F0A(1)  	MOV			DATA_IN,A
   649  00019E   C2CF(2)  	CALL		EEADDRESS_ASK
   650  00019F   C270(2)  	CALL		I2C_END_EE
   651  0001A0             	
   652  0001A0   C311(2)  	CALL		DELAY_LONG
   653  0001A1   2D01(1)  	MOV			A,#0X01
   654  0001A2   1311(1)  	ADD			CRCT2,A
   655  0001A3   1E0D(1)  	MOV			A,DATAL
   656  0001A4   1F10(1)  	MOV			CRCT1,A
   657  0001A5   2605(1+S)  	DECMS		TLC2
   658  0001A6   8191(2)  	JMP			MOVE_DATA_TO_EEPROM
   659  0001A7             ;*********************************************
   660  0001A7   60C2(1)  	B0BCLR		SCL_CONT
   661  0001A8   65C2(1)  	B0BCLR		SDA_CONT
   662  0001A9   0E00(2)  	RET
   663  0001AA             ;**************************************
   664  0001AA             PUT_DATA_INTO_TM_FUN:
   665  0001AA   68C2(1)  	B0BSET	SCL_CONT
   666  0001AB   69C2(1)  	B0BSET	SDATA_CONT
   667  0001AC   61D2(1)  	B0BCLR	SDATA_IO
   668  0001AD   60D2(1)  	B0BCLR	SCL_IO
   669  0001AE   C311(2)  	CALL 	DELAY_LONG
   670  0001AF   C311(2)  	CALL 	DELAY_LONG
   671  0001B0             ;	B0BSET 	VTM_IO
   672  0001B0   C311(2)  	CALL 	DELAY_LONG
   673  0001B1             	;CALL	DELAY_LONG
   674  0001B1             START_TMI2C_S:
   675  0001B1   2D04(1)  	MOV 	A,#0X04
   676  0001B2   1F03(1)  	MOV 	TLC0,A
   677  0001B3             LOOP_1_S:
   678  0001B3   68D2(1)  	B0BSET 	SCL_IO
   679  0001B4   C306(2)  	CALL	DELAY_MINI;13US
   680  0001B5   C305(2)  	CALL	CALL_DELAY
   681  0001B6   60D2(1)  	B0BCLR 	SCL_IO
   682  0001B7   C306(2)  	CALL 	DELAY_MINI
   683  0001B8   2603(1+S)  	DECMS  	TLC0
   684  0001B9   81B3(2)  	JMP 	LOOP_1_S
   685  0001BA   41D2(1)  	BCLR 	SDATA_IO
   686  0001BB   C311(2)  	CALL	DELAY_LONG
   687  0001BC   C311(2)  	CALL	DELAY_LONG
   688  0001BD   2D04(1)  	MOV 	A,#4
   689  0001BE   2F03(1)  	B0MOV 	TLC0,A
   690  0001BF             LOOP_2_S:
   691  0001BF   60D2(1)  	B0BCLR 	SCL_IO
   692  0001C0   C306(2)  	CALL	DELAY_MINI
   693  0001C1   C305(2)  	CALL	CALL_DELAY
   694  0001C2   68D2(1)  	B0BSET 	SCL_IO
   695  0001C3   C306(2)  	CALL	DELAY_MINI
   696  0001C4   2603(1+S)  	DECMS 	TLC0
   697  0001C5   81BF(2)  	JMP 	LOOP_2_S
   698  0001C6   C30B(2)  	CALL	DELAY_SHORT
   699  0001C7   2D14(1)  	MOV 	A,#20
   700  0001C8   2F03(1)  	B0MOV 	TLC0,A
   701  0001C9   49D2(1)  	BSET 	SDATA_IO
   702  0001CA             WAIT_TM_INIT_S:
   703  0001CA   C311(2)  	CALL 		DELAY_LONG
   704  0001CB   2603(1+S)  	DECMS 		TLC0
   705  0001CC   81CA(2)  	JMP 		WAIT_TM_INIT_S
   706  0001CD             ;**************START*****************************
   707  0001CD   C277(2)  	CALL		I2C_START_TM
   708  0001CE             ;***********************************************
   709  0001CE   2D3C(1)  	MOV 		A,#TMW_ADD
   710  0001CF   1F0A(1)  	MOV 		DATA_IN,A
   711  0001D0   C286(2)  	CALL 		TMADDRESS_ASK
   712  0001D1   5507(1+S)  	BTS0		TM_I2C_EEROR
   713  0001D2   81E5(2)  	JMP			END_TM_S
   714  0001D3   1E13(1)  	MOV 		A,MAC_H
   715  0001D4   1F0A(1)  	MOV 		DATA_IN,A
   716  0001D5   C286(2)  	CALL 		TMADDRESS_ASK
   717  0001D6   1E14(1)  	MOV 		A,MAC_L
   718  0001D7   1F0A(1)  	MOV 		DATA_IN,A
   719  0001D8   C286(2)  	CALL 		TMADDRESS_ASK
   720  0001D9   C311(2)  	CALL		DELAY_LONG
   721  0001DA   1E0C(1)  	MOV 		A,DATAH
   722  0001DB   1F0A(1)  	MOV 		DATA_IN,A
   723  0001DC   C286(2)  	CALL 		TMADDRESS_ASK
   724  0001DD   1E0D(1)  	MOV 		A,DATAL
   725  0001DE   1F0A(1)  	MOV 		DATA_IN,A
   726  0001DF   C286(2)  	CALL 		TMADDRESS_ASK
   727  0001E0   C30B(2)  	CALL		DELAY_SHORT
   728  0001E1             ;**************END*******************************
   729  0001E1   C27D(2)  	CALL		I2C_END_TM
   730  0001E2   C311(2)  	CALL		DELAY_LONG
   731  0001E3   C311(2)  	CALL		DELAY_LONG
   732  0001E4   61D2(1)  	B0BCLR		SDATA_IO
   733  0001E5             END_TM_S:
   734  0001E5   4507(1)  	BCLR		TM_I2C_EEROR
   735  0001E6             ;	B0BCLR 		VTM_IO
   736  0001E6   61C2(1)  	B0BCLR		SDATA_CONT
   737  0001E7   60C2(1)  	B0BCLR		SCL_CONT
   738  0001E8   C30B(2)  	CALL 		DELAY_SHORT
   739  0001E9   0E00(2)  	RET
   740  0001EA             ;*******************************************
   741  0001EA             ;*****************************************
   742  0001EA             GET_DATA_FROM_TM_FUN:
   743  0001EA   2D0F(1)  	MOV		A,#0X0F
   744  0001EB   1F12(1)  	MOV		COUNT,A
   745  0001EC             TM_I2C_WORK_LOOP:
   746  0001EC   68C2(1)  	B0BSET	SCL_CONT
   747  0001ED   69C2(1)  	B0BSET	SDATA_CONT
   748  0001EE   61D2(1)  	B0BCLR	SDATA_IO
   749  0001EF   60D2(1)  	B0BCLR	SCL_IO
   750  0001F0   C311(2)  	CALL 	DELAY_LONG
   751  0001F1   C311(2)  	CALL 	DELAY_LONG
   752  0001F2             ;	B0BSET 	VTM_IO
   753  0001F2   C311(2)  	CALL 	DELAY_LONG
   754  0001F3             	;CALL	DELAY_LONG
   755  0001F3             START_TMI2C:
   756  0001F3   2D04(1)  	MOV 	A,#0X04
   757  0001F4   1F03(1)  	MOV 	TLC0,A
   758  0001F5             LOOP_1:
   759  0001F5   68D2(1)  	B0BSET 	SCL_IO
   760  0001F6   C306(2)  	CALL	DELAY_MINI;13US
   761  0001F7   C305(2)  	CALL	CALL_DELAY
   762  0001F8   60D2(1)  	B0BCLR 	SCL_IO
   763  0001F9   C306(2)  	CALL 	DELAY_MINI
   764  0001FA   2603(1+S)  	DECMS  	TLC0
   765  0001FB   81F5(2)  	JMP 	LOOP_1
   766  0001FC   2D28(1)  	MOV 	A,#40
   767  0001FD   2F03(1)  	B0MOV 	TLC0,A
   768  0001FE   41D2(1)  	BCLR 	SDATA_IO
   769  0001FF   C311(2)  	CALL	DELAY_LONG
   770  000200             	;CALL	DELAY_SHORT
   771  000200   2D04(1)  	MOV 	A,#4
   772  000201   2F03(1)  	B0MOV 	TLC0,A
   773  000202             LOOP_2:
   774  000202   60D2(1)  	B0BCLR 	SCL_IO
   775  000203   C306(2)  	CALL	DELAY_MINI
   776  000204   C305(2)  	CALL	CALL_DELAY
   777  000205   68D2(1)  	B0BSET 	SCL_IO
   778  000206   C306(2)  	CALL	DELAY_MINI
   779  000207   2603(1+S)  	DECMS 	TLC0
   780  000208   8202(2)  	JMP 	LOOP_2
   781  000209   C30B(2)  	CALL	DELAY_SHORT
   782  00020A   2D05(1)  	MOV 	A,#5
   783  00020B   2F03(1)  	B0MOV 	TLC0,A
   784  00020C   49D2(1)  	BSET 	SDATA_IO
   785  00020D             WAIT_TM_INIT:
   786  00020D   C311(2)  	CALL 		DELAY_LONG
   787  00020E   2603(1+S)  	DECMS 		TLC0
   788  00020F   820D(2)  	JMP 		WAIT_TM_INIT
   789  000210             ;**************START*****************************
   790  000210   C277(2)  	CALL		I2C_START_TM
   791  000211             ;***********************************************
   792  000211   2D3D(1)  	MOV 		A,#TMR_ADD
   793  000212   1F0A(1)  	MOV 		DATA_IN,A
   794  000213   C286(2)  	CALL 		TMADDRESS_ASK
   795  000214   5507(1+S)  	BTS0		TM_I2C_EEROR
   796  000215   8239(2)  	JMP			END_TM
   797  000216   1E13(1)  	MOV 		A,MAC_H
   798  000217   1F0A(1)  	MOV 		DATA_IN,A
   799  000218   C286(2)  	CALL 		TMADDRESS_ASK
   800  000219   1E14(1)  	MOV 		A,MAC_L
   801  00021A   1F0A(1)  	MOV 		DATA_IN,A
   802  00021B   C286(2)  	CALL 		TMADDRESS_ASK
   803  00021C   61C2(1)  	B0BCLR		SDATA_CONT
   804  00021D   C311(2)  	CALL 		DELAY_LONG
   805  00021E   4706(1)  	BCLR 		ASK_FLAG
   806  00021F   C2B3(2)  	CALL 		TMDATA_ASK
   807  000220   1E0B(1)  	MOV 		A,DATA_OUT
   808  000221   1F0C(1)  	MOV 		DATAH,A
   809  000222   4F06(1)  	BSET 		ASK_FLAG
   810  000223   C2B3(2)  	CALL 		TMDATA_ASK
   811  000224   1E0B(1)  	MOV 		A,DATA_OUT
   812  000225   1F0D(1)  	MOV 		DATAL,A		
   813  000226             ;//////////////////////DEBUG////////////////////
   814  000226   C27D(2)  	CALL		I2C_END_TM
   815  000227   C311(2)  	CALL		DELAY_LONG
   816  000228   C277(2)  	CALL		I2C_START_TM
   817  000229             ;***********************************************
   818  000229   2D3C(1)  	MOV 		A,#0X3C
   819  00022A   1F0A(1)  	MOV 		DATA_IN,A
   820  00022B   C286(2)  	CALL 		TMADDRESS_ASK
   821  00022C             ;**************END*******************************
   822  00022C   C27D(2)  	CALL		I2C_END_TM
   823  00022D   C30B(2)  	CALL		DELAY_SHORT
   824  00022E   61D2(1)  	B0BCLR		SDATA_IO
   825  00022F   2612(1+S)  	DECMS		COUNT
   826  000230   8232(2)  	JMP			$+2
   827  000231   8239(2)  	JMP			END_TM
   828  000232             ;	B0BCLR 		VTM_IO
   829  000232   2D00(1)  	MOV			A,#0X00
   830  000233   070C(1+S)  	CMPRS		A,DATAH
   831  000234   8238(2)  	JMP			$+4
   832  000235   070D(1+S)  	CMPRS		A,DATAL
   833  000236   8238(2)  	JMP			$+2
   834  000237   81EC(2)  	JMP			TM_I2C_WORK_LOOP
   835  000238   4907(1)  	BSET		READ_LED_FLAG
   836  000239             END_TM:
   837  000239   4507(1)  	BCLR		TM_I2C_EEROR
   838  00023A             ;	B0BCLR 		VTM_IO
   839  00023A   61C2(1)  	B0BCLR		SDATA_CONT
   840  00023B   60C2(1)  	B0BCLR		SCL_CONT
   841  00023C   C30B(2)  	CALL 		DELAY_SHORT
   842  00023D   0E00(2)  	RET
   843  00023E             ;*******************************************
   844  00023E             ;***********************************************************
   845  00023E             ;*********************************************************
   846  00023E             GET_DATA_FROM_EE_FUN:
   847  00023E   68C2(1)  	B0BSET		SCL_CONT
   848  00023F   6DC2(1)  	B0BSET		SDA_CONT
   849  000240   6DD2(1)  	B0BSET		SDA_IO
   850  000241   68D2(1)  	B0BSET		SCL_IO
   851  000242   C30B(2)  	CALL		DELAY_SHORT
   852  000243   C26A(2)  	CALL		I2C_START_EE
   853  000244   2DA0(1)  	MOV			A,#EEW_ADD
   854  000245   1F0A(1)  	MOV			DATA_IN,A
   855  000246   C2CF(2)  	CALL		EEADDRESS_ASK
   856  000247   1E13(1)  	MOV			A,MAC_H
   857  000248   1F0A(1)  	MOV			DATA_IN,A
   858  000249   C2CF(2)  	CALL		EEADDRESS_ASK
   859  00024A   1E14(1)  	MOV			A,MAC_L
   860  00024B   1F0A(1)  	MOV			DATA_IN,A
   861  00024C   C2CF(2)  	CALL		EEADDRESS_ASK
   862  00024D   6DD2(1)  	B0BSET		SDA_IO
   863  00024E   C30B(2)  	CALL		DELAY_SHORT
   864  00024F   68D2(1)  	B0BSET		SCL_IO
   865  000250   C30B(2)  	CALL		DELAY_SHORT
   866  000251   C26A(2)  	CALL		I2C_START_EE
   867  000252   C30B(2)  	CALL		DELAY_SHORT
   868  000253   2DA1(1)  	MOV			A,#EER_ADD
   869  000254   1F0A(1)  	MOV			DATA_IN,A
   870  000255   C2CF(2)  	CALL		EEADDRESS_ASK
   871  000256   65C2(1)  	B0BCLR		SDA_CONT
   872  000257   4706(1)  	BCLR		ASK_FLAG
   873  000258   C2E9(2)  	CALL		EEDATA_ASK
   874  000259   1E0B(1)  	MOV			A,DATA_OUT
   875  00025A   1F0E(1)  	MOV			ADDRESSH,A
   876  00025B   65C2(1)  	B0BCLR		SDA_CONT
   877  00025C   C306(2)  	CALL		DELAY_MINI
   878  00025D   4F06(1)  	BSET		ASK_FLAG
   879  00025E   C2E9(2)  	CALL		EEDATA_ASK
   880  00025F   1E0B(1)  	MOV			A,DATA_OUT
   881  000260   1F0F(1)  	MOV			ADDRESSL,A
   882  000261   C270(2)  	CALL		I2C_END_EE
   883  000262             ;*************************************
   884  000262   C30B(2)  	CALL		DELAY_SHORT
   885  000263   60C2(1)  	B0BCLR		SCL_CONT
   886  000264   65C2(1)  	B0BCLR		SDA_CONT
   887  000265   0E00(2)  	RET
   888  000266             ;************************************************
   889  000266             I2C_EEROR:
   890  000266             	;open interrupt
   891  000266             	;SleepMode
   892  000266   4606(1)  	BCLR	I2CERROR_FLAG
   893  000267   54D5(1+S)  	BTS0	VTM_IO
   894  000268   4D07(1)  	BSET	TM_I2C_EEROR
   895  000269   0E00(2)  	RET
   896  00026A             I2C_START_EE:
   897  00026A   C306(2)  	CALL		DELAY_MINI
   898  00026B   65D2(1)  	B0BCLR 		SDA_IO
   899  00026C   C306(2)  	CALL 		DELAY_MINI
   900  00026D   60D2(1)  	B0BCLR 		SCL_IO
   901  00026E   C306(2)  	CALL 		DELAY_MINI
   902  00026F   0E00(2)  	RET
   903  000270             I2C_END_EE:
   904  000270   65D2(1)  	B0BCLR 		SDA_IO
   905  000271   C306(2)  	CALL 		DELAY_MINI
   906  000272   68D2(1)  	B0BSET 		SCL_IO
   907  000273   C306(2)  	CALL 		DELAY_MINI
   908  000274   6DD2(1)  	B0BSET 		SDA_IO
   909  000275   C306(2)  	CALL		DELAY_MINI
   910  000276   0E00(2)  	RET
   911  000277             I2C_START_TM:
   912  000277   C306(2)  	CALL		DELAY_MINI
   913  000278   61D2(1)  	B0BCLR 		SDATA_IO
   914  000279   C306(2)  	CALL 		DELAY_MINI
   915  00027A   60D2(1)  	B0BCLR 		SCL_IO
   916  00027B   C306(2)  	CALL 		DELAY_MINI
   917  00027C   0E00(2)  	RET
   918  00027D             I2C_END_TM:
   919  00027D   61D2(1)  	B0BCLR 		SDATA_IO
   920  00027E   C30B(2)  	CALL 		DELAY_SHORT
   921  00027F   60D2(1)  	B0BCLR		SCL_IO
   922  000280   C30B(2)  	CALL		DELAY_SHORT
   923  000281   69D2(1)  	B0BSET 		SDATA_IO
   924  000282   C306(2)  	CALL		DELAY_MINI
   925  000283   C306(2)  	CALL		DELAY_MINI
   926  000284   68D2(1)  	B0BSET 		SCL_IO
   927  000285   0E00(2)  	RET
   928  000286             TMADDRESS_ASK:
   929  000286   2D08(1)  	MOV 		A,#8
   930  000287   1F02(1)  	MOV 		TIMEOUT,A
   931  000288             TMADDRESS_LOOP:
   932  000288   570A(1+S)  	BTS0		DATA_IN.7
   933  000289   828D(2)  	JMP 		MD_1
   934  00028A   71D2(1+S)  	B0BTS0 		SDATA_IO
   935  00028B   61D2(1)  	B0BCLR		SDATA_IO
   936  00028C   828F(2)  	JMP 		NEXT_1
   937  00028D             MD_1:
   938  00028D   79D2(1+S)  	B0BTS1 		SDATA_IO
   939  00028E   69D2(1)  	B0BSET		SDATA_IO
   940  00028F             NEXT_1:
   941  00028F   C306(2)  	CALL		DELAY_MINI
   942  000290   68D2(1)  	B0BSET 		SCL_IO
   943  000291   C306(2)  	CALL		DELAY_MINI
   944  000292   0B0A(1)  	RLCM 		DATA_IN
   945  000293   60D2(1)  	B0BCLR 		SCL_IO
   946  000294   2602(1+S)  	DECMS 		TIMEOUT
   947  000295   8288(2)  	JMP 		TMADDRESS_LOOP
   948  000296             	
   949  000296   61C2(1)  	B0BCLR 		SDATA_CONT
   950  000297   C306(2)  	CALL		DELAY_MINI
   951  000298   68D2(1)  	B0BSET 		SCL_IO
   952  000299   C305(2)  	CALL 		CALL_DELAY
   953  00029A   71D2(1+S)  	B0BTS0 		SDATA_IO
   954  00029B   C266(2)  	CALL		I2C_EEROR
   955  00029C   C306(2)  	CALL		DELAY_MINI
   956  00029D   40D2(1)  	BCLR 		SCL_IO
   957  00029E   49C2(1)  	BSET 		SDATA_CONT
   958  00029F   0E00(2)  	RET
   959  0002A0             TMADDRESS_NO_ASK:
   960  0002A0   2D08(1)  	MOV 		A,#8
   961  0002A1   1F02(1)  	MOV 		TIMEOUT,A
   962  0002A2             TMADDRESS_LOOP_N:
   963  0002A2   570A(1+S)  	BTS0		DATA_IN.7
   964  0002A3   82A7(2)  	JMP 		MD_1_N
   965  0002A4   71D2(1+S)  	B0BTS0 		SDATA_IO
   966  0002A5   61D2(1)  	B0BCLR		SDATA_IO
   967  0002A6   82A9(2)  	JMP 		NEXT_1_N
   968  0002A7             MD_1_N:
   969  0002A7   79D2(1+S)  	B0BTS1 		SDATA_IO
   970  0002A8   69D2(1)  	B0BSET		SDATA_IO
   971  0002A9             NEXT_1_N:
   972  0002A9   C306(2)  	CALL		DELAY_MINI
   973  0002AA   68D2(1)  	B0BSET 		SCL_IO
   974  0002AB   C306(2)  	CALL		DELAY_MINI
   975  0002AC   0B0A(1)  	RLCM 		DATA_IN
   976  0002AD   60D2(1)  	B0BCLR 		SCL_IO
   977  0002AE   2602(1+S)  	DECMS 		TIMEOUT
   978  0002AF   82A2(2)  	JMP 		TMADDRESS_LOOP_N
   979  0002B0             	
   980  0002B0   C306(2)  	CALL		DELAY_MINI
   981  0002B1   C306(2)  	CALL		DELAY_MINI
   982  0002B2   0E00(2)  	RET
   983  0002B3             ;**********************TM_READING_DATA********************************
   984  0002B3             TMDATA_ASK:
   985  0002B3   61C2(1)  	B0BCLR 		SDATA_CONT
   986  0002B4   2D08(1)  	MOV 		A,#8
   987  0002B5   1F02(1)  	MOV 		TIMEOUT,A
   988  0002B6             TMDATA_LOOP:
   989  0002B6   2D09(1)  	MOV 		A,#9
   990  0002B7   1F03(1)  	MOV 		TLC0,A
   991  0002B8   C306(2)  	CALL		DELAY_MINI
   992  0002B9   48D2(1)  	BSET 		SCL_IO
   993  0002BA   C305(2)  	CALL 		CALL_DELAY
   994  0002BB   71D2(1+S)  	B0BTS0 		SDATA_IO
   995  0002BC   480B(1)  	BSET 		DATA_OUT.0
   996  0002BD   79D2(1+S)  	B0BTS1 		SDATA_IO
   997  0002BE   400B(1)  	BCLR 		DATA_OUT.0
   998  0002BF   0B0B(1)  	RLCM 		DATA_OUT
   999  0002C0   C306(2)  	CALL		DELAY_MINI
  1000  0002C1   60D2(1)  	B0BCLR 		SCL_IO
  1001  0002C2   2602(1+S)  	DECMS 		TIMEOUT
  1002  0002C3   82B6(2)  	JMP 		TMDATA_LOOP
  1003  0002C4   69C2(1)  	B0BSET 		SDATA_CONT
  1004  0002C5   5706(1+S)  	BTS0 		ASK_FLAG
  1005  0002C6   69D2(1)  	B0BSET 		SDATA_IO
  1006  0002C7   5F06(1+S)  	BTS1 		ASK_FLAG
  1007  0002C8   61D2(1)  	B0BCLR 		SDATA_IO
  1008  0002C9   090B(1)  	RRCM 		DATA_OUT
  1009  0002CA   C306(2)  	CALL		DELAY_MINI
  1010  0002CB   48D2(1)  	BSET 		SCL_IO
  1011  0002CC   C306(2)  	CALL		DELAY_MINI
  1012  0002CD   40D2(1)  	BCLR		SCL_IO	
  1013  0002CE   0E00(2)  	RET
  1014  0002CF             ;******************************************************
  1015  0002CF             EEADDRESS_ASK:
  1016  0002CF   2D08(1)  	MOV 		A,#8
  1017  0002D0   1F02(1)  	MOV 		TIMEOUT,A
  1018  0002D1             EEADDRESS_LOOP:
  1019  0002D1   570A(1+S)  	BTS0		DATA_IN.7
  1020  0002D2   82D6(2)  	JMP 		EEMD_1
  1021  0002D3   75D2(1+S)  	B0BTS0 		SDA_IO
  1022  0002D4   65D2(1)  	B0BCLR		SDA_IO
  1023  0002D5   82D8(2)  	JMP 		EENEXT_1
  1024  0002D6             EEMD_1:
  1025  0002D6   7DD2(1+S)  	B0BTS1 		SDA_IO
  1026  0002D7   6DD2(1)  	B0BSET		SDA_IO
  1027  0002D8             EENEXT_1:
  1028  0002D8   C306(2)  	CALL		DELAY_MINI
  1029  0002D9   68D2(1)  	B0BSET 		SCL_IO
  1030  0002DA   C306(2)  	CALL		DELAY_MINI
  1031  0002DB   0B0A(1)  	RLCM 		DATA_IN
  1032  0002DC   60D2(1)  	B0BCLR 		SCL_IO
  1033  0002DD   2602(1+S)  	DECMS 		TIMEOUT
  1034  0002DE   82D1(2)  	JMP 		EEADDRESS_LOOP
  1035  0002DF             	
  1036  0002DF   65C2(1)  	B0BCLR 		SDA_CONT
  1037  0002E0   C306(2)  	CALL		DELAY_MINI
  1038  0002E1   68D2(1)  	B0BSET 		SCL_IO
  1039  0002E2   C305(2)  	CALL 		CALL_DELAY
  1040  0002E3   75D2(1+S)  	B0BTS0 		SDA_IO
  1041  0002E4   C266(2)  	CALL		I2C_EEROR
  1042  0002E5   C306(2)  	CALL		DELAY_MINI
  1043  0002E6   40D2(1)  	BCLR 		SCL_IO
  1044  0002E7   4DC2(1)  	BSET 		SDA_CONT
  1045  0002E8   0E00(2)  	RET
  1046  0002E9             ;****************************************
  1047  0002E9             EEDATA_ASK:
  1048  0002E9   65C2(1)  	B0BCLR 		SDA_CONT
  1049  0002EA   2D08(1)  	MOV 		A,#8
  1050  0002EB   1F02(1)  	MOV 		TIMEOUT,A
  1051  0002EC             EEDATA_LOOP:
  1052  0002EC   2D09(1)  	MOV 		A,#9
  1053  0002ED   1F03(1)  	MOV 		TLC0,A
  1054  0002EE   C306(2)  	CALL		DELAY_MINI
  1055  0002EF   48D2(1)  	BSET 		SCL_IO
  1056  0002F0   C305(2)  	CALL 		CALL_DELAY
  1057  0002F1   75D2(1+S)  	B0BTS0 		SDA_IO
  1058  0002F2   480B(1)  	BSET 		DATA_OUT.0
  1059  0002F3   7DD2(1+S)  	B0BTS1 		SDA_IO
  1060  0002F4   400B(1)  	BCLR 		DATA_OUT.0
  1061  0002F5   0B0B(1)  	RLCM 		DATA_OUT
  1062  0002F6   C306(2)  	CALL		DELAY_MINI
  1063  0002F7   60D2(1)  	B0BCLR 		SCL_IO
  1064  0002F8   2602(1+S)  	DECMS 		TIMEOUT
  1065  0002F9   82EC(2)  	JMP 		EEDATA_LOOP
  1066  0002FA             	
  1067  0002FA   6DC2(1)  	B0BSET 		SDA_CONT
  1068  0002FB   5706(1+S)  	BTS0 		ASK_FLAG
  1069  0002FC   6DD2(1)  	B0BSET 		SDA_IO
  1070  0002FD   5F06(1+S)  	BTS1 		ASK_FLAG
  1071  0002FE   65D2(1)  	B0BCLR 		SDA_IO
  1072  0002FF   090B(1)  	RRCM 		DATA_OUT
  1073  000300   C306(2)  	CALL		DELAY_MINI
  1074  000301   48D2(1)  	BSET 		SCL_IO
  1075  000302   C306(2)  	CALL		DELAY_MINI
  1076  000303   40D2(1)  	BCLR		SCL_IO	
  1077  000304   0E00(2)  	RET
  1078  000305             ;*********************delay*****************
  1079  000305             CALL_DELAY:
  1080  000305   0E00(2)  	RET
  1081  000306             DELAY_MINI:;13US
  1082  000306   2D05(1)  	MOV		A,#0X05
  1083  000307   1F00(1)  	MOV		DELAYTIME1,A
  1084  000308             DELAY0:
  1085  000308   2600(1+S)  	DECMS	DELAYTIME1
  1086  000309   8308(2)  	JMP		DELAY0
  1087  00030A   0E00(2)  	RET
  1088  00030B             	
  1089  00030B             DELAY_SHORT:		;50US FOR 0.5US/INSTRUCTION
  1090  00030B   2D63(1)  	MOV		A,#0X63
  1091  00030C   1F00(1)  	MOV		DELAYTIME1,A
  1092  00030D             DELAY1:
  1093  00030D   0000(1)  	NOP
  1094  00030E   2600(1+S)  	DECMS	DELAYTIME1
  1095  00030F   830D(2)  	JMP		DELAY1
  1096  000310   0E00(2)  	RET
  1097  000311             DELAY_LONG:	;>=5MS
  1098  000311             ;WAIT_FOR_A_LONG_WHILE
  1099  000311   2D0A(1)  	MOV		A,#0X0A
  1100  000312   2F00(1)  	B0MOV	DELAYTIME1,A
  1101  000313             DELAY2_1:
  1102  000313   2DC7(1)  	MOV		A,#0XC7
  1103  000314   1F01(1)  	MOV		DELAYTIME2,A
  1104  000315             DELAY2_2:
  1105  000315   0000(1)  	NOP
  1106  000316   2601(1+S)  	DECMS	DELAYTIME2
  1107  000317   8315(2)  	JMP		DELAY2_2	
  1108  000318   2600(1+S)  	DECMS	DELAYTIME1
  1109  000319   8313(2)  	JMP		DELAY2_1
  1110  00031A   0E00(2)  	RET		
  1111  00031B             DELAY_LED:		;0.2S
  1112  00031B             ;WAIT_FOR_DEEP_DARK_FANTASY
  1113  00031B   2DFF(1)  	MOV		A,#0XFF
  1114  00031C   1F01(1)  	MOV		DELAYTIME2,A
  1115  00031D             DELAY3_1:
  1116  00031D   2DFF(1)  	MOV		A,#0XFF
  1117  00031E   1F00(1)  	MOV		DELAYTIME1,A
  1118  00031F             DELAY3_2:
  1119  00031F   0000(1)  	NOP
  1120  000320   0000(1)  	NOP
  1121  000321   2600(1+S)  	DECMS		DELAYTIME1
  1122  000322   831F(2)  	JMP			DELAY3_2
  1123  000323   2601(1+S)  	DECMS		DELAYTIME2
  1124  000324   831D(2)  	JMP			DELAY3_1
  1125  000325   0E00(2)  	RET
  1126  000326             OPEN_TC0_INT_FUN:
  1127  000326   6BDA(1)  	B0BSET	FTC0CKS	;	OUTSIDE INPUT ACCIDENT
  1128  000327   6ADA(1)  	B0BSET	FALOAD0 ;
  1129  000328   2DFD(1)  	MOV		A,#0XFD
  1130  000329   2FCD(1)  	B0MOV	TC0R,A
  1131  00032A   2FDB(1)  	B0MOV	TC0C,A
  1132  00032B   65C8(1)  	B0BCLR	FTC0IRQ
  1133  00032C   6DC9(1)  	B0BSET	FTC0IEN
  1134  00032D   6FDA(1)  	B0BSET	FTC0ENB
  1135  00032E   0E00(2)  	RET
  1136  00032F             SYS_INIT_FUN:
  1137  00032F   2D2D(1)  	MOV			A,#0X2D
  1138  000330   2FC2(1)  	B0MOV		P2M,A
  1139  000331   2D35(1)  	MOV			A,#0X35
  1140  000332   2FD2(1)  	B0MOV		P2,A
  1141  000333             	;up resistor for p2.1
  1142  000333             	;MOV			A,#0X02
  1143  000333             	;B0MOV		P2UR,A
  1144  000333             ;*************************************
  1145  000333             ;//////////up resistor for p2////////////
  1146  000333   2DFF(1)      MOV			A,#0XFF
  1147  000334   2FE2(1)  	B0MOV		P2UR,A
  1148  000335             ;////////////////////////////////////////
  1149  000335   2D01(1)  	MOV			A,#0X01
  1150  000336   2FC1(1)  	B0MOV		P1M,A
  1151  000337   2BD1(1)  	CLR			P1
  1152  000338   68B8(1)  	B0BSET		VSR_CONT
  1153  000339   60D0(1)  	B0BCLR		VSR_IO
  1154  00033A   68C1(1)  	B0BSET		S_VDD_VCC_CONT
  1155  00033B   60D1(1)  	B0BCLR		S_VDD_VCC_IO
  1156  00033C   6CC5(1)  	B0BSET		VTM_CONT
  1157  00033D   6CD5(1)  	B0BSET		VTM_IO
  1158  00033E   2D03(1)  	MOV			A,#0X03
  1159  00033F   1F10(1)  	MOV			CRCT1,A
  1160  000340   C30B(2)  	CALL		DELAY_SHORT
  1161  000341   54D2(1+S)  	BTS0		BLEF
  1162  000342   8346(2)  	JMP			SYS_INIT_LED
  1163  000343   4E07(1)  	BSET		BLE_FLAG
  1164  000344   2D02(1)  	MOV			A,#0X02
  1165  000345   1F10(1)  	MOV			CRCT1,A
  1166  000346             SYS_INIT_LED:
  1167  000346   62D2(1)  	B0BCLR		CLED_IO
  1168  000347   C31B(2)  	CALL		DELAY_LED	
  1169  000348   6AD2(1)  	B0BSET		CLED_IO
  1170  000349   C31B(2)  	CALL		DELAY_LED
  1171  00034A   2610(1+S)  	DECMS		CRCT1
  1172  00034B   8346(2)  	JMP			SYS_INIT_LED
  1173  00034C             ;************T0_INIT_START************************************
  1174  00034C   2D00(1)  	MOV			A,#0X00
  1175  00034D   2FD8(1)  	B0MOV		T0M,A	
  1176  00034E   68D8(1)  	B0BSET		FT0TB	; T0 = Fcpu/256,PERIOD TIME IS 2S
  1177  00034F   2BD9(1)  	CLR			T0C
  1178  000350   64C8(1)  	B0BCLR		FT0IRQ
  1179  000351   6CC9(1)  	B0BSET		FT0IEN
  1180  000352   6FD8(1)  	B0BSET		FT0ENB
  1181  000353             ;*****************TC0_INIT_START*****************
  1182  000353   2BDA(1)  	CLR			TC0M
  1183  000354   2BDB(1)  	CLR			TC0C
  1184  000355   65C8(1)  	B0BCLR		FTC0IRQ
  1185  000356   65C9(1)  	B0BCLR		FTC0IEN
  1186  000357   67DA(1)  	B0BCLR		FTC0ENB
  1187  000358             ;************************OPEN P1.1WEEK UP FUNCTION*********************
  1188  000358   2D02(1)  	MOV			A,#0X02
  1189  000359   2FC0(1)  	B0MOV		P1W,A
  1190  00035A   C306(2)  	CALL		DELAY_MINI
  1191  00035B   0E00(2)  	RET
  1192  00035C             ;//////////////////////////////////////////////////
  1193  00035C             SET_EE_TM_FUN:
  1194  00035C   65C2(1)  	B0BCLR		SDA_CONT
  1195  00035D             ;	B0BCLR		VTM_CONT
  1196  00035D   60C2(1)  	B0BCLR		SCL_CONT
  1197  00035E   61C2(1)  	B0BCLR		SDATA_CONT
  1198  00035F   68D0(1)  	B0BSET		VSR_IO
  1199  000360   6BD2(1)  	B0BSET		S_TM_EE_IO
  1200  000361   4A06(1)  	BSET		TM_EE_FLAG
  1201  000362   4407(1)  	BCLR	NOT_QUICK_MODE_FLAG
  1202  000363   0E00(2)  	RET
  1203  000364             ;////////////////////////////////////////
  1204  000364             ;////////////SET LOW POWER
  1205  000364             SET_LOW_POWER_FUN:
  1206  000364             ;****************************************
  1207  000364             ;	B0BCLR		VTM_CONT
  1208  000364   63D2(1)  	B0BCLR		S_TM_EE_IO
  1209  000365   60D0(1)  	B0BCLR		VSR_IO
  1210  000366   4206(1)  	BCLR		TM_EE_FLAG
  1211  000367   0E00(2)  	RET
  1212  000368             ;////////////I2C exist and pull down the VDD/////////////////////////////	
  1213  000368             ;*******************************************
  1214  000368             TM_I2C_EXIST_FUN:
  1215  000368   68C2(1)  	B0BSET	SCL_CONT
  1216  000369   69C2(1)  	B0BSET	SDATA_CONT
  1217  00036A   61D2(1)  	B0BCLR	SDATA_IO
  1218  00036B   60D2(1)  	B0BCLR	SCL_IO
  1219  00036C   C311(2)  	CALL 	DELAY_LONG
  1220  00036D   C311(2)  	CALL 	DELAY_LONG
  1221  00036E   68C1(1)  	B0BSET	S_VDD_VCC_CONT
  1222  00036F   68D1(1)  	B0BSET  S_VDD_VCC_IO
  1223  000370   C311(2)  	CALL 	DELAY_LONG
  1224  000371             	;CALL	DELAY_LONG
  1225  000371             START_TMI2CE:
  1226  000371   2D04(1)  	MOV 	A,#4
  1227  000372   2F03(1)  	B0MOV 	TLC0,A
  1228  000373             LOOP_2E:
  1229  000373   60D2(1)  	B0BCLR 	SCL_IO
  1230  000374   C306(2)  	CALL	DELAY_MINI
  1231  000375   C305(2)  	CALL	CALL_DELAY
  1232  000376   68D2(1)  	B0BSET 	SCL_IO
  1233  000377   C306(2)  	CALL	DELAY_MINI
  1234  000378   2603(1+S)  	DECMS 	TLC0
  1235  000379   8373(2)  	JMP 	LOOP_2E
  1236  00037A   C30B(2)  	CALL	DELAY_SHORT
  1237  00037B   2D05(1)  	MOV 	A,#5
  1238  00037C   2F03(1)  	B0MOV 	TLC0,A
  1239  00037D   49D2(1)  	BSET 	SDATA_IO
  1240  00037E             WAIT_TM_INIT_E:
  1241  00037E   C311(2)  	CALL 		DELAY_LONG
  1242  00037F   2603(1+S)  	DECMS 		TLC0
  1243  000380   837E(2)  	JMP 		WAIT_TM_INIT_E
  1244  000381             ;**************START*****************************
  1245  000381   C277(2)  	CALL		I2C_START_TM
  1246  000382             ;***********************************************
  1247  000382   2D3C(1)  	MOV 		A,#0X3C
  1248  000383   1F0A(1)  	MOV 		DATA_IN,A
  1249  000384   C286(2)  	CALL 		TMADDRESS_ASK
  1250  000385   5507(1+S)  	BTS0		TM_I2C_EEROR
  1251  000386   838C(2)  	JMP			END_TM_E
  1252  000387             ;**************END*******************************
  1253  000387   C27D(2)  	CALL		I2C_END_TM
  1254  000388   C30B(2)  	CALL		DELAY_SHORT
  1255  000389   60D1(1)  	B0BCLR		S_VDD_VCC_IO
  1256  00038A   61D2(1)  	B0BCLR		SDATA_IO
  1257  00038B   C30B(2)  	CALL 		DELAY_SHORT
  1258  00038C             END_TM_E:
  1259  00038C   4507(1)  	BCLR		TM_I2C_EEROR
  1260  00038D             ;	B0BCLR 		VTM_IO
  1261  00038D   61C2(1)  	B0BCLR		SDATA_CONT
  1262  00038E   60C2(1)  	B0BCLR		SCL_CONT
  1263  00038F   C30B(2)  	CALL 		DELAY_SHORT
  1264  000390   60C1(1)  	B0BCLR		S_VDD_VCC_CONT
  1265  000391   0E00(2)      RET
  1266  000392             ;/////////////////////////////////////////	
  1267  000392             ;*******************************************
  1268  000392             	ENDP
