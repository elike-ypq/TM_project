     1  000000             CHIP		SN8P2501D
     2  000000             //{{SONIX_CODE_OPTION
     3  000000             	.Code_Option	Noise_Filter	Enable
     4  000000             	.Code_Option	Reset_Pin	P11
     5  000000             	.Code_Option	Watch_Dog	Disable
     6  000000             	.Code_Option	High_Clk	IHRC_RTC	;
     7  000000             	.Code_Option	Fcpu		#3     ; Fcpu = Fosc/8
     8  000000             	.Code_Option	Security	Enable
     9  000000             	.Code_Option	LVD		LVD_L		;
    10  000000             //}}SONIX_CODE_OPTION
    11  000000             
    12  E 0000002F         	END_RAM_ADDR	EQU	0X2F
    13  E 000000A1         	EER_ADD			EQU	0XA1	;10100001B
    14  E 000000A0         	EEW_ADD			EQU	0XA0	;10100000B
    15  E 00000030         	RAM_COUNT		EQU	48
    16  E 00000034         	TM_DATA_H		EQU	0X34	;ADDR OF THE TEMPEATURE	OF TM
    17  E 00000000         	TM_DATA_L		EQU	0X00
    18  E 00000078         	TIME_GAP		EQU	0X78	;0X78
    19  E 00000001         	T0_TDR			EQU	0X01
    20  E 0000003D         	TMR_ADD 		EQU	0X3D
    21  E 0000003C         	TMW_ADD			EQU	0X3C
    22  E 0000001F         	MAX_MEMH		EQU	0X1F
    23  E 000000DE         	MAX_MEML		EQU	0XDE
    24  E 0000001F         	LAST_TIME_EE_ADD_H EQU 0X1F
    25  E 000000FE         	LAST_TIME_EE_ADD_L EQU 0XFE
    26  E 0000001F         	LIVE_TIME_ADD_H		EQU	0X1F
    27  E 000000FC         	LIVE_TIME_ADD_L		EQU	0XFC
    28  E 00000001         	DEFAULT_FRONT_TIME_DELAY	EQU	0X01
    29  E 00000001         	DEFAULT_TIME_GAP	EQU	0X01
    30  E 00000030         	TM_INITIAL_TIME_ADD_H	EQU 0X30
    31  E 00000000         	TM_INITIAL_TIME_ADD_L	EQU 0X00
    32  E 00000031         	TM_TIME_H		EQU	0X31
    33  E 00000000         	TM_TIME_L		EQU	0X00
    34  E 0000001F         	EE_DELAY_ADD_H	EQU	0X1F
    35  E 000000F8         	EE_GAP_ADD_L	EQU	0XF8
    36  E 0000001F         	EE_INITIAL_TIME_ADD_H	EQU	0X1F
    37  E 000000FA         	EE_INITIAL_TIME_ADD_L	EQU	0XFA
    38  E 00000001         	WRITE_FLAG_H	EQU 0X01
    39  E 00000000         	WRITE_FLAG_L	EQU	0X00
    40  E 00000002         	DEFAULT_GAP_TIME_FLAGH EQU 0X02
    41  E 00000000         	DEFAULT_GAP_TIME_FLAGL EQU	0X00
    42  000000             .DATA
    43  000000             			ORG	0H
    44  0000 D             	DELAYTIME1	DS	1
    45  0001 D             	DELAYTIME2	DS	1
    46  0002 D             	TIMEOUT		DS	1
    47  0003 D             	TLC0		DS	1
    48  0004 D             	TLC1		DS	1
    49  0005 D             	TLC2		DS	1
    50  0006 D             	FLAG1		DS	1
    51  0007 D             	FLAG2		DS	1
    52  0008 D             	TIMEH		DS	1
    53  0009 D             	TIMEG		DS	1
    54  000A D             	DATA_IN		DS	1
    55  000B D             	DATA_OUT	DS	1
    56  000C D             	DATAH		DS	1
    57  000D D             	DATAL		DS	1
    58  000E D             	ADDRESSH	DS	1
    59  000F D             	ADDRESSL	DS	1
    60  0010 D             	CRCT1		DS	1
    61  0011 D             	CRCT2		DS	1
    62  0012 D             	COUNT		DS	1
    63  0013 D             	MAC_H		DS	1
    64  0014 D             	MAC_L		DS	1
    65  0015 D             	FRONT_DELAY	DS	1
    66  0016 D             	TIME_DELAY_GAP	DS	1
    67  0017 D             	STARTADDRH		DS	1
    68  0018 D             	STARTADDRL		DS	1
    69  0019 D             	INITIAL_TIMEH	DS	1
    70  001A D             	INITIAL_TIMEL	DS	1
    71  00001B             ;**************BIT_VARIABLES_DEFINNITIONS*******
    72  E 00000006         	READTM_FLAG	EQU	FLAG1.0
    73  E 00030006         	TIME_FLAG	EQU	FLAG1.3
    74  E 00010006         	RESET_FLAG	EQU	FLAG1.1
    75  E 00020006         	TM_EE_FLAG	EQU FLAG1.2
    76  E 00040006         	DEFAULT_GAP_FLAG	EQU	FLAG1.4
    77  E 00050006         	FILLOUT_FLAG	EQU	FLAG1.5
    78  E 00060006         	I2CERROR_FLAG	EQU	FLAG1.6
    79  E 00070006         	ASK_FLAG	EQU	FLAG1.7
    80  E 00010007         	READ_LED_FLAG	EQU	FLAG2.1
    81  E 00020007         	NOT_UPLOAD_FLAG	EQU	FLAG2.2
    82  E 00030007         	HAVE_UPLOAD_FLAG EQU FLAG2.3
    83  E 00040007         	NOT_QUICK_MODE_FLAG EQU FLAG2.4
    84  E 00050007         	TM_I2C_EEROR	EQU FLAG2.5
    85  E 00060007         	BLE_FLAG		EQU FLAG2.6
    86  E 000200D2         	CLED_IO			EQU	P2.2
    87  E 000100D2         	SDATA_IO		EQU	P2.1
    88  E 000000D2         	SCL_IO			EQU	P2.0
    89  E 000300D2         	S_TM_EE_IO		EQU	P2.3
    90  E 000400D2         	BLEF	EQU	P2.4
    91  E 000500D2         	SDA_IO			EQU	P2.5
    92  E 000400D5         	VTM_IO			EQU	P5.4
    93  E 000000D0         	VSR_IO			EQU	P0.0
    94  E 000200C2         	CLED_CONT		EQU	P2M.2
    95  E 000100C2         	SDATA_CONT		EQU	P2M.1
    96  E 000000C2         	SCL_CONT		EQU	P2M.0
    97  E 000300C2         	S_TM_EE_CONT	EQU	P2M.3
    98  E 000500C2         	SDA_CONT		EQU	P2M.5
    99  E 000400C5         	VTM_CONT		EQU	P5M.4
   100  E 000000B8         	VSR_CONT		EQU	P0M.0
   101  00001B             ;***************************************
   102  E 000100D1         	VDDF			EQU	P1.1
   103  E 000000D1         	S_VDD_VCC_IO		EQU	P1.0
   104  E 000000C1         	S_VDD_VCC_CONT		EQU	P1M.0
   105  00001B             ;*************CODE_SECTION**********************	
   106  000000             .CODE
   107  000000             
   108  000000             		ORG	0
   109  000000   8030(2)  	JMP		START
   110  000008             		ORG	8H
   111  000008   8009(2)  	JMP		INT_SERVICE
   112  000009             INT_SERVICE:
   113  000009             ;KEEP ACC AND PFLAG
   114  000009   0400(1)  	PUSH
   115  00000A             ;T0 INTERRUPT
   116  00000A             JUST_T0:
   117  00000A   74C9(1+S)  	B0BTS0	FT0IEN
   118  00000B   7CC8(1+S)  	B0BTS1	FT0IRQ
   119  00000C   8025(2)  	JMP		JUST_TC0
   120  00000D   64C8(1)  	B0BCLR	FT0IRQ
   121  00000E             ;T0 INTERRUPT SERVISE PROGRESS
   122  00000E   71D1(1+S)  	B0BTS0	VDDF
   123  00000F   4A07(1)  	BSET 	NOT_UPLOAD_FLAG
   124  000010   71D1(1+S)  	B0BTS0	VDDF
   125  000011   4307(1)  	BCLR    HAVE_UPLOAD_FLAG
   126  000012             ;///////////////////////////////
   127  000012   5B07(1+S)  	BTS1	HAVE_UPLOAD_FLAG
   128  000013   8016(2)  	JMP		$+3
   129  000014   79D1(1+S)  	B0BTS1	VDDF
   130  000015   4C07(1)  	BSET	NOT_QUICK_MODE_FLAG
   131  000016   79D1(1+S)  	B0BTS1	VDDF
   132  000017   4B07(1)  	BSET    HAVE_UPLOAD_FLAG
   133  000018             ;//////////////////////////////////
   134  000018   1608(1+S)  	INCMS	TIMEH ;TIMEH=TIMEH+1,
   135  000019   2D78(1)  	MOV		A,#TIME_GAP
   136  00001A   0708(1+S)  	CMPRS	A,TIMEH
   137  00001B   802E(2)  	JMP		EXIT_INT
   138  00001C   2B08(1)  	CLR		TIMEH
   139  00001D   4B06(1)  	BSET	TIME_FLAG
   140  00001E   1609(1+S)  	INCMS	TIMEG
   141  00001F   1E16(1)  	MOV		A,TIME_DELAY_GAP
   142  000020   0709(1+S)  	CMPRS	A,TIMEG
   143  000021   802E(2)  	JMP		EXIT_INT
   144  000022   2B09(1)  	CLR		TIMEG
   145  000023   4806(1)  	BSET	READTM_FLAG
   146  000024   802E(2)  	JMP		EXIT_INT
   147  000025             JUST_TC0:
   148  000025   75C9(1+S)  	B0BTS0	FTC0IEN
   149  000026   7DC8(1+S)  	B0BTS1	FTC0IRQ
   150  000027   802A(2)  	JMP		JUST_INT0
   151  000028   65C8(1)  	B0BCLR	FTC0IRQ
   152  000029             ;TC0 INTERRUPT SERVICE PROGRESS
   153  000029   802E(2)  	JMP		EXIT_INT
   154  00002A             JUST_INT0:
   155  00002A   70C9(1+S)  	B0BTS0	FP00IEN
   156  00002B   78C8(1+S)  	B0BTS1	FP00IRQ
   157  00002C   802E(2)  	JMP EXIT_INT
   158  00002D   60C8(1)  	B0BCLR	FP00IRQ
   159  00002E             ;INT0 INTERRUPT SERVISE PROGRESS
   160  00002E             EXIT_INT:
   161  00002E   0500(1)  	POP
   162  00002F   0F00(2)  	RETI
   163  000030             ;*********************************************************
   164  000030             ;***********************STARRT**********************
   165  000030             START:
   166  000030   2D7F(1)  	MOV		A,#07FH
   167  000031   2FDF(1)  	B0MOV		STKP,A		;DISABLE GLOBAL INTERRUPT
   168  000032   2B86(1)  	CLR		PFLAG
   169  000033   2D00(1)  	MOV		A,#00H
   170  000034   2FCA(1)  	B0MOV		OSCM,A
   171  000035   2D5A(1)  	MOV		A,#0X5A
   172  000036   2FCC(1)  	B0MOV		WDTR,A	
   173  000037   C182(2)  	CALL		CLRRAM
   174  000038             STATE_INITIAL:
   175  000038   C32B(2)  	CALL		SYS_INIT_FUN
   176  000039   67DF(1)  	B0BCLR		FGIE
   177  00003A             ;******************************************
   178  00003A   2D01(1)  	MOV		A,#DEFAULT_FRONT_TIME_DELAY
   179  00003B   1F15(1)  	MOV		FRONT_DELAY,A
   180  00003C   2D01(1)  	MOV		A,#DEFAULT_TIME_GAP
   181  00003D   1F16(1)  	MOV		TIME_DELAY_GAP,A
   182  00003E             ;////////////////////////////////
   183  00003E   5607(1+S)  	BTS0		BLE_FLAG
   184  00003F   805C(2)  	JMP			GET_INITIAL_DATA_FROM_EE
   185  000040             GET_TIME_INITIAL_TM:
   186  000040   6BD2(1)  	B0BSET	S_TM_EE_IO
   187  000041             ;Get initial time from tm
   188  000041   2D30(1)  	MOV		A,#TM_INITIAL_TIME_ADD_H
   189  000042   1F13(1)  	MOV		MAC_H,A
   190  000043   2D00(1)  	MOV		A,#TM_INITIAL_TIME_ADD_L
   191  000044   1F14(1)  	MOV		MAC_L,A
   192  000045   C1ED(2)  	CALL	GET_DATA_FROM_TM_FUN
   193  000046   1E0C(1)  	MOV		A,DATAH
   194  000047   0600(1+S)  	CMPRS	A,#0X00
   195  000048   1F19(1)  	MOV		INITIAL_TIMEH,A
   196  000049   1E0D(1)  	MOV		A,DATAL
   197  00004A   0600(1+S)  	CMPRS	A,#0X00
   198  00004B   1F1A(1)  	MOV		INITIAL_TIMEL,A
   199  00004C   C307(2)  	CALL	DELAY_SHORT
   200  00004D             ;GET TIME DELAY AND GAP FROM TM
   201  00004D   2D31(1)  	MOV		A,#TM_TIME_H
   202  00004E   1F13(1)  	MOV		MAC_H,A
   203  00004F   2D00(1)  	MOV		A,#TM_TIME_L
   204  000050   1F14(1)  	MOV		MAC_L,A
   205  000051   C1ED(2)  	CALL	GET_DATA_FROM_TM_FUN
   206  000052             ;the 2bit in front of DATAH is useness
   207  000052   2D3F(1)  	MOV		A,#0X3F
   208  000053   290C(1)  	AND		DATAH,A
   209  000054   1E0C(1)  	MOV			A,DATAH
   210  000055   0600(1+S)  	CMPRS		A,#0X00
   211  000056   1F15(1)  	MOV			FRONT_DELAY,A
   212  000057   1E0D(1)  	MOV			A,DATAL
   213  000058   0600(1+S)  	CMPRS		A,#0X00
   214  000059   1F16(1)  	MOV			TIME_DELAY_GAP,A		
   215  00005A   63D2(1)  	B0BCLR		S_TM_EE_IO
   216  00005B   C30D(2)  	CALL		DELAY_LONG
   217  00005C             ;*******************************************
   218  00005C             GET_INITIAL_DATA_FROM_EE:
   219  00005C             ;*******************************************
   220  00005C   2D1F(1)  	MOV			A,#LAST_TIME_EE_ADD_H
   221  00005D   1F13(1)  	MOV			MAC_H,A
   222  00005E   2DFE(1)  	MOV			A,#LAST_TIME_EE_ADD_L
   223  00005F   1F14(1)  	MOV			MAC_L,A
   224  000060   5106(1+S)  	BTS0		RESET_FLAG
   225  000061   80C5(2)  	JMP			RESET_EEPROM
   226  000062   C23B(2)  	CALL		GET_DATA_FROM_EE_FUN
   227  000063   1E0F(1)  	MOV			A,ADDRESSL
   228  000064   1F18(1)  	MOV			STARTADDRL,A
   229  000065   1E0E(1)  	MOV			A,ADDRESSH
   230  000066   1F17(1)  	MOV			STARTADDRH,A
   231  000067   1E0E(1)  	MOV			A,ADDRESSH
   232  000068   06FF(1+S)  	CMPRS		A,#0XFF
   233  000069   806C(2)  	JMP			$+3
   234  00006A   2B17(1)  	CLR			STARTADDRH
   235  00006B   2B18(1)  	CLR			STARTADDRL
   236  00006C   C30D(2)  	CALL		DELAY_LONG
   237  00006D   2D1F(1)  	MOV			A,#LIVE_TIME_ADD_H
   238  00006E   1F13(1)  	MOV			MAC_H,A
   239  00006F   2DFC(1)  	MOV			A,#LIVE_TIME_ADD_L
   240  000070   1F14(1)  	MOV			MAC_L,A
   241  000071   C23B(2)  	CALL		GET_DATA_FROM_EE_FUN
   242  000072             ;;;;;;;;;;;;;;LAST READ TM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   243  000072   6BD2(1)  	B0BSET		S_TM_EE_IO
   244  000073   60D0(1)  	B0BCLR		VSR_IO
   245  000074   2D34(1)  	MOV			A,#TM_DATA_H
   246  000075   1F13(1)  	MOV			MAC_H,A
   247  000076   2D00(1)  	MOV			A,#TM_DATA_L
   248  000077   1F14(1)  	MOV			MAC_L,A
   249  000078   C1ED(2)  	CALL		GET_DATA_FROM_TM_FUN
   250  000079             ;	B0BCLR		VTM_IO
   251  000079   C307(2)  	CALL		DELAY_SHORT
   252  00007A   63D2(1)  	B0BCLR		S_TM_EE_IO
   253  00007B             ;	B0BCLR		VTM_CONT
   254  00007B             ;////////////////////READ BLE INITIAL TIME /////////////////
   255  00007B   5E07(1+S)  	BTS1		BLE_FLAG
   256  00007C   80AA(2)  	JMP			WRITE_INITIAL_DATA_TO_EE
   257  00007D             GET_INITIAL_TIME_FROM_EE:
   258  00007D   C307(2)  	CALL		DELAY_SHORT
   259  00007E   2D1F(1)  	MOV		A,#EE_INITIAL_TIME_ADD_H
   260  00007F   1F13(1)  	MOV		MAC_H,A
   261  000080   2DFA(1)  	MOV		A,#EE_INITIAL_TIME_ADD_L
   262  000081   1F14(1)  	MOV		MAC_L,A
   263  000082   C23B(2)  	CALL		GET_DATA_FROM_EE_FUN
   264  000083   1E0E(1)  	MOV		A,ADDRESSH
   265  000084   1F19(1)  	MOV		INITIAL_TIMEH,A
   266  000085   1E0F(1)  	MOV		A,ADDRESSL
   267  000086   1F1A(1)  	MOV		INITIAL_TIMEL,A
   268  000087   C30D(2)  	CALL	DELAY_LONG
   269  000088   2D1F(1)  	MOV		A,#EE_DELAY_ADD_H
   270  000089   1F13(1)  	MOV		MAC_H,A
   271  00008A   2DF8(1)  	MOV		A,#EE_GAP_ADD_L
   272  00008B   1F14(1)  	MOV		MAC_L,A
   273  00008C   C23B(2)  	CALL		GET_DATA_FROM_EE_FUN
   274  00008D   1E0E(1)  	MOV		A,ADDRESSH
   275  00008E   1F15(1)  	MOV		FRONT_DELAY,A
   276  00008F   1E0F(1)  	MOV		A,ADDRESSL
   277  000090   1F16(1)  	MOV		TIME_DELAY_GAP,A
   278  000091   C30D(2)  	CALL	DELAY_LONG
   279  000092             ;/////////////////WRITE TO TM//////////////////////////////
   280  000092             WRITE_INITIAL_DATA_TO_TM:
   281  000092   6BD2(1)  	B0BSET	S_TM_EE_IO
   282  000093             ;PUT initial time TO tm
   283  000093   2D30(1)  	MOV		A,#TM_INITIAL_TIME_ADD_H
   284  000094   1F13(1)  	MOV		MAC_H,A
   285  000095   2D00(1)  	MOV		A,#TM_INITIAL_TIME_ADD_L
   286  000096   1F14(1)  	MOV		MAC_L,A
   287  000097   1E19(1)  	MOV		A,INITIAL_TIMEH
   288  000098   1F0C(1)  	MOV		DATAH,A
   289  000099   1E1A(1)  	MOV		A,INITIAL_TIMEL
   290  00009A   1F0D(1)  	MOV		DATAL,A
   291  00009B   C1AD(2)  	CALL	PUT_DATA_INTO_TM_FUN
   292  00009C             ;PUT TIME DELAY AND GAP TO TM
   293  00009C   2D31(1)  	MOV		A,#TM_TIME_H
   294  00009D   1F13(1)  	MOV		MAC_H,A
   295  00009E   2D00(1)  	MOV		A,#TM_TIME_L
   296  00009F   1F14(1)  	MOV		MAC_L,A
   297  0000A0             ;the 2bit in front of DATAH is useness
   298  0000A0   2D3F(1)  	MOV		A,#0X3F
   299  0000A1   2815(1)  	AND		A,FRONT_DELAY
   300  0000A2   1F0C(1)  	MOV		DATAH,A
   301  0000A3   1E16(1)  	MOV		A,TIME_DELAY_GAP
   302  0000A4   1F0D(1)  	MOV		DATAL,A	
   303  0000A5   C1AD(2)  	CALL	PUT_DATA_INTO_TM_FUN
   304  0000A6             ;the 2bit in front of DATAH is useness
   305  0000A6   63D2(1)  	B0BCLR		S_TM_EE_IO
   306  0000A7   C30D(2)  	CALL		DELAY_LONG
   307  0000A8             ;///////////////////////////////
   308  0000A8   5607(1+S)  	BTS0	BLE_FLAG
   309  0000A9   80BF(2)  	JMP		SET_WRITE_EE_START_ADD
   310  0000AA             ;/////////////////WRITE TO EE//////////////////////////////
   311  0000AA             WRITE_INITIAL_DATA_TO_EE:
   312  0000AA             ;///////////INITIAL TIME/////////////////////
   313  0000AA   C307(2)  	CALL		DELAY_SHORT
   314  0000AB   2D1F(1)  	MOV		A,#EE_INITIAL_TIME_ADD_H
   315  0000AC   1F13(1)  	MOV		MAC_H,A
   316  0000AD   2DFA(1)  	MOV		A,#EE_INITIAL_TIME_ADD_L
   317  0000AE   1F14(1)  	MOV		MAC_L,A
   318  0000AF   1E19(1)  	MOV		A,INITIAL_TIMEH
   319  0000B0   1F0C(1)  	MOV		DATAH,A
   320  0000B1   1E1A(1)  	MOV		A,INITIAL_TIMEL
   321  0000B2   1F0D(1)  	MOV		DATAL,A
   322  0000B3   C18A(2)  	CALL		DATA_TO_EEPROM_FUN
   323  0000B4   C30D(2)  	CALL	DELAY_LONG
   324  0000B5   2D1F(1)  	MOV		A,#EE_DELAY_ADD_H
   325  0000B6   1F13(1)  	MOV		MAC_H,A
   326  0000B7   2DF8(1)  	MOV		A,#EE_GAP_ADD_L
   327  0000B8   1F14(1)  	MOV		MAC_L,A
   328  0000B9   1E15(1)  	MOV		A,FRONT_DELAY
   329  0000BA   1F0C(1)  	MOV		DATAH,A
   330  0000BB   1E16(1)  	MOV		A,TIME_DELAY_GAP
   331  0000BC   1F0D(1)  	MOV		DATAL,A
   332  0000BD   C18A(2)  	CALL		DATA_TO_EEPROM_FUN
   333  0000BE   C30D(2)  	CALL	DELAY_LONG
   334  0000BF             
   335  0000BF             
   336  0000BF             SET_WRITE_EE_START_ADD:
   337  0000BF   1E17(1)  	MOV			A,STARTADDRH
   338  0000C0   1F0E(1)  	MOV			ADDRESSH,A
   339  0000C1   1E18(1)  	MOV			A,STARTADDRL
   340  0000C2   1F0F(1)  	MOV			ADDRESSL,A
   341  0000C3             	
   342  0000C3   5906(1+S)  	BTS1		RESET_FLAG
   343  0000C4   80E5(2)  	JMP			FRONT_DELAY_MODE
   344  0000C5             RESET_EEPROM:
   345  0000C5   2DFF(1)  	MOV		A,#0XFF
   346  0000C6   1F0C(1)  	MOV		DATAH,A
   347  0000C7   2DFF(1)  	MOV		A,#0XFF
   348  0000C8   1F0D(1)  	MOV		DATAL,A
   349  0000C9   2D00(1)  	MOV		A,#0X00
   350  0000CA   1F13(1)  	MOV		MAC_H,A
   351  0000CB             RESET_EE_LOOP_H:
   352  0000CB   2D00(1)  	MOV		A,#0X00
   353  0000CC   1F14(1)  	MOV		MAC_L,A
   354  0000CD             RESET_EE_LOOP_L:
   355  0000CD   C18A(2)  	CALL		DATA_TO_EEPROM_FUN
   356  0000CE   1614(1+S)  	INCMS	MAC_L
   357  0000CF   80CD(2)  	JMP		RESET_EE_LOOP_L
   358  0000D0   1613(1+S)  	INCMS	MAC_H
   359  0000D1   1E13(1)  	MOV		A,MAC_H
   360  0000D2   0620(1+S)  	CMPRS	A,#0X20
   361  0000D3   80CB(2)  	JMP		RESET_EE_LOOP_H
   362  0000D4   2B0F(1)  	CLR		ADDRESSL
   363  0000D5   2B0E(1)  	CLR		ADDRESSH
   364  0000D6   2D1F(1)  	MOV		A,#LAST_TIME_EE_ADD_H
   365  0000D7   1F13(1)  	MOV		MAC_H,A
   366  0000D8   2DFE(1)  	MOV		A,#LAST_TIME_EE_ADD_L
   367  0000D9   1F14(1)  	MOV		MAC_L,A
   368  0000DA   1E0E(1)  	MOV		A,ADDRESSH
   369  0000DB   1F0C(1)  	MOV		DATAH,A
   370  0000DC   1E0F(1)  	MOV		A,ADDRESSL
   371  0000DD   1F0D(1)  	MOV		DATAL,A
   372  0000DE   C18A(2)  	CALL		DATA_TO_EEPROM_FUN
   373  0000DF   2D1F(1)  	MOV			A,#LIVE_TIME_ADD_H
   374  0000E0   1F13(1)  	MOV			MAC_H,A
   375  0000E1   2DFC(1)  	MOV			A,#LIVE_TIME_ADD_L
   376  0000E2   1F14(1)  	MOV			MAC_L,A
   377  0000E3   C18A(2)  	CALL		DATA_TO_EEPROM_FUN
   378  0000E4   4106(1)  	BCLR		RESET_FLAG
   379  0000E5             ;******************************************
   380  0000E5             FRONT_DELAY_MODE:
   381  0000E5   6FDF(1)  	B0BSET		FGIE
   382  0000E6   C360(2)  	CALL		SET_LOW_POWER_FUN
   383  0000E7             ;DELAY WAIT_FOR_SEAVAL_MINITE_FUN
   384  0000E7             ;/////////////////////////////////////////	
   385  0000E7   1E15(1)  	MOV   	A,FRONT_DELAY
   386  0000E8   1F10(1)  	MOV		CRCT1,A
   387  0000E9             FRONT_DELAY_LOOP:
   388  0000E9             	GreenMode
   389  0000E9   6CCA(1)  		B0BSET	FCPUM1
   390  0000EA   0000(1)  		NOP
   391  0000EB   0000(1)  		NOP
   392  0000EC   5407(1+S)  	BTS0	NOT_QUICK_MODE_FLAG
   393  0000ED   C358(2)  	CALL	SET_EE_TM_FUN
   394  0000EE   5207(1+S)  	BTS0	NOT_UPLOAD_FLAG
   395  0000EF   C360(2)  	CALL	SET_LOW_POWER_FUN
   396  0000F0   5B06(1+S)  	BTS1	TIME_FLAG
   397  0000F1   80E9(2)  	JMP		FRONT_DELAY_LOOP
   398  0000F2   4306(1)  	BCLR	TIME_FLAG
   399  0000F3   2610(1+S)  	DECMS	CRCT1
   400  0000F4   80E9(2)  	JMP		FRONT_DELAY_LOOP
   401  0000F5             	;///////////////////////////
   402  0000F5   4207(1)  	BCLR		NOT_UPLOAD_FLAG
   403  0000F6   4307(1)  	BCLR		HAVE_UPLOAD_FLAG
   404  0000F7   4607(1)  	BCLR		BLE_FLAG
   405  0000F8             ;//////////////////////////////////////
   406  0000F8             MAIN:
   407  0000F8             	;close tc0 interrupt until the recording finished 
   408  0000F8             	GreenMode
   409  0000F8   6CCA(1)  		B0BSET	FCPUM1
   410  0000F9   0000(1)  		NOP
   411  0000FA   0000(1)  		NOP
   412  0000FB             	
   413  0000FB             JUST_I2CSLAVE_MODE:
   414  0000FB   5806(1+S)  	BTS1	READTM_FLAG
   415  0000FC   8140(2)  	JMP		JUST_UPLOAD_MODE
   416  0000FD   5506(1+S)  	BTS0	FILLOUT_FLAG
   417  0000FE   815E(2)  	JMP		MEM_FILLOUT_MODE
   418  0000FF   7CC9(1+S)  	B0BTS1	FT0IEN
   419  000100   8140(2)  	JMP		JUST_UPLOAD_MODE
   420  000101             ;*****START TM I2C SLAVE MODE***********
   421  000101             I2CSLAVE_MODE:
   422  000101   4006(1)  	BCLR 	READTM_FLAG
   423  000102   59D1(1+S)  	BTS1	VDDF
   424  000103   8132(2)  	JMP		ADDRESS_CHANGE
   425  000104   5CD2(1+S)  	BTS1	BLEF
   426  000105   8132(2)  	JMP		ADDRESS_CHANGE
   427  000106   4607(1)  	BCLR	BLE_FLAG
   428  000107   67DF(1)  	B0BCLR 	FGIE
   429  000108             ;	B0BSET	VTM_CONT
   430  000108   6BD2(1)  	B0BSET	S_TM_EE_IO
   431  000109   60D0(1)  	B0BCLR	VSR_IO
   432  00010A   2D34(1)  	MOV		A,#TM_DATA_H
   433  00010B   1F13(1)  	MOV		MAC_H,A
   434  00010C   2D00(1)  	MOV		A,#TM_DATA_L
   435  00010D   1F14(1)  	MOV		MAC_L,A
   436  00010E   C1ED(2)  	CALL	GET_DATA_FROM_TM_FUN
   437  00010F             ;	B0BCLR		VTM_IO
   438  00010F   C307(2)  	CALL		DELAY_SHORT
   439  000110   63D2(1)  	B0BCLR		S_TM_EE_IO
   440  000111             ;	B0BCLR		VTM_CONT
   441  000111   C307(2)  	CALL		DELAY_SHORT
   442  000112             ;***************************************
   443  000112             ;***************************************
   444  000112             ;***************************************
   445  000112   6BD2(1)      B0BSET	S_TM_EE_IO
   446  000113   C364(2)  	CALL	TM_I2C_EXIST_FUN
   447  000114   63D2(1)  	B0BCLR	S_TM_EE_IO
   448  000115             ;****************************************
   449  000115             ;***************************************
   450  000115             ;***************************************
   451  000115   1E0E(1)  	MOV		A,ADDRESSH
   452  000116   1F13(1)  	MOV		MAC_H,A
   453  000117   1E0F(1)  	MOV		A,ADDRESSL
   454  000118   1F14(1)  	MOV		MAC_L,A
   455  000119   C18A(2)  	CALL		DATA_TO_EEPROM_FUN
   456  00011A   2D1F(1)  	MOV		A,#LAST_TIME_EE_ADD_H
   457  00011B   1F13(1)  	MOV		MAC_H,A
   458  00011C   2DFE(1)  	MOV		A,#LAST_TIME_EE_ADD_L
   459  00011D   1F14(1)  	MOV		MAC_L,A
   460  00011E   1E0E(1)  	MOV		A,ADDRESSH
   461  00011F   1F0C(1)  	MOV		DATAH,A
   462  000120   1E0F(1)  	MOV		A,ADDRESSL
   463  000121   1F0D(1)  	MOV		DATAL,A
   464  000122   C18A(2)  	CALL		DATA_TO_EEPROM_FUN
   465  000123   74C8(1+S)  	B0BTS0		FT0IRQ
   466  000124   1608(1+S)  	INCMS		TIMEH
   467  000125   64C8(1)  	B0BCLR		FT0IRQ
   468  000126   6FDF(1)  	B0BSET		FGIE
   469  000127   2D78(1)  	MOV			A,#TIME_GAP
   470  000128   0708(1+S)  	CMPRS		A,TIMEH
   471  000129   8132(2)  	JMP			ADDRESS_CHANGE
   472  00012A   2B08(1)  	CLR			TIMEH
   473  00012B   4B06(1)  	BSET		TIME_FLAG
   474  00012C   1609(1+S)  	INCMS		TIMEG
   475  00012D   1E16(1)  	MOV			A,TIME_DELAY_GAP
   476  00012E   0709(1+S)  	CMPRS		A,TIMEG
   477  00012F   8132(2)  	JMP			ADDRESS_CHANGE
   478  000130   2B09(1)  	CLR			TIMEG
   479  000131   4806(1)  	BSET		READTM_FLAG
   480  000132             ADDRESS_CHANGE:
   481  000132   2D02(1)  	MOV			A,#0X02
   482  000133   130F(1)  	ADD			ADDRESSL,A
   483  000134   2D00(1)  	MOV			A,#0X00
   484  000135   110E(1)  	ADC			ADDRESSH,A
   485  000136   2D1F(1)  	MOV			A,#MAX_MEMH
   486  000137   070E(1+S)  	CMPRS		A,ADDRESSH
   487  000138   80FB(2)  	JMP			JUST_I2CSLAVE_MODE
   488  000139   2DDE(1)  	MOV			A,#MAX_MEML
   489  00013A   070F(1+S)  	CMPRS		A,ADDRESSL
   490  00013B   80FB(2)  	JMP			JUST_I2CSLAVE_MODE
   491  00013C   4D06(1)  	BSET		FILLOUT_FLAG
   492  00013D   67D8(1)  	B0BCLR		FT0ENB
   493  00013E   64C9(1)  	B0BCLR		FT0IEN
   494  00013F   815E(2)  	JMP			MEM_FILLOUT_MODE
   495  000140             ;*****************************************
   496  000140             JUST_UPLOAD_MODE:
   497  000140   62C2(1)  	B0BCLR		CLED_CONT
   498  000141   C307(2)  	CALL		DELAY_SHORT
   499  000142   C307(2)  	CALL		DELAY_SHORT
   500  000143   7AD2(1+S)  	B0BTS1		CLED_IO
   501  000144   8174(2)  	JMP			RESET_MODE
   502  000145             BLE_EE_UPLOAD_MODE:
   503  000145   5607(1+S)  	BTS0		BLE_FLAG
   504  000146   814C(2)  	JMP			END_BLE_EE_MODE
   505  000147   54D2(1+S)  	BTS0		BLEF
   506  000148   8150(2)  	JMP			TM_EE_UPLOAD_MODE
   507  000149   4E07(1)  	BSET		BLE_FLAG
   508  00014A   C360(2)  	CALL		SET_LOW_POWER_FUN
   509  00014B   815E(2)  	JMP			MEM_FILLOUT_MODE
   510  00014C             END_BLE_EE_MODE:
   511  00014C   5CD2(1+S)  	BTS1		BLEF
   512  00014D   815E(2)  	JMP			MEM_FILLOUT_MODE
   513  00014E   C360(2)  	CALL		SET_LOW_POWER_FUN
   514  00014F   4607(1)  	BCLR		BLE_FLAG
   515  000150             TM_EE_UPLOAD_MODE:
   516  000150   5206(1+S)  	BTS0		TM_EE_FLAG
   517  000151   8158(2)  	JMP			END_TM_EE_MODE
   518  000152   51D1(1+S)  	BTS0		VDDF
   519  000153   815E(2)  	JMP			MEM_FILLOUT_MODE
   520  000154             TM_EE_MODE:
   521  000154   4307(1)  	BCLR		HAVE_UPLOAD_FLAG
   522  000155   5206(1+S)  	BTS0		TM_EE_FLAG
   523  000156   8158(2)  	JMP			END_TM_EE_MODE
   524  000157   C358(2)  	CALL		SET_EE_TM_FUN
   525  000158             END_TM_EE_MODE:
   526  000158             	;BTS0		FILLOUT_FLAG
   527  000158             	;JMP			MEM_FILLOUT_MODE	
   528  000158   59D1(1+S)  	BTS1		VDDF
   529  000159   815E(2)  	JMP			MEM_FILLOUT_MODE
   530  00015A   C360(2)  	CALL		SET_LOW_POWER_FUN
   531  00015B   5506(1+S)  	BTS0		FILLOUT_FLAG
   532  00015C   815E(2)  	JMP			MEM_FILLOUT_MODE
   533  00015D             	;we should keep rtc function 
   534  00015D   816B(2)  	JMP		ON_LED_MODE
   535  00015E             ;*************************************
   536  00015E             MEM_FILLOUT_MODE:
   537  00015E   5D06(1+S)  	BTS1	FILLOUT_FLAG
   538  00015F   816B(2)  	JMP		ON_LED_MODE
   539  000160             ;***************************
   540  000160             	;B0BTS1	VDDF
   541  000160             	;JMP		$+4
   542  000160             	;BTS0	TM_EE_FLAG
   543  000160             	;CALL	SET_LOW_POWER_FUN
   544  000160             	;JMP		$+3
   545  000160             	;BTS1	TM_EE_FLAG
   546  000160             	;CALL	SET_EE_TM_FUN
   547  000160             ;********************************
   548  000160   7FD8(1+S)  	B0BTS1		FT0ENB
   549  000161   8165(2)  	JMP			$+4
   550  000162   2BD9(1)  	CLR			T0C
   551  000163   64C8(1)  	B0BCLR		FT0IRQ
   552  000164   64C9(1)  	B0BCLR		FT0IEN
   553  000165   67D8(1)  	B0BCLR		FT0ENB
   554  000166             	SleepMode
   555  000166   6BCA(1)  		B0BSET	FCPUM0
   556  000167             END_FILLOUT_MODE:
   557  000167   6AC2(1)  	B0BSET		CLED_CONT
   558  000168   6AD2(1)  	B0BSET		CLED_IO
   559  000169   C302(2)  	CALL		DELAY_MINI
   560  00016A   8140(2)  	JMP		JUST_UPLOAD_MODE
   561  00016B             ON_LED_MODE:
   562  00016B   6AC2(1)  	B0BSET	CLED_CONT
   563  00016C   6AD2(1)  	B0BSET	CLED_IO
   564  00016D   5107(1+S)  	BTS0	READ_LED_FLAG
   565  00016E   C179(2)  	CALL	READ_LED_FUN
   566  00016F   4107(1)  	BCLR   	READ_LED_FLAG
   567  000170   6AD2(1)  	B0BSET	CLED_IO
   568  000171   5506(1+S)  	BTS0	FILLOUT_FLAG
   569  000172   8140(2)  	JMP		JUST_UPLOAD_MODE
   570  000173   80F8(2)  	JMP		MAIN
   571  000174             RESET_MODE:
   572  000174   4906(1)  	BSET	RESET_FLAG
   573  000175   4506(1)  	BCLR	FILLOUT_FLAG
   574  000176   2B08(1)  	CLR		TIMEH
   575  000177   2B09(1)  	CLR		TIMEG
   576  000178   8038(2)  	JMP		STATE_INITIAL
   577  000179             	
   578  000179             ;******************************************************************************	
   579  000179             READ_LED_FUN:
   580  000179   2D01(1)     	MOV  	   	A,#1
   581  00017A   1F05(1)     	MOV  	   	TLC2,A
   582  00017B             LED_MODEL1:	
   583  00017B   6AD2(1)     	B0BSET   	CLED_IO
   584  00017C   C317(2)     	CALL   	   	DELAY_LED
   585  00017D   62D2(1)     	B0BCLR   	CLED_IO
   586  00017E   C317(2)     	CALL   	   	DELAY_LED
   587  00017F   2605(1+S)     	DECMS   	TLC2
   588  000180   817B(2)     	JMP   	   	LED_MODEL1
   589  000181   0E00(2)     	RET
   590  000182             ;*******************************************************
   591  000182             ;***************************************
   592  000182             	
   593  000182             	
   594  000182             	
   595  000182             	
   596  000182             	
   597  000182             	
   598  000182             	
   599  000182             	
   600  000182             	
   601  000182             	
   602  000182             	
   603  000182             	
   604  000182             	
   605  000182             	
   606  000182             	
   607  000182             	
   608  000182             CLRRAM:
   609  000182             	
   610  000182   2B84(1)  	CLR			Y
   611  000183   2D2F(1)  	MOV			A,#END_RAM_ADDR
   612  000184   2F83(1)  	B0MOV		Z,A
   613  000185             CLRRAM10:
   614  000185   2BE7(1)  	CLR			@YZ
   615  000186   2683(1+S)  	DECMS		Z
   616  000187   8185(2)  	JMP			CLRRAM10
   617  000188   2BE7(1)  	CLR			@YZ
   618  000189   0E00(2)  	RET
   619  00018A             ;***********************************
   620  00018A             ;***************************************
   621  00018A             ;*************WRITE TMEPERATURE INTO EEPROM*************
   622  00018A             ;*************RECORDING ADDRESS THE LAST TIME STORAGE THE TMPERATURE VALUE************
   623  00018A             ;**************************************
   624  00018A             DATA_TO_EEPROM_FUN:
   625  00018A   6DC2(1)  	B0BSET		SDA_CONT
   626  00018B   6DD2(1)  	B0BSET		SDA_IO
   627  00018C   68C2(1)  	B0BSET		SCL_CONT
   628  00018D   68D2(1)  	B0BSET		SCL_IO
   629  00018E   1E14(1)  	MOV			A,MAC_L
   630  00018F   1F11(1)  	MOV			CRCT2,A
   631  000190   1E0C(1)  	MOV			A,DATAH
   632  000191   1F10(1)  	MOV			CRCT1,A
   633  000192   2D02(1)  	MOV			A,#0X02
   634  000193   1F05(1)  	MOV			TLC2,A
   635  000194             MOVE_DATA_TO_EEPROM:
   636  000194   C267(2)  	CALL		I2C_START_EE
   637  000195   2DA0(1)  	MOV			A,#EEW_ADD
   638  000196   1F0A(1)  	MOV			DATA_IN,A
   639  000197   C2CB(2)  	CALL		EEADDRESS_ASK
   640  000198   1E13(1)  	MOV			A,MAC_H
   641  000199   1F0A(1)  	MOV			DATA_IN,A
   642  00019A   C2CB(2)  	CALL		EEADDRESS_ASK
   643  00019B   1E11(1)  	MOV			A,CRCT2
   644  00019C   1F0A(1)  	MOV			DATA_IN,A
   645  00019D   C2CB(2)  	CALL		EEADDRESS_ASK
   646  00019E   C302(2)  	CALL		DELAY_MINI
   647  00019F   1E10(1)  	MOV			A,CRCT1
   648  0001A0   1F0A(1)  	MOV			DATA_IN,A
   649  0001A1   C2CB(2)  	CALL		EEADDRESS_ASK
   650  0001A2   C26D(2)  	CALL		I2C_END_EE
   651  0001A3             	
   652  0001A3   C30D(2)  	CALL		DELAY_LONG
   653  0001A4   2D01(1)  	MOV			A,#0X01
   654  0001A5   1311(1)  	ADD			CRCT2,A
   655  0001A6   1E0D(1)  	MOV			A,DATAL
   656  0001A7   1F10(1)  	MOV			CRCT1,A
   657  0001A8   2605(1+S)  	DECMS		TLC2
   658  0001A9   8194(2)  	JMP			MOVE_DATA_TO_EEPROM
   659  0001AA             ;*********************************************
   660  0001AA   60C2(1)  	B0BCLR		SCL_CONT
   661  0001AB   65C2(1)  	B0BCLR		SDA_CONT
   662  0001AC   0E00(2)  	RET
   663  0001AD             ;**************************************
   664  0001AD             PUT_DATA_INTO_TM_FUN:
   665  0001AD   68C2(1)  	B0BSET	SCL_CONT
   666  0001AE   69C2(1)  	B0BSET	SDATA_CONT
   667  0001AF   61D2(1)  	B0BCLR	SDATA_IO
   668  0001B0   60D2(1)  	B0BCLR	SCL_IO
   669  0001B1   C30D(2)  	CALL 	DELAY_LONG
   670  0001B2   C30D(2)  	CALL 	DELAY_LONG
   671  0001B3             ;	B0BSET 	VTM_IO
   672  0001B3   C30D(2)  	CALL 	DELAY_LONG
   673  0001B4             	;CALL	DELAY_LONG
   674  0001B4             START_TMI2C_S:
   675  0001B4   2D04(1)  	MOV 	A,#0X04
   676  0001B5   1F03(1)  	MOV 	TLC0,A
   677  0001B6             LOOP_1_S:
   678  0001B6   68D2(1)  	B0BSET 	SCL_IO
   679  0001B7   C302(2)  	CALL	DELAY_MINI;13US
   680  0001B8   C301(2)  	CALL	CALL_DELAY
   681  0001B9   60D2(1)  	B0BCLR 	SCL_IO
   682  0001BA   C302(2)  	CALL 	DELAY_MINI
   683  0001BB   2603(1+S)  	DECMS  	TLC0
   684  0001BC   81B6(2)  	JMP 	LOOP_1_S
   685  0001BD   41D2(1)  	BCLR 	SDATA_IO
   686  0001BE   C30D(2)  	CALL	DELAY_LONG
   687  0001BF   C30D(2)  	CALL	DELAY_LONG
   688  0001C0   2D04(1)  	MOV 	A,#4
   689  0001C1   2F03(1)  	B0MOV 	TLC0,A
   690  0001C2             LOOP_2_S:
   691  0001C2   60D2(1)  	B0BCLR 	SCL_IO
   692  0001C3   C302(2)  	CALL	DELAY_MINI
   693  0001C4   C301(2)  	CALL	CALL_DELAY
   694  0001C5   68D2(1)  	B0BSET 	SCL_IO
   695  0001C6   C302(2)  	CALL	DELAY_MINI
   696  0001C7   2603(1+S)  	DECMS 	TLC0
   697  0001C8   81C2(2)  	JMP 	LOOP_2_S
   698  0001C9   C307(2)  	CALL	DELAY_SHORT
   699  0001CA   2D14(1)  	MOV 	A,#20
   700  0001CB   2F03(1)  	B0MOV 	TLC0,A
   701  0001CC   49D2(1)  	BSET 	SDATA_IO
   702  0001CD             WAIT_TM_INIT_S:
   703  0001CD   C30D(2)  	CALL 		DELAY_LONG
   704  0001CE   2603(1+S)  	DECMS 		TLC0
   705  0001CF   81CD(2)  	JMP 		WAIT_TM_INIT_S
   706  0001D0             ;**************START*****************************
   707  0001D0   C274(2)  	CALL		I2C_START_TM
   708  0001D1             ;***********************************************
   709  0001D1   2D3C(1)  	MOV 		A,#TMW_ADD
   710  0001D2   1F0A(1)  	MOV 		DATA_IN,A
   711  0001D3   C282(2)  	CALL 		TMADDRESS_ASK
   712  0001D4   5507(1+S)  	BTS0		TM_I2C_EEROR
   713  0001D5   81E8(2)  	JMP			END_TM_S
   714  0001D6   1E13(1)  	MOV 		A,MAC_H
   715  0001D7   1F0A(1)  	MOV 		DATA_IN,A
   716  0001D8   C282(2)  	CALL 		TMADDRESS_ASK
   717  0001D9   1E14(1)  	MOV 		A,MAC_L
   718  0001DA   1F0A(1)  	MOV 		DATA_IN,A
   719  0001DB   C282(2)  	CALL 		TMADDRESS_ASK
   720  0001DC   C30D(2)  	CALL		DELAY_LONG
   721  0001DD   1E0C(1)  	MOV 		A,DATAH
   722  0001DE   1F0A(1)  	MOV 		DATA_IN,A
   723  0001DF   C282(2)  	CALL 		TMADDRESS_ASK
   724  0001E0   1E0D(1)  	MOV 		A,DATAL
   725  0001E1   1F0A(1)  	MOV 		DATA_IN,A
   726  0001E2   C282(2)  	CALL 		TMADDRESS_ASK
   727  0001E3   C307(2)  	CALL		DELAY_SHORT
   728  0001E4             ;**************END*******************************
   729  0001E4   C27A(2)  	CALL		I2C_END_TM
   730  0001E5   C30D(2)  	CALL		DELAY_LONG
   731  0001E6   C30D(2)  	CALL		DELAY_LONG
   732  0001E7   61D2(1)  	B0BCLR		SDATA_IO
   733  0001E8             END_TM_S:
   734  0001E8   4507(1)  	BCLR		TM_I2C_EEROR
   735  0001E9             ;	B0BCLR 		VTM_IO
   736  0001E9   61C2(1)  	B0BCLR		SDATA_CONT
   737  0001EA   60C2(1)  	B0BCLR		SCL_CONT
   738  0001EB   C307(2)  	CALL 		DELAY_SHORT
   739  0001EC   0E00(2)  	RET
   740  0001ED             ;*******************************************
   741  0001ED             ;*****************************************
   742  0001ED             GET_DATA_FROM_TM_FUN:
   743  0001ED   2D0F(1)  	MOV		A,#0X0F
   744  0001EE   1F12(1)  	MOV		COUNT,A
   745  0001EF             TM_I2C_WORK_LOOP:
   746  0001EF   68C2(1)  	B0BSET	SCL_CONT
   747  0001F0   69C2(1)  	B0BSET	SDATA_CONT
   748  0001F1   61D2(1)  	B0BCLR	SDATA_IO
   749  0001F2   60D2(1)  	B0BCLR	SCL_IO
   750  0001F3   C30D(2)  	CALL 	DELAY_LONG
   751  0001F4   C30D(2)  	CALL 	DELAY_LONG
   752  0001F5             ;	B0BSET 	VTM_IO
   753  0001F5   C30D(2)  	CALL 	DELAY_LONG
   754  0001F6             	;CALL	DELAY_LONG
   755  0001F6             START_TMI2C:
   756  0001F6   2D04(1)  	MOV 	A,#0X04
   757  0001F7   1F03(1)  	MOV 	TLC0,A
   758  0001F8             LOOP_1:
   759  0001F8   68D2(1)  	B0BSET 	SCL_IO
   760  0001F9   C302(2)  	CALL	DELAY_MINI;13US
   761  0001FA   C301(2)  	CALL	CALL_DELAY
   762  0001FB   60D2(1)  	B0BCLR 	SCL_IO
   763  0001FC   C302(2)  	CALL 	DELAY_MINI
   764  0001FD   2603(1+S)  	DECMS  	TLC0
   765  0001FE   81F8(2)  	JMP 	LOOP_1
   766  0001FF   2D28(1)  	MOV 	A,#40
   767  000200   2F03(1)  	B0MOV 	TLC0,A
   768  000201   41D2(1)  	BCLR 	SDATA_IO
   769  000202   C30D(2)  	CALL	DELAY_LONG
   770  000203             	;CALL	DELAY_SHORT
   771  000203   2D04(1)  	MOV 	A,#4
   772  000204   2F03(1)  	B0MOV 	TLC0,A
   773  000205             LOOP_2:
   774  000205   60D2(1)  	B0BCLR 	SCL_IO
   775  000206   C302(2)  	CALL	DELAY_MINI
   776  000207   C301(2)  	CALL	CALL_DELAY
   777  000208   68D2(1)  	B0BSET 	SCL_IO
   778  000209   C302(2)  	CALL	DELAY_MINI
   779  00020A   2603(1+S)  	DECMS 	TLC0
   780  00020B   8205(2)  	JMP 	LOOP_2
   781  00020C   C307(2)  	CALL	DELAY_SHORT
   782  00020D   2D05(1)  	MOV 	A,#5
   783  00020E   2F03(1)  	B0MOV 	TLC0,A
   784  00020F   49D2(1)  	BSET 	SDATA_IO
   785  000210             WAIT_TM_INIT:
   786  000210   C30D(2)  	CALL 		DELAY_LONG
   787  000211   2603(1+S)  	DECMS 		TLC0
   788  000212   8210(2)  	JMP 		WAIT_TM_INIT
   789  000213             ;**************START*****************************
   790  000213   C274(2)  	CALL		I2C_START_TM
   791  000214             ;***********************************************
   792  000214   2D3D(1)  	MOV 		A,#TMR_ADD
   793  000215   1F0A(1)  	MOV 		DATA_IN,A
   794  000216   C282(2)  	CALL 		TMADDRESS_ASK
   795  000217   5507(1+S)  	BTS0		TM_I2C_EEROR
   796  000218   8236(2)  	JMP			END_TM
   797  000219   1E13(1)  	MOV 		A,MAC_H
   798  00021A   1F0A(1)  	MOV 		DATA_IN,A
   799  00021B   C282(2)  	CALL 		TMADDRESS_ASK
   800  00021C   1E14(1)  	MOV 		A,MAC_L
   801  00021D   1F0A(1)  	MOV 		DATA_IN,A
   802  00021E   C282(2)  	CALL 		TMADDRESS_ASK
   803  00021F   61C2(1)  	B0BCLR		SDATA_CONT
   804  000220   C30D(2)  	CALL 		DELAY_LONG
   805  000221   4706(1)  	BCLR 		ASK_FLAG
   806  000222   C2AF(2)  	CALL 		TMDATA_ASK
   807  000223   1E0B(1)  	MOV 		A,DATA_OUT
   808  000224   1F0C(1)  	MOV 		DATAH,A
   809  000225   4F06(1)  	BSET 		ASK_FLAG
   810  000226   C2AF(2)  	CALL 		TMDATA_ASK
   811  000227   1E0B(1)  	MOV 		A,DATA_OUT
   812  000228   1F0D(1)  	MOV 		DATAL,A		
   813  000229             ;**************END*******************************
   814  000229   C27A(2)  	CALL		I2C_END_TM
   815  00022A   C307(2)  	CALL		DELAY_SHORT
   816  00022B   61D2(1)  	B0BCLR		SDATA_IO
   817  00022C   2612(1+S)  	DECMS		COUNT
   818  00022D   822F(2)  	JMP			$+2
   819  00022E   8236(2)  	JMP			END_TM
   820  00022F             ;	B0BCLR 		VTM_IO
   821  00022F   2D00(1)  	MOV			A,#0X00
   822  000230   070C(1+S)  	CMPRS		A,DATAH
   823  000231   8235(2)  	JMP			$+4
   824  000232   070D(1+S)  	CMPRS		A,DATAL
   825  000233   8235(2)  	JMP			$+2
   826  000234   81EF(2)  	JMP			TM_I2C_WORK_LOOP
   827  000235   4907(1)  	BSET		READ_LED_FLAG
   828  000236             END_TM:
   829  000236   4507(1)  	BCLR		TM_I2C_EEROR
   830  000237             ;	B0BCLR 		VTM_IO
   831  000237   61C2(1)  	B0BCLR		SDATA_CONT
   832  000238   60C2(1)  	B0BCLR		SCL_CONT
   833  000239   C307(2)  	CALL 		DELAY_SHORT
   834  00023A   0E00(2)  	RET
   835  00023B             ;*******************************************
   836  00023B             ;***********************************************************
   837  00023B             ;*********************************************************
   838  00023B             GET_DATA_FROM_EE_FUN:
   839  00023B   68C2(1)  	B0BSET		SCL_CONT
   840  00023C   6DC2(1)  	B0BSET		SDA_CONT
   841  00023D   6DD2(1)  	B0BSET		SDA_IO
   842  00023E   68D2(1)  	B0BSET		SCL_IO
   843  00023F   C307(2)  	CALL		DELAY_SHORT
   844  000240   C267(2)  	CALL		I2C_START_EE
   845  000241   2DA0(1)  	MOV			A,#EEW_ADD
   846  000242   1F0A(1)  	MOV			DATA_IN,A
   847  000243   C2CB(2)  	CALL		EEADDRESS_ASK
   848  000244   1E13(1)  	MOV			A,MAC_H
   849  000245   1F0A(1)  	MOV			DATA_IN,A
   850  000246   C2CB(2)  	CALL		EEADDRESS_ASK
   851  000247   1E14(1)  	MOV			A,MAC_L
   852  000248   1F0A(1)  	MOV			DATA_IN,A
   853  000249   C2CB(2)  	CALL		EEADDRESS_ASK
   854  00024A   6DD2(1)  	B0BSET		SDA_IO
   855  00024B   C307(2)  	CALL		DELAY_SHORT
   856  00024C   68D2(1)  	B0BSET		SCL_IO
   857  00024D   C307(2)  	CALL		DELAY_SHORT
   858  00024E   C267(2)  	CALL		I2C_START_EE
   859  00024F   C307(2)  	CALL		DELAY_SHORT
   860  000250   2DA1(1)  	MOV			A,#EER_ADD
   861  000251   1F0A(1)  	MOV			DATA_IN,A
   862  000252   C2CB(2)  	CALL		EEADDRESS_ASK
   863  000253   65C2(1)  	B0BCLR		SDA_CONT
   864  000254   4706(1)  	BCLR		ASK_FLAG
   865  000255   C2E5(2)  	CALL		EEDATA_ASK
   866  000256   1E0B(1)  	MOV			A,DATA_OUT
   867  000257   1F0E(1)  	MOV			ADDRESSH,A
   868  000258   65C2(1)  	B0BCLR		SDA_CONT
   869  000259   C302(2)  	CALL		DELAY_MINI
   870  00025A   4F06(1)  	BSET		ASK_FLAG
   871  00025B   C2E5(2)  	CALL		EEDATA_ASK
   872  00025C   1E0B(1)  	MOV			A,DATA_OUT
   873  00025D   1F0F(1)  	MOV			ADDRESSL,A
   874  00025E   C26D(2)  	CALL		I2C_END_EE
   875  00025F             ;*************************************
   876  00025F   C307(2)  	CALL		DELAY_SHORT
   877  000260   60C2(1)  	B0BCLR		SCL_CONT
   878  000261   65C2(1)  	B0BCLR		SDA_CONT
   879  000262   0E00(2)  	RET
   880  000263             ;************************************************
   881  000263             I2C_EEROR:
   882  000263             	;open interrupt
   883  000263             	;SleepMode
   884  000263   4606(1)  	BCLR	I2CERROR_FLAG
   885  000264   54D5(1+S)  	BTS0	VTM_IO
   886  000265   4D07(1)  	BSET	TM_I2C_EEROR
   887  000266   0E00(2)  	RET
   888  000267             I2C_START_EE:
   889  000267   C302(2)  	CALL		DELAY_MINI
   890  000268   65D2(1)  	B0BCLR 		SDA_IO
   891  000269   C302(2)  	CALL 		DELAY_MINI
   892  00026A   60D2(1)  	B0BCLR 		SCL_IO
   893  00026B   C302(2)  	CALL 		DELAY_MINI
   894  00026C   0E00(2)  	RET
   895  00026D             I2C_END_EE:
   896  00026D   65D2(1)  	B0BCLR 		SDA_IO
   897  00026E   C302(2)  	CALL 		DELAY_MINI
   898  00026F   68D2(1)  	B0BSET 		SCL_IO
   899  000270   C302(2)  	CALL 		DELAY_MINI
   900  000271   6DD2(1)  	B0BSET 		SDA_IO
   901  000272   C302(2)  	CALL		DELAY_MINI
   902  000273   0E00(2)  	RET
   903  000274             I2C_START_TM:
   904  000274   C302(2)  	CALL		DELAY_MINI
   905  000275   61D2(1)  	B0BCLR 		SDATA_IO
   906  000276   C302(2)  	CALL 		DELAY_MINI
   907  000277   60D2(1)  	B0BCLR 		SCL_IO
   908  000278   C302(2)  	CALL 		DELAY_MINI
   909  000279   0E00(2)  	RET
   910  00027A             I2C_END_TM:
   911  00027A   61D2(1)  	B0BCLR 		SDATA_IO
   912  00027B   C302(2)  	CALL 		DELAY_MINI
   913  00027C   60D2(1)  	B0BCLR		SCL_IO
   914  00027D   C302(2)  	CALL		DELAY_MINI
   915  00027E   69D2(1)  	B0BSET 		SDATA_IO
   916  00027F   C302(2)  	CALL		DELAY_MINI
   917  000280   68D2(1)  	B0BSET 		SCL_IO
   918  000281   0E00(2)  	RET
   919  000282             TMADDRESS_ASK:
   920  000282   2D08(1)  	MOV 		A,#8
   921  000283   1F02(1)  	MOV 		TIMEOUT,A
   922  000284             TMADDRESS_LOOP:
   923  000284   570A(1+S)  	BTS0		DATA_IN.7
   924  000285   8289(2)  	JMP 		MD_1
   925  000286   71D2(1+S)  	B0BTS0 		SDATA_IO
   926  000287   61D2(1)  	B0BCLR		SDATA_IO
   927  000288   828B(2)  	JMP 		NEXT_1
   928  000289             MD_1:
   929  000289   79D2(1+S)  	B0BTS1 		SDATA_IO
   930  00028A   69D2(1)  	B0BSET		SDATA_IO
   931  00028B             NEXT_1:
   932  00028B   C302(2)  	CALL		DELAY_MINI
   933  00028C   68D2(1)  	B0BSET 		SCL_IO
   934  00028D   C302(2)  	CALL		DELAY_MINI
   935  00028E   0B0A(1)  	RLCM 		DATA_IN
   936  00028F   60D2(1)  	B0BCLR 		SCL_IO
   937  000290   2602(1+S)  	DECMS 		TIMEOUT
   938  000291   8284(2)  	JMP 		TMADDRESS_LOOP
   939  000292             	
   940  000292   61C2(1)  	B0BCLR 		SDATA_CONT
   941  000293   C302(2)  	CALL		DELAY_MINI
   942  000294   68D2(1)  	B0BSET 		SCL_IO
   943  000295   C301(2)  	CALL 		CALL_DELAY
   944  000296   71D2(1+S)  	B0BTS0 		SDATA_IO
   945  000297   C263(2)  	CALL		I2C_EEROR
   946  000298   C302(2)  	CALL		DELAY_MINI
   947  000299   40D2(1)  	BCLR 		SCL_IO
   948  00029A   49C2(1)  	BSET 		SDATA_CONT
   949  00029B   0E00(2)  	RET
   950  00029C             TMADDRESS_NO_ASK:
   951  00029C   2D08(1)  	MOV 		A,#8
   952  00029D   1F02(1)  	MOV 		TIMEOUT,A
   953  00029E             TMADDRESS_LOOP_N:
   954  00029E   570A(1+S)  	BTS0		DATA_IN.7
   955  00029F   82A3(2)  	JMP 		MD_1_N
   956  0002A0   71D2(1+S)  	B0BTS0 		SDATA_IO
   957  0002A1   61D2(1)  	B0BCLR		SDATA_IO
   958  0002A2   82A5(2)  	JMP 		NEXT_1_N
   959  0002A3             MD_1_N:
   960  0002A3   79D2(1+S)  	B0BTS1 		SDATA_IO
   961  0002A4   69D2(1)  	B0BSET		SDATA_IO
   962  0002A5             NEXT_1_N:
   963  0002A5   C302(2)  	CALL		DELAY_MINI
   964  0002A6   68D2(1)  	B0BSET 		SCL_IO
   965  0002A7   C302(2)  	CALL		DELAY_MINI
   966  0002A8   0B0A(1)  	RLCM 		DATA_IN
   967  0002A9   60D2(1)  	B0BCLR 		SCL_IO
   968  0002AA   2602(1+S)  	DECMS 		TIMEOUT
   969  0002AB   829E(2)  	JMP 		TMADDRESS_LOOP_N
   970  0002AC             	
   971  0002AC   C302(2)  	CALL		DELAY_MINI
   972  0002AD   C302(2)  	CALL		DELAY_MINI
   973  0002AE   0E00(2)  	RET
   974  0002AF             ;**********************TM_READING_DATA********************************
   975  0002AF             TMDATA_ASK:
   976  0002AF   61C2(1)  	B0BCLR 		SDATA_CONT
   977  0002B0   2D08(1)  	MOV 		A,#8
   978  0002B1   1F02(1)  	MOV 		TIMEOUT,A
   979  0002B2             TMDATA_LOOP:
   980  0002B2   2D09(1)  	MOV 		A,#9
   981  0002B3   1F03(1)  	MOV 		TLC0,A
   982  0002B4   C302(2)  	CALL		DELAY_MINI
   983  0002B5   48D2(1)  	BSET 		SCL_IO
   984  0002B6   C301(2)  	CALL 		CALL_DELAY
   985  0002B7   71D2(1+S)  	B0BTS0 		SDATA_IO
   986  0002B8   480B(1)  	BSET 		DATA_OUT.0
   987  0002B9   79D2(1+S)  	B0BTS1 		SDATA_IO
   988  0002BA   400B(1)  	BCLR 		DATA_OUT.0
   989  0002BB   0B0B(1)  	RLCM 		DATA_OUT
   990  0002BC   C302(2)  	CALL		DELAY_MINI
   991  0002BD   60D2(1)  	B0BCLR 		SCL_IO
   992  0002BE   2602(1+S)  	DECMS 		TIMEOUT
   993  0002BF   82B2(2)  	JMP 		TMDATA_LOOP
   994  0002C0   69C2(1)  	B0BSET 		SDATA_CONT
   995  0002C1   5706(1+S)  	BTS0 		ASK_FLAG
   996  0002C2   69D2(1)  	B0BSET 		SDATA_IO
   997  0002C3   5F06(1+S)  	BTS1 		ASK_FLAG
   998  0002C4   61D2(1)  	B0BCLR 		SDATA_IO
   999  0002C5   090B(1)  	RRCM 		DATA_OUT
  1000  0002C6   C302(2)  	CALL		DELAY_MINI
  1001  0002C7   48D2(1)  	BSET 		SCL_IO
  1002  0002C8   C302(2)  	CALL		DELAY_MINI
  1003  0002C9   40D2(1)  	BCLR		SCL_IO	
  1004  0002CA   0E00(2)  	RET
  1005  0002CB             ;******************************************************
  1006  0002CB             EEADDRESS_ASK:
  1007  0002CB   2D08(1)  	MOV 		A,#8
  1008  0002CC   1F02(1)  	MOV 		TIMEOUT,A
  1009  0002CD             EEADDRESS_LOOP:
  1010  0002CD   570A(1+S)  	BTS0		DATA_IN.7
  1011  0002CE   82D2(2)  	JMP 		EEMD_1
  1012  0002CF   75D2(1+S)  	B0BTS0 		SDA_IO
  1013  0002D0   65D2(1)  	B0BCLR		SDA_IO
  1014  0002D1   82D4(2)  	JMP 		EENEXT_1
  1015  0002D2             EEMD_1:
  1016  0002D2   7DD2(1+S)  	B0BTS1 		SDA_IO
  1017  0002D3   6DD2(1)  	B0BSET		SDA_IO
  1018  0002D4             EENEXT_1:
  1019  0002D4   C302(2)  	CALL		DELAY_MINI
  1020  0002D5   68D2(1)  	B0BSET 		SCL_IO
  1021  0002D6   C302(2)  	CALL		DELAY_MINI
  1022  0002D7   0B0A(1)  	RLCM 		DATA_IN
  1023  0002D8   60D2(1)  	B0BCLR 		SCL_IO
  1024  0002D9   2602(1+S)  	DECMS 		TIMEOUT
  1025  0002DA   82CD(2)  	JMP 		EEADDRESS_LOOP
  1026  0002DB             	
  1027  0002DB   65C2(1)  	B0BCLR 		SDA_CONT
  1028  0002DC   C302(2)  	CALL		DELAY_MINI
  1029  0002DD   68D2(1)  	B0BSET 		SCL_IO
  1030  0002DE   C301(2)  	CALL 		CALL_DELAY
  1031  0002DF   75D2(1+S)  	B0BTS0 		SDA_IO
  1032  0002E0   C263(2)  	CALL		I2C_EEROR
  1033  0002E1   C302(2)  	CALL		DELAY_MINI
  1034  0002E2   40D2(1)  	BCLR 		SCL_IO
  1035  0002E3   4DC2(1)  	BSET 		SDA_CONT
  1036  0002E4   0E00(2)  	RET
  1037  0002E5             ;****************************************
  1038  0002E5             EEDATA_ASK:
  1039  0002E5   65C2(1)  	B0BCLR 		SDA_CONT
  1040  0002E6   2D08(1)  	MOV 		A,#8
  1041  0002E7   1F02(1)  	MOV 		TIMEOUT,A
  1042  0002E8             EEDATA_LOOP:
  1043  0002E8   2D09(1)  	MOV 		A,#9
  1044  0002E9   1F03(1)  	MOV 		TLC0,A
  1045  0002EA   C302(2)  	CALL		DELAY_MINI
  1046  0002EB   48D2(1)  	BSET 		SCL_IO
  1047  0002EC   C301(2)  	CALL 		CALL_DELAY
  1048  0002ED   75D2(1+S)  	B0BTS0 		SDA_IO
  1049  0002EE   480B(1)  	BSET 		DATA_OUT.0
  1050  0002EF   7DD2(1+S)  	B0BTS1 		SDA_IO
  1051  0002F0   400B(1)  	BCLR 		DATA_OUT.0
  1052  0002F1   0B0B(1)  	RLCM 		DATA_OUT
  1053  0002F2   C302(2)  	CALL		DELAY_MINI
  1054  0002F3   60D2(1)  	B0BCLR 		SCL_IO
  1055  0002F4   2602(1+S)  	DECMS 		TIMEOUT
  1056  0002F5   82E8(2)  	JMP 		EEDATA_LOOP
  1057  0002F6             	
  1058  0002F6   6DC2(1)  	B0BSET 		SDA_CONT
  1059  0002F7   5706(1+S)  	BTS0 		ASK_FLAG
  1060  0002F8   6DD2(1)  	B0BSET 		SDA_IO
  1061  0002F9   5F06(1+S)  	BTS1 		ASK_FLAG
  1062  0002FA   65D2(1)  	B0BCLR 		SDA_IO
  1063  0002FB   090B(1)  	RRCM 		DATA_OUT
  1064  0002FC   C302(2)  	CALL		DELAY_MINI
  1065  0002FD   48D2(1)  	BSET 		SCL_IO
  1066  0002FE   C302(2)  	CALL		DELAY_MINI
  1067  0002FF   40D2(1)  	BCLR		SCL_IO	
  1068  000300   0E00(2)  	RET
  1069  000301             ;*********************delay*****************
  1070  000301             CALL_DELAY:
  1071  000301   0E00(2)  	RET
  1072  000302             DELAY_MINI:;13US
  1073  000302   2D05(1)  	MOV		A,#0X05
  1074  000303   1F00(1)  	MOV		DELAYTIME1,A
  1075  000304             DELAY0:
  1076  000304   2600(1+S)  	DECMS	DELAYTIME1
  1077  000305   8304(2)  	JMP		DELAY0
  1078  000306   0E00(2)  	RET
  1079  000307             	
  1080  000307             DELAY_SHORT:		;50US FOR 0.5US/INSTRUCTION
  1081  000307   2D63(1)  	MOV		A,#0X63
  1082  000308   1F00(1)  	MOV		DELAYTIME1,A
  1083  000309             DELAY1:
  1084  000309   0000(1)  	NOP
  1085  00030A   2600(1+S)  	DECMS	DELAYTIME1
  1086  00030B   8309(2)  	JMP		DELAY1
  1087  00030C   0E00(2)  	RET
  1088  00030D             DELAY_LONG:	;>=5MS
  1089  00030D             ;WAIT_FOR_A_LONG_WHILE
  1090  00030D   2D0A(1)  	MOV		A,#0X0A
  1091  00030E   2F00(1)  	B0MOV	DELAYTIME1,A
  1092  00030F             DELAY2_1:
  1093  00030F   2DC7(1)  	MOV		A,#0XC7
  1094  000310   1F01(1)  	MOV		DELAYTIME2,A
  1095  000311             DELAY2_2:
  1096  000311   0000(1)  	NOP
  1097  000312   2601(1+S)  	DECMS	DELAYTIME2
  1098  000313   8311(2)  	JMP		DELAY2_2	
  1099  000314   2600(1+S)  	DECMS	DELAYTIME1
  1100  000315   830F(2)  	JMP		DELAY2_1
  1101  000316   0E00(2)  	RET		
  1102  000317             DELAY_LED:		;0.2S
  1103  000317             ;WAIT_FOR_DEEP_DARK_FANTASY
  1104  000317   2DFF(1)  	MOV		A,#0XFF
  1105  000318   1F01(1)  	MOV		DELAYTIME2,A
  1106  000319             DELAY3_1:
  1107  000319   2DFF(1)  	MOV		A,#0XFF
  1108  00031A   1F00(1)  	MOV		DELAYTIME1,A
  1109  00031B             DELAY3_2:
  1110  00031B   0000(1)  	NOP
  1111  00031C   0000(1)  	NOP
  1112  00031D   2600(1+S)  	DECMS		DELAYTIME1
  1113  00031E   831B(2)  	JMP			DELAY3_2
  1114  00031F   2601(1+S)  	DECMS		DELAYTIME2
  1115  000320   8319(2)  	JMP			DELAY3_1
  1116  000321   0E00(2)  	RET
  1117  000322             OPEN_TC0_INT_FUN:
  1118  000322   6BDA(1)  	B0BSET	FTC0CKS	;	OUTSIDE INPUT ACCIDENT
  1119  000323   6ADA(1)  	B0BSET	FALOAD0 ;
  1120  000324   2DFD(1)  	MOV		A,#0XFD
  1121  000325   2FCD(1)  	B0MOV	TC0R,A
  1122  000326   2FDB(1)  	B0MOV	TC0C,A
  1123  000327   65C8(1)  	B0BCLR	FTC0IRQ
  1124  000328   6DC9(1)  	B0BSET	FTC0IEN
  1125  000329   6FDA(1)  	B0BSET	FTC0ENB
  1126  00032A   0E00(2)  	RET
  1127  00032B             SYS_INIT_FUN:
  1128  00032B   2D2D(1)  	MOV			A,#0X2D
  1129  00032C   2FC2(1)  	B0MOV		P2M,A
  1130  00032D   2D35(1)  	MOV			A,#0X35
  1131  00032E   2FD2(1)  	B0MOV		P2,A
  1132  00032F             	;up resistor for p2.1
  1133  00032F             	;MOV			A,#0X02
  1134  00032F             	;B0MOV		P2UR,A
  1135  00032F             ;*************************************
  1136  00032F             ;//////////up resistor for p2////////////
  1137  00032F   2DFF(1)      MOV			A,#0XFF
  1138  000330   2FE2(1)  	B0MOV		P2UR,A
  1139  000331             ;////////////////////////////////////////
  1140  000331   2D01(1)  	MOV			A,#0X01
  1141  000332   2FC1(1)  	B0MOV		P1M,A
  1142  000333   2BD1(1)  	CLR			P1
  1143  000334   68B8(1)  	B0BSET		VSR_CONT
  1144  000335   60D0(1)  	B0BCLR		VSR_IO
  1145  000336   68C1(1)  	B0BSET		S_VDD_VCC_CONT
  1146  000337   60D1(1)  	B0BCLR		S_VDD_VCC_IO
  1147  000338   6CC5(1)  	B0BSET		VTM_CONT
  1148  000339   6CD5(1)  	B0BSET		VTM_IO
  1149  00033A   2D03(1)  	MOV			A,#0X03
  1150  00033B   1F10(1)  	MOV			CRCT1,A
  1151  00033C   C307(2)  	CALL		DELAY_SHORT
  1152  00033D   54D2(1+S)  	BTS0		BLEF
  1153  00033E   8342(2)  	JMP			SYS_INIT_LED
  1154  00033F   4E07(1)  	BSET		BLE_FLAG
  1155  000340   2D02(1)  	MOV			A,#0X02
  1156  000341   1F10(1)  	MOV			CRCT1,A
  1157  000342             SYS_INIT_LED:
  1158  000342   62D2(1)  	B0BCLR		CLED_IO
  1159  000343   C317(2)  	CALL		DELAY_LED	
  1160  000344   6AD2(1)  	B0BSET		CLED_IO
  1161  000345   C317(2)  	CALL		DELAY_LED
  1162  000346   2610(1+S)  	DECMS		CRCT1
  1163  000347   8342(2)  	JMP			SYS_INIT_LED
  1164  000348             ;************T0_INIT_START************************************
  1165  000348   2D00(1)  	MOV			A,#0X00
  1166  000349   2FD8(1)  	B0MOV		T0M,A	
  1167  00034A   68D8(1)  	B0BSET		FT0TB	; T0 = Fcpu/256,PERIOD TIME IS 2S
  1168  00034B   2BD9(1)  	CLR			T0C
  1169  00034C   64C8(1)  	B0BCLR		FT0IRQ
  1170  00034D   6CC9(1)  	B0BSET		FT0IEN
  1171  00034E   6FD8(1)  	B0BSET		FT0ENB
  1172  00034F             ;*****************TC0_INIT_START*****************
  1173  00034F   2BDA(1)  	CLR			TC0M
  1174  000350   2BDB(1)  	CLR			TC0C
  1175  000351   65C8(1)  	B0BCLR		FTC0IRQ
  1176  000352   65C9(1)  	B0BCLR		FTC0IEN
  1177  000353   67DA(1)  	B0BCLR		FTC0ENB
  1178  000354             ;************************OPEN P1.1WEEK UP FUNCTION*********************
  1179  000354   2D02(1)  	MOV			A,#0X02
  1180  000355   2FC0(1)  	B0MOV		P1W,A
  1181  000356   C302(2)  	CALL		DELAY_MINI
  1182  000357   0E00(2)  	RET
  1183  000358             ;//////////////////////////////////////////////////
  1184  000358             SET_EE_TM_FUN:
  1185  000358   65C2(1)  	B0BCLR		SDA_CONT
  1186  000359             ;	B0BCLR		VTM_CONT
  1187  000359   60C2(1)  	B0BCLR		SCL_CONT
  1188  00035A   61C2(1)  	B0BCLR		SDATA_CONT
  1189  00035B   68D0(1)  	B0BSET		VSR_IO
  1190  00035C   6BD2(1)  	B0BSET		S_TM_EE_IO
  1191  00035D   4A06(1)  	BSET		TM_EE_FLAG
  1192  00035E   4407(1)  	BCLR	NOT_QUICK_MODE_FLAG
  1193  00035F   0E00(2)  	RET
  1194  000360             ;////////////////////////////////////////
  1195  000360             ;////////////SET LOW POWER
  1196  000360             SET_LOW_POWER_FUN:
  1197  000360             ;****************************************
  1198  000360             ;	B0BCLR		VTM_CONT
  1199  000360   63D2(1)  	B0BCLR		S_TM_EE_IO
  1200  000361   60D0(1)  	B0BCLR		VSR_IO
  1201  000362   4206(1)  	BCLR		TM_EE_FLAG
  1202  000363   0E00(2)  	RET
  1203  000364             ;////////////I2C exist and pull down the VDD/////////////////////////////	
  1204  000364             ;*******************************************
  1205  000364             TM_I2C_EXIST_FUN:
  1206  000364   68C2(1)  	B0BSET	SCL_CONT
  1207  000365   69C2(1)  	B0BSET	SDATA_CONT
  1208  000366   61D2(1)  	B0BCLR	SDATA_IO
  1209  000367   60D2(1)  	B0BCLR	SCL_IO
  1210  000368   C30D(2)  	CALL 	DELAY_LONG
  1211  000369   C30D(2)  	CALL 	DELAY_LONG
  1212  00036A   68C1(1)  	B0BSET	S_VDD_VCC_CONT
  1213  00036B   68D1(1)  	B0BSET  S_VDD_VCC_IO
  1214  00036C   C30D(2)  	CALL 	DELAY_LONG
  1215  00036D             	;CALL	DELAY_LONG
  1216  00036D             START_TMI2CE:
  1217  00036D   2D04(1)  	MOV 	A,#4
  1218  00036E   2F03(1)  	B0MOV 	TLC0,A
  1219  00036F             LOOP_2E:
  1220  00036F   60D2(1)  	B0BCLR 	SCL_IO
  1221  000370   C302(2)  	CALL	DELAY_MINI
  1222  000371   C301(2)  	CALL	CALL_DELAY
  1223  000372   68D2(1)  	B0BSET 	SCL_IO
  1224  000373   C302(2)  	CALL	DELAY_MINI
  1225  000374   2603(1+S)  	DECMS 	TLC0
  1226  000375   836F(2)  	JMP 	LOOP_2E
  1227  000376   C307(2)  	CALL	DELAY_SHORT
  1228  000377   2D05(1)  	MOV 	A,#5
  1229  000378   2F03(1)  	B0MOV 	TLC0,A
  1230  000379   49D2(1)  	BSET 	SDATA_IO
  1231  00037A             WAIT_TM_INIT_E:
  1232  00037A   C30D(2)  	CALL 		DELAY_LONG
  1233  00037B   2603(1+S)  	DECMS 		TLC0
  1234  00037C   837A(2)  	JMP 		WAIT_TM_INIT_E
  1235  00037D             ;**************START*****************************
  1236  00037D   C274(2)  	CALL		I2C_START_TM
  1237  00037E             ;***********************************************
  1238  00037E   2D3C(1)  	MOV 		A,#0X3C
  1239  00037F   1F0A(1)  	MOV 		DATA_IN,A
  1240  000380   C29C(2)  	CALL 		TMADDRESS_NO_ASK
  1241  000381   5507(1+S)  	BTS0		TM_I2C_EEROR
  1242  000382   8387(2)  	JMP			END_TM_E
  1243  000383             ;**************END*******************************
  1244  000383   C27A(2)  	CALL		I2C_END_TM
  1245  000384   C30D(2)  	CALL		DELAY_LONG
  1246  000385   60D1(1)  	B0BCLR		S_VDD_VCC_IO
  1247  000386   61D2(1)  	B0BCLR		SDATA_IO
  1248  000387             END_TM_E:
  1249  000387   4507(1)  	BCLR		TM_I2C_EEROR
  1250  000388             ;	B0BCLR 		VTM_IO
  1251  000388   61C2(1)  	B0BCLR		SDATA_CONT
  1252  000389   60C2(1)  	B0BCLR		SCL_CONT
  1253  00038A   C307(2)  	CALL 		DELAY_SHORT
  1254  00038B   60C1(1)  	B0BCLR		S_VDD_VCC_CONT
  1255  00038C   0E00(2)      RET
  1256  00038D             ;/////////////////////////////////////////	
  1257  00038D             ;*******************************************
  1258  00038D             	ENDP
