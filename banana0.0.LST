     1  000000             CHIP		SN8P2501D
     2  000000             //{{SONIX_CODE_OPTION
     3  000000             	.Code_Option	Noise_Filter	Enable
     4  000000             	.Code_Option	Reset_Pin	P11
     5  000000             	.Code_Option	Watch_Dog	Disable
     6  000000             	.Code_Option	High_Clk	IHRC_RTC	;
     7  000000             	.Code_Option	Fcpu		#3     ; Fcpu = Fosc/8
     8  000000             	.Code_Option	Security	Enable
     9  000000             	.Code_Option	LVD		LVD_L		;
    10  000000             //}}SONIX_CODE_OPTION
    11  000000             
    12  E 0000002F         	END_RAM_ADDR	EQU	0X2F
    13  E 000000A1         	EER_ADD			EQU	0XA1	;10100001B
    14  E 000000A0         	EEW_ADD			EQU	0XA0	;10100000B
    15  E 00000030         	RAM_COUNT		EQU	48
    16  E 00000034         	TM_DATA_H		EQU	0X34	;ADDR OF THE TEMPEATURE	OF TM
    17  E 00000000         	TM_DATA_L		EQU	0X00
    18  E 0000000A         	TIME_GAP		EQU	0X0A	;5S
    19  E 00000001         	T0_TDR			EQU	0X01
    20  E 0000003D         	TMR_ADD 		EQU	0X3D
    21  E 0000003C         	TMW_ADD			EQU	0X3C
    22  E 0000001F         	MAX_MEMH		EQU	0X1F
    23  E 000000DE         	MAX_MEML		EQU	0XDE
    24  E 0000001F         	LAST_TIME_EE_ADD_H EQU 0X1F
    25  E 000000FE         	LAST_TIME_EE_ADD_L EQU 0XFE
    26  E 0000001F         	LIVE_TIME_ADD_H		EQU	0X1F
    27  E 000000FC         	LIVE_TIME_ADD_L		EQU	0XFC
    28  E 00000001         	DEFAULT_FRONT_TIME_DELAY	EQU	0X01
    29  E 00000001         	DEFAULT_TIME_GAP	EQU	0X01
    30  E 00000030         	TM_INITIAL_TIME_ADD_H	EQU 0X30
    31  E 00000000         	TM_INITIAL_TIME_ADD_L	EQU 0X00
    32  E 00000031         	TM_TIME_H		EQU	0X31
    33  E 00000000         	TM_TIME_L		EQU	0X00
    34  E 0000001F         	EE_DELAY_ADD_H	EQU	0X1F
    35  E 000000F8         	EE_GAP_ADD_L	EQU	0XF8
    36  E 0000001F         	EE_INITIAL_TIME_ADD_H	EQU	0X1F
    37  E 000000FA         	EE_INITIAL_TIME_ADD_L	EQU	0XFA
    38  E 00000001         	WRITE_FLAG_H	EQU 0X01
    39  E 00000000         	WRITE_FLAG_L	EQU	0X00
    40  E 00000002         	DEFAULT_GAP_TIME_FLAGH EQU 0X02
    41  E 00000000         	DEFAULT_GAP_TIME_FLAGL EQU	0X00
    42  E 00000020         	HIGT_TMP_LEVEL1	EQU	0X20
    43  E 00000005         	LOW_TMP_LEVEL1 EQU	0X05
    44  E 0000001F         	TMP_LEVEL_ADDH	EQU	0X1F
    45  E 000000F0         	TMP_LEVEL_ADDL	EQU	0XF0
    46  000000             .DATA
    47  000000             			ORG	0H
    48  0000 D             	DELAYTIME1	DS	1
    49  0001 D             	DELAYTIME2	DS	1
    50  0002 D             	TIMEOUT		DS	1
    51  0003 D             	TLC0		DS	1
    52  0004 D             	TLC2		DS	1
    53  0005 D             	FLAG1		DS	1
    54  0006 D             	FLAG2		DS	1
    55  0007 D             	TIMEH		DS	1
    56  0008 D             	TIMEG		DS	1
    57  0009 D             	DATA_IN		DS	1
    58  000A D             	DATA_OUT	DS	1
    59  000B D             	DATAH		DS	1
    60  000C D             	DATAL		DS	1
    61  000D D             	ADDRESSH	DS	1
    62  000E D             	ADDRESSL	DS	1
    63  000F D             	CRCT1		DS	1
    64  0010 D             	CRCT2		DS	1
    65  0011 D             	COUNT		DS	1
    66  0012 D             	MAC_H		DS	1
    67  0013 D             	MAC_L		DS	1
    68  0014 D             	FRONT_DELAY	DS	1
    69  0015 D             	TIME_DELAY_GAP	DS	1
    70  0016 D             	STARTADDRH		DS	1
    71  0017 D             	STARTADDRL		DS	1
    72  0018 D             	INITIAL_TIMEH	DS	1
    73  0019 D             	INITIAL_TIMEL	DS	1
    74  001A D             	TEMPERATURE_H	DS	1
    75  00001B             ;**************BIT_VARIABLES_DEFINNITIONS*******
    76  E 00000005         	READTM_FLAG	EQU	FLAG1.0
    77  E 00030005         	TIME_FLAG	EQU	FLAG1.3
    78  E 00010005         	RESET_FLAG	EQU	FLAG1.1
    79  E 00020005         	TM_EE_FLAG	EQU FLAG1.2
    80  E 00040005         	DEFAULT_GAP_FLAG	EQU	FLAG1.4
    81  E 00050005         	FILLOUT_FLAG	EQU	FLAG1.5
    82  E 00060005         	I2CERROR_FLAG	EQU	FLAG1.6
    83  E 00070005         	ASK_FLAG	EQU	FLAG1.7
    84  E 00010006         	READ_LED_FLAG	EQU	FLAG2.1
    85  E 00020006         	NOT_UPLOAD_FLAG	EQU	FLAG2.2
    86  E 00030006         	HAVE_UPLOAD_FLAG EQU FLAG2.3
    87  E 00040006         	NOT_QUICK_MODE_FLAG EQU FLAG2.4
    88  E 00050006         	TM_I2C_EEROR	EQU FLAG2.5
    89  E 00060006         	BLE_FLAG		EQU FLAG2.6
    90  E 00070006         	TMP_LEVEL_FLAG		EQU	FLAG2.7
    91  E 000200D2         	CLED_IO			EQU	P2.2
    92  E 000100D2         	SDATA_IO		EQU	P2.1
    93  E 000000D2         	SCL_IO			EQU	P2.0
    94  E 000300D2         	S_TM_EE_IO		EQU	P2.3
    95  E 000400D2         	BLEF	EQU	P2.4
    96  E 000500D2         	SDA_IO			EQU	P2.5
    97  E 000400D5         	VTM_IO			EQU	P5.4
    98  E 000000D0         	VSR_IO			EQU	P0.0
    99  E 000200C2         	CLED_CONT		EQU	P2M.2
   100  E 000100C2         	SDATA_CONT		EQU	P2M.1
   101  E 000000C2         	SCL_CONT		EQU	P2M.0
   102  E 000300C2         	S_TM_EE_CONT	EQU	P2M.3
   103  E 000500C2         	SDA_CONT		EQU	P2M.5
   104  E 000400C5         	VTM_CONT		EQU	P5M.4
   105  E 000000B8         	VSR_CONT		EQU	P0M.0
   106  00001B             ;***************************************
   107  E 000100D1         	VDDF			EQU	P1.1
   108  E 000000D1         	S_VDD_VCC_IO		EQU	P1.0
   109  E 000000C1         	S_VDD_VCC_CONT		EQU	P1M.0
   110  00001B             ;*************CODE_SECTION**********************	
   111  000000             .CODE
   112  000000             
   113  000000             		ORG	0
   114  000000   8037(2)  	JMP		START
   115  000008             		ORG	8H
   116  000008   8009(2)  	JMP		INT_SERVICE
   117  000009             INT_SERVICE:
   118  000009             ;KEEP ACC AND PFLAG
   119  000009   0400(1)  	PUSH
   120  00000A             ;T0 INTERRUPT
   121  00000A             JUST_T0:
   122  00000A   74C9(1+S)  	B0BTS0	FT0IEN
   123  00000B   7CC8(1+S)  	B0BTS1	FT0IRQ
   124  00000C   802C(2)  	JMP		JUST_TC0
   125  00000D   64C8(1)  	B0BCLR	FT0IRQ
   126  00000E             ;T0 INTERRUPT SERVISE PROGRESS
   127  00000E   71D1(1+S)  	B0BTS0	VDDF
   128  00000F   4A06(1)  	BSET 	NOT_UPLOAD_FLAG
   129  000010   71D1(1+S)  	B0BTS0	VDDF
   130  000011   4306(1)  	BCLR    HAVE_UPLOAD_FLAG
   131  000012             ;///////////////////////////////
   132  000012   5B06(1+S)  	BTS1	HAVE_UPLOAD_FLAG
   133  000013   8016(2)  	JMP		$+3
   134  000014   79D1(1+S)  	B0BTS1	VDDF
   135  000015   4C06(1)  	BSET	NOT_QUICK_MODE_FLAG
   136  000016   79D1(1+S)  	B0BTS1	VDDF
   137  000017   4B06(1)  	BSET    HAVE_UPLOAD_FLAG
   138  000018             ;//////////////////////////////////
   139  000018   1607(1+S)  	INCMS	TIMEH ;TIMEH=TIMEH+1,
   140  000019   2D0A(1)  	MOV			A,#TIME_GAP
   141  00001A   1F10(1)  	MOV			CRCT2,A
   142  00001B   6286(1)  	B0BCLR		FC
   143  00001C   5906(1+S)  	BTS1		READ_LED_FLAG
   144  00001D   8020(2)  	JMP			$+3
   145  00001E   5706(1+S)  	BTS0		TMP_LEVEL_FLAG
   146  00001F   0910(1)  	RRCM		CRCT2
   147  000020   1E10(1)  	MOV			A,CRCT2
   148  000021   0707(1+S)  	CMPRS	A,TIMEH
   149  000022   8035(2)  	JMP		EXIT_INT
   150  000023   2B07(1)  	CLR		TIMEH
   151  000024   4B05(1)  	BSET	TIME_FLAG
   152  000025   1608(1+S)  	INCMS	TIMEG
   153  000026   1E15(1)  	MOV		A,TIME_DELAY_GAP
   154  000027   0708(1+S)  	CMPRS	A,TIMEG
   155  000028   8035(2)  	JMP		EXIT_INT
   156  000029   2B08(1)  	CLR		TIMEG
   157  00002A   4805(1)  	BSET	READTM_FLAG
   158  00002B   8035(2)  	JMP		EXIT_INT
   159  00002C             JUST_TC0:
   160  00002C   75C9(1+S)  	B0BTS0	FTC0IEN
   161  00002D   7DC8(1+S)  	B0BTS1	FTC0IRQ
   162  00002E   8031(2)  	JMP		JUST_INT0
   163  00002F   65C8(1)  	B0BCLR	FTC0IRQ
   164  000030             ;TC0 INTERRUPT SERVICE PROGRESS
   165  000030   8035(2)  	JMP		EXIT_INT
   166  000031             JUST_INT0:
   167  000031   70C9(1+S)  	B0BTS0	FP00IEN
   168  000032   78C8(1+S)  	B0BTS1	FP00IRQ
   169  000033   8035(2)  	JMP EXIT_INT
   170  000034   60C8(1)  	B0BCLR	FP00IRQ
   171  000035             ;INT0 INTERRUPT SERVISE PROGRESS
   172  000035             EXIT_INT:
   173  000035   0500(1)  	POP
   174  000036   0F00(2)  	RETI
   175  000037             ;*********************************************************
   176  000037             ;***********************STARRT**********************
   177  000037             START:
   178  000037   2D7F(1)  	MOV		A,#07FH
   179  000038   2FDF(1)  	B0MOV		STKP,A		;DISABLE GLOBAL INTERRUPT
   180  000039   2B86(1)  	CLR		PFLAG
   181  00003A   2D00(1)  	MOV		A,#00H
   182  00003B   2FCA(1)  	B0MOV		OSCM,A
   183  00003C   2D5A(1)  	MOV		A,#0X5A
   184  00003D   2FCC(1)  	B0MOV		WDTR,A	
   185  00003E   C1A8(2)  	CALL		CLRRAM
   186  00003F             STATE_INITIAL:
   187  00003F   C34D(2)  	CALL		SYS_INIT_FUN
   188  000040   67DF(1)  	B0BCLR		FGIE
   189  000041             ;******************************************
   190  000041   2D01(1)  	MOV		A,#DEFAULT_FRONT_TIME_DELAY
   191  000042   1F14(1)  	MOV		FRONT_DELAY,A
   192  000043   2D01(1)  	MOV		A,#DEFAULT_TIME_GAP
   193  000044   1F15(1)  	MOV		TIME_DELAY_GAP,A
   194  000045             ;////////////////////////////////
   195  000045   5606(1+S)  	BTS0		BLE_FLAG
   196  000046   8063(2)  	JMP			GET_INITIAL_DATA_FROM_EE
   197  000047             GET_TIME_INITIAL_TM:
   198  000047   6BD2(1)  	B0BSET	S_TM_EE_IO
   199  000048             ;Get initial time from tm
   200  000048   2D30(1)  	MOV		A,#TM_INITIAL_TIME_ADD_H
   201  000049   1F12(1)  	MOV		MAC_H,A
   202  00004A   2D00(1)  	MOV		A,#TM_INITIAL_TIME_ADD_L
   203  00004B   1F13(1)  	MOV		MAC_L,A
   204  00004C   C21B(2)  	CALL	GET_DATA_FROM_TM_FUN
   205  00004D   1E0B(1)  	MOV		A,DATAH
   206  00004E   06FE(1+S)  	CMPRS	A,#0XFE
   207  00004F   1F18(1)  	MOV		INITIAL_TIMEH,A
   208  000050   1E0C(1)  	MOV		A,DATAL
   209  000051   06FE(1+S)  	CMPRS	A,#0XFE
   210  000052   1F19(1)  	MOV		INITIAL_TIMEL,A
   211  000053   C329(2)  	CALL	DELAY_SHORT
   212  000054             ;GET TIME DELAY AND GAP FROM TM
   213  000054   2D31(1)  	MOV		A,#TM_TIME_H
   214  000055   1F12(1)  	MOV		MAC_H,A
   215  000056   2D00(1)  	MOV		A,#TM_TIME_L
   216  000057   1F13(1)  	MOV		MAC_L,A
   217  000058   C21B(2)  	CALL	GET_DATA_FROM_TM_FUN
   218  000059             ;the 2bit in front of DATAH is useness
   219  000059   2D3F(1)  	MOV		A,#0X3F
   220  00005A   290B(1)  	AND		DATAH,A
   221  00005B   1E0B(1)  	MOV			A,DATAH
   222  00005C   063E(1+S)  	CMPRS		A,#0X3E
   223  00005D   1F14(1)  	MOV			FRONT_DELAY,A
   224  00005E   1E0C(1)  	MOV			A,DATAL
   225  00005F   06FE(1+S)  	CMPRS		A,#0XFE
   226  000060   1F15(1)  	MOV			TIME_DELAY_GAP,A		
   227  000061   63D2(1)  	B0BCLR		S_TM_EE_IO
   228  000062   C32F(2)  	CALL		DELAY_LONG
   229  000063             ;*******************************************
   230  000063             GET_INITIAL_DATA_FROM_EE:
   231  000063             ;*******************************************
   232  000063   2D1F(1)  	MOV			A,#LAST_TIME_EE_ADD_H
   233  000064   1F12(1)  	MOV			MAC_H,A
   234  000065   2DFE(1)  	MOV			A,#LAST_TIME_EE_ADD_L
   235  000066   1F13(1)  	MOV			MAC_L,A
   236  000067   5105(1+S)  	BTS0		RESET_FLAG
   237  000068   80CE(2)  	JMP			RESET_EEPROM
   238  000069   C270(2)  	CALL		GET_DATA_FROM_EE_FUN
   239  00006A   1E0E(1)  	MOV			A,ADDRESSL
   240  00006B   1F17(1)  	MOV			STARTADDRL,A
   241  00006C   1E0D(1)  	MOV			A,ADDRESSH
   242  00006D   1F16(1)  	MOV			STARTADDRH,A
   243  00006E   1E0D(1)  	MOV			A,ADDRESSH
   244  00006F   06FF(1+S)  	CMPRS		A,#0XFF
   245  000070   8073(2)  	JMP			$+3
   246  000071   2B16(1)  	CLR			STARTADDRH
   247  000072   2B17(1)  	CLR			STARTADDRL
   248  000073   C32F(2)  	CALL		DELAY_LONG
   249  000074   2D1F(1)  	MOV			A,#LIVE_TIME_ADD_H
   250  000075   1F12(1)  	MOV			MAC_H,A
   251  000076   2DFC(1)  	MOV			A,#LIVE_TIME_ADD_L
   252  000077   1F13(1)  	MOV			MAC_L,A
   253  000078   1E16(1)  	MOV			A,STARTADDRH
   254  000079   1F0B(1)  	MOV			DATAH,A
   255  00007A   1E17(1)  	MOV			A,STARTADDRL
   256  00007B   1F0C(1)  	MOV			DATAL,A
   257  00007C   C1B0(2)  	CALL		DATA_TO_EEPROM_FUN
   258  00007D             ;;;;;;;;;;;;;;LAST READ TM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   259  00007D   6BD2(1)  	B0BSET		S_TM_EE_IO
   260  00007E   60D0(1)  	B0BCLR		VSR_IO
   261  00007F   2D34(1)  	MOV			A,#TM_DATA_H
   262  000080   1F12(1)  	MOV			MAC_H,A
   263  000081   2D00(1)  	MOV			A,#TM_DATA_L
   264  000082   1F13(1)  	MOV			MAC_L,A
   265  000083   C21B(2)  	CALL		GET_DATA_FROM_TM_FUN
   266  000084   64D5(1)  	B0BCLR		VTM_IO
   267  000085   C329(2)  	CALL		DELAY_SHORT
   268  000086   63D2(1)  	B0BCLR		S_TM_EE_IO
   269  000087   64C5(1)  	B0BCLR		VTM_CONT
   270  000088             ;////////////////////READ BLE INITIAL TIME /////////////////
   271  000088   5E06(1+S)  	BTS1		BLE_FLAG
   272  000089   80B7(2)  	JMP			WRITE_INITIAL_DATA_TO_EE
   273  00008A             GET_INITIAL_TIME_FROM_EE:
   274  00008A   C329(2)  	CALL		DELAY_SHORT
   275  00008B   2D1F(1)  	MOV		A,#EE_INITIAL_TIME_ADD_H
   276  00008C   1F12(1)  	MOV		MAC_H,A
   277  00008D   2DFA(1)  	MOV		A,#EE_INITIAL_TIME_ADD_L
   278  00008E   1F13(1)  	MOV		MAC_L,A
   279  00008F   C270(2)  	CALL		GET_DATA_FROM_EE_FUN
   280  000090   1E0D(1)  	MOV		A,ADDRESSH
   281  000091   1F18(1)  	MOV		INITIAL_TIMEH,A
   282  000092   1E0E(1)  	MOV		A,ADDRESSL
   283  000093   1F19(1)  	MOV		INITIAL_TIMEL,A
   284  000094   C32F(2)  	CALL	DELAY_LONG
   285  000095   2D1F(1)  	MOV		A,#EE_DELAY_ADD_H
   286  000096   1F12(1)  	MOV		MAC_H,A
   287  000097   2DF8(1)  	MOV		A,#EE_GAP_ADD_L
   288  000098   1F13(1)  	MOV		MAC_L,A
   289  000099   C270(2)  	CALL		GET_DATA_FROM_EE_FUN
   290  00009A   1E0D(1)  	MOV		A,ADDRESSH
   291  00009B   1F14(1)  	MOV		FRONT_DELAY,A
   292  00009C   1E0E(1)  	MOV		A,ADDRESSL
   293  00009D   1F15(1)  	MOV		TIME_DELAY_GAP,A
   294  00009E   C32F(2)  	CALL	DELAY_LONG
   295  00009F             ;/////////////////WRITE TO TM//////////////////////////////
   296  00009F             WRITE_INITIAL_DATA_TO_TM:
   297  00009F   6BD2(1)  	B0BSET	S_TM_EE_IO
   298  0000A0             ;PUT initial time TO tm
   299  0000A0   2D30(1)  	MOV		A,#TM_INITIAL_TIME_ADD_H
   300  0000A1   1F12(1)  	MOV		MAC_H,A
   301  0000A2   2D00(1)  	MOV		A,#TM_INITIAL_TIME_ADD_L
   302  0000A3   1F13(1)  	MOV		MAC_L,A
   303  0000A4   1E18(1)  	MOV		A,INITIAL_TIMEH
   304  0000A5   1F0B(1)  	MOV		DATAH,A
   305  0000A6   1E19(1)  	MOV		A,INITIAL_TIMEL
   306  0000A7   1F0C(1)  	MOV		DATAL,A
   307  0000A8   C1D3(2)  	CALL	PUT_DATA_INTO_TM_FUN
   308  0000A9             ;PUT TIME DELAY AND GAP TO TM
   309  0000A9   2D31(1)  	MOV		A,#TM_TIME_H
   310  0000AA   1F12(1)  	MOV		MAC_H,A
   311  0000AB   2D00(1)  	MOV		A,#TM_TIME_L
   312  0000AC   1F13(1)  	MOV		MAC_L,A
   313  0000AD             ;the 2bit in front of DATAH is useness
   314  0000AD   2D3F(1)  	MOV		A,#0X3F
   315  0000AE   2814(1)  	AND		A,FRONT_DELAY
   316  0000AF   1F0B(1)  	MOV		DATAH,A
   317  0000B0   1E15(1)  	MOV		A,TIME_DELAY_GAP
   318  0000B1   1F0C(1)  	MOV		DATAL,A	
   319  0000B2   C1D3(2)  	CALL	PUT_DATA_INTO_TM_FUN
   320  0000B3             ;the 2bit in front of DATAH is useness
   321  0000B3   63D2(1)  	B0BCLR		S_TM_EE_IO
   322  0000B4   C32F(2)  	CALL		DELAY_LONG
   323  0000B5             ;///////////////////////////////
   324  0000B5   5606(1+S)  	BTS0	BLE_FLAG
   325  0000B6   80CC(2)  	JMP		SET_WRITE_EE_START_ADD
   326  0000B7             ;/////////////////WRITE TO EE//////////////////////////////
   327  0000B7             WRITE_INITIAL_DATA_TO_EE:
   328  0000B7             ;///////////INITIAL TIME/////////////////////
   329  0000B7   C329(2)  	CALL		DELAY_SHORT
   330  0000B8   2D1F(1)  	MOV		A,#EE_INITIAL_TIME_ADD_H
   331  0000B9   1F12(1)  	MOV		MAC_H,A
   332  0000BA   2DFA(1)  	MOV		A,#EE_INITIAL_TIME_ADD_L
   333  0000BB   1F13(1)  	MOV		MAC_L,A
   334  0000BC   1E18(1)  	MOV		A,INITIAL_TIMEH
   335  0000BD   1F0B(1)  	MOV		DATAH,A
   336  0000BE   1E19(1)  	MOV		A,INITIAL_TIMEL
   337  0000BF   1F0C(1)  	MOV		DATAL,A
   338  0000C0   C1B0(2)  	CALL		DATA_TO_EEPROM_FUN
   339  0000C1   C32F(2)  	CALL	DELAY_LONG
   340  0000C2   2D1F(1)  	MOV		A,#EE_DELAY_ADD_H
   341  0000C3   1F12(1)  	MOV		MAC_H,A
   342  0000C4   2DF8(1)  	MOV		A,#EE_GAP_ADD_L
   343  0000C5   1F13(1)  	MOV		MAC_L,A
   344  0000C6   1E14(1)  	MOV		A,FRONT_DELAY
   345  0000C7   1F0B(1)  	MOV		DATAH,A
   346  0000C8   1E15(1)  	MOV		A,TIME_DELAY_GAP
   347  0000C9   1F0C(1)  	MOV		DATAL,A
   348  0000CA   C1B0(2)  	CALL		DATA_TO_EEPROM_FUN
   349  0000CB   C32F(2)  	CALL	DELAY_LONG
   350  0000CC             
   351  0000CC             
   352  0000CC             SET_WRITE_EE_START_ADD:
   353  0000CC             	
   354  0000CC   5905(1+S)  	BTS1		RESET_FLAG
   355  0000CD   80EE(2)  	JMP			FRONT_DELAY_MODE
   356  0000CE             RESET_EEPROM:
   357  0000CE   2DFF(1)  	MOV		A,#0XFF
   358  0000CF   1F0B(1)  	MOV		DATAH,A
   359  0000D0   2DFF(1)  	MOV		A,#0XFF
   360  0000D1   1F0C(1)  	MOV		DATAL,A
   361  0000D2   2D00(1)  	MOV		A,#0X00
   362  0000D3   1F12(1)  	MOV		MAC_H,A
   363  0000D4             RESET_EE_LOOP_H:
   364  0000D4   2D00(1)  	MOV		A,#0X00
   365  0000D5   1F13(1)  	MOV		MAC_L,A
   366  0000D6             RESET_EE_LOOP_L:
   367  0000D6   C1B0(2)  	CALL		DATA_TO_EEPROM_FUN
   368  0000D7   1613(1+S)  	INCMS	MAC_L
   369  0000D8   80D6(2)  	JMP		RESET_EE_LOOP_L
   370  0000D9   1612(1+S)  	INCMS	MAC_H
   371  0000DA   1E12(1)  	MOV		A,MAC_H
   372  0000DB   0620(1+S)  	CMPRS	A,#0X20
   373  0000DC   80D4(2)  	JMP		RESET_EE_LOOP_H
   374  0000DD   2B16(1)  	CLR		STARTADDRH
   375  0000DE   2B17(1)  	CLR		STARTADDRL
   376  0000DF   2D1F(1)  	MOV		A,#LAST_TIME_EE_ADD_H
   377  0000E0   1F12(1)  	MOV		MAC_H,A
   378  0000E1   2DFE(1)  	MOV		A,#LAST_TIME_EE_ADD_L
   379  0000E2   1F13(1)  	MOV		MAC_L,A
   380  0000E3   1E16(1)  	MOV		A,STARTADDRH
   381  0000E4   1F0B(1)  	MOV		DATAH,A
   382  0000E5   1E17(1)  	MOV		A,STARTADDRL
   383  0000E6   1F0C(1)  	MOV		DATAL,A
   384  0000E7   C1B0(2)  	CALL		DATA_TO_EEPROM_FUN
   385  0000E8   2D1F(1)  	MOV			A,#LIVE_TIME_ADD_H
   386  0000E9   1F12(1)  	MOV			MAC_H,A
   387  0000EA   2DFC(1)  	MOV			A,#LIVE_TIME_ADD_L
   388  0000EB   1F13(1)  	MOV			MAC_L,A
   389  0000EC   C1B0(2)  	CALL		DATA_TO_EEPROM_FUN
   390  0000ED   4105(1)  	BCLR		RESET_FLAG
   391  0000EE             ;******************************************
   392  0000EE             FRONT_DELAY_MODE:
   393  0000EE   6FDF(1)  	B0BSET		FGIE
   394  0000EF   C383(2)  	CALL		SET_LOW_POWER_FUN
   395  0000F0             ;DELAY WAIT_FOR_SEAVAL_MINITE_FUN
   396  0000F0             ;/////////////////////////////////////////	
   397  0000F0   1E14(1)  	MOV   	A,FRONT_DELAY
   398  0000F1   1F0F(1)  	MOV		CRCT1,A
   399  0000F2             FRONT_DELAY_LOOP:
   400  0000F2             	GreenMode
   401  0000F2   6CCA(1)  		B0BSET	FCPUM1
   402  0000F3   0000(1)  		NOP
   403  0000F4   0000(1)  		NOP
   404  0000F5   5406(1+S)  	BTS0	NOT_QUICK_MODE_FLAG
   405  0000F6   C37A(2)  	CALL	SET_EE_TM_FUN
   406  0000F7   5206(1+S)  	BTS0	NOT_UPLOAD_FLAG
   407  0000F8   C383(2)  	CALL	SET_LOW_POWER_FUN
   408  0000F9   5B05(1+S)  	BTS1	TIME_FLAG
   409  0000FA   80F2(2)  	JMP		FRONT_DELAY_LOOP
   410  0000FB   4305(1)  	BCLR	TIME_FLAG
   411  0000FC   260F(1+S)  	DECMS	CRCT1
   412  0000FD   80F2(2)  	JMP		FRONT_DELAY_LOOP
   413  0000FE             	;///////////////////////////
   414  0000FE   4206(1)  	BCLR		NOT_UPLOAD_FLAG
   415  0000FF   4306(1)  	BCLR		HAVE_UPLOAD_FLAG
   416  000100   4606(1)  	BCLR		BLE_FLAG
   417  000101             ;//////////////////////////////////////
   418  000101             MAIN:
   419  000101             	;close tc0 interrupt until the recording finished 
   420  000101             	GreenMode
   421  000101   6CCA(1)  		B0BSET	FCPUM1
   422  000102   0000(1)  		NOP
   423  000103   0000(1)  		NOP
   424  000104             	
   425  000104             JUST_I2CSLAVE_MODE:
   426  000104   5805(1+S)  	BTS1	READTM_FLAG
   427  000105   8166(2)  	JMP		JUST_UPLOAD_MODE
   428  000106   5505(1+S)  	BTS0	FILLOUT_FLAG
   429  000107   8184(2)  	JMP		MEM_FILLOUT_MODE
   430  000108   7CC9(1+S)  	B0BTS1	FT0IEN
   431  000109   8166(2)  	JMP		JUST_UPLOAD_MODE
   432  00010A             ;*****START TM I2C SLAVE MODE***********
   433  00010A             I2CSLAVE_MODE:
   434  00010A   4005(1)  	BCLR 	READTM_FLAG
   435  00010B   59D1(1+S)  	BTS1	VDDF
   436  00010C   8158(2)  	JMP		ADDRESS_CHANGE
   437  00010D   5CD2(1+S)  	BTS1	BLEF
   438  00010E   8158(2)  	JMP		ADDRESS_CHANGE
   439  00010F   4606(1)  	BCLR	BLE_FLAG
   440  000110   67DF(1)  	B0BCLR 	FGIE
   441  000111   6CC5(1)  	B0BSET	VTM_CONT
   442  000112   6BD2(1)  	B0BSET	S_TM_EE_IO
   443  000113   60D0(1)  	B0BCLR	VSR_IO
   444  000114   2D34(1)  	MOV		A,#TM_DATA_H
   445  000115   1F12(1)  	MOV		MAC_H,A
   446  000116   2D00(1)  	MOV		A,#TM_DATA_L
   447  000117   1F13(1)  	MOV		MAC_L,A
   448  000118   C21B(2)  	CALL	GET_DATA_FROM_TM_FUN
   449  000119   64D5(1)  	B0BCLR		VTM_IO
   450  00011A   C329(2)  	CALL		DELAY_SHORT
   451  00011B   63D2(1)  	B0BCLR		S_TM_EE_IO
   452  00011C   64C5(1)  	B0BCLR		VTM_CONT
   453  00011D   C329(2)  	CALL		DELAY_SHORT
   454  00011E   1E16(1)  	MOV		A,STARTADDRH
   455  00011F   1F12(1)  	MOV		MAC_H,A
   456  000120   1E17(1)  	MOV		A,STARTADDRL
   457  000121   1F13(1)  	MOV		MAC_L,A
   458  000122   C1B0(2)  	CALL		DATA_TO_EEPROM_FUN
   459  000123   5906(1+S)  	BTS1		READ_LED_FLAG
   460  000124   8139(2)  	JMP			EEPROM_WIRTE_TEMP_ADD
   461  000125             ;compare temperature is over the set level
   462  000125   4706(1)  	BCLR		TMP_LEVEL_FLAG
   463  000126   1E0B(1)  	MOV			A,DATAH
   464  000127   1F1A(1)  	MOV			TEMPERATURE_H,A
   465  000128   2D1F(1)  	MOV			A,#TMP_LEVEL_ADDH
   466  000129   1F12(1)  	MOV			MAC_H,A
   467  00012A   2DF0(1)  	MOV			A,#TMP_LEVEL_ADDL
   468  00012B   1F13(1)  	MOV			MAC_L,A
   469  00012C   C270(2)  	CALL		GET_DATA_FROM_EE_FUN
   470  00012D   1E0D(1)  	MOV			A,ADDRESSH
   471  00012E   06FF(1+S)  	CMPRS		A,#0XFF
   472  00012F   2D20(1)  	MOV			A,#HIGT_TMP_LEVEL1
   473  000130   221A(1)  	SUB			A,TEMPERATURE_H
   474  000131   7A86(1+S)  	B0BTS1		FC
   475  000132   4F06(1)  	BSET		TMP_LEVEL_FLAG
   476  000133   1E0E(1)  	MOV			A,ADDRESSL
   477  000134   06FF(1+S)  	CMPRS		A,#0XFF
   478  000135   2D05(1)  	MOV			A,#LOW_TMP_LEVEL1
   479  000136   221A(1)  	SUB			A,TEMPERATURE_H
   480  000137   7286(1+S)  	B0BTS0		FC
   481  000138   4F06(1)  	BSET		TMP_LEVEL_FLAG
   482  000139             ;////////////////////////////////////////
   483  000139             EEPROM_WIRTE_TEMP_ADD:
   484  000139   2D1F(1)  	MOV		A,#LAST_TIME_EE_ADD_H
   485  00013A   1F12(1)  	MOV		MAC_H,A
   486  00013B   2DFE(1)  	MOV		A,#LAST_TIME_EE_ADD_L
   487  00013C   1F13(1)  	MOV		MAC_L,A
   488  00013D   1E16(1)  	MOV		A,STARTADDRH
   489  00013E   1F0B(1)  	MOV		DATAH,A
   490  00013F   1E17(1)  	MOV		A,STARTADDRL
   491  000140   1F0C(1)  	MOV		DATAL,A
   492  000141   C1B0(2)  	CALL		DATA_TO_EEPROM_FUN
   493  000142   74C8(1+S)  	B0BTS0		FT0IRQ
   494  000143   1607(1+S)  	INCMS		TIMEH
   495  000144   64C8(1)  	B0BCLR		FT0IRQ
   496  000145   6FDF(1)  	B0BSET		FGIE
   497  000146   2D0A(1)  	MOV			A,#TIME_GAP
   498  000147   1F10(1)  	MOV			CRCT2,A
   499  000148   6286(1)  	B0BCLR		FC
   500  000149   5906(1+S)  	BTS1		READ_LED_FLAG
   501  00014A   814D(2)  	JMP			$+3
   502  00014B   5706(1+S)  	BTS0		TMP_LEVEL_FLAG
   503  00014C   0910(1)  	RRCM		CRCT2
   504  00014D   1E10(1)  	MOV			A,CRCT2
   505  00014E   0707(1+S)  	CMPRS		A,TIMEH
   506  00014F   8158(2)  	JMP			ADDRESS_CHANGE
   507  000150   2B07(1)  	CLR			TIMEH
   508  000151   4B05(1)  	BSET		TIME_FLAG
   509  000152   1608(1+S)  	INCMS		TIMEG
   510  000153   1E15(1)  	MOV			A,TIME_DELAY_GAP
   511  000154   0708(1+S)  	CMPRS		A,TIMEG
   512  000155   8158(2)  	JMP			ADDRESS_CHANGE
   513  000156   2B08(1)  	CLR			TIMEG
   514  000157   4805(1)  	BSET		READTM_FLAG
   515  000158             ADDRESS_CHANGE:
   516  000158   2D02(1)  	MOV			A,#0X02
   517  000159   1317(1)  	ADD			STARTADDRL,A
   518  00015A   2D00(1)  	MOV			A,#0X00
   519  00015B   1116(1)  	ADC			STARTADDRH,A
   520  00015C   2D1F(1)  	MOV			A,#MAX_MEMH
   521  00015D   0716(1+S)  	CMPRS		A,STARTADDRH
   522  00015E   8104(2)  	JMP			JUST_I2CSLAVE_MODE
   523  00015F   2DDE(1)  	MOV			A,#MAX_MEML
   524  000160   0717(1+S)  	CMPRS		A,STARTADDRL
   525  000161   8104(2)  	JMP			JUST_I2CSLAVE_MODE
   526  000162   4D05(1)  	BSET		FILLOUT_FLAG
   527  000163   67D8(1)  	B0BCLR		FT0ENB
   528  000164   64C9(1)  	B0BCLR		FT0IEN
   529  000165   8184(2)  	JMP			MEM_FILLOUT_MODE
   530  000166             ;*****************************************
   531  000166             JUST_UPLOAD_MODE:
   532  000166   62C2(1)  	B0BCLR		CLED_CONT
   533  000167   C329(2)  	CALL		DELAY_SHORT
   534  000168   C329(2)  	CALL		DELAY_SHORT
   535  000169   7AD2(1+S)  	B0BTS1		CLED_IO
   536  00016A   819A(2)  	JMP			RESET_MODE
   537  00016B             BLE_EE_UPLOAD_MODE:
   538  00016B   5606(1+S)  	BTS0		BLE_FLAG
   539  00016C   8172(2)  	JMP			END_BLE_EE_MODE
   540  00016D   54D2(1+S)  	BTS0		BLEF
   541  00016E   8176(2)  	JMP			TM_EE_UPLOAD_MODE
   542  00016F   4E06(1)  	BSET		BLE_FLAG
   543  000170   C383(2)  	CALL		SET_LOW_POWER_FUN
   544  000171   8184(2)  	JMP			MEM_FILLOUT_MODE
   545  000172             END_BLE_EE_MODE:
   546  000172   5CD2(1+S)  	BTS1		BLEF
   547  000173   8184(2)  	JMP			MEM_FILLOUT_MODE
   548  000174   C383(2)  	CALL		SET_LOW_POWER_FUN
   549  000175   4606(1)  	BCLR		BLE_FLAG
   550  000176             TM_EE_UPLOAD_MODE:
   551  000176   5205(1+S)  	BTS0		TM_EE_FLAG
   552  000177   817E(2)  	JMP			END_TM_EE_MODE
   553  000178   51D1(1+S)  	BTS0		VDDF
   554  000179   8184(2)  	JMP			MEM_FILLOUT_MODE
   555  00017A             TM_EE_MODE:
   556  00017A   4306(1)  	BCLR		HAVE_UPLOAD_FLAG
   557  00017B   5205(1+S)  	BTS0		TM_EE_FLAG
   558  00017C   817E(2)  	JMP			END_TM_EE_MODE
   559  00017D   C37A(2)  	CALL		SET_EE_TM_FUN
   560  00017E             END_TM_EE_MODE:
   561  00017E             	;BTS0		FILLOUT_FLAG
   562  00017E             	;JMP			MEM_FILLOUT_MODE	
   563  00017E   59D1(1+S)  	BTS1		VDDF
   564  00017F   8184(2)  	JMP			MEM_FILLOUT_MODE
   565  000180   C383(2)  	CALL		SET_LOW_POWER_FUN
   566  000181   5505(1+S)  	BTS0		FILLOUT_FLAG
   567  000182   8184(2)  	JMP			MEM_FILLOUT_MODE
   568  000183             	;we should keep rtc function 
   569  000183   8191(2)  	JMP		ON_LED_MODE
   570  000184             ;*************************************
   571  000184             MEM_FILLOUT_MODE:
   572  000184   5D05(1+S)  	BTS1	FILLOUT_FLAG
   573  000185   8191(2)  	JMP		ON_LED_MODE
   574  000186             ;***************************
   575  000186             	;B0BTS1	VDDF
   576  000186             	;JMP		$+4
   577  000186             	;BTS0	TM_EE_FLAG
   578  000186             	;CALL	SET_LOW_POWER_FUN
   579  000186             	;JMP		$+3
   580  000186             	;BTS1	TM_EE_FLAG
   581  000186             	;CALL	SET_EE_TM_FUN
   582  000186             ;********************************
   583  000186   7FD8(1+S)  	B0BTS1		FT0ENB
   584  000187   818B(2)  	JMP			$+4
   585  000188   2BD9(1)  	CLR			T0C
   586  000189   64C8(1)  	B0BCLR		FT0IRQ
   587  00018A   64C9(1)  	B0BCLR		FT0IEN
   588  00018B   67D8(1)  	B0BCLR		FT0ENB
   589  00018C             	SleepMode
   590  00018C   6BCA(1)  		B0BSET	FCPUM0
   591  00018D             END_FILLOUT_MODE:
   592  00018D   6AC2(1)  	B0BSET		CLED_CONT
   593  00018E   6AD2(1)  	B0BSET		CLED_IO
   594  00018F   C324(2)  	CALL		DELAY_MINI
   595  000190   8166(2)  	JMP		JUST_UPLOAD_MODE
   596  000191             ON_LED_MODE:
   597  000191   6AC2(1)  	B0BSET	CLED_CONT
   598  000192   6AD2(1)  	B0BSET	CLED_IO
   599  000193   5106(1+S)  	BTS0	READ_LED_FLAG
   600  000194   C19F(2)  	CALL	READ_LED_FUN
   601  000195   4106(1)  	BCLR   	READ_LED_FLAG
   602  000196   6AD2(1)  	B0BSET	CLED_IO
   603  000197   5505(1+S)  	BTS0	FILLOUT_FLAG
   604  000198   8166(2)  	JMP		JUST_UPLOAD_MODE
   605  000199   8101(2)  	JMP		MAIN
   606  00019A             RESET_MODE:
   607  00019A   4905(1)  	BSET	RESET_FLAG
   608  00019B   4505(1)  	BCLR	FILLOUT_FLAG
   609  00019C   2B07(1)  	CLR		TIMEH
   610  00019D   2B08(1)  	CLR		TIMEG
   611  00019E   803F(2)  	JMP		STATE_INITIAL
   612  00019F             	
   613  00019F             ;******************************************************************************	
   614  00019F             READ_LED_FUN:
   615  00019F   2D01(1)     	MOV  	   	A,#1
   616  0001A0   1F04(1)     	MOV  	   	TLC2,A
   617  0001A1             LED_MODEL1:	
   618  0001A1   6AD2(1)     	B0BSET   	CLED_IO
   619  0001A2   C339(2)     	CALL   	   	DELAY_LED
   620  0001A3   62D2(1)     	B0BCLR   	CLED_IO
   621  0001A4   C339(2)     	CALL   	   	DELAY_LED
   622  0001A5   2604(1+S)     	DECMS   	TLC2
   623  0001A6   81A1(2)     	JMP   	   	LED_MODEL1
   624  0001A7   0E00(2)     	RET
   625  0001A8             ;*******************************************************
   626  0001A8             ;***************************************
   627  0001A8             	
   628  0001A8             	
   629  0001A8             	
   630  0001A8             	
   631  0001A8             	
   632  0001A8             	
   633  0001A8             	
   634  0001A8             	
   635  0001A8             	
   636  0001A8             	
   637  0001A8             	
   638  0001A8             	
   639  0001A8             	
   640  0001A8             	
   641  0001A8             	
   642  0001A8             	
   643  0001A8             CLRRAM:
   644  0001A8             	
   645  0001A8   2B84(1)  	CLR			Y
   646  0001A9   2D2F(1)  	MOV			A,#END_RAM_ADDR
   647  0001AA   2F83(1)  	B0MOV		Z,A
   648  0001AB             CLRRAM10:
   649  0001AB   2BE7(1)  	CLR			@YZ
   650  0001AC   2683(1+S)  	DECMS		Z
   651  0001AD   81AB(2)  	JMP			CLRRAM10
   652  0001AE   2BE7(1)  	CLR			@YZ
   653  0001AF   0E00(2)  	RET
   654  0001B0             ;***********************************
   655  0001B0             ;***************************************
   656  0001B0             ;*************WRITE TMEPERATURE INTO EEPROM*************
   657  0001B0             ;*************RECORDING ADDRESS THE LAST TIME STORAGE THE TMPERATURE VALUE************
   658  0001B0             ;**************************************
   659  0001B0             DATA_TO_EEPROM_FUN:
   660  0001B0   6DC2(1)  	B0BSET		SDA_CONT
   661  0001B1   6DD2(1)  	B0BSET		SDA_IO
   662  0001B2   68C2(1)  	B0BSET		SCL_CONT
   663  0001B3   68D2(1)  	B0BSET		SCL_IO
   664  0001B4   1E13(1)  	MOV			A,MAC_L
   665  0001B5   1F10(1)  	MOV			CRCT2,A
   666  0001B6   1E0B(1)  	MOV			A,DATAH
   667  0001B7   1F0F(1)  	MOV			CRCT1,A
   668  0001B8   2D02(1)  	MOV			A,#0X02
   669  0001B9   1F04(1)  	MOV			TLC2,A
   670  0001BA             MOVE_DATA_TO_EEPROM:
   671  0001BA   C29C(2)  	CALL		I2C_START_EE
   672  0001BB   2DA0(1)  	MOV			A,#EEW_ADD
   673  0001BC   1F09(1)  	MOV			DATA_IN,A
   674  0001BD   C2ED(2)  	CALL		EEADDRESS_ASK
   675  0001BE   1E12(1)  	MOV			A,MAC_H
   676  0001BF   1F09(1)  	MOV			DATA_IN,A
   677  0001C0   C2ED(2)  	CALL		EEADDRESS_ASK
   678  0001C1   1E10(1)  	MOV			A,CRCT2
   679  0001C2   1F09(1)  	MOV			DATA_IN,A
   680  0001C3   C2ED(2)  	CALL		EEADDRESS_ASK
   681  0001C4   C324(2)  	CALL		DELAY_MINI
   682  0001C5   1E0F(1)  	MOV			A,CRCT1
   683  0001C6   1F09(1)  	MOV			DATA_IN,A
   684  0001C7   C2ED(2)  	CALL		EEADDRESS_ASK
   685  0001C8   C2A2(2)  	CALL		I2C_END_EE
   686  0001C9             	
   687  0001C9   C32F(2)  	CALL		DELAY_LONG
   688  0001CA   2D01(1)  	MOV			A,#0X01
   689  0001CB   1310(1)  	ADD			CRCT2,A
   690  0001CC   1E0C(1)  	MOV			A,DATAL
   691  0001CD   1F0F(1)  	MOV			CRCT1,A
   692  0001CE   2604(1+S)  	DECMS		TLC2
   693  0001CF   81BA(2)  	JMP			MOVE_DATA_TO_EEPROM
   694  0001D0             ;*********************************************
   695  0001D0   60C2(1)  	B0BCLR		SCL_CONT
   696  0001D1   65C2(1)  	B0BCLR		SDA_CONT
   697  0001D2   0E00(2)  	RET
   698  0001D3             ;**************************************
   699  0001D3             PUT_DATA_INTO_TM_FUN:
   700  0001D3   68C2(1)  	B0BSET	SCL_CONT
   701  0001D4   69C2(1)  	B0BSET	SDATA_CONT
   702  0001D5   61D2(1)  	B0BCLR	SDATA_IO
   703  0001D6   60D2(1)  	B0BCLR	SCL_IO
   704  0001D7   C32F(2)  	CALL 	DELAY_LONG
   705  0001D8   C32F(2)  	CALL 	DELAY_LONG
   706  0001D9   6CD5(1)  	B0BSET 	VTM_IO
   707  0001DA   C32F(2)  	CALL 	DELAY_LONG
   708  0001DB             	;CALL	DELAY_LONG
   709  0001DB             START_TMI2C_S:
   710  0001DB   2D04(1)  	MOV 	A,#0X04
   711  0001DC   1F03(1)  	MOV 	TLC0,A
   712  0001DD             LOOP_1_S:
   713  0001DD   68D2(1)  	B0BSET 	SCL_IO
   714  0001DE   C324(2)  	CALL	DELAY_MINI;13US
   715  0001DF   C323(2)  	CALL	CALL_DELAY
   716  0001E0   60D2(1)  	B0BCLR 	SCL_IO
   717  0001E1   C324(2)  	CALL 	DELAY_MINI
   718  0001E2   2603(1+S)  	DECMS  	TLC0
   719  0001E3   81DD(2)  	JMP 	LOOP_1_S
   720  0001E4   41D2(1)  	BCLR 	SDATA_IO
   721  0001E5   C32F(2)  	CALL	DELAY_LONG
   722  0001E6   C32F(2)  	CALL	DELAY_LONG
   723  0001E7   2D04(1)  	MOV 	A,#4
   724  0001E8   2F03(1)  	B0MOV 	TLC0,A
   725  0001E9             LOOP_2_S:
   726  0001E9   60D2(1)  	B0BCLR 	SCL_IO
   727  0001EA   C324(2)  	CALL	DELAY_MINI
   728  0001EB   C323(2)  	CALL	CALL_DELAY
   729  0001EC   68D2(1)  	B0BSET 	SCL_IO
   730  0001ED   C324(2)  	CALL	DELAY_MINI
   731  0001EE   2603(1+S)  	DECMS 	TLC0
   732  0001EF   81E9(2)  	JMP 	LOOP_2_S
   733  0001F0   C329(2)  	CALL	DELAY_SHORT
   734  0001F1   2D14(1)  	MOV 	A,#20
   735  0001F2   2F03(1)  	B0MOV 	TLC0,A
   736  0001F3   49D2(1)  	BSET 	SDATA_IO
   737  0001F4             WAIT_TM_INIT_S:
   738  0001F4   C32F(2)  	CALL 		DELAY_LONG
   739  0001F5   2603(1+S)  	DECMS 		TLC0
   740  0001F6   81F4(2)  	JMP 		WAIT_TM_INIT_S
   741  0001F7             ;**************START*****************************
   742  0001F7   C2A9(2)  	CALL		I2C_START_TM
   743  0001F8             ;***********************************************
   744  0001F8   2D3C(1)  	MOV 		A,#TMW_ADD
   745  0001F9   1F09(1)  	MOV 		DATA_IN,A
   746  0001FA   C2B7(2)  	CALL 		TMADDRESS_ASK
   747  0001FB   5506(1+S)  	BTS0		TM_I2C_EEROR
   748  0001FC   8215(2)  	JMP			END_TM_S
   749  0001FD   1E12(1)  	MOV 		A,MAC_H
   750  0001FE   1F09(1)  	MOV 		DATA_IN,A
   751  0001FF   C2B7(2)  	CALL 		TMADDRESS_ASK
   752  000200   1E13(1)  	MOV 		A,MAC_L
   753  000201   1F09(1)  	MOV 		DATA_IN,A
   754  000202   C2B7(2)  	CALL 		TMADDRESS_ASK
   755  000203   C32F(2)  	CALL		DELAY_LONG
   756  000204   1E0B(1)  	MOV 		A,DATAH
   757  000205   1F09(1)  	MOV 		DATA_IN,A
   758  000206   C2B7(2)  	CALL 		TMADDRESS_ASK
   759  000207   1E0C(1)  	MOV 		A,DATAL
   760  000208   1F09(1)  	MOV 		DATA_IN,A
   761  000209   C2B7(2)  	CALL 		TMADDRESS_ASK
   762  00020A   C329(2)  	CALL		DELAY_SHORT
   763  00020B             ;**************END*******************************
   764  00020B             ;//////////////////////DEBUG////////////////////
   765  00020B   C2AF(2)  	CALL		I2C_END_TM
   766  00020C   C32F(2)  	CALL		DELAY_LONG
   767  00020D   C2A9(2)  	CALL		I2C_START_TM
   768  00020E             ;***********************************************
   769  00020E   2D3C(1)  	MOV 		A,#0X3C
   770  00020F   1F09(1)  	MOV 		DATA_IN,A
   771  000210   C2B7(2)  	CALL 		TMADDRESS_ASK
   772  000211             ;**************END*******************************
   773  000211   C2AF(2)  	CALL		I2C_END_TM
   774  000212   C32F(2)  	CALL		DELAY_LONG
   775  000213   C32F(2)  	CALL		DELAY_LONG
   776  000214   61D2(1)  	B0BCLR		SDATA_IO
   777  000215             END_TM_S:
   778  000215   4506(1)  	BCLR		TM_I2C_EEROR
   779  000216   64D5(1)  	B0BCLR 		VTM_IO
   780  000217   61C2(1)  	B0BCLR		SDATA_CONT
   781  000218   60C2(1)  	B0BCLR		SCL_CONT
   782  000219   C329(2)  	CALL 		DELAY_SHORT
   783  00021A   0E00(2)  	RET
   784  00021B             ;*******************************************
   785  00021B             ;*****************************************
   786  00021B             GET_DATA_FROM_TM_FUN:
   787  00021B   2D0F(1)  	MOV		A,#0X0F
   788  00021C   1F11(1)  	MOV		COUNT,A
   789  00021D             TM_I2C_WORK_LOOP:
   790  00021D   68C2(1)  	B0BSET	SCL_CONT
   791  00021E   69C2(1)  	B0BSET	SDATA_CONT
   792  00021F   61D2(1)  	B0BCLR	SDATA_IO
   793  000220   60D2(1)  	B0BCLR	SCL_IO
   794  000221   C32F(2)  	CALL 	DELAY_LONG
   795  000222   C32F(2)  	CALL 	DELAY_LONG
   796  000223   6CD5(1)  	B0BSET 	VTM_IO
   797  000224   C32F(2)  	CALL 	DELAY_LONG
   798  000225             	;CALL	DELAY_LONG
   799  000225             START_TMI2C:
   800  000225   2D04(1)  	MOV 	A,#0X04
   801  000226   1F03(1)  	MOV 	TLC0,A
   802  000227             LOOP_1:
   803  000227   68D2(1)  	B0BSET 	SCL_IO
   804  000228   C324(2)  	CALL	DELAY_MINI;13US
   805  000229   C323(2)  	CALL	CALL_DELAY
   806  00022A   60D2(1)  	B0BCLR 	SCL_IO
   807  00022B   C324(2)  	CALL 	DELAY_MINI
   808  00022C   2603(1+S)  	DECMS  	TLC0
   809  00022D   8227(2)  	JMP 	LOOP_1
   810  00022E   2D28(1)  	MOV 	A,#40
   811  00022F   2F03(1)  	B0MOV 	TLC0,A
   812  000230   41D2(1)  	BCLR 	SDATA_IO
   813  000231   C32F(2)  	CALL	DELAY_LONG
   814  000232             	;CALL	DELAY_SHORT
   815  000232   2D04(1)  	MOV 	A,#4
   816  000233   2F03(1)  	B0MOV 	TLC0,A
   817  000234             LOOP_2:
   818  000234   60D2(1)  	B0BCLR 	SCL_IO
   819  000235   C324(2)  	CALL	DELAY_MINI
   820  000236   C323(2)  	CALL	CALL_DELAY
   821  000237   68D2(1)  	B0BSET 	SCL_IO
   822  000238   C324(2)  	CALL	DELAY_MINI
   823  000239   2603(1+S)  	DECMS 	TLC0
   824  00023A   8234(2)  	JMP 	LOOP_2
   825  00023B   C329(2)  	CALL	DELAY_SHORT
   826  00023C   2D05(1)  	MOV 	A,#5
   827  00023D   2F03(1)  	B0MOV 	TLC0,A
   828  00023E   49D2(1)  	BSET 	SDATA_IO
   829  00023F             WAIT_TM_INIT:
   830  00023F   C32F(2)  	CALL 		DELAY_LONG
   831  000240   2603(1+S)  	DECMS 		TLC0
   832  000241   823F(2)  	JMP 		WAIT_TM_INIT
   833  000242             ;**************START*****************************
   834  000242   C2A9(2)  	CALL		I2C_START_TM
   835  000243             ;***********************************************
   836  000243   2D3D(1)  	MOV 		A,#TMR_ADD
   837  000244   1F09(1)  	MOV 		DATA_IN,A
   838  000245   C2B7(2)  	CALL 		TMADDRESS_ASK
   839  000246   5506(1+S)  	BTS0		TM_I2C_EEROR
   840  000247   826A(2)  	JMP			END_TM
   841  000248   1E12(1)  	MOV 		A,MAC_H
   842  000249   1F09(1)  	MOV 		DATA_IN,A
   843  00024A   C2B7(2)  	CALL 		TMADDRESS_ASK
   844  00024B   1E13(1)  	MOV 		A,MAC_L
   845  00024C   1F09(1)  	MOV 		DATA_IN,A
   846  00024D   C2B7(2)  	CALL 		TMADDRESS_ASK
   847  00024E   61C2(1)  	B0BCLR		SDATA_CONT
   848  00024F   C32F(2)  	CALL 		DELAY_LONG
   849  000250   4705(1)  	BCLR 		ASK_FLAG
   850  000251   C2D1(2)  	CALL 		TMDATA_ASK
   851  000252   1E0A(1)  	MOV 		A,DATA_OUT
   852  000253   1F0B(1)  	MOV 		DATAH,A
   853  000254   4F05(1)  	BSET 		ASK_FLAG
   854  000255   C2D1(2)  	CALL 		TMDATA_ASK
   855  000256   1E0A(1)  	MOV 		A,DATA_OUT
   856  000257   1F0C(1)  	MOV 		DATAL,A		
   857  000258             ;//////////////////////DEBUG////////////////////
   858  000258   C2AF(2)  	CALL		I2C_END_TM
   859  000259   C32F(2)  	CALL		DELAY_LONG
   860  00025A   C2A9(2)  	CALL		I2C_START_TM
   861  00025B             ;***********************************************
   862  00025B   2D3C(1)  	MOV 		A,#0X3C
   863  00025C   1F09(1)  	MOV 		DATA_IN,A
   864  00025D   C2B7(2)  	CALL 		TMADDRESS_ASK
   865  00025E             ;**************END*******************************
   866  00025E             ;**************END*******************************
   867  00025E   C2AF(2)  	CALL		I2C_END_TM
   868  00025F   C329(2)  	CALL		DELAY_SHORT
   869  000260   61D2(1)  	B0BCLR		SDATA_IO
   870  000261   2611(1+S)  	DECMS		COUNT
   871  000262   8264(2)  	JMP			$+2
   872  000263   826A(2)  	JMP			END_TM
   873  000264   64D5(1)  	B0BCLR 		VTM_IO
   874  000265   2D00(1)  	MOV			A,#0X00
   875  000266   070B(1+S)  	CMPRS		A,DATAH
   876  000267   8269(2)  	JMP			$+2
   877  000268   821D(2)  	JMP			TM_I2C_WORK_LOOP
   878  000269   4906(1)  	BSET		READ_LED_FLAG
   879  00026A             END_TM:
   880  00026A   4506(1)  	BCLR		TM_I2C_EEROR
   881  00026B   64D5(1)  	B0BCLR 		VTM_IO
   882  00026C   61C2(1)  	B0BCLR		SDATA_CONT
   883  00026D   60C2(1)  	B0BCLR		SCL_CONT
   884  00026E   C329(2)  	CALL 		DELAY_SHORT
   885  00026F             ;////////////////////////////////////////////////
   886  00026F             ;	MOV			A,#0X00
   887  00026F             ;	CMPRS		A,DATAH
   888  00026F             ;	JMP			EXIT_TM_I2C
   889  00026F             ;	CMPRS		A,DATAL
   890  00026F             ;	JMP			EXIT_TM_I2C
   891  00026F             ;	MOV			A,#0XFE
   892  00026F             ;	MOV			DATAH,A
   893  00026F             ;	MOV			DATAL,A
   894  00026F             EXIT_TM_I2C:
   895  00026F   0E00(2)  	RET
   896  000270             ;*******************************************
   897  000270             ;***********************************************************
   898  000270             ;*********************************************************
   899  000270             GET_DATA_FROM_EE_FUN:
   900  000270   68C2(1)  	B0BSET		SCL_CONT
   901  000271   6DC2(1)  	B0BSET		SDA_CONT
   902  000272   6DD2(1)  	B0BSET		SDA_IO
   903  000273   68D2(1)  	B0BSET		SCL_IO
   904  000274   C329(2)  	CALL		DELAY_SHORT
   905  000275   C29C(2)  	CALL		I2C_START_EE
   906  000276   2DA0(1)  	MOV			A,#EEW_ADD
   907  000277   1F09(1)  	MOV			DATA_IN,A
   908  000278   C2ED(2)  	CALL		EEADDRESS_ASK
   909  000279   1E12(1)  	MOV			A,MAC_H
   910  00027A   1F09(1)  	MOV			DATA_IN,A
   911  00027B   C2ED(2)  	CALL		EEADDRESS_ASK
   912  00027C   1E13(1)  	MOV			A,MAC_L
   913  00027D   1F09(1)  	MOV			DATA_IN,A
   914  00027E   C2ED(2)  	CALL		EEADDRESS_ASK
   915  00027F   6DD2(1)  	B0BSET		SDA_IO
   916  000280   C329(2)  	CALL		DELAY_SHORT
   917  000281   68D2(1)  	B0BSET		SCL_IO
   918  000282   C329(2)  	CALL		DELAY_SHORT
   919  000283   C29C(2)  	CALL		I2C_START_EE
   920  000284   C329(2)  	CALL		DELAY_SHORT
   921  000285   2DA1(1)  	MOV			A,#EER_ADD
   922  000286   1F09(1)  	MOV			DATA_IN,A
   923  000287   C2ED(2)  	CALL		EEADDRESS_ASK
   924  000288   65C2(1)  	B0BCLR		SDA_CONT
   925  000289   4705(1)  	BCLR		ASK_FLAG
   926  00028A   C307(2)  	CALL		EEDATA_ASK
   927  00028B   1E0A(1)  	MOV			A,DATA_OUT
   928  00028C   1F0D(1)  	MOV			ADDRESSH,A
   929  00028D   65C2(1)  	B0BCLR		SDA_CONT
   930  00028E   C324(2)  	CALL		DELAY_MINI
   931  00028F   4F05(1)  	BSET		ASK_FLAG
   932  000290   C307(2)  	CALL		EEDATA_ASK
   933  000291   1E0A(1)  	MOV			A,DATA_OUT
   934  000292   1F0E(1)  	MOV			ADDRESSL,A
   935  000293   C2A2(2)  	CALL		I2C_END_EE
   936  000294             ;*************************************
   937  000294   C329(2)  	CALL		DELAY_SHORT
   938  000295   60C2(1)  	B0BCLR		SCL_CONT
   939  000296   65C2(1)  	B0BCLR		SDA_CONT
   940  000297   0E00(2)  	RET
   941  000298             ;************************************************
   942  000298             I2C_EEROR:
   943  000298             	;open interrupt
   944  000298             	;SleepMode
   945  000298   4605(1)  	BCLR	I2CERROR_FLAG
   946  000299   54D5(1+S)  	BTS0	VTM_IO
   947  00029A   4D06(1)  	BSET	TM_I2C_EEROR
   948  00029B   0E00(2)  	RET
   949  00029C             I2C_START_EE:
   950  00029C   C324(2)  	CALL		DELAY_MINI
   951  00029D   65D2(1)  	B0BCLR 		SDA_IO
   952  00029E   C324(2)  	CALL 		DELAY_MINI
   953  00029F   60D2(1)  	B0BCLR 		SCL_IO
   954  0002A0   C324(2)  	CALL 		DELAY_MINI
   955  0002A1   0E00(2)  	RET
   956  0002A2             I2C_END_EE:
   957  0002A2   65D2(1)  	B0BCLR 		SDA_IO
   958  0002A3   C324(2)  	CALL 		DELAY_MINI
   959  0002A4   68D2(1)  	B0BSET 		SCL_IO
   960  0002A5   C324(2)  	CALL 		DELAY_MINI
   961  0002A6   6DD2(1)  	B0BSET 		SDA_IO
   962  0002A7   C324(2)  	CALL		DELAY_MINI
   963  0002A8   0E00(2)  	RET
   964  0002A9             I2C_START_TM:
   965  0002A9   C324(2)  	CALL		DELAY_MINI
   966  0002AA   61D2(1)  	B0BCLR 		SDATA_IO
   967  0002AB   C324(2)  	CALL 		DELAY_MINI
   968  0002AC   60D2(1)  	B0BCLR 		SCL_IO
   969  0002AD   C324(2)  	CALL 		DELAY_MINI
   970  0002AE   0E00(2)  	RET
   971  0002AF             I2C_END_TM:
   972  0002AF   61D2(1)  	B0BCLR 		SDATA_IO
   973  0002B0   C324(2)  	CALL 		DELAY_MINI
   974  0002B1   60D2(1)  	B0BCLR		SCL_IO
   975  0002B2   C324(2)  	CALL		DELAY_MINI
   976  0002B3   69D2(1)  	B0BSET 		SDATA_IO
   977  0002B4   C324(2)  	CALL		DELAY_MINI
   978  0002B5   68D2(1)  	B0BSET 		SCL_IO
   979  0002B6   0E00(2)  	RET
   980  0002B7             TMADDRESS_ASK:
   981  0002B7   2D08(1)  	MOV 		A,#8
   982  0002B8   1F02(1)  	MOV 		TIMEOUT,A
   983  0002B9             TMADDRESS_LOOP:
   984  0002B9   5709(1+S)  	BTS0		DATA_IN.7
   985  0002BA   82BE(2)  	JMP 		MD_1
   986  0002BB   71D2(1+S)  	B0BTS0 		SDATA_IO
   987  0002BC   61D2(1)  	B0BCLR		SDATA_IO
   988  0002BD   82C0(2)  	JMP 		NEXT_1
   989  0002BE             MD_1:
   990  0002BE   79D2(1+S)  	B0BTS1 		SDATA_IO
   991  0002BF   69D2(1)  	B0BSET		SDATA_IO
   992  0002C0             NEXT_1:
   993  0002C0   C324(2)  	CALL		DELAY_MINI
   994  0002C1   68D2(1)  	B0BSET 		SCL_IO
   995  0002C2   C324(2)  	CALL		DELAY_MINI
   996  0002C3   0B09(1)  	RLCM 		DATA_IN
   997  0002C4   60D2(1)  	B0BCLR 		SCL_IO
   998  0002C5   2602(1+S)  	DECMS 		TIMEOUT
   999  0002C6   82B9(2)  	JMP 		TMADDRESS_LOOP
  1000  0002C7             	
  1001  0002C7   61C2(1)  	B0BCLR 		SDATA_CONT
  1002  0002C8   C324(2)  	CALL		DELAY_MINI
  1003  0002C9   68D2(1)  	B0BSET 		SCL_IO
  1004  0002CA   C323(2)  	CALL 		CALL_DELAY
  1005  0002CB   71D2(1+S)  	B0BTS0 		SDATA_IO
  1006  0002CC   C298(2)  	CALL		I2C_EEROR
  1007  0002CD   C324(2)  	CALL		DELAY_MINI
  1008  0002CE   40D2(1)  	BCLR 		SCL_IO
  1009  0002CF   49C2(1)  	BSET 		SDATA_CONT
  1010  0002D0   0E00(2)  	RET
  1011  0002D1             ;**********************TM_READING_DATA********************************
  1012  0002D1             TMDATA_ASK:
  1013  0002D1   61C2(1)  	B0BCLR 		SDATA_CONT
  1014  0002D2   2D08(1)  	MOV 		A,#8
  1015  0002D3   1F02(1)  	MOV 		TIMEOUT,A
  1016  0002D4             TMDATA_LOOP:
  1017  0002D4   2D09(1)  	MOV 		A,#9
  1018  0002D5   1F03(1)  	MOV 		TLC0,A
  1019  0002D6   C324(2)  	CALL		DELAY_MINI
  1020  0002D7   48D2(1)  	BSET 		SCL_IO
  1021  0002D8   C323(2)  	CALL 		CALL_DELAY
  1022  0002D9   71D2(1+S)  	B0BTS0 		SDATA_IO
  1023  0002DA   480A(1)  	BSET 		DATA_OUT.0
  1024  0002DB   79D2(1+S)  	B0BTS1 		SDATA_IO
  1025  0002DC   400A(1)  	BCLR 		DATA_OUT.0
  1026  0002DD   0B0A(1)  	RLCM 		DATA_OUT
  1027  0002DE   C324(2)  	CALL		DELAY_MINI
  1028  0002DF   60D2(1)  	B0BCLR 		SCL_IO
  1029  0002E0   2602(1+S)  	DECMS 		TIMEOUT
  1030  0002E1   82D4(2)  	JMP 		TMDATA_LOOP
  1031  0002E2   69C2(1)  	B0BSET 		SDATA_CONT
  1032  0002E3   5705(1+S)  	BTS0 		ASK_FLAG
  1033  0002E4   69D2(1)  	B0BSET 		SDATA_IO
  1034  0002E5   5F05(1+S)  	BTS1 		ASK_FLAG
  1035  0002E6   61D2(1)  	B0BCLR 		SDATA_IO
  1036  0002E7   090A(1)  	RRCM 		DATA_OUT
  1037  0002E8   C324(2)  	CALL		DELAY_MINI
  1038  0002E9   48D2(1)  	BSET 		SCL_IO
  1039  0002EA   C324(2)  	CALL		DELAY_MINI
  1040  0002EB   40D2(1)  	BCLR		SCL_IO	
  1041  0002EC   0E00(2)  	RET
  1042  0002ED             ;******************************************************
  1043  0002ED             EEADDRESS_ASK:
  1044  0002ED   2D08(1)  	MOV 		A,#8
  1045  0002EE   1F02(1)  	MOV 		TIMEOUT,A
  1046  0002EF             EEADDRESS_LOOP:
  1047  0002EF   5709(1+S)  	BTS0		DATA_IN.7
  1048  0002F0   82F4(2)  	JMP 		EEMD_1
  1049  0002F1   75D2(1+S)  	B0BTS0 		SDA_IO
  1050  0002F2   65D2(1)  	B0BCLR		SDA_IO
  1051  0002F3   82F6(2)  	JMP 		EENEXT_1
  1052  0002F4             EEMD_1:
  1053  0002F4   7DD2(1+S)  	B0BTS1 		SDA_IO
  1054  0002F5   6DD2(1)  	B0BSET		SDA_IO
  1055  0002F6             EENEXT_1:
  1056  0002F6   C324(2)  	CALL		DELAY_MINI
  1057  0002F7   68D2(1)  	B0BSET 		SCL_IO
  1058  0002F8   C324(2)  	CALL		DELAY_MINI
  1059  0002F9   0B09(1)  	RLCM 		DATA_IN
  1060  0002FA   60D2(1)  	B0BCLR 		SCL_IO
  1061  0002FB   2602(1+S)  	DECMS 		TIMEOUT
  1062  0002FC   82EF(2)  	JMP 		EEADDRESS_LOOP
  1063  0002FD             	
  1064  0002FD   65C2(1)  	B0BCLR 		SDA_CONT
  1065  0002FE   C324(2)  	CALL		DELAY_MINI
  1066  0002FF   68D2(1)  	B0BSET 		SCL_IO
  1067  000300   C323(2)  	CALL 		CALL_DELAY
  1068  000301   75D2(1+S)  	B0BTS0 		SDA_IO
  1069  000302   C298(2)  	CALL		I2C_EEROR
  1070  000303   C324(2)  	CALL		DELAY_MINI
  1071  000304   40D2(1)  	BCLR 		SCL_IO
  1072  000305   4DC2(1)  	BSET 		SDA_CONT
  1073  000306   0E00(2)  	RET
  1074  000307             ;****************************************
  1075  000307             EEDATA_ASK:
  1076  000307   65C2(1)  	B0BCLR 		SDA_CONT
  1077  000308   2D08(1)  	MOV 		A,#8
  1078  000309   1F02(1)  	MOV 		TIMEOUT,A
  1079  00030A             EEDATA_LOOP:
  1080  00030A   2D09(1)  	MOV 		A,#9
  1081  00030B   1F03(1)  	MOV 		TLC0,A
  1082  00030C   C324(2)  	CALL		DELAY_MINI
  1083  00030D   48D2(1)  	BSET 		SCL_IO
  1084  00030E   C323(2)  	CALL 		CALL_DELAY
  1085  00030F   75D2(1+S)  	B0BTS0 		SDA_IO
  1086  000310   480A(1)  	BSET 		DATA_OUT.0
  1087  000311   7DD2(1+S)  	B0BTS1 		SDA_IO
  1088  000312   400A(1)  	BCLR 		DATA_OUT.0
  1089  000313   0B0A(1)  	RLCM 		DATA_OUT
  1090  000314   C324(2)  	CALL		DELAY_MINI
  1091  000315   60D2(1)  	B0BCLR 		SCL_IO
  1092  000316   2602(1+S)  	DECMS 		TIMEOUT
  1093  000317   830A(2)  	JMP 		EEDATA_LOOP
  1094  000318             	
  1095  000318   6DC2(1)  	B0BSET 		SDA_CONT
  1096  000319   5705(1+S)  	BTS0 		ASK_FLAG
  1097  00031A   6DD2(1)  	B0BSET 		SDA_IO
  1098  00031B   5F05(1+S)  	BTS1 		ASK_FLAG
  1099  00031C   65D2(1)  	B0BCLR 		SDA_IO
  1100  00031D   090A(1)  	RRCM 		DATA_OUT
  1101  00031E   C324(2)  	CALL		DELAY_MINI
  1102  00031F   48D2(1)  	BSET 		SCL_IO
  1103  000320   C324(2)  	CALL		DELAY_MINI
  1104  000321   40D2(1)  	BCLR		SCL_IO	
  1105  000322   0E00(2)  	RET
  1106  000323             ;*********************delay*****************
  1107  000323             CALL_DELAY:
  1108  000323   0E00(2)  	RET
  1109  000324             DELAY_MINI:;13US
  1110  000324   2D05(1)  	MOV		A,#0X05
  1111  000325   1F00(1)  	MOV		DELAYTIME1,A
  1112  000326             DELAY0:
  1113  000326   2600(1+S)  	DECMS	DELAYTIME1
  1114  000327   8326(2)  	JMP		DELAY0
  1115  000328   0E00(2)  	RET
  1116  000329             	
  1117  000329             DELAY_SHORT:		;50US FOR 0.5US/INSTRUCTION
  1118  000329   2D63(1)  	MOV		A,#0X63
  1119  00032A   1F00(1)  	MOV		DELAYTIME1,A
  1120  00032B             DELAY1:
  1121  00032B   0000(1)  	NOP
  1122  00032C   2600(1+S)  	DECMS	DELAYTIME1
  1123  00032D   832B(2)  	JMP		DELAY1
  1124  00032E   0E00(2)  	RET
  1125  00032F             DELAY_LONG:	;>=5MS
  1126  00032F             ;WAIT_FOR_A_LONG_WHILE
  1127  00032F   2D0A(1)  	MOV		A,#0X0A
  1128  000330   2F00(1)  	B0MOV	DELAYTIME1,A
  1129  000331             DELAY2_1:
  1130  000331   2DC7(1)  	MOV		A,#0XC7
  1131  000332   1F01(1)  	MOV		DELAYTIME2,A
  1132  000333             DELAY2_2:
  1133  000333   0000(1)  	NOP
  1134  000334   2601(1+S)  	DECMS	DELAYTIME2
  1135  000335   8333(2)  	JMP		DELAY2_2	
  1136  000336   2600(1+S)  	DECMS	DELAYTIME1
  1137  000337   8331(2)  	JMP		DELAY2_1
  1138  000338   0E00(2)  	RET		
  1139  000339             DELAY_LED:		;0.2S
  1140  000339             ;WAIT_FOR_DEEP_DARK_FANTASY
  1141  000339   2DFF(1)  	MOV		A,#0XFF
  1142  00033A   1F01(1)  	MOV		DELAYTIME2,A
  1143  00033B             DELAY3_1:
  1144  00033B   2DFF(1)  	MOV		A,#0XFF
  1145  00033C   1F00(1)  	MOV		DELAYTIME1,A
  1146  00033D             DELAY3_2:
  1147  00033D   0000(1)  	NOP
  1148  00033E   0000(1)  	NOP
  1149  00033F   2600(1+S)  	DECMS		DELAYTIME1
  1150  000340   833D(2)  	JMP			DELAY3_2
  1151  000341   2601(1+S)  	DECMS		DELAYTIME2
  1152  000342   833B(2)  	JMP			DELAY3_1
  1153  000343   0E00(2)  	RET
  1154  000344             OPEN_TC0_INT_FUN:
  1155  000344   6BDA(1)  	B0BSET	FTC0CKS	;	OUTSIDE INPUT ACCIDENT
  1156  000345   6ADA(1)  	B0BSET	FALOAD0 ;
  1157  000346   2DFD(1)  	MOV		A,#0XFD
  1158  000347   2FCD(1)  	B0MOV	TC0R,A
  1159  000348   2FDB(1)  	B0MOV	TC0C,A
  1160  000349   65C8(1)  	B0BCLR	FTC0IRQ
  1161  00034A   6DC9(1)  	B0BSET	FTC0IEN
  1162  00034B   6FDA(1)  	B0BSET	FTC0ENB
  1163  00034C   0E00(2)  	RET
  1164  00034D             SYS_INIT_FUN:
  1165  00034D   2D2D(1)  	MOV			A,#0X2D
  1166  00034E   2FC2(1)  	B0MOV		P2M,A
  1167  00034F   2D35(1)  	MOV			A,#0X35
  1168  000350   2FD2(1)  	B0MOV		P2,A
  1169  000351             	;up resistor for p2.4
  1170  000351   2D10(1)  	MOV			A,#0X10
  1171  000352   2FE2(1)  	B0MOV		P2UR,A
  1172  000353   2D01(1)  	MOV			A,#0X01
  1173  000354   2FC1(1)  	B0MOV		P1M,A
  1174  000355   2BD1(1)  	CLR			P1
  1175  000356   68B8(1)  	B0BSET		VSR_CONT
  1176  000357   60D0(1)  	B0BCLR		VSR_IO
  1177  000358   68C1(1)  	B0BSET		S_VDD_VCC_CONT
  1178  000359   60D1(1)  	B0BCLR		S_VDD_VCC_IO
  1179  00035A   6CC5(1)  	B0BSET		VTM_CONT
  1180  00035B   64D5(1)  	B0BCLR		VTM_IO
  1181  00035C   2D03(1)  	MOV			A,#0X03
  1182  00035D   1F0F(1)  	MOV			CRCT1,A
  1183  00035E   C329(2)  	CALL		DELAY_SHORT
  1184  00035F   54D2(1+S)  	BTS0		BLEF
  1185  000360   8364(2)  	JMP			SYS_INIT_LED
  1186  000361   4E06(1)  	BSET		BLE_FLAG
  1187  000362   2D02(1)  	MOV			A,#0X02
  1188  000363   1F0F(1)  	MOV			CRCT1,A
  1189  000364             SYS_INIT_LED:
  1190  000364   62D2(1)  	B0BCLR		CLED_IO
  1191  000365   C339(2)  	CALL		DELAY_LED	
  1192  000366   6AD2(1)  	B0BSET		CLED_IO
  1193  000367   C339(2)  	CALL		DELAY_LED
  1194  000368   260F(1+S)  	DECMS		CRCT1
  1195  000369   8364(2)  	JMP			SYS_INIT_LED
  1196  00036A             ;************T0_INIT_START************************************
  1197  00036A   2D00(1)  	MOV			A,#0X00
  1198  00036B   2FD8(1)  	B0MOV		T0M,A	
  1199  00036C   68D8(1)  	B0BSET		FT0TB	; T0 = Fcpu/256,PERIOD TIME IS 2S
  1200  00036D   2BD9(1)  	CLR			T0C
  1201  00036E   64C8(1)  	B0BCLR		FT0IRQ
  1202  00036F   6CC9(1)  	B0BSET		FT0IEN
  1203  000370   6FD8(1)  	B0BSET		FT0ENB
  1204  000371             ;*****************TC0_INIT_START*****************
  1205  000371   2BDA(1)  	CLR			TC0M
  1206  000372   2BDB(1)  	CLR			TC0C
  1207  000373   65C8(1)  	B0BCLR		FTC0IRQ
  1208  000374   65C9(1)  	B0BCLR		FTC0IEN
  1209  000375   67DA(1)  	B0BCLR		FTC0ENB
  1210  000376             ;************************OPEN P1.1WEEK UP FUNCTION*********************
  1211  000376   2D02(1)  	MOV			A,#0X02
  1212  000377   2FC0(1)  	B0MOV		P1W,A
  1213  000378   C324(2)  	CALL		DELAY_MINI
  1214  000379   0E00(2)  	RET
  1215  00037A             ;//////////////////////////////////////////////////
  1216  00037A             SET_EE_TM_FUN:
  1217  00037A   65C2(1)  	B0BCLR		SDA_CONT
  1218  00037B   64C5(1)  	B0BCLR		VTM_CONT
  1219  00037C   60C2(1)  	B0BCLR		SCL_CONT
  1220  00037D   61C2(1)  	B0BCLR		SDATA_CONT
  1221  00037E   68D0(1)  	B0BSET		VSR_IO
  1222  00037F   6BD2(1)  	B0BSET		S_TM_EE_IO
  1223  000380   4A05(1)  	BSET		TM_EE_FLAG
  1224  000381   4406(1)  	BCLR	NOT_QUICK_MODE_FLAG
  1225  000382   0E00(2)  	RET
  1226  000383             ;////////////////////////////////////////
  1227  000383             ;////////////SET LOW POWER
  1228  000383             SET_LOW_POWER_FUN:
  1229  000383             ;****************************************
  1230  000383   64C5(1)  	B0BCLR		VTM_CONT
  1231  000384   63D2(1)  	B0BCLR		S_TM_EE_IO
  1232  000385   60D0(1)  	B0BCLR		VSR_IO
  1233  000386   4205(1)  	BCLR		TM_EE_FLAG
  1234  000387   0E00(2)  	RET
  1235  000388             ;/////////////////////////////////////////	
  1236  000388             ;*******************************************
  1237  000388             	ENDP
