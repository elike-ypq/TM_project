     1  000000             CHIP		SN8P2501D
     2  000000             //{{SONIX_CODE_OPTION
     3  000000             	.Code_Option	Noise_Filter	Enable
     4  000000             	.Code_Option	Reset_Pin	P11
     5  000000             	.Code_Option	Watch_Dog	Disable
     6  000000             	.Code_Option	High_Clk	IHRC_RTC	;
     7  000000             	.Code_Option	Fcpu		#3     ; Fcpu = Fosc/8
     8  000000             	.Code_Option	Security	Enable
     9  000000             	.Code_Option	LVD		LVD_L		;
    10  000000             //}}SONIX_CODE_OPTION
    11  000000             
    12  E 0000002F         	END_RAM_ADDR	EQU	0X2F
    13  E 000000A1         	EER_ADD			EQU	0XA1	;10100001B
    14  E 000000A0         	EEW_ADD			EQU	0XA0	;10100000B
    15  E 00000030         	RAM_COUNT		EQU	48
    16  E 00000034         	TM_DATA_H		EQU	0X34	;ADDR OF THE TEMPEATURE	OF TM
    17  E 00000000         	TM_DATA_L		EQU	0X00
    18  E 00000078         	TIME_GAP		EQU	0X78	;0X78
    19  E 00000001         	T0_TDR			EQU	0X01
    20  E 0000003D         	TMR_ADD 		EQU	0X3D
    21  E 0000003C         	TMW_ADD			EQU	0X3C
    22  E 0000001F         	MAX_MEMH		EQU	0X1F
    23  E 000000F0         	MAX_MEML		EQU	0XF0
    24  E 0000001F         	LAST_TIME_EE_ADD_H EQU 0X1F
    25  E 000000FE         	LAST_TIME_EE_ADD_L EQU 0XFE
    26  E 0000001F         	LIVE_TIME_ADD_H		EQU	0X1F
    27  E 000000FC         	LIVE_TIME_ADD_L		EQU	0XFC
    28  E 00000001         	DEFAULT_FRONT_TIME_DELAY	EQU	0X01
    29  E 00000001         	DEFAULT_TIME_GAP	EQU	0X01
    30  E 0000002E         	TM_TIME_H		EQU	0X2E
    31  E 00000000         	TM_TIME_L		EQU	0X00
    32  E 0000002F         	WRITE_TM_ADD_H	EQU	0X2F
    33  E 00000000         	WRITE_TM_ADD_L	EQU	0X00
    34  E 00000001         	WRITE_FLAG_H	EQU 0X01
    35  E 00000000         	WRITE_FLAG_L	EQU	0X00
    36  E 00000002         	DEFAULT_GAP_TIME_FLAGH EQU 0X02
    37  E 00000000         	DEFAULT_GAP_TIME_FLAGL EQU	0X00
    38  000000             .DATA
    39  000000             			ORG	0H
    40  0000 D             	DELAYTIME1	DS	1
    41  0001 D             	DELAYTIME2	DS	1
    42  0002 D             	TIMEOUT		DS	1
    43  0003 D             	TLC0		DS	1
    44  0004 D             	TLC1		DS	1
    45  0005 D             	TLC2		DS	1
    46  0006 D             	FLAG1		DS	1
    47  0007 D             	FLAG2		DS	1
    48  0008 D             	TIMEH		DS	1
    49  0009 D             	TIMEG		DS	1
    50  000A D             	DATA_IN		DS	1
    51  000B D             	DATA_OUT	DS	1
    52  000C D             	DATAH		DS	1
    53  000D D             	DATAL		DS	1
    54  000E D             	ADDRESSH	DS	1
    55  000F D             	ADDRESSL	DS	1
    56  0010 D             	CRCT1		DS	1
    57  0011 D             	CRCT2		DS	1
    58  0012 D             	COUNT		DS	1
    59  0013 D             	MAC_H		DS	1
    60  0014 D             	MAC_L		DS	1
    61  0015 D             	FRONT_DELAY	DS	1
    62  0016 D             	TIME_DELAY_GAP	DS	1
    63  0017 D             	STARTADDRH		DS	1
    64  0018 D             	STARTADDRL		DS	1
    65  000019             ;**************BIT_VARIABLES_DEFINNITIONS*******
    66  E 00000006         	READTM_FLAG	EQU	FLAG1.0
    67  E 00030006         	TIME_FLAG	EQU	FLAG1.3
    68  E 00010006         	RESET_FLAG	EQU	FLAG1.1
    69  E 00020006         	TM_EE_FLAG	EQU FLAG1.2
    70  E 00040006         	DEFAULT_GAP_FLAG	EQU	FLAG1.4
    71  E 00050006         	FILLOUT_FLAG	EQU	FLAG1.5
    72  E 00060006         	I2CERROR_FLAG	EQU	FLAG1.6
    73  E 00070006         	ASK_FLAG	EQU	FLAG1.7
    74  E 00010007         	READ_LED_FLAG	EQU	FLAG2.1
    75  E 00020007         	NOT_UPLOAD_FLAG	EQU	FLAG2.2
    76  E 00030007         	HAVE_UPLOAD_FLAG EQU FLAG2.3
    77  E 00040007         	NOT_QUICK_MODE_FLAG EQU FLAG2.4
    78  E 00050007         	TM_I2C_EEROR	EQU FLAG2.5
    79  E 000200D2         	CLED_IO			EQU	P2.2
    80  E 000100D2         	SDATA_IO		EQU	P2.1
    81  E 000000D2         	SCL_IO			EQU	P2.0
    82  E 000300D2         	S_TM_EE_IO		EQU	P2.3
    83  E 000400D2         	IC_IDLE	EQU	P2.4
    84  E 000500D2         	SDA_IO			EQU	P2.5
    85  E 000400D5         	VTM_IO			EQU	P5.4
    86  E 000000D0         	VSR_IO			EQU	P0.0
    87  E 000200C2         	CLED_CONT		EQU	P2M.2
    88  E 000100C2         	SDATA_CONT		EQU	P2M.1
    89  E 000000C2         	SCL_CONT		EQU	P2M.0
    90  E 000300C2         	S_TM_EE_CONT	EQU	P2M.3
    91  E 000500C2         	SDA_CONT		EQU	P2M.5
    92  E 000400C5         	VTM_CONT		EQU	P5M.4
    93  E 000000B8         	VSR_CONT		EQU	P0M.0
    94  000019             ;***************************************
    95  E 000100D1         	VDDF			EQU	P1.1
    96  E 000000D1         	S_VDD_VCC_IO		EQU	P1.0
    97  E 000000C1         	S_VDD_VCC_CONT		EQU	P1M.0
    98  000019             ;*************CODE_SECTION**********************	
    99  000000             .CODE
   100  000000             
   101  000000             		ORG	0
   102  000000   8030(2)  	JMP		START
   103  000008             		ORG	8H
   104  000008   8009(2)  	JMP		INT_SERVICE
   105  000009             INT_SERVICE:
   106  000009             ;KEEP ACC AND PFLAG
   107  000009   0400(1)  	PUSH
   108  00000A             ;T0 INTERRUPT
   109  00000A             JUST_T0:
   110  00000A   74C9(1+S)  	B0BTS0	FT0IEN
   111  00000B   7CC8(1+S)  	B0BTS1	FT0IRQ
   112  00000C   8025(2)  	JMP		JUST_TC0
   113  00000D   64C8(1)  	B0BCLR	FT0IRQ
   114  00000E             ;T0 INTERRUPT SERVISE PROGRESS
   115  00000E   71D1(1+S)  	B0BTS0	VDDF
   116  00000F   4A07(1)  	BSET 	NOT_UPLOAD_FLAG
   117  000010   71D1(1+S)  	B0BTS0	VDDF
   118  000011   4307(1)  	BCLR    HAVE_UPLOAD_FLAG
   119  000012             ;///////////////////////////////
   120  000012   5B07(1+S)  	BTS1	HAVE_UPLOAD_FLAG
   121  000013   8016(2)  	JMP		$+3
   122  000014   79D1(1+S)  	B0BTS1	VDDF
   123  000015   4C07(1)  	BSET	NOT_QUICK_MODE_FLAG
   124  000016   79D1(1+S)  	B0BTS1	VDDF
   125  000017   4B07(1)  	BSET    HAVE_UPLOAD_FLAG
   126  000018             ;//////////////////////////////////
   127  000018   1608(1+S)  	INCMS	TIMEH ;TIMEH=TIMEH+1,
   128  000019   2D78(1)  	MOV		A,#TIME_GAP
   129  00001A   0708(1+S)  	CMPRS	A,TIMEH
   130  00001B   802E(2)  	JMP		EXIT_INT
   131  00001C   2B08(1)  	CLR		TIMEH
   132  00001D   4B06(1)  	BSET	TIME_FLAG
   133  00001E   1609(1+S)  	INCMS	TIMEG
   134  00001F   1E16(1)  	MOV		A,TIME_DELAY_GAP
   135  000020   0709(1+S)  	CMPRS	A,TIMEG
   136  000021   802E(2)  	JMP		EXIT_INT
   137  000022   2B09(1)  	CLR		TIMEG
   138  000023   4806(1)  	BSET	READTM_FLAG
   139  000024   802E(2)  	JMP		EXIT_INT
   140  000025             JUST_TC0:
   141  000025   75C9(1+S)  	B0BTS0	FTC0IEN
   142  000026   7DC8(1+S)  	B0BTS1	FTC0IRQ
   143  000027   802A(2)  	JMP		JUST_INT0
   144  000028   65C8(1)  	B0BCLR	FTC0IRQ
   145  000029             ;TC0 INTERRUPT SERVICE PROGRESS
   146  000029   802E(2)  	JMP		EXIT_INT
   147  00002A             JUST_INT0:
   148  00002A   70C9(1+S)  	B0BTS0	FP00IEN
   149  00002B   78C8(1+S)  	B0BTS1	FP00IRQ
   150  00002C   802E(2)  	JMP EXIT_INT
   151  00002D   60C8(1)  	B0BCLR	FP00IRQ
   152  00002E             ;INT0 INTERRUPT SERVISE PROGRESS
   153  00002E             EXIT_INT:
   154  00002E   0500(1)  	POP
   155  00002F   0F00(2)  	RETI
   156  000030             ;*********************************************************
   157  000030             ;***********************STARRT**********************
   158  000030             START:
   159  000030   2D7F(1)  	MOV		A,#07FH
   160  000031   2FDF(1)  	B0MOV		STKP,A		;DISABLE GLOBAL INTERRUPT
   161  000032   2B86(1)  	CLR		PFLAG
   162  000033   2D00(1)  	MOV		A,#00H
   163  000034   2FCA(1)  	B0MOV		OSCM,A
   164  000035   2D5A(1)  	MOV		A,#0X5A
   165  000036   2FCC(1)  	B0MOV		WDTR,A	
   166  000037   C146(2)  	CALL		CLRRAM
   167  000038             STATE_INITIAL:
   168  000038   C2DE(2)  	CALL		SYS_INIT_FUN
   169  000039   67DF(1)  	B0BCLR		FGIE
   170  00003A             GET_TIME_GAP:
   171  00003A             ;******************************************
   172  00003A   2D01(1)  	MOV		A,#DEFAULT_FRONT_TIME_DELAY
   173  00003B   1F15(1)  	MOV		FRONT_DELAY,A
   174  00003C   2D01(1)  	MOV		A,#DEFAULT_TIME_GAP
   175  00003D   1F16(1)  	MOV		TIME_DELAY_GAP,A
   176  00003E   6BD2(1)  	B0BSET	S_TM_EE_IO
   177  00003F   64D2(1)  	B0BCLR	IC_IDLE
   178  000040   2D2E(1)  	MOV		A,#TM_TIME_H
   179  000041   1F13(1)  	MOV		MAC_H,A
   180  000042   2D00(1)  	MOV		A,#TM_TIME_L
   181  000043   1F14(1)  	MOV		MAC_L,A
   182  000044   C1B1(2)  	CALL	GET_DATA_FROM_TM_FUN
   183  000045   1E0C(1)  	MOV			A,DATAH
   184  000046   0600(1+S)  	CMPRS		A,#0X00
   185  000047   1F15(1)  	MOV			FRONT_DELAY,A
   186  000048   1E0D(1)  	MOV			A,DATAL
   187  000049   0600(1+S)  	CMPRS		A,#0X00
   188  00004A   1F16(1)  	MOV			TIME_DELAY_GAP,A		
   189  00004B   63D2(1)  	B0BCLR		S_TM_EE_IO
   190  00004C   C2C0(2)  	CALL		DELAY_LONG
   191  00004D             ;*******************************************
   192  00004D             WRITE_FLAG_TO_TM:
   193  00004D   6BD2(1)  	B0BSET		S_TM_EE_IO
   194  00004E   2D01(1)  	MOV			A,#WRITE_FLAG_H
   195  00004F   1F0C(1)  	MOV			DATAH,A
   196  000050   2D00(1)  	MOV			A,#WRITE_FLAG_L
   197  000051   1F0D(1)  	MOV			DATAL,A
   198  000052   5107(1+S)  	BTS0		READ_LED_FLAG
   199  000053   8058(2)  	JMP			$+5
   200  000054   2D02(1)  	MOV			A,#DEFAULT_GAP_TIME_FLAGH
   201  000055   1F0C(1)  	MOV			DATAH,A
   202  000056   2D00(1)  	MOV			A,#DEFAULT_GAP_TIME_FLAGL
   203  000057   1F0D(1)  	MOV			DATAL,A
   204  000058   C170(2)  	CALL		PUT_DATA_INTO_TM_FUN
   205  000059   63D2(1)  	B0BCLR		S_TM_EE_IO
   206  00005A   C2BA(2)  	CALL		DELAY_SHORT
   207  00005B             ;*******************************************
   208  00005B   2D1F(1)  	MOV			A,#LAST_TIME_EE_ADD_H
   209  00005C   1F13(1)  	MOV			MAC_H,A
   210  00005D   2DFE(1)  	MOV			A,#LAST_TIME_EE_ADD_L
   211  00005E   1F14(1)  	MOV			MAC_L,A
   212  00005F   5106(1+S)  	BTS0		RESET_FLAG
   213  000060   8090(2)  	JMP			RESET_EEPROM
   214  000061   C202(2)  	CALL		GET_DATA_FROM_EE_FUN
   215  000062   1E0F(1)  	MOV			A,ADDRESSL
   216  000063   1F18(1)  	MOV			STARTADDRL,A
   217  000064   1E0E(1)  	MOV			A,ADDRESSH
   218  000065   1F17(1)  	MOV			STARTADDRH,A
   219  000066   1E0E(1)  	MOV			A,ADDRESSH
   220  000067   06FF(1+S)  	CMPRS		A,#0XFF
   221  000068   806B(2)  	JMP			$+3
   222  000069   2B17(1)  	CLR			STARTADDRH
   223  00006A   2B18(1)  	CLR			STARTADDRL
   224  00006B   C2C0(2)  	CALL		DELAY_LONG
   225  00006C   2D1F(1)  	MOV			A,#LIVE_TIME_ADD_H
   226  00006D   1F13(1)  	MOV			MAC_H,A
   227  00006E   2DFC(1)  	MOV			A,#LIVE_TIME_ADD_L
   228  00006F   1F14(1)  	MOV			MAC_L,A
   229  000070   C202(2)  	CALL		GET_DATA_FROM_EE_FUN
   230  000071             ;;;;;;;;;;;;;;LAST READ TM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   231  000071   6BD2(1)  	B0BSET		S_TM_EE_IO
   232  000072   60D0(1)  	B0BCLR		VSR_IO
   233  000073   2D34(1)  	MOV			A,#TM_DATA_H
   234  000074   1F13(1)  	MOV			MAC_H,A
   235  000075   2D00(1)  	MOV			A,#TM_DATA_L
   236  000076   1F14(1)  	MOV			MAC_L,A
   237  000077   C1B1(2)  	CALL		GET_DATA_FROM_TM_FUN
   238  000078   64D5(1)  	B0BCLR		VTM_IO
   239  000079   C2BA(2)  	CALL		DELAY_SHORT
   240  00007A   63D2(1)  	B0BCLR		S_TM_EE_IO
   241  00007B   64C5(1)  	B0BCLR		VTM_CONT
   242  00007C             ;/////////////////WRITE TO EE//////////////////////////////
   243  00007C   1E0E(1)  	MOV			A,ADDRESSH
   244  00007D   06FF(1+S)  	CMPRS		A,#0XFF
   245  00007E   8080(2)  	JMP			$+2
   246  00007F   8083(2)  	JMP			$+4
   247  000080   160F(1+S)  	INCMS		ADDRESSL
   248  000081   160E(1+S)  	INCMS		ADDRESSH
   249  000082   8085(2)  	JMP			$+3
   250  000083   2B0F(1)  	CLR			ADDRESSL
   251  000084   2B0E(1)  	CLR			ADDRESSH
   252  000085   1E0F(1)  	MOV			A,ADDRESSL
   253  000086   1F0D(1)  	MOV			DATAL,A
   254  000087   1E0E(1)  	MOV			A,ADDRESSH
   255  000088   1F0C(1)  	MOV			DATAH,A
   256  000089   C14E(2)  	CALL		DATA_TO_EEPROM_FUN
   257  00008A   1E17(1)  	MOV			A,STARTADDRH
   258  00008B   1F0E(1)  	MOV			ADDRESSH,A
   259  00008C   1E18(1)  	MOV			A,STARTADDRL
   260  00008D   1F0F(1)  	MOV			ADDRESSL,A
   261  00008E   5906(1+S)  	BTS1		RESET_FLAG
   262  00008F   80B0(2)  	JMP			FRONT_DELAY_MODE
   263  000090             RESET_EEPROM:
   264  000090   2DFF(1)  	MOV		A,#0XFF
   265  000091   1F0C(1)  	MOV		DATAH,A
   266  000092   2DFF(1)  	MOV		A,#0XFF
   267  000093   1F0D(1)  	MOV		DATAL,A
   268  000094   2D00(1)  	MOV		A,#0X00
   269  000095   1F13(1)  	MOV		MAC_H,A
   270  000096             RESET_EE_LOOP_H:
   271  000096   2D00(1)  	MOV		A,#0X00
   272  000097   1F14(1)  	MOV		MAC_L,A
   273  000098             RESET_EE_LOOP_L:
   274  000098   C14E(2)  	CALL		DATA_TO_EEPROM_FUN
   275  000099   1614(1+S)  	INCMS	MAC_L
   276  00009A   8098(2)  	JMP		RESET_EE_LOOP_L
   277  00009B   1613(1+S)  	INCMS	MAC_H
   278  00009C   1E13(1)  	MOV		A,MAC_H
   279  00009D   0620(1+S)  	CMPRS	A,#0X20
   280  00009E   8096(2)  	JMP		RESET_EE_LOOP_H
   281  00009F   2B0F(1)  	CLR		ADDRESSL
   282  0000A0   2B0E(1)  	CLR		ADDRESSH
   283  0000A1   2D1F(1)  	MOV		A,#LAST_TIME_EE_ADD_H
   284  0000A2   1F13(1)  	MOV		MAC_H,A
   285  0000A3   2DFE(1)  	MOV		A,#LAST_TIME_EE_ADD_L
   286  0000A4   1F14(1)  	MOV		MAC_L,A
   287  0000A5   1E0E(1)  	MOV		A,ADDRESSH
   288  0000A6   1F0C(1)  	MOV		DATAH,A
   289  0000A7   1E0F(1)  	MOV		A,ADDRESSL
   290  0000A8   1F0D(1)  	MOV		DATAL,A
   291  0000A9   C14E(2)  	CALL		DATA_TO_EEPROM_FUN
   292  0000AA   2D1F(1)  	MOV			A,#LIVE_TIME_ADD_H
   293  0000AB   1F13(1)  	MOV			MAC_H,A
   294  0000AC   2DFC(1)  	MOV			A,#LIVE_TIME_ADD_L
   295  0000AD   1F14(1)  	MOV			MAC_L,A
   296  0000AE   C14E(2)  	CALL		DATA_TO_EEPROM_FUN
   297  0000AF   4106(1)  	BCLR		RESET_FLAG
   298  0000B0             ;******************************************
   299  0000B0             FRONT_DELAY_MODE:
   300  0000B0   6FDF(1)  	B0BSET		FGIE
   301  0000B1   C30D(2)  	CALL		SET_LOW_POWER_FUN
   302  0000B2             ;DELAY
   303  0000B2   C313(2)  	CALL		WAIT_FOR_SEAVAL_MINITE_FUN
   304  0000B3             	;///////////////////////////
   305  0000B3   4207(1)  	BCLR		NOT_UPLOAD_FLAG
   306  0000B4   4307(1)  	BCLR		HAVE_UPLOAD_FLAG
   307  0000B5             ;//////////////////////////////////////
   308  0000B5             MAIN:
   309  0000B5             	;close tc0 interrupt until the recording finished 
   310  0000B5             	GreenMode
   311  0000B5   6CCA(1)  		B0BSET	FCPUM1
   312  0000B6   0000(1)  		NOP
   313  0000B7   0000(1)  		NOP
   314  0000B8             	
   315  0000B8             JUST_I2CSLAVE_MODE:
   316  0000B8   5806(1+S)  	BTS1	READTM_FLAG
   317  0000B9   8108(2)  	JMP		JUST_UPLOAD_MODE
   318  0000BA   5506(1+S)  	BTS0	FILLOUT_FLAG
   319  0000BB   811B(2)  	JMP		MEM_FILLOUT_MODE
   320  0000BC   7CC9(1+S)  	B0BTS1	FT0IEN
   321  0000BD   8108(2)  	JMP		JUST_UPLOAD_MODE
   322  0000BE             ;*****START TM I2C SLAVE MODE***********
   323  0000BE             I2CSLAVE_MODE:
   324  0000BE   4006(1)  	BCLR 	READTM_FLAG
   325  0000BF             ;//////////////////////////////////////
   326  0000BF   7DD2(1+S)  	B0BTS1		SDA_IO
   327  0000C0   80F9(2)  	JMP			ADDRESS_CHANGE
   328  0000C1   6DC2(1)  	B0BSET		SDA_CONT
   329  0000C2   65D2(1)  	B0BCLR		SDA_IO
   330  0000C3   68C2(1)  	B0BSET		SCL_CONT
   331  0000C4   60D2(1)  	B0BCLR		SCL_IO
   332  0000C5   C2C0(2)  	CALL		DELAY_LONG
   333  0000C6   71D1(1+S)  	B0BTS0		VDDF
   334  0000C7   4A07(1)  	BSET		NOT_UPLOAD_FLAG
   335  0000C8   65C2(1)  	B0BCLR		SDA_CONT
   336  0000C9   60C2(1)  	B0BCLR		SCL_CONT
   337  0000CA             ;/////////////////////////////////////////
   338  0000CA   5A07(1+S)  	BTS1		NOT_UPLOAD_FLAG
   339  0000CB   80F9(2)  	JMP		ADDRESS_CHANGE
   340  0000CC   4207(1)  	BCLR		NOT_UPLOAD_FLAG
   341  0000CD   67DF(1)  	B0BCLR 	FGIE
   342  0000CE   6CC5(1)  	B0BSET	VTM_CONT
   343  0000CF   6BD2(1)  	B0BSET	S_TM_EE_IO
   344  0000D0   60D0(1)  	B0BCLR	VSR_IO
   345  0000D1   2D34(1)  	MOV		A,#TM_DATA_H
   346  0000D2   1F13(1)  	MOV		MAC_H,A
   347  0000D3   2D00(1)  	MOV		A,#TM_DATA_L
   348  0000D4   1F14(1)  	MOV		MAC_L,A
   349  0000D5   C1B1(2)  	CALL	GET_DATA_FROM_TM_FUN
   350  0000D6   64D5(1)  	B0BCLR		VTM_IO
   351  0000D7   C2BA(2)  	CALL		DELAY_SHORT
   352  0000D8   64D2(1)  	B0BCLR		IC_IDLE
   353  0000D9   63D2(1)  	B0BCLR		S_TM_EE_IO
   354  0000DA   64C5(1)  	B0BCLR		VTM_CONT
   355  0000DB   C2BA(2)  	CALL		DELAY_SHORT
   356  0000DC   1E0E(1)  	MOV		A,ADDRESSH
   357  0000DD   1F13(1)  	MOV		MAC_H,A
   358  0000DE   1E0F(1)  	MOV		A,ADDRESSL
   359  0000DF   1F14(1)  	MOV		MAC_L,A
   360  0000E0   C14E(2)  	CALL		DATA_TO_EEPROM_FUN
   361  0000E1   2D1F(1)  	MOV		A,#LAST_TIME_EE_ADD_H
   362  0000E2   1F13(1)  	MOV		MAC_H,A
   363  0000E3   2DFE(1)  	MOV		A,#LAST_TIME_EE_ADD_L
   364  0000E4   1F14(1)  	MOV		MAC_L,A
   365  0000E5   1E0E(1)  	MOV		A,ADDRESSH
   366  0000E6   1F0C(1)  	MOV		DATAH,A
   367  0000E7   1E0F(1)  	MOV		A,ADDRESSL
   368  0000E8   1F0D(1)  	MOV		DATAL,A
   369  0000E9   C14E(2)  	CALL		DATA_TO_EEPROM_FUN
   370  0000EA   74C8(1+S)  	B0BTS0		FT0IRQ
   371  0000EB   1608(1+S)  	INCMS		TIMEH
   372  0000EC   64C8(1)  	B0BCLR		FT0IRQ
   373  0000ED   6FDF(1)  	B0BSET		FGIE
   374  0000EE   2D78(1)  	MOV			A,#TIME_GAP
   375  0000EF   0708(1+S)  	CMPRS		A,TIMEH
   376  0000F0   80F9(2)  	JMP			ADDRESS_CHANGE
   377  0000F1   2B08(1)  	CLR			TIMEH
   378  0000F2   4B06(1)  	BSET		TIME_FLAG
   379  0000F3   1609(1+S)  	INCMS		TIMEG
   380  0000F4   1E16(1)  	MOV			A,TIME_DELAY_GAP
   381  0000F5   0709(1+S)  	CMPRS		A,TIMEG
   382  0000F6   80F9(2)  	JMP			ADDRESS_CHANGE
   383  0000F7   2B09(1)  	CLR			TIMEG
   384  0000F8   4806(1)  	BSET		READTM_FLAG
   385  0000F9             ADDRESS_CHANGE:
   386  0000F9   6CD2(1)  	B0BSET		IC_IDLE
   387  0000FA   2D02(1)  	MOV			A,#0X02
   388  0000FB   130F(1)  	ADD			ADDRESSL,A
   389  0000FC   2D00(1)  	MOV			A,#0X00
   390  0000FD   110E(1)  	ADC			ADDRESSH,A
   391  0000FE   2D1F(1)  	MOV			A,#MAX_MEMH
   392  0000FF   070E(1+S)  	CMPRS		A,ADDRESSH
   393  000100   80B8(2)  	JMP			JUST_I2CSLAVE_MODE
   394  000101   2DF0(1)  	MOV			A,#MAX_MEML
   395  000102   070F(1+S)  	CMPRS		A,ADDRESSL
   396  000103   80B8(2)  	JMP			JUST_I2CSLAVE_MODE
   397  000104   4D06(1)  	BSET		FILLOUT_FLAG
   398  000105   67D8(1)  	B0BCLR		FT0ENB
   399  000106   64C9(1)  	B0BCLR		FT0IEN
   400  000107   811B(2)  	JMP			MEM_FILLOUT_MODE
   401  000108             ;*****************************************
   402  000108             JUST_UPLOAD_MODE:
   403  000108   62C2(1)  	B0BCLR		CLED_CONT
   404  000109   C2BA(2)  	CALL		DELAY_SHORT
   405  00010A   C2BA(2)  	CALL		DELAY_SHORT
   406  00010B   7AD2(1+S)  	B0BTS1		CLED_IO
   407  00010C   8138(2)  	JMP			RESET_MODE
   408  00010D   5206(1+S)  	BTS0		TM_EE_FLAG
   409  00010E   8115(2)  	JMP			END_TM_EE_MODE
   410  00010F   51D1(1+S)  	BTS0		VDDF
   411  000110   811B(2)  	JMP			MEM_FILLOUT_MODE
   412  000111             TM_EE_MODE:
   413  000111   4307(1)  	BCLR		HAVE_UPLOAD_FLAG
   414  000112   5206(1+S)  	BTS0		TM_EE_FLAG
   415  000113   8115(2)  	JMP			END_TM_EE_MODE
   416  000114   C303(2)  	CALL		SET_EE_TM_FUN
   417  000115             END_TM_EE_MODE:
   418  000115             	;BTS0		FILLOUT_FLAG
   419  000115             	;JMP			MEM_FILLOUT_MODE	
   420  000115   59D1(1+S)  	BTS1		VDDF
   421  000116   811B(2)  	JMP			MEM_FILLOUT_MODE
   422  000117   C30D(2)  	CALL		SET_LOW_POWER_FUN
   423  000118   5506(1+S)  	BTS0		FILLOUT_FLAG
   424  000119   811B(2)  	JMP			MEM_FILLOUT_MODE
   425  00011A             	;we should keep rtc function 
   426  00011A   812F(2)  	JMP		ON_LED_MODE
   427  00011B             ;*************************************
   428  00011B             MEM_FILLOUT_MODE:
   429  00011B   5D06(1+S)  	BTS1	FILLOUT_FLAG
   430  00011C   812F(2)  	JMP		ON_LED_MODE
   431  00011D   79D1(1+S)  	B0BTS1	VDDF
   432  00011E   8122(2)  	JMP		$+4
   433  00011F   5206(1+S)  	BTS0	TM_EE_FLAG
   434  000120   C30D(2)  	CALL	SET_LOW_POWER_FUN
   435  000121   8124(2)  	JMP		$+3
   436  000122   5A06(1+S)  	BTS1	TM_EE_FLAG
   437  000123   C303(2)  	CALL	SET_EE_TM_FUN
   438  000124   7FD8(1+S)  	B0BTS1		FT0ENB
   439  000125   812A(2)  	JMP			$+5
   440  000126   2BD9(1)  	CLR			T0C
   441  000127   64C8(1)  	B0BCLR		FT0IRQ
   442  000128   64C9(1)  	B0BCLR		FT0IEN
   443  000129   67D8(1)  	B0BCLR		FT0ENB
   444  00012A             	SleepMode
   445  00012A   6BCA(1)  		B0BSET	FCPUM0
   446  00012B             END_FILLOUT_MODE:
   447  00012B   6AC2(1)  	B0BSET		CLED_CONT
   448  00012C   6AD2(1)  	B0BSET		CLED_IO
   449  00012D   C2B5(2)  	CALL		DELAY_MINI
   450  00012E   8108(2)  	JMP		JUST_UPLOAD_MODE
   451  00012F             ON_LED_MODE:
   452  00012F   6AC2(1)  	B0BSET	CLED_CONT
   453  000130   6AD2(1)  	B0BSET	CLED_IO
   454  000131   5107(1+S)  	BTS0	READ_LED_FLAG
   455  000132   C13D(2)  	CALL	READ_LED_FUN
   456  000133   4107(1)  	BCLR   	READ_LED_FLAG
   457  000134   6AD2(1)  	B0BSET	CLED_IO
   458  000135   5506(1+S)  	BTS0	FILLOUT_FLAG
   459  000136   8108(2)  	JMP		JUST_UPLOAD_MODE
   460  000137   80B5(2)  	JMP		MAIN
   461  000138             RESET_MODE:
   462  000138   4906(1)  	BSET	RESET_FLAG
   463  000139   4506(1)  	BCLR	FILLOUT_FLAG
   464  00013A   2B08(1)  	CLR		TIMEH
   465  00013B   2B09(1)  	CLR		TIMEG
   466  00013C   8038(2)  	JMP		STATE_INITIAL
   467  00013D             	
   468  00013D             ;******************************************************************************	
   469  00013D             READ_LED_FUN:
   470  00013D   2D01(1)     	MOV  	   	A,#1
   471  00013E   1F05(1)     	MOV  	   	TLC2,A
   472  00013F             LED_MODEL1:	
   473  00013F   6AD2(1)     	B0BSET   	CLED_IO
   474  000140   C2CA(2)     	CALL   	   	DELAY_LED
   475  000141   62D2(1)     	B0BCLR   	CLED_IO
   476  000142   C2CA(2)     	CALL   	   	DELAY_LED
   477  000143   2605(1+S)     	DECMS   	TLC2
   478  000144   813F(2)     	JMP   	   	LED_MODEL1
   479  000145   0E00(2)     	RET
   480  000146             ;*******************************************************
   481  000146             ;***************************************
   482  000146             	
   483  000146             	
   484  000146             	
   485  000146             	
   486  000146             	
   487  000146             	
   488  000146             	
   489  000146             	
   490  000146             	
   491  000146             	
   492  000146             	
   493  000146             	
   494  000146             	
   495  000146             	
   496  000146             	
   497  000146             	
   498  000146             CLRRAM:
   499  000146             	
   500  000146   2B84(1)  	CLR			Y
   501  000147   2D2F(1)  	MOV			A,#END_RAM_ADDR
   502  000148   2F83(1)  	B0MOV		Z,A
   503  000149             CLRRAM10:
   504  000149   2BE7(1)  	CLR			@YZ
   505  00014A   2683(1+S)  	DECMS		Z
   506  00014B   8149(2)  	JMP			CLRRAM10
   507  00014C   2BE7(1)  	CLR			@YZ
   508  00014D   0E00(2)  	RET
   509  00014E             ;***********************************
   510  00014E             ;***************************************
   511  00014E             ;*************WRITE TMEPERATURE INTO EEPROM*************
   512  00014E             ;*************RECORDING ADDRESS THE LAST TIME STORAGE THE TMPERATURE VALUE************
   513  00014E             ;**************************************
   514  00014E             DATA_TO_EEPROM_FUN:
   515  00014E   6DC2(1)  	B0BSET		SDA_CONT
   516  00014F   6DD2(1)  	B0BSET		SDA_IO
   517  000150   68C2(1)  	B0BSET		SCL_CONT
   518  000151   68D2(1)  	B0BSET		SCL_IO
   519  000152   1E14(1)  	MOV			A,MAC_L
   520  000153   1F11(1)  	MOV			CRCT2,A
   521  000154   1E0C(1)  	MOV			A,DATAH
   522  000155   1F10(1)  	MOV			CRCT1,A
   523  000156   2D02(1)  	MOV			A,#0X02
   524  000157   1F05(1)  	MOV			TLC2,A
   525  000158             MOVE_DATA_TO_EEPROM:
   526  000158   C22D(2)  	CALL		I2C_START_EE
   527  000159   2DA0(1)  	MOV			A,#EEW_ADD
   528  00015A   1F0A(1)  	MOV			DATA_IN,A
   529  00015B   C27E(2)  	CALL		EEADDRESS_ASK
   530  00015C   1E13(1)  	MOV			A,MAC_H
   531  00015D   1F0A(1)  	MOV			DATA_IN,A
   532  00015E   C27E(2)  	CALL		EEADDRESS_ASK
   533  00015F   1E11(1)  	MOV			A,CRCT2
   534  000160   1F0A(1)  	MOV			DATA_IN,A
   535  000161   C27E(2)  	CALL		EEADDRESS_ASK
   536  000162   C2B5(2)  	CALL		DELAY_MINI
   537  000163   1E10(1)  	MOV			A,CRCT1
   538  000164   1F0A(1)  	MOV			DATA_IN,A
   539  000165   C27E(2)  	CALL		EEADDRESS_ASK
   540  000166   C233(2)  	CALL		I2C_END_EE
   541  000167             	
   542  000167   C2C0(2)  	CALL		DELAY_LONG
   543  000168   2D01(1)  	MOV			A,#0X01
   544  000169   1311(1)  	ADD			CRCT2,A
   545  00016A   1E0D(1)  	MOV			A,DATAL
   546  00016B   1F10(1)  	MOV			CRCT1,A
   547  00016C   2605(1+S)  	DECMS		TLC2
   548  00016D   8158(2)  	JMP			MOVE_DATA_TO_EEPROM
   549  00016E             ;*********************************************
   550  00016E   60C2(1)  	B0BCLR		SCL_CONT
   551  00016F   0E00(2)  	RET
   552  000170             ;**************************************
   553  000170             PUT_DATA_INTO_TM_FUN:
   554  000170   68C2(1)  	B0BSET	SCL_CONT
   555  000171   69C2(1)  	B0BSET	SDATA_CONT
   556  000172   61D2(1)  	B0BCLR	SDATA_IO
   557  000173   60D2(1)  	B0BCLR	SCL_IO
   558  000174   C2C0(2)  	CALL 	DELAY_LONG
   559  000175   C2C0(2)  	CALL 	DELAY_LONG
   560  000176   6CD5(1)  	B0BSET 	VTM_IO
   561  000177   C2C0(2)  	CALL 	DELAY_LONG
   562  000178             	;CALL	DELAY_LONG
   563  000178             START_TMI2C_S:
   564  000178   2D04(1)  	MOV 	A,#0X04
   565  000179   1F03(1)  	MOV 	TLC0,A
   566  00017A             LOOP_1_S:
   567  00017A   68D2(1)  	B0BSET 	SCL_IO
   568  00017B   C2B5(2)  	CALL	DELAY_MINI;13US
   569  00017C   C2B4(2)  	CALL	CALL_DELAY
   570  00017D   60D2(1)  	B0BCLR 	SCL_IO
   571  00017E   C2B5(2)  	CALL 	DELAY_MINI
   572  00017F   2603(1+S)  	DECMS  	TLC0
   573  000180   817A(2)  	JMP 	LOOP_1_S
   574  000181   41D2(1)  	BCLR 	SDATA_IO
   575  000182   C2C0(2)  	CALL	DELAY_LONG
   576  000183   C2C0(2)  	CALL	DELAY_LONG
   577  000184   2D04(1)  	MOV 	A,#4
   578  000185   2F03(1)  	B0MOV 	TLC0,A
   579  000186             LOOP_2_S:
   580  000186   60D2(1)  	B0BCLR 	SCL_IO
   581  000187   C2B5(2)  	CALL	DELAY_MINI
   582  000188   C2B4(2)  	CALL	CALL_DELAY
   583  000189   68D2(1)  	B0BSET 	SCL_IO
   584  00018A   C2B5(2)  	CALL	DELAY_MINI
   585  00018B   2603(1+S)  	DECMS 	TLC0
   586  00018C   8186(2)  	JMP 	LOOP_2_S
   587  00018D   C2BA(2)  	CALL	DELAY_SHORT
   588  00018E   2D14(1)  	MOV 	A,#20
   589  00018F   2F03(1)  	B0MOV 	TLC0,A
   590  000190   49D2(1)  	BSET 	SDATA_IO
   591  000191             WAIT_TM_INIT_S:
   592  000191   C2C0(2)  	CALL 		DELAY_LONG
   593  000192   2603(1+S)  	DECMS 		TLC0
   594  000193   8191(2)  	JMP 		WAIT_TM_INIT_S
   595  000194             ;**************START*****************************
   596  000194   C23A(2)  	CALL		I2C_START_TM
   597  000195             ;***********************************************
   598  000195   2D3C(1)  	MOV 		A,#TMW_ADD
   599  000196   1F0A(1)  	MOV 		DATA_IN,A
   600  000197   C248(2)  	CALL 		TMADDRESS_ASK
   601  000198   5507(1+S)  	BTS0		TM_I2C_EEROR
   602  000199   81AB(2)  	JMP			END_TM_S
   603  00019A   2D2F(1)  	MOV 		A,#WRITE_TM_ADD_H
   604  00019B   1F0A(1)  	MOV 		DATA_IN,A
   605  00019C   C248(2)  	CALL 		TMADDRESS_ASK
   606  00019D   2D00(1)  	MOV 		A,#WRITE_TM_ADD_L
   607  00019E   1F0A(1)  	MOV 		DATA_IN,A
   608  00019F   C248(2)  	CALL 		TMADDRESS_ASK
   609  0001A0   C2C0(2)  	CALL		DELAY_LONG
   610  0001A1   1E0C(1)  	MOV 		A,DATAH
   611  0001A2   1F0A(1)  	MOV 		DATA_IN,A
   612  0001A3   C248(2)  	CALL 		TMADDRESS_ASK
   613  0001A4   1E0D(1)  	MOV 		A,DATAL
   614  0001A5   1F0A(1)  	MOV 		DATA_IN,A
   615  0001A6   C248(2)  	CALL 		TMADDRESS_ASK
   616  0001A7   C2BA(2)  	CALL		DELAY_SHORT
   617  0001A8             ;**************END*******************************
   618  0001A8   C240(2)  	CALL		I2C_END_TM
   619  0001A9   C2BA(2)  	CALL		DELAY_SHORT
   620  0001AA   61D2(1)  	B0BCLR		SDATA_IO
   621  0001AB             END_TM_S:
   622  0001AB   4507(1)  	BCLR		TM_I2C_EEROR
   623  0001AC   64D5(1)  	B0BCLR 		VTM_IO
   624  0001AD   61C2(1)  	B0BCLR		SDATA_CONT
   625  0001AE   60C2(1)  	B0BCLR		SCL_CONT
   626  0001AF   C2BA(2)  	CALL 		DELAY_SHORT
   627  0001B0   0E00(2)  	RET
   628  0001B1             ;*******************************************
   629  0001B1             ;*****************************************
   630  0001B1             GET_DATA_FROM_TM_FUN:
   631  0001B1   2D0F(1)  	MOV		A,#0X0F
   632  0001B2   1F12(1)  	MOV		COUNT,A
   633  0001B3             TM_I2C_WORK_LOOP:
   634  0001B3   68C2(1)  	B0BSET	SCL_CONT
   635  0001B4   69C2(1)  	B0BSET	SDATA_CONT
   636  0001B5   61D2(1)  	B0BCLR	SDATA_IO
   637  0001B6   60D2(1)  	B0BCLR	SCL_IO
   638  0001B7   C2C0(2)  	CALL 	DELAY_LONG
   639  0001B8   C2C0(2)  	CALL 	DELAY_LONG
   640  0001B9   6CD5(1)  	B0BSET 	VTM_IO
   641  0001BA   C2C0(2)  	CALL 	DELAY_LONG
   642  0001BB             	;CALL	DELAY_LONG
   643  0001BB             START_TMI2C:
   644  0001BB   2D04(1)  	MOV 	A,#0X04
   645  0001BC   1F03(1)  	MOV 	TLC0,A
   646  0001BD             LOOP_1:
   647  0001BD   68D2(1)  	B0BSET 	SCL_IO
   648  0001BE   C2B5(2)  	CALL	DELAY_MINI;13US
   649  0001BF   C2B4(2)  	CALL	CALL_DELAY
   650  0001C0   60D2(1)  	B0BCLR 	SCL_IO
   651  0001C1   C2B5(2)  	CALL 	DELAY_MINI
   652  0001C2   2603(1+S)  	DECMS  	TLC0
   653  0001C3   81BD(2)  	JMP 	LOOP_1
   654  0001C4   2D28(1)  	MOV 	A,#40
   655  0001C5   2F03(1)  	B0MOV 	TLC0,A
   656  0001C6   41D2(1)  	BCLR 	SDATA_IO
   657  0001C7   C2C0(2)  	CALL	DELAY_LONG
   658  0001C8             	;CALL	DELAY_SHORT
   659  0001C8   2D04(1)  	MOV 	A,#4
   660  0001C9   2F03(1)  	B0MOV 	TLC0,A
   661  0001CA             LOOP_2:
   662  0001CA   60D2(1)  	B0BCLR 	SCL_IO
   663  0001CB   C2B5(2)  	CALL	DELAY_MINI
   664  0001CC   C2B4(2)  	CALL	CALL_DELAY
   665  0001CD   68D2(1)  	B0BSET 	SCL_IO
   666  0001CE   C2B5(2)  	CALL	DELAY_MINI
   667  0001CF   2603(1+S)  	DECMS 	TLC0
   668  0001D0   81CA(2)  	JMP 	LOOP_2
   669  0001D1   C2BA(2)  	CALL	DELAY_SHORT
   670  0001D2   2D05(1)  	MOV 	A,#5
   671  0001D3   2F03(1)  	B0MOV 	TLC0,A
   672  0001D4   49D2(1)  	BSET 	SDATA_IO
   673  0001D5             WAIT_TM_INIT:
   674  0001D5   C2C0(2)  	CALL 		DELAY_LONG
   675  0001D6   2603(1+S)  	DECMS 		TLC0
   676  0001D7   81D5(2)  	JMP 		WAIT_TM_INIT
   677  0001D8             ;**************START*****************************
   678  0001D8   C23A(2)  	CALL		I2C_START_TM
   679  0001D9             ;***********************************************
   680  0001D9   2D3D(1)  	MOV 		A,#TMR_ADD
   681  0001DA   1F0A(1)  	MOV 		DATA_IN,A
   682  0001DB   C248(2)  	CALL 		TMADDRESS_ASK
   683  0001DC   5507(1+S)  	BTS0		TM_I2C_EEROR
   684  0001DD   81FC(2)  	JMP			END_TM
   685  0001DE   1E13(1)  	MOV 		A,MAC_H
   686  0001DF   1F0A(1)  	MOV 		DATA_IN,A
   687  0001E0   C248(2)  	CALL 		TMADDRESS_ASK
   688  0001E1   1E14(1)  	MOV 		A,MAC_L
   689  0001E2   1F0A(1)  	MOV 		DATA_IN,A
   690  0001E3   C248(2)  	CALL 		TMADDRESS_ASK
   691  0001E4   61C2(1)  	B0BCLR		SDATA_CONT
   692  0001E5   C2C0(2)  	CALL 		DELAY_LONG
   693  0001E6   4706(1)  	BCLR 		ASK_FLAG
   694  0001E7   C262(2)  	CALL 		TMDATA_ASK
   695  0001E8   1E0B(1)  	MOV 		A,DATA_OUT
   696  0001E9   1F0C(1)  	MOV 		DATAH,A
   697  0001EA   4F06(1)  	BSET 		ASK_FLAG
   698  0001EB   C262(2)  	CALL 		TMDATA_ASK
   699  0001EC   1E0B(1)  	MOV 		A,DATA_OUT
   700  0001ED   1F0D(1)  	MOV 		DATAL,A		
   701  0001EE             ;**************END*******************************
   702  0001EE   C240(2)  	CALL		I2C_END_TM
   703  0001EF   C2BA(2)  	CALL		DELAY_SHORT
   704  0001F0   61D2(1)  	B0BCLR		SDATA_IO
   705  0001F1   2612(1+S)  	DECMS		COUNT
   706  0001F2   81F4(2)  	JMP			$+2
   707  0001F3   81FC(2)  	JMP			END_TM
   708  0001F4   64D5(1)  	B0BCLR 		VTM_IO
   709  0001F5   2D00(1)  	MOV			A,#0X00
   710  0001F6   070C(1+S)  	CMPRS		A,DATAH
   711  0001F7   81FB(2)  	JMP			$+4
   712  0001F8   070D(1+S)  	CMPRS		A,DATAL
   713  0001F9   81FB(2)  	JMP			$+2
   714  0001FA   81B3(2)  	JMP			TM_I2C_WORK_LOOP
   715  0001FB   4907(1)  	BSET		READ_LED_FLAG
   716  0001FC             END_TM:
   717  0001FC   4507(1)  	BCLR		TM_I2C_EEROR
   718  0001FD   64D5(1)  	B0BCLR 		VTM_IO
   719  0001FE   61C2(1)  	B0BCLR		SDATA_CONT
   720  0001FF   60C2(1)  	B0BCLR		SCL_CONT
   721  000200   C2BA(2)  	CALL 		DELAY_SHORT
   722  000201   0E00(2)  	RET
   723  000202             ;*******************************************
   724  000202             ;***********************************************************
   725  000202             ;*********************************************************
   726  000202             GET_DATA_FROM_EE_FUN:
   727  000202   68C2(1)  	B0BSET		SCL_CONT
   728  000203   6DC2(1)  	B0BSET		SDA_CONT
   729  000204   6DD2(1)  	B0BSET		SDA_IO
   730  000205   68D2(1)  	B0BSET		SCL_IO
   731  000206   C2BA(2)  	CALL		DELAY_SHORT
   732  000207   C22D(2)  	CALL		I2C_START_EE
   733  000208   2DA0(1)  	MOV			A,#EEW_ADD
   734  000209   1F0A(1)  	MOV			DATA_IN,A
   735  00020A   C27E(2)  	CALL		EEADDRESS_ASK
   736  00020B   1E13(1)  	MOV			A,MAC_H
   737  00020C   1F0A(1)  	MOV			DATA_IN,A
   738  00020D   C27E(2)  	CALL		EEADDRESS_ASK
   739  00020E   1E14(1)  	MOV			A,MAC_L
   740  00020F   1F0A(1)  	MOV			DATA_IN,A
   741  000210   C27E(2)  	CALL		EEADDRESS_ASK
   742  000211   6DD2(1)  	B0BSET		SDA_IO
   743  000212   C2BA(2)  	CALL		DELAY_SHORT
   744  000213   68D2(1)  	B0BSET		SCL_IO
   745  000214   C2BA(2)  	CALL		DELAY_SHORT
   746  000215   C22D(2)  	CALL		I2C_START_EE
   747  000216   C2BA(2)  	CALL		DELAY_SHORT
   748  000217   2DA1(1)  	MOV			A,#EER_ADD
   749  000218   1F0A(1)  	MOV			DATA_IN,A
   750  000219   C27E(2)  	CALL		EEADDRESS_ASK
   751  00021A   65C2(1)  	B0BCLR		SDA_CONT
   752  00021B   4706(1)  	BCLR		ASK_FLAG
   753  00021C   C298(2)  	CALL		EEDATA_ASK
   754  00021D   1E0B(1)  	MOV			A,DATA_OUT
   755  00021E   1F0E(1)  	MOV			ADDRESSH,A
   756  00021F   65C2(1)  	B0BCLR		SDA_CONT
   757  000220   C2B5(2)  	CALL		DELAY_MINI
   758  000221   4F06(1)  	BSET		ASK_FLAG
   759  000222   C298(2)  	CALL		EEDATA_ASK
   760  000223   1E0B(1)  	MOV			A,DATA_OUT
   761  000224   1F0F(1)  	MOV			ADDRESSL,A
   762  000225   C233(2)  	CALL		I2C_END_EE
   763  000226             ;*************************************
   764  000226   C2BA(2)  	CALL		DELAY_SHORT
   765  000227   60C2(1)  	B0BCLR		SCL_CONT
   766  000228   0E00(2)  	RET
   767  000229             ;************************************************
   768  000229             I2C_EEROR:
   769  000229             	;open interrupt
   770  000229             	;SleepMode
   771  000229   4606(1)  	BCLR	I2CERROR_FLAG
   772  00022A   54D5(1+S)  	BTS0	VTM_IO
   773  00022B   4D07(1)  	BSET	TM_I2C_EEROR
   774  00022C   0E00(2)  	RET
   775  00022D             I2C_START_EE:
   776  00022D   C2B5(2)  	CALL		DELAY_MINI
   777  00022E   65D2(1)  	B0BCLR 		SDA_IO
   778  00022F   C2B5(2)  	CALL 		DELAY_MINI
   779  000230   60D2(1)  	B0BCLR 		SCL_IO
   780  000231   C2B5(2)  	CALL 		DELAY_MINI
   781  000232   0E00(2)  	RET
   782  000233             I2C_END_EE:
   783  000233   65D2(1)  	B0BCLR 		SDA_IO
   784  000234   C2B5(2)  	CALL 		DELAY_MINI
   785  000235   68D2(1)  	B0BSET 		SCL_IO
   786  000236   C2B5(2)  	CALL 		DELAY_MINI
   787  000237   6DD2(1)  	B0BSET 		SDA_IO
   788  000238   C2B5(2)  	CALL		DELAY_MINI
   789  000239   0E00(2)  	RET
   790  00023A             I2C_START_TM:
   791  00023A   C2B5(2)  	CALL		DELAY_MINI
   792  00023B   61D2(1)  	B0BCLR 		SDATA_IO
   793  00023C   C2B5(2)  	CALL 		DELAY_MINI
   794  00023D   60D2(1)  	B0BCLR 		SCL_IO
   795  00023E   C2B5(2)  	CALL 		DELAY_MINI
   796  00023F   0E00(2)  	RET
   797  000240             I2C_END_TM:
   798  000240   61D2(1)  	B0BCLR 		SDATA_IO
   799  000241   C2B5(2)  	CALL 		DELAY_MINI
   800  000242   60D2(1)  	B0BCLR		SCL_IO
   801  000243   C2B5(2)  	CALL		DELAY_MINI
   802  000244   69D2(1)  	B0BSET 		SDATA_IO
   803  000245   C2B5(2)  	CALL		DELAY_MINI
   804  000246   68D2(1)  	B0BSET 		SCL_IO
   805  000247   0E00(2)  	RET
   806  000248             TMADDRESS_ASK:
   807  000248   2D08(1)  	MOV 		A,#8
   808  000249   1F02(1)  	MOV 		TIMEOUT,A
   809  00024A             TMADDRESS_LOOP:
   810  00024A   570A(1+S)  	BTS0		DATA_IN.7
   811  00024B   824F(2)  	JMP 		MD_1
   812  00024C   71D2(1+S)  	B0BTS0 		SDATA_IO
   813  00024D   61D2(1)  	B0BCLR		SDATA_IO
   814  00024E   8251(2)  	JMP 		NEXT_1
   815  00024F             MD_1:
   816  00024F   79D2(1+S)  	B0BTS1 		SDATA_IO
   817  000250   69D2(1)  	B0BSET		SDATA_IO
   818  000251             NEXT_1:
   819  000251   C2B5(2)  	CALL		DELAY_MINI
   820  000252   68D2(1)  	B0BSET 		SCL_IO
   821  000253   C2B5(2)  	CALL		DELAY_MINI
   822  000254   0B0A(1)  	RLCM 		DATA_IN
   823  000255   60D2(1)  	B0BCLR 		SCL_IO
   824  000256   2602(1+S)  	DECMS 		TIMEOUT
   825  000257   824A(2)  	JMP 		TMADDRESS_LOOP
   826  000258             	
   827  000258   61C2(1)  	B0BCLR 		SDATA_CONT
   828  000259   C2B5(2)  	CALL		DELAY_MINI
   829  00025A   68D2(1)  	B0BSET 		SCL_IO
   830  00025B   C2B4(2)  	CALL 		CALL_DELAY
   831  00025C   71D2(1+S)  	B0BTS0 		SDATA_IO
   832  00025D   C229(2)  	CALL		I2C_EEROR
   833  00025E   C2B5(2)  	CALL		DELAY_MINI
   834  00025F   40D2(1)  	BCLR 		SCL_IO
   835  000260   49C2(1)  	BSET 		SDATA_CONT
   836  000261   0E00(2)  	RET
   837  000262             ;**********************TM_READING_DATA********************************
   838  000262             TMDATA_ASK:
   839  000262   61C2(1)  	B0BCLR 		SDATA_CONT
   840  000263   2D08(1)  	MOV 		A,#8
   841  000264   1F02(1)  	MOV 		TIMEOUT,A
   842  000265             TMDATA_LOOP:
   843  000265   2D09(1)  	MOV 		A,#9
   844  000266   1F03(1)  	MOV 		TLC0,A
   845  000267   C2B5(2)  	CALL		DELAY_MINI
   846  000268   48D2(1)  	BSET 		SCL_IO
   847  000269   C2B4(2)  	CALL 		CALL_DELAY
   848  00026A   71D2(1+S)  	B0BTS0 		SDATA_IO
   849  00026B   480B(1)  	BSET 		DATA_OUT.0
   850  00026C   79D2(1+S)  	B0BTS1 		SDATA_IO
   851  00026D   400B(1)  	BCLR 		DATA_OUT.0
   852  00026E   0B0B(1)  	RLCM 		DATA_OUT
   853  00026F   C2B5(2)  	CALL		DELAY_MINI
   854  000270   60D2(1)  	B0BCLR 		SCL_IO
   855  000271   2602(1+S)  	DECMS 		TIMEOUT
   856  000272   8265(2)  	JMP 		TMDATA_LOOP
   857  000273   69C2(1)  	B0BSET 		SDATA_CONT
   858  000274   5706(1+S)  	BTS0 		ASK_FLAG
   859  000275   69D2(1)  	B0BSET 		SDATA_IO
   860  000276   5F06(1+S)  	BTS1 		ASK_FLAG
   861  000277   61D2(1)  	B0BCLR 		SDATA_IO
   862  000278   090B(1)  	RRCM 		DATA_OUT
   863  000279   C2B5(2)  	CALL		DELAY_MINI
   864  00027A   48D2(1)  	BSET 		SCL_IO
   865  00027B   C2B5(2)  	CALL		DELAY_MINI
   866  00027C   40D2(1)  	BCLR		SCL_IO	
   867  00027D   0E00(2)  	RET
   868  00027E             ;******************************************************
   869  00027E             EEADDRESS_ASK:
   870  00027E   2D08(1)  	MOV 		A,#8
   871  00027F   1F02(1)  	MOV 		TIMEOUT,A
   872  000280             EEADDRESS_LOOP:
   873  000280   570A(1+S)  	BTS0		DATA_IN.7
   874  000281   8285(2)  	JMP 		EEMD_1
   875  000282   75D2(1+S)  	B0BTS0 		SDA_IO
   876  000283   65D2(1)  	B0BCLR		SDA_IO
   877  000284   8287(2)  	JMP 		EENEXT_1
   878  000285             EEMD_1:
   879  000285   7DD2(1+S)  	B0BTS1 		SDA_IO
   880  000286   6DD2(1)  	B0BSET		SDA_IO
   881  000287             EENEXT_1:
   882  000287   C2B5(2)  	CALL		DELAY_MINI
   883  000288   68D2(1)  	B0BSET 		SCL_IO
   884  000289   C2B5(2)  	CALL		DELAY_MINI
   885  00028A   0B0A(1)  	RLCM 		DATA_IN
   886  00028B   60D2(1)  	B0BCLR 		SCL_IO
   887  00028C   2602(1+S)  	DECMS 		TIMEOUT
   888  00028D   8280(2)  	JMP 		EEADDRESS_LOOP
   889  00028E             	
   890  00028E   65C2(1)  	B0BCLR 		SDA_CONT
   891  00028F   C2B5(2)  	CALL		DELAY_MINI
   892  000290   68D2(1)  	B0BSET 		SCL_IO
   893  000291   C2B4(2)  	CALL 		CALL_DELAY
   894  000292   75D2(1+S)  	B0BTS0 		SDA_IO
   895  000293   C229(2)  	CALL		I2C_EEROR
   896  000294   C2B5(2)  	CALL		DELAY_MINI
   897  000295   40D2(1)  	BCLR 		SCL_IO
   898  000296   4DC2(1)  	BSET 		SDA_CONT
   899  000297   0E00(2)  	RET
   900  000298             ;****************************************
   901  000298             EEDATA_ASK:
   902  000298   65C2(1)  	B0BCLR 		SDA_CONT
   903  000299   2D08(1)  	MOV 		A,#8
   904  00029A   1F02(1)  	MOV 		TIMEOUT,A
   905  00029B             EEDATA_LOOP:
   906  00029B   2D09(1)  	MOV 		A,#9
   907  00029C   1F03(1)  	MOV 		TLC0,A
   908  00029D   C2B5(2)  	CALL		DELAY_MINI
   909  00029E   48D2(1)  	BSET 		SCL_IO
   910  00029F   C2B4(2)  	CALL 		CALL_DELAY
   911  0002A0   75D2(1+S)  	B0BTS0 		SDA_IO
   912  0002A1   480B(1)  	BSET 		DATA_OUT.0
   913  0002A2   7DD2(1+S)  	B0BTS1 		SDA_IO
   914  0002A3   400B(1)  	BCLR 		DATA_OUT.0
   915  0002A4   0B0B(1)  	RLCM 		DATA_OUT
   916  0002A5   C2B5(2)  	CALL		DELAY_MINI
   917  0002A6   60D2(1)  	B0BCLR 		SCL_IO
   918  0002A7   2602(1+S)  	DECMS 		TIMEOUT
   919  0002A8   829B(2)  	JMP 		EEDATA_LOOP
   920  0002A9             	
   921  0002A9   6DC2(1)  	B0BSET 		SDA_CONT
   922  0002AA   5706(1+S)  	BTS0 		ASK_FLAG
   923  0002AB   6DD2(1)  	B0BSET 		SDA_IO
   924  0002AC   5F06(1+S)  	BTS1 		ASK_FLAG
   925  0002AD   65D2(1)  	B0BCLR 		SDA_IO
   926  0002AE   090B(1)  	RRCM 		DATA_OUT
   927  0002AF   C2B5(2)  	CALL		DELAY_MINI
   928  0002B0   48D2(1)  	BSET 		SCL_IO
   929  0002B1   C2B5(2)  	CALL		DELAY_MINI
   930  0002B2   40D2(1)  	BCLR		SCL_IO	
   931  0002B3   0E00(2)  	RET
   932  0002B4             ;*********************delay*****************
   933  0002B4             CALL_DELAY:
   934  0002B4   0E00(2)  	RET
   935  0002B5             DELAY_MINI:;13US
   936  0002B5   2D05(1)  	MOV		A,#0X05
   937  0002B6   1F00(1)  	MOV		DELAYTIME1,A
   938  0002B7             DELAY0:
   939  0002B7   2600(1+S)  	DECMS	DELAYTIME1
   940  0002B8   82B7(2)  	JMP		DELAY0
   941  0002B9   0E00(2)  	RET
   942  0002BA             	
   943  0002BA             DELAY_SHORT:		;50US FOR 0.5US/INSTRUCTION
   944  0002BA   2D63(1)  	MOV		A,#0X63
   945  0002BB   1F00(1)  	MOV		DELAYTIME1,A
   946  0002BC             DELAY1:
   947  0002BC   0000(1)  	NOP
   948  0002BD   2600(1+S)  	DECMS	DELAYTIME1
   949  0002BE   82BC(2)  	JMP		DELAY1
   950  0002BF   0E00(2)  	RET
   951  0002C0             DELAY_LONG:	;>=5MS
   952  0002C0             ;WAIT_FOR_A_LONG_WHILE
   953  0002C0   2D0A(1)  	MOV		A,#0X0A
   954  0002C1   2F00(1)  	B0MOV	DELAYTIME1,A
   955  0002C2             DELAY2_1:
   956  0002C2   2DC7(1)  	MOV		A,#0XC7
   957  0002C3   1F01(1)  	MOV		DELAYTIME2,A
   958  0002C4             DELAY2_2:
   959  0002C4   0000(1)  	NOP
   960  0002C5   2601(1+S)  	DECMS	DELAYTIME2
   961  0002C6   82C4(2)  	JMP		DELAY2_2	
   962  0002C7   2600(1+S)  	DECMS	DELAYTIME1
   963  0002C8   82C2(2)  	JMP		DELAY2_1
   964  0002C9   0E00(2)  	RET		
   965  0002CA             DELAY_LED:		;0.2S
   966  0002CA             ;WAIT_FOR_DEEP_DARK_FANTASY
   967  0002CA   2DFF(1)  	MOV		A,#0XFF
   968  0002CB   1F01(1)  	MOV		DELAYTIME2,A
   969  0002CC             DELAY3_1:
   970  0002CC   2DFF(1)  	MOV		A,#0XFF
   971  0002CD   1F00(1)  	MOV		DELAYTIME1,A
   972  0002CE             DELAY3_2:
   973  0002CE   0000(1)  	NOP
   974  0002CF   0000(1)  	NOP
   975  0002D0   2600(1+S)  	DECMS		DELAYTIME1
   976  0002D1   82CE(2)  	JMP			DELAY3_2
   977  0002D2   2601(1+S)  	DECMS		DELAYTIME2
   978  0002D3   82CC(2)  	JMP			DELAY3_1
   979  0002D4   0E00(2)  	RET
   980  0002D5             OPEN_TC0_INT_FUN:
   981  0002D5   6BDA(1)  	B0BSET	FTC0CKS	;	OUTSIDE INPUT ACCIDENT
   982  0002D6   6ADA(1)  	B0BSET	FALOAD0 ;
   983  0002D7   2DFD(1)  	MOV		A,#0XFD
   984  0002D8   2FCD(1)  	B0MOV	TC0R,A
   985  0002D9   2FDB(1)  	B0MOV	TC0C,A
   986  0002DA   65C8(1)  	B0BCLR	FTC0IRQ
   987  0002DB   6DC9(1)  	B0BSET	FTC0IEN
   988  0002DC   6FDA(1)  	B0BSET	FTC0ENB
   989  0002DD   0E00(2)  	RET
   990  0002DE             SYS_INIT_FUN:
   991  0002DE   2D3D(1)  	MOV			A,#0X3D
   992  0002DF   2FC2(1)  	B0MOV		P2M,A
   993  0002E0   2D35(1)  	MOV			A,#0X35
   994  0002E1   2FD2(1)  	B0MOV		P2,A
   995  0002E2             	;up resistor for p2.1
   996  0002E2             	;MOV			A,#0X02
   997  0002E2             	;B0MOV		P2UR,A
   998  0002E2   2D01(1)  	MOV			A,#0X01
   999  0002E3   2FC1(1)  	B0MOV		P1M,A
  1000  0002E4   2BD1(1)  	CLR			P1
  1001  0002E5   68B8(1)  	B0BSET		VSR_CONT
  1002  0002E6   60D0(1)  	B0BCLR		VSR_IO
  1003  0002E7   68C1(1)  	B0BSET		S_VDD_VCC_CONT
  1004  0002E8   60D1(1)  	B0BCLR		S_VDD_VCC_IO
  1005  0002E9   6CC5(1)  	B0BSET		VTM_CONT
  1006  0002EA   64D5(1)  	B0BCLR		VTM_IO
  1007  0002EB   2D03(1)  	MOV			A,#0X03
  1008  0002EC   1F10(1)  	MOV			CRCT1,A
  1009  0002ED             SYS_INIT_LED:
  1010  0002ED   62D2(1)  	B0BCLR		CLED_IO
  1011  0002EE   C2CA(2)  	CALL		DELAY_LED	
  1012  0002EF   6AD2(1)  	B0BSET		CLED_IO
  1013  0002F0   C2CA(2)  	CALL		DELAY_LED
  1014  0002F1   2610(1+S)  	DECMS		CRCT1
  1015  0002F2   82ED(2)  	JMP			SYS_INIT_LED
  1016  0002F3             ;************T0_INIT_START************************************
  1017  0002F3   2D00(1)  	MOV			A,#0X00
  1018  0002F4   2FD8(1)  	B0MOV		T0M,A	
  1019  0002F5   68D8(1)  	B0BSET		FT0TB	; T0 = Fcpu/256,PERIOD TIME IS 2S
  1020  0002F6   2BD9(1)  	CLR			T0C
  1021  0002F7   64C8(1)  	B0BCLR		FT0IRQ
  1022  0002F8   6CC9(1)  	B0BSET		FT0IEN
  1023  0002F9   6FD8(1)  	B0BSET		FT0ENB
  1024  0002FA             ;*****************TC0_INIT_START*****************
  1025  0002FA   2BDA(1)  	CLR			TC0M
  1026  0002FB   2BDB(1)  	CLR			TC0C
  1027  0002FC   65C8(1)  	B0BCLR		FTC0IRQ
  1028  0002FD   65C9(1)  	B0BCLR		FTC0IEN
  1029  0002FE   67DA(1)  	B0BCLR		FTC0ENB
  1030  0002FF             ;************************OPEN P1.1WEEK UP FUNCTION*********************
  1031  0002FF   2D02(1)  	MOV			A,#0X02
  1032  000300   2FC0(1)  	B0MOV		P1W,A
  1033  000301   C2B5(2)  	CALL		DELAY_MINI
  1034  000302   0E00(2)  	RET
  1035  000303             ;//////////////////////////////////////////////////
  1036  000303             SET_EE_TM_FUN:
  1037  000303   65C2(1)  	B0BCLR		SDA_CONT
  1038  000304   64C5(1)  	B0BCLR		VTM_CONT
  1039  000305   60C2(1)  	B0BCLR		SCL_CONT
  1040  000306   61C2(1)  	B0BCLR		SDATA_CONT
  1041  000307   68D0(1)  	B0BSET		VSR_IO
  1042  000308   6BD2(1)  	B0BSET		S_TM_EE_IO
  1043  000309   4A06(1)  	BSET		TM_EE_FLAG
  1044  00030A   64D2(1)  	B0BCLR	IC_IDLE
  1045  00030B   4407(1)  	BCLR	NOT_QUICK_MODE_FLAG
  1046  00030C   0E00(2)  	RET
  1047  00030D             ;////////////////////////////////////////
  1048  00030D             ;////////////SET LOW POWER
  1049  00030D             SET_LOW_POWER_FUN:
  1050  00030D             ;****************************************
  1051  00030D   64C5(1)  	B0BCLR		VTM_CONT
  1052  00030E   63D2(1)  	B0BCLR		S_TM_EE_IO
  1053  00030F   60D0(1)  	B0BCLR		VSR_IO
  1054  000310   4206(1)  	BCLR		TM_EE_FLAG
  1055  000311   6CD2(1)  	B0BSET	IC_IDLE
  1056  000312   0E00(2)  	RET
  1057  000313             ;/////////////////////////////////////////	
  1058  000313             WAIT_FOR_SEAVAL_MINITE_FUN:
  1059  000313   1E15(1)  	MOV   	A,FRONT_DELAY
  1060  000314   1F10(1)  	MOV		CRCT1,A
  1061  000315             	GreenMode
  1062  000315   6CCA(1)  		B0BSET	FCPUM1
  1063  000316   0000(1)  		NOP
  1064  000317   0000(1)  		NOP
  1065  000318   5407(1+S)  	BTS0	NOT_QUICK_MODE_FLAG
  1066  000319   C303(2)  	CALL	SET_EE_TM_FUN
  1067  00031A   5207(1+S)  	BTS0	NOT_UPLOAD_FLAG
  1068  00031B   C30D(2)  	CALL	SET_LOW_POWER_FUN
  1069  00031C   5B06(1+S)  	BTS1	TIME_FLAG
  1070  00031D   8317(2)  	JMP		$-6
  1071  00031E   4306(1)  	BCLR	TIME_FLAG
  1072  00031F   2610(1+S)  	DECMS	CRCT1
  1073  000320   8317(2)  	JMP		$-9
  1074  000321   0E00(2)  	RET
  1075  000322             ;*******************************************
  1076  000322             	ENDP
