     1  000000             CHIP		SN8P2501D
     2  000000             //{{SONIX_CODE_OPTION
     3  000000             	.Code_Option	Noise_Filter	Enable
     4  000000             	.Code_Option	Reset_Pin	P11
     5  000000             	.Code_Option	Watch_Dog	Disable
     6  000000             	.Code_Option	High_Clk	IHRC_RTC	;
     7  000000             	.Code_Option	Fcpu		#3     ; Fcpu = Fosc/8
     8  000000             	.Code_Option	Security	Enable
     9  000000             	.Code_Option	LVD		LVD_L		;
    10  000000             //}}SONIX_CODE_OPTION
    11  000000             
    12  E 0000002F         	END_RAM_ADDR	EQU	0X2F
    13  E 000000A1         	EER_ADD			EQU	0XA1	;10100001B
    14  E 000000A0         	EEW_ADD			EQU	0XA0	;10100000B
    15  E 00000030         	RAM_COUNT		EQU	48
    16  E 00000034         	TM_DATA_H		EQU	0X34	;ADDR OF THE TEMPEATURE	OF TM
    17  E 00000000         	TM_DATA_L		EQU	0X00
    18  E 00000078         	TIME_GAP		EQU	0X78	;0X78
    19  E 00000001         	T0_TDR			EQU	0X01
    20  E 0000003D         	TMR_ADD 		EQU	0X3D
    21  E 0000003C         	TMW_ADD			EQU	0X3C
    22  E 0000001F         	MAX_MEMH		EQU	0X1F
    23  E 000000F0         	MAX_MEML		EQU	0XF0
    24  E 0000001F         	LAST_TIME_EE_ADD_H EQU 0X1F
    25  E 000000FE         	LAST_TIME_EE_ADD_L EQU 0XFE
    26  E 0000001F         	LIVE_TIME_ADD_H		EQU	0X1F
    27  E 000000FC         	LIVE_TIME_ADD_L		EQU	0XFC
    28  E 00000001         	DEFAULT_FRONT_TIME_DELAY	EQU	0X01
    29  E 00000001         	DEFAULT_TIME_GAP	EQU	0X01
    30  E 0000002E         	TM_TIME_H		EQU	0X2E
    31  E 00000000         	TM_TIME_L		EQU	0X00
    32  E 0000002F         	WRITE_TM_ADD_H	EQU	0X2F
    33  E 00000000         	WRITE_TM_ADD_L	EQU	0X00
    34  E 00000001         	WRITE_FLAG_H	EQU 0X01
    35  E 00000000         	WRITE_FLAG_L	EQU	0X00
    36  E 00000002         	DEFAULT_GAP_TIME_FLAGH EQU 0X02
    37  E 00000000         	DEFAULT_GAP_TIME_FLAGL EQU	0X00
    38  000000             .DATA
    39  000000             			ORG	0H
    40  0000 D             	DELAYTIME1	DS	1
    41  0001 D             	DELAYTIME2	DS	1
    42  0002 D             	TIMEOUT		DS	1
    43  0003 D             	TLC0		DS	1
    44  0004 D             	TLC1		DS	1
    45  0005 D             	TLC2		DS	1
    46  0006 D             	FLAG1		DS	1
    47  0007 D             	FLAG2		DS	1
    48  0008 D             	TIMEH		DS	1
    49  0009 D             	TIMEG		DS	1
    50  000A D             	DATA_IN		DS	1
    51  000B D             	DATA_OUT	DS	1
    52  000C D             	DATAH		DS	1
    53  000D D             	DATAL		DS	1
    54  000E D             	ADDRESSH	DS	1
    55  000F D             	ADDRESSL	DS	1
    56  0010 D             	CRCT1		DS	1
    57  0011 D             	CRCT2		DS	1
    58  0012 D             	COUNT		DS	1
    59  0013 D             	MAC_H		DS	1
    60  0014 D             	MAC_L		DS	1
    61  0015 D             	FRONT_DELAY	DS	1
    62  0016 D             	TIME_DELAY_GAP	DS	1
    63  0017 D             	STARTADDRH		DS	1
    64  0018 D             	STARTADDRL		DS	1
    65  000019             ;**************BIT_VARIABLES_DEFINNITIONS*******
    66  E 00000006         	READTM_FLAG	EQU	FLAG1.0
    67  E 00030006         	TIME_FLAG	EQU	FLAG1.3
    68  E 00010006         	RESET_FLAG	EQU	FLAG1.1
    69  E 00020006         	TM_EE_FLAG	EQU FLAG1.2
    70  E 00040006         	DEFAULT_GAP_FLAG	EQU	FLAG1.4
    71  E 00050006         	FILLOUT_FLAG	EQU	FLAG1.5
    72  E 00060006         	I2CERROR_FLAG	EQU	FLAG1.6
    73  E 00070006         	ASK_FLAG	EQU	FLAG1.7
    74  E 00010007         	READ_LED_FLAG	EQU	FLAG2.1
    75  E 00020007         	NOT_UPLOAD_FLAG	EQU	FLAG2.2
    76  E 00030007         	HAVE_UPLOAD_FLAG EQU FLAG2.3
    77  E 00040007         	NOT_QUICK_MODE_FLAG EQU FLAG2.4
    78  E 00050007         	TM_I2C_EEROR	EQU FLAG2.5
    79  E 000200D2         	CLED_IO			EQU	P2.2
    80  E 000100D2         	SDATA_IO		EQU	P2.1
    81  E 000000D2         	SCL_IO			EQU	P2.0
    82  E 000300D2         	S_TM_EE_IO		EQU	P2.3
    83  E 000400D2         	IC_IDLE	EQU	P2.4
    84  E 000500D2         	SDA_IO			EQU	P2.5
    85  E 000400D5         	VTM_IO			EQU	P5.4
    86  E 000000D0         	VSR_IO			EQU	P0.0
    87  E 000200C2         	CLED_CONT		EQU	P2M.2
    88  E 000100C2         	SDATA_CONT		EQU	P2M.1
    89  E 000000C2         	SCL_CONT		EQU	P2M.0
    90  E 000300C2         	S_TM_EE_CONT	EQU	P2M.3
    91  E 000500C2         	SDA_CONT		EQU	P2M.5
    92  E 000400C5         	VTM_CONT		EQU	P5M.4
    93  E 000000B8         	VSR_CONT		EQU	P0M.0
    94  000019             ;***************************************
    95  E 000100D1         	VDDF			EQU	P1.1
    96  E 000000D1         	S_VDD_VCC_IO		EQU	P1.0
    97  E 000000C1         	S_VDD_VCC_CONT		EQU	P1M.0
    98  000019             ;*************CODE_SECTION**********************	
    99  000000             .CODE
   100  000000             
   101  000000             		ORG	0
   102  000000   8030(2)  	JMP		START
   103  000008             		ORG	8H
   104  000008   8009(2)  	JMP		INT_SERVICE
   105  000009             INT_SERVICE:
   106  000009             ;KEEP ACC AND PFLAG
   107  000009   0400(1)  	PUSH
   108  00000A             ;T0 INTERRUPT
   109  00000A             JUST_T0:
   110  00000A   74C9(1+S)  	B0BTS0	FT0IEN
   111  00000B   7CC8(1+S)  	B0BTS1	FT0IRQ
   112  00000C   8025(2)  	JMP		JUST_TC0
   113  00000D   64C8(1)  	B0BCLR	FT0IRQ
   114  00000E             ;T0 INTERRUPT SERVISE PROGRESS
   115  00000E   71D1(1+S)  	B0BTS0	VDDF
   116  00000F   4A07(1)  	BSET 	NOT_UPLOAD_FLAG
   117  000010   71D1(1+S)  	B0BTS0	VDDF
   118  000011   4307(1)  	BCLR    HAVE_UPLOAD_FLAG
   119  000012             ;///////////////////////////////
   120  000012   5B07(1+S)  	BTS1	HAVE_UPLOAD_FLAG
   121  000013   8016(2)  	JMP		$+3
   122  000014   79D1(1+S)  	B0BTS1	VDDF
   123  000015   4C07(1)  	BSET	NOT_QUICK_MODE_FLAG
   124  000016   79D1(1+S)  	B0BTS1	VDDF
   125  000017   4B07(1)  	BSET    HAVE_UPLOAD_FLAG
   126  000018             ;//////////////////////////////////
   127  000018   1608(1+S)  	INCMS	TIMEH ;TIMEH=TIMEH+1,
   128  000019   2D78(1)  	MOV		A,#TIME_GAP
   129  00001A   0708(1+S)  	CMPRS	A,TIMEH
   130  00001B   802E(2)  	JMP		EXIT_INT
   131  00001C   2B08(1)  	CLR		TIMEH
   132  00001D   4B06(1)  	BSET	TIME_FLAG
   133  00001E   1609(1+S)  	INCMS	TIMEG
   134  00001F   1E16(1)  	MOV		A,TIME_DELAY_GAP
   135  000020   0709(1+S)  	CMPRS	A,TIMEG
   136  000021   802E(2)  	JMP		EXIT_INT
   137  000022   2B09(1)  	CLR		TIMEG
   138  000023   4806(1)  	BSET	READTM_FLAG
   139  000024   802E(2)  	JMP		EXIT_INT
   140  000025             JUST_TC0:
   141  000025   75C9(1+S)  	B0BTS0	FTC0IEN
   142  000026   7DC8(1+S)  	B0BTS1	FTC0IRQ
   143  000027   802A(2)  	JMP		JUST_INT0
   144  000028   65C8(1)  	B0BCLR	FTC0IRQ
   145  000029             ;TC0 INTERRUPT SERVICE PROGRESS
   146  000029   802E(2)  	JMP		EXIT_INT
   147  00002A             JUST_INT0:
   148  00002A   70C9(1+S)  	B0BTS0	FP00IEN
   149  00002B   78C8(1+S)  	B0BTS1	FP00IRQ
   150  00002C   802E(2)  	JMP EXIT_INT
   151  00002D   60C8(1)  	B0BCLR	FP00IRQ
   152  00002E             ;INT0 INTERRUPT SERVISE PROGRESS
   153  00002E             EXIT_INT:
   154  00002E   0500(1)  	POP
   155  00002F   0F00(2)  	RETI
   156  000030             ;*********************************************************
   157  000030             ;***********************STARRT**********************
   158  000030             START:
   159  000030   2D7F(1)  	MOV		A,#07FH
   160  000031   2FDF(1)  	B0MOV		STKP,A		;DISABLE GLOBAL INTERRUPT
   161  000032   2B86(1)  	CLR		PFLAG
   162  000033   2D00(1)  	MOV		A,#00H
   163  000034   2FCA(1)  	B0MOV		OSCM,A
   164  000035   2D5A(1)  	MOV		A,#0X5A
   165  000036   2FCC(1)  	B0MOV		WDTR,A	
   166  000037   C150(2)  	CALL		CLRRAM
   167  000038             STATE_INITIAL:
   168  000038   C2E8(2)  	CALL		SYS_INIT_FUN
   169  000039   67DF(1)  	B0BCLR		FGIE
   170  00003A             GET_TIME_GAP:
   171  00003A             ;******************************************
   172  00003A   2D01(1)  	MOV		A,#DEFAULT_FRONT_TIME_DELAY
   173  00003B   1F15(1)  	MOV		FRONT_DELAY,A
   174  00003C   2D01(1)  	MOV		A,#DEFAULT_TIME_GAP
   175  00003D   1F16(1)  	MOV		TIME_DELAY_GAP,A
   176  00003E   6BD2(1)  	B0BSET	S_TM_EE_IO
   177  00003F   64D2(1)  	B0BCLR	IC_IDLE
   178  000040   2D2E(1)  	MOV		A,#TM_TIME_H
   179  000041   1F13(1)  	MOV		MAC_H,A
   180  000042   2D00(1)  	MOV		A,#TM_TIME_L
   181  000043   1F14(1)  	MOV		MAC_L,A
   182  000044   C1BB(2)  	CALL	GET_DATA_FROM_TM_FUN
   183  000045   1E0C(1)  	MOV			A,DATAH
   184  000046   0600(1+S)  	CMPRS		A,#0X00
   185  000047   1F15(1)  	MOV			FRONT_DELAY,A
   186  000048   1E0D(1)  	MOV			A,DATAL
   187  000049   0600(1+S)  	CMPRS		A,#0X00
   188  00004A   1F16(1)  	MOV			TIME_DELAY_GAP,A		
   189  00004B   63D2(1)  	B0BCLR		S_TM_EE_IO
   190  00004C   C2CA(2)  	CALL		DELAY_LONG
   191  00004D             ;*******************************************
   192  00004D             WRITE_FLAG_TO_TM:
   193  00004D   6BD2(1)  	B0BSET		S_TM_EE_IO
   194  00004E   2D01(1)  	MOV			A,#WRITE_FLAG_H
   195  00004F   1F0C(1)  	MOV			DATAH,A
   196  000050   2D00(1)  	MOV			A,#WRITE_FLAG_L
   197  000051   1F0D(1)  	MOV			DATAL,A
   198  000052   5107(1+S)  	BTS0		READ_LED_FLAG
   199  000053   8058(2)  	JMP			$+5
   200  000054   2D02(1)  	MOV			A,#DEFAULT_GAP_TIME_FLAGH
   201  000055   1F0C(1)  	MOV			DATAH,A
   202  000056   2D00(1)  	MOV			A,#DEFAULT_GAP_TIME_FLAGL
   203  000057   1F0D(1)  	MOV			DATAL,A
   204  000058   C17A(2)  	CALL		PUT_DATA_INTO_TM_FUN
   205  000059   63D2(1)  	B0BCLR		S_TM_EE_IO
   206  00005A   C2C4(2)  	CALL		DELAY_SHORT
   207  00005B             ;*******************************************
   208  00005B   2D1F(1)  	MOV			A,#LAST_TIME_EE_ADD_H
   209  00005C   1F13(1)  	MOV			MAC_H,A
   210  00005D   2DFE(1)  	MOV			A,#LAST_TIME_EE_ADD_L
   211  00005E   1F14(1)  	MOV			MAC_L,A
   212  00005F   5106(1+S)  	BTS0		RESET_FLAG
   213  000060   8090(2)  	JMP			RESET_EEPROM
   214  000061   C20C(2)  	CALL		GET_DATA_FROM_EE_FUN
   215  000062   1E0F(1)  	MOV			A,ADDRESSL
   216  000063   1F18(1)  	MOV			STARTADDRL,A
   217  000064   1E0E(1)  	MOV			A,ADDRESSH
   218  000065   1F17(1)  	MOV			STARTADDRH,A
   219  000066   1E0E(1)  	MOV			A,ADDRESSH
   220  000067   06FF(1+S)  	CMPRS		A,#0XFF
   221  000068   806B(2)  	JMP			$+3
   222  000069   2B17(1)  	CLR			STARTADDRH
   223  00006A   2B18(1)  	CLR			STARTADDRL
   224  00006B   C2CA(2)  	CALL		DELAY_LONG
   225  00006C   2D1F(1)  	MOV			A,#LIVE_TIME_ADD_H
   226  00006D   1F13(1)  	MOV			MAC_H,A
   227  00006E   2DFC(1)  	MOV			A,#LIVE_TIME_ADD_L
   228  00006F   1F14(1)  	MOV			MAC_L,A
   229  000070   C20C(2)  	CALL		GET_DATA_FROM_EE_FUN
   230  000071             ;;;;;;;;;;;;;;LAST READ TM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   231  000071   6BD2(1)  	B0BSET		S_TM_EE_IO
   232  000072   60D0(1)  	B0BCLR		VSR_IO
   233  000073   2D34(1)  	MOV			A,#TM_DATA_H
   234  000074   1F13(1)  	MOV			MAC_H,A
   235  000075   2D00(1)  	MOV			A,#TM_DATA_L
   236  000076   1F14(1)  	MOV			MAC_L,A
   237  000077   C1BB(2)  	CALL		GET_DATA_FROM_TM_FUN
   238  000078   64D5(1)  	B0BCLR		VTM_IO
   239  000079   C2C4(2)  	CALL		DELAY_SHORT
   240  00007A   63D2(1)  	B0BCLR		S_TM_EE_IO
   241  00007B   64C5(1)  	B0BCLR		VTM_CONT
   242  00007C             ;/////////////////WRITE TO EE//////////////////////////////
   243  00007C   1E0E(1)  	MOV			A,ADDRESSH
   244  00007D   06FF(1+S)  	CMPRS		A,#0XFF
   245  00007E   8080(2)  	JMP			$+2
   246  00007F   8083(2)  	JMP			$+4
   247  000080   160F(1+S)  	INCMS		ADDRESSL
   248  000081   160E(1+S)  	INCMS		ADDRESSH
   249  000082   8085(2)  	JMP			$+3
   250  000083   2B0F(1)  	CLR			ADDRESSL
   251  000084   2B0E(1)  	CLR			ADDRESSH
   252  000085   1E0F(1)  	MOV			A,ADDRESSL
   253  000086   1F0D(1)  	MOV			DATAL,A
   254  000087   1E0E(1)  	MOV			A,ADDRESSH
   255  000088   1F0C(1)  	MOV			DATAH,A
   256  000089   C158(2)  	CALL		DATA_TO_EEPROM_FUN
   257  00008A   1E17(1)  	MOV			A,STARTADDRH
   258  00008B   1F0E(1)  	MOV			ADDRESSH,A
   259  00008C   1E18(1)  	MOV			A,STARTADDRL
   260  00008D   1F0F(1)  	MOV			ADDRESSL,A
   261  00008E   5906(1+S)  	BTS1		RESET_FLAG
   262  00008F   80B0(2)  	JMP			READ_TM_FLAG_MODE
   263  000090             RESET_EEPROM:
   264  000090   2DFF(1)  	MOV		A,#0XFF
   265  000091   1F0C(1)  	MOV		DATAH,A
   266  000092   2DFF(1)  	MOV		A,#0XFF
   267  000093   1F0D(1)  	MOV		DATAL,A
   268  000094   2D00(1)  	MOV		A,#0X00
   269  000095   1F13(1)  	MOV		MAC_H,A
   270  000096             RESET_EE_LOOP_H:
   271  000096   2D00(1)  	MOV		A,#0X00
   272  000097   1F14(1)  	MOV		MAC_L,A
   273  000098             RESET_EE_LOOP_L:
   274  000098   C158(2)  	CALL		DATA_TO_EEPROM_FUN
   275  000099   1614(1+S)  	INCMS	MAC_L
   276  00009A   8098(2)  	JMP		RESET_EE_LOOP_L
   277  00009B   1613(1+S)  	INCMS	MAC_H
   278  00009C   1E13(1)  	MOV		A,MAC_H
   279  00009D   0620(1+S)  	CMPRS	A,#0X20
   280  00009E   8096(2)  	JMP		RESET_EE_LOOP_H
   281  00009F   2B0F(1)  	CLR		ADDRESSL
   282  0000A0   2B0E(1)  	CLR		ADDRESSH
   283  0000A1   2D1F(1)  	MOV		A,#LAST_TIME_EE_ADD_H
   284  0000A2   1F13(1)  	MOV		MAC_H,A
   285  0000A3   2DFE(1)  	MOV		A,#LAST_TIME_EE_ADD_L
   286  0000A4   1F14(1)  	MOV		MAC_L,A
   287  0000A5   1E0E(1)  	MOV		A,ADDRESSH
   288  0000A6   1F0C(1)  	MOV		DATAH,A
   289  0000A7   1E0F(1)  	MOV		A,ADDRESSL
   290  0000A8   1F0D(1)  	MOV		DATAL,A
   291  0000A9   C158(2)  	CALL		DATA_TO_EEPROM_FUN
   292  0000AA   2D1F(1)  	MOV			A,#LIVE_TIME_ADD_H
   293  0000AB   1F13(1)  	MOV			MAC_H,A
   294  0000AC   2DFC(1)  	MOV			A,#LIVE_TIME_ADD_L
   295  0000AD   1F14(1)  	MOV			MAC_L,A
   296  0000AE   C158(2)  	CALL		DATA_TO_EEPROM_FUN
   297  0000AF   4106(1)  	BCLR		RESET_FLAG
   298  0000B0             ;******************************************
   299  0000B0             READ_TM_FLAG_MODE:
   300  0000B0   71D1(1+S)  	B0BTS0	VDDF
   301  0000B1             	SleepMode
   302  0000B1   6BCA(1)  		B0BSET	FCPUM0
   303  0000B2   2D02(1)  	MOV			A,#0X02
   304  0000B3   1F10(1)  	MOV			CRCT1,A
   305  0000B4             SYS_INIT_LED_S:
   306  0000B4   62D2(1)  	B0BCLR		CLED_IO
   307  0000B5   C2D4(2)  	CALL		DELAY_LED	
   308  0000B6   6AD2(1)  	B0BSET		CLED_IO
   309  0000B7   C2D4(2)  	CALL		DELAY_LED
   310  0000B8   2610(1+S)  	DECMS		CRCT1
   311  0000B9   80B4(2)  	JMP			SYS_INIT_LED_S
   312  0000BA             
   313  0000BA             FRONT_DELAY_MODE:
   314  0000BA   6FDF(1)  	B0BSET		FGIE
   315  0000BB   C317(2)  	CALL		SET_LOW_POWER_FUN
   316  0000BC             ;DELAY
   317  0000BC   C31D(2)  	CALL		WAIT_FOR_SEAVAL_MINITE_FUN
   318  0000BD             	;///////////////////////////
   319  0000BD   4207(1)  	BCLR		NOT_UPLOAD_FLAG
   320  0000BE   4307(1)  	BCLR		HAVE_UPLOAD_FLAG
   321  0000BF             ;//////////////////////////////////////
   322  0000BF             MAIN:
   323  0000BF             	;close tc0 interrupt until the recording finished 
   324  0000BF             	GreenMode
   325  0000BF   6CCA(1)  		B0BSET	FCPUM1
   326  0000C0   0000(1)  		NOP
   327  0000C1   0000(1)  		NOP
   328  0000C2             	
   329  0000C2             JUST_I2CSLAVE_MODE:
   330  0000C2   5806(1+S)  	BTS1	READTM_FLAG
   331  0000C3   8112(2)  	JMP		JUST_UPLOAD_MODE
   332  0000C4   5506(1+S)  	BTS0	FILLOUT_FLAG
   333  0000C5   8125(2)  	JMP		MEM_FILLOUT_MODE
   334  0000C6   7CC9(1+S)  	B0BTS1	FT0IEN
   335  0000C7   8112(2)  	JMP		JUST_UPLOAD_MODE
   336  0000C8             ;*****START TM I2C SLAVE MODE***********
   337  0000C8             I2CSLAVE_MODE:
   338  0000C8   4006(1)  	BCLR 	READTM_FLAG
   339  0000C9             ;//////////////////////////////////////
   340  0000C9   7DD2(1+S)  	B0BTS1		SDA_IO
   341  0000CA   8103(2)  	JMP			ADDRESS_CHANGE
   342  0000CB   6DC2(1)  	B0BSET		SDA_CONT
   343  0000CC   65D2(1)  	B0BCLR		SDA_IO
   344  0000CD   68C2(1)  	B0BSET		SCL_CONT
   345  0000CE   60D2(1)  	B0BCLR		SCL_IO
   346  0000CF   C2CA(2)  	CALL		DELAY_LONG
   347  0000D0   71D1(1+S)  	B0BTS0		VDDF
   348  0000D1   4A07(1)  	BSET		NOT_UPLOAD_FLAG
   349  0000D2   65C2(1)  	B0BCLR		SDA_CONT
   350  0000D3   60C2(1)  	B0BCLR		SCL_CONT
   351  0000D4             ;/////////////////////////////////////////
   352  0000D4   5A07(1+S)  	BTS1		NOT_UPLOAD_FLAG
   353  0000D5   8103(2)  	JMP		ADDRESS_CHANGE
   354  0000D6   4207(1)  	BCLR		NOT_UPLOAD_FLAG
   355  0000D7   67DF(1)  	B0BCLR 	FGIE
   356  0000D8   6CC5(1)  	B0BSET	VTM_CONT
   357  0000D9   6BD2(1)  	B0BSET	S_TM_EE_IO
   358  0000DA   60D0(1)  	B0BCLR	VSR_IO
   359  0000DB   2D34(1)  	MOV		A,#TM_DATA_H
   360  0000DC   1F13(1)  	MOV		MAC_H,A
   361  0000DD   2D00(1)  	MOV		A,#TM_DATA_L
   362  0000DE   1F14(1)  	MOV		MAC_L,A
   363  0000DF   C1BB(2)  	CALL	GET_DATA_FROM_TM_FUN
   364  0000E0   64D5(1)  	B0BCLR		VTM_IO
   365  0000E1   C2C4(2)  	CALL		DELAY_SHORT
   366  0000E2   64D2(1)  	B0BCLR		IC_IDLE
   367  0000E3   63D2(1)  	B0BCLR		S_TM_EE_IO
   368  0000E4   64C5(1)  	B0BCLR		VTM_CONT
   369  0000E5   C2C4(2)  	CALL		DELAY_SHORT
   370  0000E6   1E0E(1)  	MOV		A,ADDRESSH
   371  0000E7   1F13(1)  	MOV		MAC_H,A
   372  0000E8   1E0F(1)  	MOV		A,ADDRESSL
   373  0000E9   1F14(1)  	MOV		MAC_L,A
   374  0000EA   C158(2)  	CALL		DATA_TO_EEPROM_FUN
   375  0000EB   2D1F(1)  	MOV		A,#LAST_TIME_EE_ADD_H
   376  0000EC   1F13(1)  	MOV		MAC_H,A
   377  0000ED   2DFE(1)  	MOV		A,#LAST_TIME_EE_ADD_L
   378  0000EE   1F14(1)  	MOV		MAC_L,A
   379  0000EF   1E0E(1)  	MOV		A,ADDRESSH
   380  0000F0   1F0C(1)  	MOV		DATAH,A
   381  0000F1   1E0F(1)  	MOV		A,ADDRESSL
   382  0000F2   1F0D(1)  	MOV		DATAL,A
   383  0000F3   C158(2)  	CALL		DATA_TO_EEPROM_FUN
   384  0000F4   74C8(1+S)  	B0BTS0		FT0IRQ
   385  0000F5   1608(1+S)  	INCMS		TIMEH
   386  0000F6   64C8(1)  	B0BCLR		FT0IRQ
   387  0000F7   6FDF(1)  	B0BSET		FGIE
   388  0000F8   2D78(1)  	MOV			A,#TIME_GAP
   389  0000F9   0708(1+S)  	CMPRS		A,TIMEH
   390  0000FA   8103(2)  	JMP			ADDRESS_CHANGE
   391  0000FB   2B08(1)  	CLR			TIMEH
   392  0000FC   4B06(1)  	BSET		TIME_FLAG
   393  0000FD   1609(1+S)  	INCMS		TIMEG
   394  0000FE   1E16(1)  	MOV			A,TIME_DELAY_GAP
   395  0000FF   0709(1+S)  	CMPRS		A,TIMEG
   396  000100   8103(2)  	JMP			ADDRESS_CHANGE
   397  000101   2B09(1)  	CLR			TIMEG
   398  000102   4806(1)  	BSET		READTM_FLAG
   399  000103             ADDRESS_CHANGE:
   400  000103   6CD2(1)  	B0BSET		IC_IDLE
   401  000104   2D02(1)  	MOV			A,#0X02
   402  000105   130F(1)  	ADD			ADDRESSL,A
   403  000106   2D00(1)  	MOV			A,#0X00
   404  000107   110E(1)  	ADC			ADDRESSH,A
   405  000108   2D1F(1)  	MOV			A,#MAX_MEMH
   406  000109   070E(1+S)  	CMPRS		A,ADDRESSH
   407  00010A   80C2(2)  	JMP			JUST_I2CSLAVE_MODE
   408  00010B   2DF0(1)  	MOV			A,#MAX_MEML
   409  00010C   070F(1+S)  	CMPRS		A,ADDRESSL
   410  00010D   80C2(2)  	JMP			JUST_I2CSLAVE_MODE
   411  00010E   4D06(1)  	BSET		FILLOUT_FLAG
   412  00010F   67D8(1)  	B0BCLR		FT0ENB
   413  000110   64C9(1)  	B0BCLR		FT0IEN
   414  000111   8125(2)  	JMP			MEM_FILLOUT_MODE
   415  000112             ;*****************************************
   416  000112             JUST_UPLOAD_MODE:
   417  000112   62C2(1)  	B0BCLR		CLED_CONT
   418  000113   C2C4(2)  	CALL		DELAY_SHORT
   419  000114   C2C4(2)  	CALL		DELAY_SHORT
   420  000115   7AD2(1+S)  	B0BTS1		CLED_IO
   421  000116   8142(2)  	JMP			RESET_MODE
   422  000117   5206(1+S)  	BTS0		TM_EE_FLAG
   423  000118   811F(2)  	JMP			END_TM_EE_MODE
   424  000119   51D1(1+S)  	BTS0		VDDF
   425  00011A   8125(2)  	JMP			MEM_FILLOUT_MODE
   426  00011B             TM_EE_MODE:
   427  00011B   4307(1)  	BCLR		HAVE_UPLOAD_FLAG
   428  00011C   5206(1+S)  	BTS0		TM_EE_FLAG
   429  00011D   811F(2)  	JMP			END_TM_EE_MODE
   430  00011E   C30D(2)  	CALL		SET_EE_TM_FUN
   431  00011F             END_TM_EE_MODE:
   432  00011F             	;BTS0		FILLOUT_FLAG
   433  00011F             	;JMP			MEM_FILLOUT_MODE	
   434  00011F   59D1(1+S)  	BTS1		VDDF
   435  000120   8125(2)  	JMP			MEM_FILLOUT_MODE
   436  000121   C317(2)  	CALL		SET_LOW_POWER_FUN
   437  000122   5506(1+S)  	BTS0		FILLOUT_FLAG
   438  000123   8125(2)  	JMP			MEM_FILLOUT_MODE
   439  000124             	;we should keep rtc function 
   440  000124   8139(2)  	JMP		ON_LED_MODE
   441  000125             ;*************************************
   442  000125             MEM_FILLOUT_MODE:
   443  000125   5D06(1+S)  	BTS1	FILLOUT_FLAG
   444  000126   8139(2)  	JMP		ON_LED_MODE
   445  000127   79D1(1+S)  	B0BTS1	VDDF
   446  000128   812C(2)  	JMP		$+4
   447  000129   5206(1+S)  	BTS0	TM_EE_FLAG
   448  00012A   C317(2)  	CALL	SET_LOW_POWER_FUN
   449  00012B   812E(2)  	JMP		$+3
   450  00012C   5A06(1+S)  	BTS1	TM_EE_FLAG
   451  00012D   C30D(2)  	CALL	SET_EE_TM_FUN
   452  00012E   7FD8(1+S)  	B0BTS1		FT0ENB
   453  00012F   8134(2)  	JMP			$+5
   454  000130   2BD9(1)  	CLR			T0C
   455  000131   64C8(1)  	B0BCLR		FT0IRQ
   456  000132   64C9(1)  	B0BCLR		FT0IEN
   457  000133   67D8(1)  	B0BCLR		FT0ENB
   458  000134             	SleepMode
   459  000134   6BCA(1)  		B0BSET	FCPUM0
   460  000135             END_FILLOUT_MODE:
   461  000135   6AC2(1)  	B0BSET		CLED_CONT
   462  000136   6AD2(1)  	B0BSET		CLED_IO
   463  000137   C2BF(2)  	CALL		DELAY_MINI
   464  000138   8112(2)  	JMP		JUST_UPLOAD_MODE
   465  000139             ON_LED_MODE:
   466  000139   6AC2(1)  	B0BSET	CLED_CONT
   467  00013A   6AD2(1)  	B0BSET	CLED_IO
   468  00013B   5107(1+S)  	BTS0	READ_LED_FLAG
   469  00013C   C147(2)  	CALL	READ_LED_FUN
   470  00013D   4107(1)  	BCLR   	READ_LED_FLAG
   471  00013E   6AD2(1)  	B0BSET	CLED_IO
   472  00013F   5506(1+S)  	BTS0	FILLOUT_FLAG
   473  000140   8112(2)  	JMP		JUST_UPLOAD_MODE
   474  000141   80BF(2)  	JMP		MAIN
   475  000142             RESET_MODE:
   476  000142   4906(1)  	BSET	RESET_FLAG
   477  000143   4506(1)  	BCLR	FILLOUT_FLAG
   478  000144   2B08(1)  	CLR		TIMEH
   479  000145   2B09(1)  	CLR		TIMEG
   480  000146   8038(2)  	JMP		STATE_INITIAL
   481  000147             	
   482  000147             ;******************************************************************************	
   483  000147             READ_LED_FUN:
   484  000147   2D01(1)     	MOV  	   	A,#1
   485  000148   1F05(1)     	MOV  	   	TLC2,A
   486  000149             LED_MODEL1:	
   487  000149   6AD2(1)     	B0BSET   	CLED_IO
   488  00014A   C2D4(2)     	CALL   	   	DELAY_LED
   489  00014B   62D2(1)     	B0BCLR   	CLED_IO
   490  00014C   C2D4(2)     	CALL   	   	DELAY_LED
   491  00014D   2605(1+S)     	DECMS   	TLC2
   492  00014E   8149(2)     	JMP   	   	LED_MODEL1
   493  00014F   0E00(2)     	RET
   494  000150             ;*******************************************************
   495  000150             ;***************************************
   496  000150             	
   497  000150             	
   498  000150             	
   499  000150             	
   500  000150             	
   501  000150             	
   502  000150             	
   503  000150             	
   504  000150             	
   505  000150             	
   506  000150             	
   507  000150             	
   508  000150             	
   509  000150             	
   510  000150             	
   511  000150             	
   512  000150             CLRRAM:
   513  000150             	
   514  000150   2B84(1)  	CLR			Y
   515  000151   2D2F(1)  	MOV			A,#END_RAM_ADDR
   516  000152   2F83(1)  	B0MOV		Z,A
   517  000153             CLRRAM10:
   518  000153   2BE7(1)  	CLR			@YZ
   519  000154   2683(1+S)  	DECMS		Z
   520  000155   8153(2)  	JMP			CLRRAM10
   521  000156   2BE7(1)  	CLR			@YZ
   522  000157   0E00(2)  	RET
   523  000158             ;***********************************
   524  000158             ;***************************************
   525  000158             ;*************WRITE TMEPERATURE INTO EEPROM*************
   526  000158             ;*************RECORDING ADDRESS THE LAST TIME STORAGE THE TMPERATURE VALUE************
   527  000158             ;**************************************
   528  000158             DATA_TO_EEPROM_FUN:
   529  000158   6DC2(1)  	B0BSET		SDA_CONT
   530  000159   6DD2(1)  	B0BSET		SDA_IO
   531  00015A   68C2(1)  	B0BSET		SCL_CONT
   532  00015B   68D2(1)  	B0BSET		SCL_IO
   533  00015C   1E14(1)  	MOV			A,MAC_L
   534  00015D   1F11(1)  	MOV			CRCT2,A
   535  00015E   1E0C(1)  	MOV			A,DATAH
   536  00015F   1F10(1)  	MOV			CRCT1,A
   537  000160   2D02(1)  	MOV			A,#0X02
   538  000161   1F05(1)  	MOV			TLC2,A
   539  000162             MOVE_DATA_TO_EEPROM:
   540  000162   C237(2)  	CALL		I2C_START_EE
   541  000163   2DA0(1)  	MOV			A,#EEW_ADD
   542  000164   1F0A(1)  	MOV			DATA_IN,A
   543  000165   C288(2)  	CALL		EEADDRESS_ASK
   544  000166   1E13(1)  	MOV			A,MAC_H
   545  000167   1F0A(1)  	MOV			DATA_IN,A
   546  000168   C288(2)  	CALL		EEADDRESS_ASK
   547  000169   1E11(1)  	MOV			A,CRCT2
   548  00016A   1F0A(1)  	MOV			DATA_IN,A
   549  00016B   C288(2)  	CALL		EEADDRESS_ASK
   550  00016C   C2BF(2)  	CALL		DELAY_MINI
   551  00016D   1E10(1)  	MOV			A,CRCT1
   552  00016E   1F0A(1)  	MOV			DATA_IN,A
   553  00016F   C288(2)  	CALL		EEADDRESS_ASK
   554  000170   C23D(2)  	CALL		I2C_END_EE
   555  000171             	
   556  000171   C2CA(2)  	CALL		DELAY_LONG
   557  000172   2D01(1)  	MOV			A,#0X01
   558  000173   1311(1)  	ADD			CRCT2,A
   559  000174   1E0D(1)  	MOV			A,DATAL
   560  000175   1F10(1)  	MOV			CRCT1,A
   561  000176   2605(1+S)  	DECMS		TLC2
   562  000177   8162(2)  	JMP			MOVE_DATA_TO_EEPROM
   563  000178             ;*********************************************
   564  000178   60C2(1)  	B0BCLR		SCL_CONT
   565  000179   0E00(2)  	RET
   566  00017A             ;**************************************
   567  00017A             PUT_DATA_INTO_TM_FUN:
   568  00017A   68C2(1)  	B0BSET	SCL_CONT
   569  00017B   69C2(1)  	B0BSET	SDATA_CONT
   570  00017C   61D2(1)  	B0BCLR	SDATA_IO
   571  00017D   60D2(1)  	B0BCLR	SCL_IO
   572  00017E   C2CA(2)  	CALL 	DELAY_LONG
   573  00017F   C2CA(2)  	CALL 	DELAY_LONG
   574  000180   6CD5(1)  	B0BSET 	VTM_IO
   575  000181   C2CA(2)  	CALL 	DELAY_LONG
   576  000182             	;CALL	DELAY_LONG
   577  000182             START_TMI2C_S:
   578  000182   2D04(1)  	MOV 	A,#0X04
   579  000183   1F03(1)  	MOV 	TLC0,A
   580  000184             LOOP_1_S:
   581  000184   68D2(1)  	B0BSET 	SCL_IO
   582  000185   C2BF(2)  	CALL	DELAY_MINI;13US
   583  000186   C2BE(2)  	CALL	CALL_DELAY
   584  000187   60D2(1)  	B0BCLR 	SCL_IO
   585  000188   C2BF(2)  	CALL 	DELAY_MINI
   586  000189   2603(1+S)  	DECMS  	TLC0
   587  00018A   8184(2)  	JMP 	LOOP_1_S
   588  00018B   41D2(1)  	BCLR 	SDATA_IO
   589  00018C   C2CA(2)  	CALL	DELAY_LONG
   590  00018D   C2CA(2)  	CALL	DELAY_LONG
   591  00018E   2D04(1)  	MOV 	A,#4
   592  00018F   2F03(1)  	B0MOV 	TLC0,A
   593  000190             LOOP_2_S:
   594  000190   60D2(1)  	B0BCLR 	SCL_IO
   595  000191   C2BF(2)  	CALL	DELAY_MINI
   596  000192   C2BE(2)  	CALL	CALL_DELAY
   597  000193   68D2(1)  	B0BSET 	SCL_IO
   598  000194   C2BF(2)  	CALL	DELAY_MINI
   599  000195   2603(1+S)  	DECMS 	TLC0
   600  000196   8190(2)  	JMP 	LOOP_2_S
   601  000197   C2C4(2)  	CALL	DELAY_SHORT
   602  000198   2D14(1)  	MOV 	A,#20
   603  000199   2F03(1)  	B0MOV 	TLC0,A
   604  00019A   49D2(1)  	BSET 	SDATA_IO
   605  00019B             WAIT_TM_INIT_S:
   606  00019B   C2CA(2)  	CALL 		DELAY_LONG
   607  00019C   2603(1+S)  	DECMS 		TLC0
   608  00019D   819B(2)  	JMP 		WAIT_TM_INIT_S
   609  00019E             ;**************START*****************************
   610  00019E   C244(2)  	CALL		I2C_START_TM
   611  00019F             ;***********************************************
   612  00019F   2D3C(1)  	MOV 		A,#TMW_ADD
   613  0001A0   1F0A(1)  	MOV 		DATA_IN,A
   614  0001A1   C252(2)  	CALL 		TMADDRESS_ASK
   615  0001A2   5507(1+S)  	BTS0		TM_I2C_EEROR
   616  0001A3   81B5(2)  	JMP			END_TM_S
   617  0001A4   2D2F(1)  	MOV 		A,#WRITE_TM_ADD_H
   618  0001A5   1F0A(1)  	MOV 		DATA_IN,A
   619  0001A6   C252(2)  	CALL 		TMADDRESS_ASK
   620  0001A7   2D00(1)  	MOV 		A,#WRITE_TM_ADD_L
   621  0001A8   1F0A(1)  	MOV 		DATA_IN,A
   622  0001A9   C252(2)  	CALL 		TMADDRESS_ASK
   623  0001AA   C2CA(2)  	CALL		DELAY_LONG
   624  0001AB   1E0C(1)  	MOV 		A,DATAH
   625  0001AC   1F0A(1)  	MOV 		DATA_IN,A
   626  0001AD   C252(2)  	CALL 		TMADDRESS_ASK
   627  0001AE   1E0D(1)  	MOV 		A,DATAL
   628  0001AF   1F0A(1)  	MOV 		DATA_IN,A
   629  0001B0   C252(2)  	CALL 		TMADDRESS_ASK
   630  0001B1   C2C4(2)  	CALL		DELAY_SHORT
   631  0001B2             ;**************END*******************************
   632  0001B2   C24A(2)  	CALL		I2C_END_TM
   633  0001B3   C2C4(2)  	CALL		DELAY_SHORT
   634  0001B4   61D2(1)  	B0BCLR		SDATA_IO
   635  0001B5             END_TM_S:
   636  0001B5   4507(1)  	BCLR		TM_I2C_EEROR
   637  0001B6   64D5(1)  	B0BCLR 		VTM_IO
   638  0001B7   61C2(1)  	B0BCLR		SDATA_CONT
   639  0001B8   60C2(1)  	B0BCLR		SCL_CONT
   640  0001B9   C2C4(2)  	CALL 		DELAY_SHORT
   641  0001BA   0E00(2)  	RET
   642  0001BB             ;*******************************************
   643  0001BB             ;*****************************************
   644  0001BB             GET_DATA_FROM_TM_FUN:
   645  0001BB   2D0F(1)  	MOV		A,#0X0F
   646  0001BC   1F12(1)  	MOV		COUNT,A
   647  0001BD             TM_I2C_WORK_LOOP:
   648  0001BD   68C2(1)  	B0BSET	SCL_CONT
   649  0001BE   69C2(1)  	B0BSET	SDATA_CONT
   650  0001BF   61D2(1)  	B0BCLR	SDATA_IO
   651  0001C0   60D2(1)  	B0BCLR	SCL_IO
   652  0001C1   C2CA(2)  	CALL 	DELAY_LONG
   653  0001C2   C2CA(2)  	CALL 	DELAY_LONG
   654  0001C3   6CD5(1)  	B0BSET 	VTM_IO
   655  0001C4   C2CA(2)  	CALL 	DELAY_LONG
   656  0001C5             	;CALL	DELAY_LONG
   657  0001C5             START_TMI2C:
   658  0001C5   2D04(1)  	MOV 	A,#0X04
   659  0001C6   1F03(1)  	MOV 	TLC0,A
   660  0001C7             LOOP_1:
   661  0001C7   68D2(1)  	B0BSET 	SCL_IO
   662  0001C8   C2BF(2)  	CALL	DELAY_MINI;13US
   663  0001C9   C2BE(2)  	CALL	CALL_DELAY
   664  0001CA   60D2(1)  	B0BCLR 	SCL_IO
   665  0001CB   C2BF(2)  	CALL 	DELAY_MINI
   666  0001CC   2603(1+S)  	DECMS  	TLC0
   667  0001CD   81C7(2)  	JMP 	LOOP_1
   668  0001CE   2D28(1)  	MOV 	A,#40
   669  0001CF   2F03(1)  	B0MOV 	TLC0,A
   670  0001D0   41D2(1)  	BCLR 	SDATA_IO
   671  0001D1   C2CA(2)  	CALL	DELAY_LONG
   672  0001D2             	;CALL	DELAY_SHORT
   673  0001D2   2D04(1)  	MOV 	A,#4
   674  0001D3   2F03(1)  	B0MOV 	TLC0,A
   675  0001D4             LOOP_2:
   676  0001D4   60D2(1)  	B0BCLR 	SCL_IO
   677  0001D5   C2BF(2)  	CALL	DELAY_MINI
   678  0001D6   C2BE(2)  	CALL	CALL_DELAY
   679  0001D7   68D2(1)  	B0BSET 	SCL_IO
   680  0001D8   C2BF(2)  	CALL	DELAY_MINI
   681  0001D9   2603(1+S)  	DECMS 	TLC0
   682  0001DA   81D4(2)  	JMP 	LOOP_2
   683  0001DB   C2C4(2)  	CALL	DELAY_SHORT
   684  0001DC   2D05(1)  	MOV 	A,#5
   685  0001DD   2F03(1)  	B0MOV 	TLC0,A
   686  0001DE   49D2(1)  	BSET 	SDATA_IO
   687  0001DF             WAIT_TM_INIT:
   688  0001DF   C2CA(2)  	CALL 		DELAY_LONG
   689  0001E0   2603(1+S)  	DECMS 		TLC0
   690  0001E1   81DF(2)  	JMP 		WAIT_TM_INIT
   691  0001E2             ;**************START*****************************
   692  0001E2   C244(2)  	CALL		I2C_START_TM
   693  0001E3             ;***********************************************
   694  0001E3   2D3D(1)  	MOV 		A,#TMR_ADD
   695  0001E4   1F0A(1)  	MOV 		DATA_IN,A
   696  0001E5   C252(2)  	CALL 		TMADDRESS_ASK
   697  0001E6   5507(1+S)  	BTS0		TM_I2C_EEROR
   698  0001E7   8206(2)  	JMP			END_TM
   699  0001E8   1E13(1)  	MOV 		A,MAC_H
   700  0001E9   1F0A(1)  	MOV 		DATA_IN,A
   701  0001EA   C252(2)  	CALL 		TMADDRESS_ASK
   702  0001EB   1E14(1)  	MOV 		A,MAC_L
   703  0001EC   1F0A(1)  	MOV 		DATA_IN,A
   704  0001ED   C252(2)  	CALL 		TMADDRESS_ASK
   705  0001EE   61C2(1)  	B0BCLR		SDATA_CONT
   706  0001EF   C2CA(2)  	CALL 		DELAY_LONG
   707  0001F0   4706(1)  	BCLR 		ASK_FLAG
   708  0001F1   C26C(2)  	CALL 		TMDATA_ASK
   709  0001F2   1E0B(1)  	MOV 		A,DATA_OUT
   710  0001F3   1F0C(1)  	MOV 		DATAH,A
   711  0001F4   4F06(1)  	BSET 		ASK_FLAG
   712  0001F5   C26C(2)  	CALL 		TMDATA_ASK
   713  0001F6   1E0B(1)  	MOV 		A,DATA_OUT
   714  0001F7   1F0D(1)  	MOV 		DATAL,A		
   715  0001F8             ;**************END*******************************
   716  0001F8   C24A(2)  	CALL		I2C_END_TM
   717  0001F9   C2C4(2)  	CALL		DELAY_SHORT
   718  0001FA   61D2(1)  	B0BCLR		SDATA_IO
   719  0001FB   2612(1+S)  	DECMS		COUNT
   720  0001FC   81FE(2)  	JMP			$+2
   721  0001FD   8206(2)  	JMP			END_TM
   722  0001FE   64D5(1)  	B0BCLR 		VTM_IO
   723  0001FF   2D00(1)  	MOV			A,#0X00
   724  000200   070C(1+S)  	CMPRS		A,DATAH
   725  000201   8205(2)  	JMP			$+4
   726  000202   070D(1+S)  	CMPRS		A,DATAL
   727  000203   8205(2)  	JMP			$+2
   728  000204   81BD(2)  	JMP			TM_I2C_WORK_LOOP
   729  000205   4907(1)  	BSET		READ_LED_FLAG
   730  000206             END_TM:
   731  000206   4507(1)  	BCLR		TM_I2C_EEROR
   732  000207   64D5(1)  	B0BCLR 		VTM_IO
   733  000208   61C2(1)  	B0BCLR		SDATA_CONT
   734  000209   60C2(1)  	B0BCLR		SCL_CONT
   735  00020A   C2C4(2)  	CALL 		DELAY_SHORT
   736  00020B   0E00(2)  	RET
   737  00020C             ;*******************************************
   738  00020C             ;***********************************************************
   739  00020C             ;*********************************************************
   740  00020C             GET_DATA_FROM_EE_FUN:
   741  00020C   68C2(1)  	B0BSET		SCL_CONT
   742  00020D   6DC2(1)  	B0BSET		SDA_CONT
   743  00020E   6DD2(1)  	B0BSET		SDA_IO
   744  00020F   68D2(1)  	B0BSET		SCL_IO
   745  000210   C2C4(2)  	CALL		DELAY_SHORT
   746  000211   C237(2)  	CALL		I2C_START_EE
   747  000212   2DA0(1)  	MOV			A,#EEW_ADD
   748  000213   1F0A(1)  	MOV			DATA_IN,A
   749  000214   C288(2)  	CALL		EEADDRESS_ASK
   750  000215   1E13(1)  	MOV			A,MAC_H
   751  000216   1F0A(1)  	MOV			DATA_IN,A
   752  000217   C288(2)  	CALL		EEADDRESS_ASK
   753  000218   1E14(1)  	MOV			A,MAC_L
   754  000219   1F0A(1)  	MOV			DATA_IN,A
   755  00021A   C288(2)  	CALL		EEADDRESS_ASK
   756  00021B   6DD2(1)  	B0BSET		SDA_IO
   757  00021C   C2C4(2)  	CALL		DELAY_SHORT
   758  00021D   68D2(1)  	B0BSET		SCL_IO
   759  00021E   C2C4(2)  	CALL		DELAY_SHORT
   760  00021F   C237(2)  	CALL		I2C_START_EE
   761  000220   C2C4(2)  	CALL		DELAY_SHORT
   762  000221   2DA1(1)  	MOV			A,#EER_ADD
   763  000222   1F0A(1)  	MOV			DATA_IN,A
   764  000223   C288(2)  	CALL		EEADDRESS_ASK
   765  000224   65C2(1)  	B0BCLR		SDA_CONT
   766  000225   4706(1)  	BCLR		ASK_FLAG
   767  000226   C2A2(2)  	CALL		EEDATA_ASK
   768  000227   1E0B(1)  	MOV			A,DATA_OUT
   769  000228   1F0E(1)  	MOV			ADDRESSH,A
   770  000229   65C2(1)  	B0BCLR		SDA_CONT
   771  00022A   C2BF(2)  	CALL		DELAY_MINI
   772  00022B   4F06(1)  	BSET		ASK_FLAG
   773  00022C   C2A2(2)  	CALL		EEDATA_ASK
   774  00022D   1E0B(1)  	MOV			A,DATA_OUT
   775  00022E   1F0F(1)  	MOV			ADDRESSL,A
   776  00022F   C23D(2)  	CALL		I2C_END_EE
   777  000230             ;*************************************
   778  000230   C2C4(2)  	CALL		DELAY_SHORT
   779  000231   60C2(1)  	B0BCLR		SCL_CONT
   780  000232   0E00(2)  	RET
   781  000233             ;************************************************
   782  000233             I2C_EEROR:
   783  000233             	;open interrupt
   784  000233             	;SleepMode
   785  000233   4606(1)  	BCLR	I2CERROR_FLAG
   786  000234   54D5(1+S)  	BTS0	VTM_IO
   787  000235   4D07(1)  	BSET	TM_I2C_EEROR
   788  000236   0E00(2)  	RET
   789  000237             I2C_START_EE:
   790  000237   C2BF(2)  	CALL		DELAY_MINI
   791  000238   65D2(1)  	B0BCLR 		SDA_IO
   792  000239   C2BF(2)  	CALL 		DELAY_MINI
   793  00023A   60D2(1)  	B0BCLR 		SCL_IO
   794  00023B   C2BF(2)  	CALL 		DELAY_MINI
   795  00023C   0E00(2)  	RET
   796  00023D             I2C_END_EE:
   797  00023D   65D2(1)  	B0BCLR 		SDA_IO
   798  00023E   C2BF(2)  	CALL 		DELAY_MINI
   799  00023F   68D2(1)  	B0BSET 		SCL_IO
   800  000240   C2BF(2)  	CALL 		DELAY_MINI
   801  000241   6DD2(1)  	B0BSET 		SDA_IO
   802  000242   C2BF(2)  	CALL		DELAY_MINI
   803  000243   0E00(2)  	RET
   804  000244             I2C_START_TM:
   805  000244   C2BF(2)  	CALL		DELAY_MINI
   806  000245   61D2(1)  	B0BCLR 		SDATA_IO
   807  000246   C2BF(2)  	CALL 		DELAY_MINI
   808  000247   60D2(1)  	B0BCLR 		SCL_IO
   809  000248   C2BF(2)  	CALL 		DELAY_MINI
   810  000249   0E00(2)  	RET
   811  00024A             I2C_END_TM:
   812  00024A   61D2(1)  	B0BCLR 		SDATA_IO
   813  00024B   C2BF(2)  	CALL 		DELAY_MINI
   814  00024C   60D2(1)  	B0BCLR		SCL_IO
   815  00024D   C2BF(2)  	CALL		DELAY_MINI
   816  00024E   69D2(1)  	B0BSET 		SDATA_IO
   817  00024F   C2BF(2)  	CALL		DELAY_MINI
   818  000250   68D2(1)  	B0BSET 		SCL_IO
   819  000251   0E00(2)  	RET
   820  000252             TMADDRESS_ASK:
   821  000252   2D08(1)  	MOV 		A,#8
   822  000253   1F02(1)  	MOV 		TIMEOUT,A
   823  000254             TMADDRESS_LOOP:
   824  000254   570A(1+S)  	BTS0		DATA_IN.7
   825  000255   8259(2)  	JMP 		MD_1
   826  000256   71D2(1+S)  	B0BTS0 		SDATA_IO
   827  000257   61D2(1)  	B0BCLR		SDATA_IO
   828  000258   825B(2)  	JMP 		NEXT_1
   829  000259             MD_1:
   830  000259   79D2(1+S)  	B0BTS1 		SDATA_IO
   831  00025A   69D2(1)  	B0BSET		SDATA_IO
   832  00025B             NEXT_1:
   833  00025B   C2BF(2)  	CALL		DELAY_MINI
   834  00025C   68D2(1)  	B0BSET 		SCL_IO
   835  00025D   C2BF(2)  	CALL		DELAY_MINI
   836  00025E   0B0A(1)  	RLCM 		DATA_IN
   837  00025F   60D2(1)  	B0BCLR 		SCL_IO
   838  000260   2602(1+S)  	DECMS 		TIMEOUT
   839  000261   8254(2)  	JMP 		TMADDRESS_LOOP
   840  000262             	
   841  000262   61C2(1)  	B0BCLR 		SDATA_CONT
   842  000263   C2BF(2)  	CALL		DELAY_MINI
   843  000264   68D2(1)  	B0BSET 		SCL_IO
   844  000265   C2BE(2)  	CALL 		CALL_DELAY
   845  000266   71D2(1+S)  	B0BTS0 		SDATA_IO
   846  000267   C233(2)  	CALL		I2C_EEROR
   847  000268   C2BF(2)  	CALL		DELAY_MINI
   848  000269   40D2(1)  	BCLR 		SCL_IO
   849  00026A   49C2(1)  	BSET 		SDATA_CONT
   850  00026B   0E00(2)  	RET
   851  00026C             ;**********************TM_READING_DATA********************************
   852  00026C             TMDATA_ASK:
   853  00026C   61C2(1)  	B0BCLR 		SDATA_CONT
   854  00026D   2D08(1)  	MOV 		A,#8
   855  00026E   1F02(1)  	MOV 		TIMEOUT,A
   856  00026F             TMDATA_LOOP:
   857  00026F   2D09(1)  	MOV 		A,#9
   858  000270   1F03(1)  	MOV 		TLC0,A
   859  000271   C2BF(2)  	CALL		DELAY_MINI
   860  000272   48D2(1)  	BSET 		SCL_IO
   861  000273   C2BE(2)  	CALL 		CALL_DELAY
   862  000274   71D2(1+S)  	B0BTS0 		SDATA_IO
   863  000275   480B(1)  	BSET 		DATA_OUT.0
   864  000276   79D2(1+S)  	B0BTS1 		SDATA_IO
   865  000277   400B(1)  	BCLR 		DATA_OUT.0
   866  000278   0B0B(1)  	RLCM 		DATA_OUT
   867  000279   C2BF(2)  	CALL		DELAY_MINI
   868  00027A   60D2(1)  	B0BCLR 		SCL_IO
   869  00027B   2602(1+S)  	DECMS 		TIMEOUT
   870  00027C   826F(2)  	JMP 		TMDATA_LOOP
   871  00027D   69C2(1)  	B0BSET 		SDATA_CONT
   872  00027E   5706(1+S)  	BTS0 		ASK_FLAG
   873  00027F   69D2(1)  	B0BSET 		SDATA_IO
   874  000280   5F06(1+S)  	BTS1 		ASK_FLAG
   875  000281   61D2(1)  	B0BCLR 		SDATA_IO
   876  000282   090B(1)  	RRCM 		DATA_OUT
   877  000283   C2BF(2)  	CALL		DELAY_MINI
   878  000284   48D2(1)  	BSET 		SCL_IO
   879  000285   C2BF(2)  	CALL		DELAY_MINI
   880  000286   40D2(1)  	BCLR		SCL_IO	
   881  000287   0E00(2)  	RET
   882  000288             ;******************************************************
   883  000288             EEADDRESS_ASK:
   884  000288   2D08(1)  	MOV 		A,#8
   885  000289   1F02(1)  	MOV 		TIMEOUT,A
   886  00028A             EEADDRESS_LOOP:
   887  00028A   570A(1+S)  	BTS0		DATA_IN.7
   888  00028B   828F(2)  	JMP 		EEMD_1
   889  00028C   75D2(1+S)  	B0BTS0 		SDA_IO
   890  00028D   65D2(1)  	B0BCLR		SDA_IO
   891  00028E   8291(2)  	JMP 		EENEXT_1
   892  00028F             EEMD_1:
   893  00028F   7DD2(1+S)  	B0BTS1 		SDA_IO
   894  000290   6DD2(1)  	B0BSET		SDA_IO
   895  000291             EENEXT_1:
   896  000291   C2BF(2)  	CALL		DELAY_MINI
   897  000292   68D2(1)  	B0BSET 		SCL_IO
   898  000293   C2BF(2)  	CALL		DELAY_MINI
   899  000294   0B0A(1)  	RLCM 		DATA_IN
   900  000295   60D2(1)  	B0BCLR 		SCL_IO
   901  000296   2602(1+S)  	DECMS 		TIMEOUT
   902  000297   828A(2)  	JMP 		EEADDRESS_LOOP
   903  000298             	
   904  000298   65C2(1)  	B0BCLR 		SDA_CONT
   905  000299   C2BF(2)  	CALL		DELAY_MINI
   906  00029A   68D2(1)  	B0BSET 		SCL_IO
   907  00029B   C2BE(2)  	CALL 		CALL_DELAY
   908  00029C   75D2(1+S)  	B0BTS0 		SDA_IO
   909  00029D   C233(2)  	CALL		I2C_EEROR
   910  00029E   C2BF(2)  	CALL		DELAY_MINI
   911  00029F   40D2(1)  	BCLR 		SCL_IO
   912  0002A0   4DC2(1)  	BSET 		SDA_CONT
   913  0002A1   0E00(2)  	RET
   914  0002A2             ;****************************************
   915  0002A2             EEDATA_ASK:
   916  0002A2   65C2(1)  	B0BCLR 		SDA_CONT
   917  0002A3   2D08(1)  	MOV 		A,#8
   918  0002A4   1F02(1)  	MOV 		TIMEOUT,A
   919  0002A5             EEDATA_LOOP:
   920  0002A5   2D09(1)  	MOV 		A,#9
   921  0002A6   1F03(1)  	MOV 		TLC0,A
   922  0002A7   C2BF(2)  	CALL		DELAY_MINI
   923  0002A8   48D2(1)  	BSET 		SCL_IO
   924  0002A9   C2BE(2)  	CALL 		CALL_DELAY
   925  0002AA   75D2(1+S)  	B0BTS0 		SDA_IO
   926  0002AB   480B(1)  	BSET 		DATA_OUT.0
   927  0002AC   7DD2(1+S)  	B0BTS1 		SDA_IO
   928  0002AD   400B(1)  	BCLR 		DATA_OUT.0
   929  0002AE   0B0B(1)  	RLCM 		DATA_OUT
   930  0002AF   C2BF(2)  	CALL		DELAY_MINI
   931  0002B0   60D2(1)  	B0BCLR 		SCL_IO
   932  0002B1   2602(1+S)  	DECMS 		TIMEOUT
   933  0002B2   82A5(2)  	JMP 		EEDATA_LOOP
   934  0002B3             	
   935  0002B3   6DC2(1)  	B0BSET 		SDA_CONT
   936  0002B4   5706(1+S)  	BTS0 		ASK_FLAG
   937  0002B5   6DD2(1)  	B0BSET 		SDA_IO
   938  0002B6   5F06(1+S)  	BTS1 		ASK_FLAG
   939  0002B7   65D2(1)  	B0BCLR 		SDA_IO
   940  0002B8   090B(1)  	RRCM 		DATA_OUT
   941  0002B9   C2BF(2)  	CALL		DELAY_MINI
   942  0002BA   48D2(1)  	BSET 		SCL_IO
   943  0002BB   C2BF(2)  	CALL		DELAY_MINI
   944  0002BC   40D2(1)  	BCLR		SCL_IO	
   945  0002BD   0E00(2)  	RET
   946  0002BE             ;*********************delay*****************
   947  0002BE             CALL_DELAY:
   948  0002BE   0E00(2)  	RET
   949  0002BF             DELAY_MINI:;13US
   950  0002BF   2D05(1)  	MOV		A,#0X05
   951  0002C0   1F00(1)  	MOV		DELAYTIME1,A
   952  0002C1             DELAY0:
   953  0002C1   2600(1+S)  	DECMS	DELAYTIME1
   954  0002C2   82C1(2)  	JMP		DELAY0
   955  0002C3   0E00(2)  	RET
   956  0002C4             	
   957  0002C4             DELAY_SHORT:		;50US FOR 0.5US/INSTRUCTION
   958  0002C4   2D63(1)  	MOV		A,#0X63
   959  0002C5   1F00(1)  	MOV		DELAYTIME1,A
   960  0002C6             DELAY1:
   961  0002C6   0000(1)  	NOP
   962  0002C7   2600(1+S)  	DECMS	DELAYTIME1
   963  0002C8   82C6(2)  	JMP		DELAY1
   964  0002C9   0E00(2)  	RET
   965  0002CA             DELAY_LONG:	;>=5MS
   966  0002CA             ;WAIT_FOR_A_LONG_WHILE
   967  0002CA   2D0A(1)  	MOV		A,#0X0A
   968  0002CB   2F00(1)  	B0MOV	DELAYTIME1,A
   969  0002CC             DELAY2_1:
   970  0002CC   2DC7(1)  	MOV		A,#0XC7
   971  0002CD   1F01(1)  	MOV		DELAYTIME2,A
   972  0002CE             DELAY2_2:
   973  0002CE   0000(1)  	NOP
   974  0002CF   2601(1+S)  	DECMS	DELAYTIME2
   975  0002D0   82CE(2)  	JMP		DELAY2_2	
   976  0002D1   2600(1+S)  	DECMS	DELAYTIME1
   977  0002D2   82CC(2)  	JMP		DELAY2_1
   978  0002D3   0E00(2)  	RET		
   979  0002D4             DELAY_LED:		;0.2S
   980  0002D4             ;WAIT_FOR_DEEP_DARK_FANTASY
   981  0002D4   2DFF(1)  	MOV		A,#0XFF
   982  0002D5   1F01(1)  	MOV		DELAYTIME2,A
   983  0002D6             DELAY3_1:
   984  0002D6   2DFF(1)  	MOV		A,#0XFF
   985  0002D7   1F00(1)  	MOV		DELAYTIME1,A
   986  0002D8             DELAY3_2:
   987  0002D8   0000(1)  	NOP
   988  0002D9   0000(1)  	NOP
   989  0002DA   2600(1+S)  	DECMS		DELAYTIME1
   990  0002DB   82D8(2)  	JMP			DELAY3_2
   991  0002DC   2601(1+S)  	DECMS		DELAYTIME2
   992  0002DD   82D6(2)  	JMP			DELAY3_1
   993  0002DE   0E00(2)  	RET
   994  0002DF             OPEN_TC0_INT_FUN:
   995  0002DF   6BDA(1)  	B0BSET	FTC0CKS	;	OUTSIDE INPUT ACCIDENT
   996  0002E0   6ADA(1)  	B0BSET	FALOAD0 ;
   997  0002E1   2DFD(1)  	MOV		A,#0XFD
   998  0002E2   2FCD(1)  	B0MOV	TC0R,A
   999  0002E3   2FDB(1)  	B0MOV	TC0C,A
  1000  0002E4   65C8(1)  	B0BCLR	FTC0IRQ
  1001  0002E5   6DC9(1)  	B0BSET	FTC0IEN
  1002  0002E6   6FDA(1)  	B0BSET	FTC0ENB
  1003  0002E7   0E00(2)  	RET
  1004  0002E8             SYS_INIT_FUN:
  1005  0002E8   2D3D(1)  	MOV			A,#0X3D
  1006  0002E9   2FC2(1)  	B0MOV		P2M,A
  1007  0002EA   2D35(1)  	MOV			A,#0X35
  1008  0002EB   2FD2(1)  	B0MOV		P2,A
  1009  0002EC             	;up resistor for p2.1
  1010  0002EC             	;MOV			A,#0X02
  1011  0002EC             	;B0MOV		P2UR,A
  1012  0002EC   2D01(1)  	MOV			A,#0X01
  1013  0002ED   2FC1(1)  	B0MOV		P1M,A
  1014  0002EE   2BD1(1)  	CLR			P1
  1015  0002EF   68B8(1)  	B0BSET		VSR_CONT
  1016  0002F0   60D0(1)  	B0BCLR		VSR_IO
  1017  0002F1   68C1(1)  	B0BSET		S_VDD_VCC_CONT
  1018  0002F2   60D1(1)  	B0BCLR		S_VDD_VCC_IO
  1019  0002F3   6CC5(1)  	B0BSET		VTM_CONT
  1020  0002F4   64D5(1)  	B0BCLR		VTM_IO
  1021  0002F5   2D03(1)  	MOV			A,#0X03
  1022  0002F6   1F10(1)  	MOV			CRCT1,A
  1023  0002F7             SYS_INIT_LED:
  1024  0002F7   62D2(1)  	B0BCLR		CLED_IO
  1025  0002F8   C2D4(2)  	CALL		DELAY_LED	
  1026  0002F9   6AD2(1)  	B0BSET		CLED_IO
  1027  0002FA   C2D4(2)  	CALL		DELAY_LED
  1028  0002FB   2610(1+S)  	DECMS		CRCT1
  1029  0002FC   82F7(2)  	JMP			SYS_INIT_LED
  1030  0002FD             ;************T0_INIT_START************************************
  1031  0002FD   2D00(1)  	MOV			A,#0X00
  1032  0002FE   2FD8(1)  	B0MOV		T0M,A	
  1033  0002FF   68D8(1)  	B0BSET		FT0TB	; T0 = Fcpu/256,PERIOD TIME IS 2S
  1034  000300   2BD9(1)  	CLR			T0C
  1035  000301   64C8(1)  	B0BCLR		FT0IRQ
  1036  000302   6CC9(1)  	B0BSET		FT0IEN
  1037  000303   6FD8(1)  	B0BSET		FT0ENB
  1038  000304             ;*****************TC0_INIT_START*****************
  1039  000304   2BDA(1)  	CLR			TC0M
  1040  000305   2BDB(1)  	CLR			TC0C
  1041  000306   65C8(1)  	B0BCLR		FTC0IRQ
  1042  000307   65C9(1)  	B0BCLR		FTC0IEN
  1043  000308   67DA(1)  	B0BCLR		FTC0ENB
  1044  000309             ;************************OPEN P1.1WEEK UP FUNCTION*********************
  1045  000309   2D02(1)  	MOV			A,#0X02
  1046  00030A   2FC0(1)  	B0MOV		P1W,A
  1047  00030B   C2BF(2)  	CALL		DELAY_MINI
  1048  00030C   0E00(2)  	RET
  1049  00030D             ;//////////////////////////////////////////////////
  1050  00030D             SET_EE_TM_FUN:
  1051  00030D   65C2(1)  	B0BCLR		SDA_CONT
  1052  00030E   64C5(1)  	B0BCLR		VTM_CONT
  1053  00030F   60C2(1)  	B0BCLR		SCL_CONT
  1054  000310   61C2(1)  	B0BCLR		SDATA_CONT
  1055  000311   68D0(1)  	B0BSET		VSR_IO
  1056  000312   6BD2(1)  	B0BSET		S_TM_EE_IO
  1057  000313   4A06(1)  	BSET		TM_EE_FLAG
  1058  000314   64D2(1)  	B0BCLR	IC_IDLE
  1059  000315   4407(1)  	BCLR	NOT_QUICK_MODE_FLAG
  1060  000316   0E00(2)  	RET
  1061  000317             ;////////////////////////////////////////
  1062  000317             ;////////////SET LOW POWER
  1063  000317             SET_LOW_POWER_FUN:
  1064  000317             ;****************************************
  1065  000317   64C5(1)  	B0BCLR		VTM_CONT
  1066  000318   63D2(1)  	B0BCLR		S_TM_EE_IO
  1067  000319   60D0(1)  	B0BCLR		VSR_IO
  1068  00031A   4206(1)  	BCLR		TM_EE_FLAG
  1069  00031B   6CD2(1)  	B0BSET	IC_IDLE
  1070  00031C   0E00(2)  	RET
  1071  00031D             ;/////////////////////////////////////////	
  1072  00031D             WAIT_FOR_SEAVAL_MINITE_FUN:
  1073  00031D   1E15(1)  	MOV   	A,FRONT_DELAY
  1074  00031E   1F10(1)  	MOV		CRCT1,A
  1075  00031F             	GreenMode
  1076  00031F   6CCA(1)  		B0BSET	FCPUM1
  1077  000320   0000(1)  		NOP
  1078  000321   0000(1)  		NOP
  1079  000322   5407(1+S)  	BTS0	NOT_QUICK_MODE_FLAG
  1080  000323   C30D(2)  	CALL	SET_EE_TM_FUN
  1081  000324   5207(1+S)  	BTS0	NOT_UPLOAD_FLAG
  1082  000325   C317(2)  	CALL	SET_LOW_POWER_FUN
  1083  000326   5B06(1+S)  	BTS1	TIME_FLAG
  1084  000327   8321(2)  	JMP		$-6
  1085  000328   4306(1)  	BCLR	TIME_FLAG
  1086  000329   2610(1+S)  	DECMS	CRCT1
  1087  00032A   8321(2)  	JMP		$-9
  1088  00032B   0E00(2)  	RET
  1089  00032C             ;*******************************************
  1090  00032C             	ENDP
