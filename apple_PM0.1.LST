     1  000000             CHIP		SN8P2501D
     2  000000             //{{SONIX_CODE_OPTION
     3  000000             	.Code_Option	Noise_Filter	Enable
     4  000000             	.Code_Option	Reset_Pin	P11
     5  000000             	.Code_Option	Watch_Dog	Disable
     6  000000             	.Code_Option	High_Clk	IHRC_RTC	;
     7  000000             	.Code_Option	Fcpu		#3     ; Fcpu = Fosc/8
     8  000000             	.Code_Option	Security	Enable
     9  000000             	.Code_Option	LVD		LVD_L		;
    10  000000             //}}SONIX_CODE_OPTION
    11  000000             
    12  E 0000002F         	END_RAM_ADDR	EQU	0X2F
    13  E 000000A1         	EER_ADD			EQU	0XA1	;10100001B
    14  E 000000A0         	EEW_ADD			EQU	0XA0	;10100000B
    15  E 00000030         	RAM_COUNT		EQU	48
    16  E 00000034         	TM_DATA_H		EQU	0X34	;ADDR OF THE TEMPEATURE	OF TM
    17  E 00000000         	TM_DATA_L		EQU	0X00
    18  E 0000002F         	WRITE_TM_ADD_H	EQU	0X2F	;Where mcu want to wirte something into tm
    19  E 00000000         	WRITE_TM_ADD_L	EQU	0X00
    20  E 00000078         	TIME_GAP		EQU	0X78	;0X78
    21  E 00000001         	T0_TDR			EQU	0X01
    22  E 0000003D         	TMR_ADD 		EQU	0X3D
    23  E 0000003C         	TMW_ADD			EQU	0X3C
    24  E 0000001F         	MAX_MEMH		EQU	0X1F
    25  E 000000F0         	MAX_MEML		EQU	0XF0
    26  E 0000001F         	LAST_TIME_EE_ADD_H EQU 0X1F
    27  E 000000FE         	LAST_TIME_EE_ADD_L EQU 0XFE
    28  E 0000001F         	LIVE_TIME_ADD_H		EQU	0X1F
    29  E 000000FC         	LIVE_TIME_ADD_L		EQU	0XFC
    30  E 00000001         	DEFAULT_FRONT_TIME_DELAY	EQU	0X01
    31  E 00000001         	DEFAULT_TIME_GAP	EQU	0X01
    32  E 00000030         	TM_INITIAL_TIME_ADD_H	EQU 0X30
    33  E 00000000         	TM_INITIAL_TIME_ADD_L	EQU 0X00
    34  E 00000031         	TM_TIME_H		EQU	0X31
    35  E 00000000         	TM_TIME_L		EQU	0X00
    36  E 0000001F         	EE_DELAY_ADD_H	EQU	0X1F
    37  E 000000F8         	EE_GAP_ADD_L	EQU	0XF8
    38  E 0000001F         	EE_INITIAL_TIME_ADD_H	EQU	0X1F
    39  E 000000FA         	EE_INITIAL_TIME_ADD_L	EQU	0XFA
    40  E 00000001         	WRITE_FLAG_H	EQU 0X01
    41  E 00000000         	WRITE_FLAG_L	EQU	0X00
    42  E 00000002         	DEFAULT_GAP_TIME_FLAGH EQU 0X02
    43  E 00000000         	DEFAULT_GAP_TIME_FLAGL EQU	0X00
    44  000000             .DATA
    45  000000             			ORG	0H
    46  0000 D             	DELAYTIME1	DS	1
    47  0001 D             	DELAYTIME2	DS	1
    48  0002 D             	TIMEOUT		DS	1
    49  0003 D             	TLC0		DS	1
    50  0004 D             	TLC1		DS	1
    51  0005 D             	TLC2		DS	1
    52  0006 D             	FLAG1		DS	1
    53  0007 D             	FLAG2		DS	1
    54  0008 D             	TIMEH		DS	1
    55  0009 D             	TIMEG		DS	1
    56  000A D             	DATA_IN		DS	1
    57  000B D             	DATA_OUT	DS	1
    58  000C D             	DATAH		DS	1
    59  000D D             	DATAL		DS	1
    60  000E D             	ADDRESSH	DS	1
    61  000F D             	ADDRESSL	DS	1
    62  0010 D             	CRCT1		DS	1
    63  0011 D             	CRCT2		DS	1
    64  0012 D             	COUNT		DS	1
    65  0013 D             	MAC_H		DS	1
    66  0014 D             	MAC_L		DS	1
    67  0015 D             	FRONT_DELAY	DS	1
    68  0016 D             	TIME_DELAY_GAP	DS	1
    69  0017 D             	STARTADDRH		DS	1
    70  0018 D             	STARTADDRL		DS	1
    71  0019 D             	INITIAL_TIMEH	DS	1
    72  001A D             	INITIAL_TIMEL	DS	1
    73  00001B             ;**************BIT_VARIABLES_DEFINNITIONS*******
    74  E 00000006         	READTM_FLAG	EQU	FLAG1.0
    75  E 00030006         	TIME_FLAG	EQU	FLAG1.3
    76  E 00010006         	RESET_FLAG	EQU	FLAG1.1
    77  E 00020006         	TM_EE_FLAG	EQU FLAG1.2
    78  E 00040006         	DEFAULT_GAP_FLAG	EQU	FLAG1.4
    79  E 00050006         	FILLOUT_FLAG	EQU	FLAG1.5
    80  E 00060006         	I2CERROR_FLAG	EQU	FLAG1.6
    81  E 00070006         	ASK_FLAG	EQU	FLAG1.7
    82  E 00010007         	READ_LED_FLAG	EQU	FLAG2.1
    83  E 00020007         	NOT_UPLOAD_FLAG	EQU	FLAG2.2
    84  E 00030007         	HAVE_UPLOAD_FLAG EQU FLAG2.3
    85  E 00040007         	NOT_QUICK_MODE_FLAG EQU FLAG2.4
    86  E 00050007         	TM_I2C_EEROR	EQU FLAG2.5
    87  E 000200D2         	CLED_IO			EQU	P2.2
    88  E 000100D2         	SDATA_IO		EQU	P2.1
    89  E 000000D2         	SCL_IO			EQU	P2.0
    90  E 000300D2         	S_TM_EE_IO		EQU	P2.3
    91  E 000400D2         	IC_IDLE	EQU	P2.4
    92  E 000500D2         	SDA_IO			EQU	P2.5
    93  E 000400D5         	VTM_IO			EQU	P5.4
    94  E 000000D0         	VSR_IO			EQU	P0.0
    95  E 000200C2         	CLED_CONT		EQU	P2M.2
    96  E 000100C2         	SDATA_CONT		EQU	P2M.1
    97  E 000000C2         	SCL_CONT		EQU	P2M.0
    98  E 000300C2         	S_TM_EE_CONT	EQU	P2M.3
    99  E 000500C2         	SDA_CONT		EQU	P2M.5
   100  E 000400C5         	VTM_CONT		EQU	P5M.4
   101  E 000000B8         	VSR_CONT		EQU	P0M.0
   102  00001B             ;***************************************
   103  E 000100D1         	VDDF			EQU	P1.1
   104  E 000000D1         	S_VDD_VCC_IO		EQU	P1.0
   105  E 000000C1         	S_VDD_VCC_CONT		EQU	P1M.0
   106  00001B             ;*************CODE_SECTION**********************	
   107  000000             .CODE
   108  000000             
   109  000000             		ORG	0
   110  000000   8030(2)  	JMP		START
   111  000008             		ORG	8H
   112  000008   8009(2)  	JMP		INT_SERVICE
   113  000009             INT_SERVICE:
   114  000009             ;KEEP ACC AND PFLAG
   115  000009   0400(1)  	PUSH
   116  00000A             ;T0 INTERRUPT
   117  00000A             JUST_T0:
   118  00000A   74C9(1+S)  	B0BTS0	FT0IEN
   119  00000B   7CC8(1+S)  	B0BTS1	FT0IRQ
   120  00000C   8025(2)  	JMP		JUST_TC0
   121  00000D   64C8(1)  	B0BCLR	FT0IRQ
   122  00000E             ;T0 INTERRUPT SERVISE PROGRESS
   123  00000E   71D1(1+S)  	B0BTS0	VDDF
   124  00000F   4A07(1)  	BSET 	NOT_UPLOAD_FLAG
   125  000010   71D1(1+S)  	B0BTS0	VDDF
   126  000011   4307(1)  	BCLR    HAVE_UPLOAD_FLAG
   127  000012             ;///////////////////////////////
   128  000012   5B07(1+S)  	BTS1	HAVE_UPLOAD_FLAG
   129  000013   8016(2)  	JMP		$+3
   130  000014   79D1(1+S)  	B0BTS1	VDDF
   131  000015   4C07(1)  	BSET	NOT_QUICK_MODE_FLAG
   132  000016   79D1(1+S)  	B0BTS1	VDDF
   133  000017   4B07(1)  	BSET    HAVE_UPLOAD_FLAG
   134  000018             ;//////////////////////////////////
   135  000018   1608(1+S)  	INCMS	TIMEH ;TIMEH=TIMEH+1,
   136  000019   2D78(1)  	MOV		A,#TIME_GAP
   137  00001A   0708(1+S)  	CMPRS	A,TIMEH
   138  00001B   802E(2)  	JMP		EXIT_INT
   139  00001C   2B08(1)  	CLR		TIMEH
   140  00001D   4B06(1)  	BSET	TIME_FLAG
   141  00001E   1609(1+S)  	INCMS	TIMEG
   142  00001F   1E16(1)  	MOV		A,TIME_DELAY_GAP
   143  000020   0709(1+S)  	CMPRS	A,TIMEG
   144  000021   802E(2)  	JMP		EXIT_INT
   145  000022   2B09(1)  	CLR		TIMEG
   146  000023   4806(1)  	BSET	READTM_FLAG
   147  000024   802E(2)  	JMP		EXIT_INT
   148  000025             JUST_TC0:
   149  000025   75C9(1+S)  	B0BTS0	FTC0IEN
   150  000026   7DC8(1+S)  	B0BTS1	FTC0IRQ
   151  000027   802A(2)  	JMP		JUST_INT0
   152  000028   65C8(1)  	B0BCLR	FTC0IRQ
   153  000029             ;TC0 INTERRUPT SERVICE PROGRESS
   154  000029   802E(2)  	JMP		EXIT_INT
   155  00002A             JUST_INT0:
   156  00002A   70C9(1+S)  	B0BTS0	FP00IEN
   157  00002B   78C8(1+S)  	B0BTS1	FP00IRQ
   158  00002C   802E(2)  	JMP EXIT_INT
   159  00002D   60C8(1)  	B0BCLR	FP00IRQ
   160  00002E             ;INT0 INTERRUPT SERVISE PROGRESS
   161  00002E             EXIT_INT:
   162  00002E   0500(1)  	POP
   163  00002F   0F00(2)  	RETI
   164  000030             ;*********************************************************
   165  000030             ;***********************STARRT**********************
   166  000030             START:
   167  000030   2D7F(1)  	MOV		A,#07FH
   168  000031   2FDF(1)  	B0MOV		STKP,A		;DISABLE GLOBAL INTERRUPT
   169  000032   2B86(1)  	CLR		PFLAG
   170  000033   2D00(1)  	MOV		A,#00H
   171  000034   2FCA(1)  	B0MOV		OSCM,A
   172  000035   2D5A(1)  	MOV		A,#0X5A
   173  000036   2FCC(1)  	B0MOV		WDTR,A	
   174  000037   C14F(2)  	CALL		CLRRAM
   175  000038             STATE_INITIAL:
   176  000038   C2E7(2)  	CALL		SYS_INIT_FUN
   177  000039   67DF(1)  	B0BCLR		FGIE
   178  00003A             GET_TIME_INITIAL:
   179  00003A             ;******************************************
   180  00003A   2D01(1)  	MOV		A,#DEFAULT_FRONT_TIME_DELAY
   181  00003B   1F15(1)  	MOV		FRONT_DELAY,A
   182  00003C   2D01(1)  	MOV		A,#DEFAULT_TIME_GAP
   183  00003D   1F16(1)  	MOV		TIME_DELAY_GAP,A
   184  00003E   6BD2(1)  	B0BSET	S_TM_EE_IO
   185  00003F   64D2(1)  	B0BCLR	IC_IDLE
   186  000040             ;Get initial time from tm
   187  000040   2D30(1)  	MOV		A,#TM_INITIAL_TIME_ADD_H
   188  000041   1F13(1)  	MOV		MAC_H,A
   189  000042   2D00(1)  	MOV		A,#TM_INITIAL_TIME_ADD_L
   190  000043   1F14(1)  	MOV		MAC_L,A
   191  000044   C1BA(2)  	CALL	GET_DATA_FROM_TM_FUN
   192  000045   1E0C(1)  	MOV		A,DATAH
   193  000046   0600(1+S)  	CMPRS	A,#0X00
   194  000047   1F19(1)  	MOV		INITIAL_TIMEH,A
   195  000048   1E0D(1)  	MOV		A,DATAL
   196  000049   0600(1+S)  	CMPRS	A,#0X00
   197  00004A   1F1A(1)  	MOV		INITIAL_TIMEL,A
   198  00004B   C2C3(2)  	CALL	DELAY_SHORT
   199  00004C             ;GET TIME DELAY AND GAP FROM TM
   200  00004C   2D31(1)  	MOV		A,#TM_TIME_H
   201  00004D   1F13(1)  	MOV		MAC_H,A
   202  00004E   2D00(1)  	MOV		A,#TM_TIME_L
   203  00004F   1F14(1)  	MOV		MAC_L,A
   204  000050   C1BA(2)  	CALL	GET_DATA_FROM_TM_FUN
   205  000051             ;the 2bit in front of DATAH is useness
   206  000051   2D3F(1)  	MOV		A,#0X3F
   207  000052   290C(1)  	AND		DATAH,A
   208  000053   1E0C(1)  	MOV			A,DATAH
   209  000054   0600(1+S)  	CMPRS		A,#0X00
   210  000055   1F15(1)  	MOV			FRONT_DELAY,A
   211  000056   1E0D(1)  	MOV			A,DATAL
   212  000057   0600(1+S)  	CMPRS		A,#0X00
   213  000058   1F16(1)  	MOV			TIME_DELAY_GAP,A		
   214  000059   63D2(1)  	B0BCLR		S_TM_EE_IO
   215  00005A   C2C9(2)  	CALL		DELAY_LONG
   216  00005B             ;*******************************************
   217  00005B             GET_INITIAL_DATA_FROM_EE:
   218  00005B             ;*******************************************
   219  00005B   2D1F(1)  	MOV			A,#LAST_TIME_EE_ADD_H
   220  00005C   1F13(1)  	MOV			MAC_H,A
   221  00005D   2DFE(1)  	MOV			A,#LAST_TIME_EE_ADD_L
   222  00005E   1F14(1)  	MOV			MAC_L,A
   223  00005F   5106(1+S)  	BTS0		RESET_FLAG
   224  000060   8097(2)  	JMP			RESET_EEPROM
   225  000061   C20B(2)  	CALL		GET_DATA_FROM_EE_FUN
   226  000062   1E0F(1)  	MOV			A,ADDRESSL
   227  000063   1F18(1)  	MOV			STARTADDRL,A
   228  000064   1E0E(1)  	MOV			A,ADDRESSH
   229  000065   1F17(1)  	MOV			STARTADDRH,A
   230  000066   1E0E(1)  	MOV			A,ADDRESSH
   231  000067   06FF(1+S)  	CMPRS		A,#0XFF
   232  000068   806B(2)  	JMP			$+3
   233  000069   2B17(1)  	CLR			STARTADDRH
   234  00006A   2B18(1)  	CLR			STARTADDRL
   235  00006B   C2C9(2)  	CALL		DELAY_LONG
   236  00006C   2D1F(1)  	MOV			A,#LIVE_TIME_ADD_H
   237  00006D   1F13(1)  	MOV			MAC_H,A
   238  00006E   2DFC(1)  	MOV			A,#LIVE_TIME_ADD_L
   239  00006F   1F14(1)  	MOV			MAC_L,A
   240  000070   C20B(2)  	CALL		GET_DATA_FROM_EE_FUN
   241  000071             ;;;;;;;;;;;;;;LAST READ TM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   242  000071   6BD2(1)  	B0BSET		S_TM_EE_IO
   243  000072   60D0(1)  	B0BCLR		VSR_IO
   244  000073   2D34(1)  	MOV			A,#TM_DATA_H
   245  000074   1F13(1)  	MOV			MAC_H,A
   246  000075   2D00(1)  	MOV			A,#TM_DATA_L
   247  000076   1F14(1)  	MOV			MAC_L,A
   248  000077   C1BA(2)  	CALL		GET_DATA_FROM_TM_FUN
   249  000078   64D5(1)  	B0BCLR		VTM_IO
   250  000079   C2C3(2)  	CALL		DELAY_SHORT
   251  00007A   63D2(1)  	B0BCLR		S_TM_EE_IO
   252  00007B   64C5(1)  	B0BCLR		VTM_CONT
   253  00007C             ;/////////////////WRITE TO EE//////////////////////////////
   254  00007C             WRITE_INITIAL_DATA_TO_EE:
   255  00007C             ;///////////INITIAL TIME/////////////////////
   256  00007C   C2C3(2)  	CALL		DELAY_SHORT
   257  00007D   2D1F(1)  	MOV		A,#EE_INITIAL_TIME_ADD_H
   258  00007E   1F13(1)  	MOV		MAC_H,A
   259  00007F   2DFA(1)  	MOV		A,#EE_INITIAL_TIME_ADD_L
   260  000080   1F14(1)  	MOV		MAC_L,A
   261  000081   1E19(1)  	MOV		A,INITIAL_TIMEH
   262  000082   1F0C(1)  	MOV		DATAH,A
   263  000083   1E1A(1)  	MOV		A,INITIAL_TIMEL
   264  000084   1F0D(1)  	MOV		DATAL,A
   265  000085   C157(2)  	CALL		DATA_TO_EEPROM_FUN
   266  000086   C2C9(2)  	CALL	DELAY_LONG
   267  000087   2D1F(1)  	MOV		A,#EE_DELAY_ADD_H
   268  000088   1F13(1)  	MOV		MAC_H,A
   269  000089   2DF8(1)  	MOV		A,#EE_GAP_ADD_L
   270  00008A   1F14(1)  	MOV		MAC_L,A
   271  00008B   1E15(1)  	MOV		A,FRONT_DELAY
   272  00008C   1F0C(1)  	MOV		DATAH,A
   273  00008D   1E16(1)  	MOV		A,TIME_DELAY_GAP
   274  00008E   1F0D(1)  	MOV		DATAL,A
   275  00008F   C157(2)  	CALL		DATA_TO_EEPROM_FUN
   276  000090   C2C9(2)  	CALL	DELAY_LONG
   277  000091             SET_WRITE_EE_START_ADD:
   278  000091   1E17(1)  	MOV			A,STARTADDRH
   279  000092   1F0E(1)  	MOV			ADDRESSH,A
   280  000093   1E18(1)  	MOV			A,STARTADDRL
   281  000094   1F0F(1)  	MOV			ADDRESSL,A
   282  000095             	
   283  000095   5906(1+S)  	BTS1		RESET_FLAG
   284  000096   80B8(2)  	JMP			FRONT_DELAY_MODE
   285  000097             RESET_EEPROM:
   286  000097   44D2(1)  	BCLR	IC_IDLE
   287  000098   2DFF(1)  	MOV		A,#0XFF
   288  000099   1F0C(1)  	MOV		DATAH,A
   289  00009A   2DFF(1)  	MOV		A,#0XFF
   290  00009B   1F0D(1)  	MOV		DATAL,A
   291  00009C   2D00(1)  	MOV		A,#0X00
   292  00009D   1F13(1)  	MOV		MAC_H,A
   293  00009E             RESET_EE_LOOP_H:
   294  00009E   2D00(1)  	MOV		A,#0X00
   295  00009F   1F14(1)  	MOV		MAC_L,A
   296  0000A0             RESET_EE_LOOP_L:
   297  0000A0   C157(2)  	CALL		DATA_TO_EEPROM_FUN
   298  0000A1   1614(1+S)  	INCMS	MAC_L
   299  0000A2   80A0(2)  	JMP		RESET_EE_LOOP_L
   300  0000A3   1613(1+S)  	INCMS	MAC_H
   301  0000A4   1E13(1)  	MOV		A,MAC_H
   302  0000A5   0620(1+S)  	CMPRS	A,#0X20
   303  0000A6   809E(2)  	JMP		RESET_EE_LOOP_H
   304  0000A7   2B0F(1)  	CLR		ADDRESSL
   305  0000A8   2B0E(1)  	CLR		ADDRESSH
   306  0000A9   2D1F(1)  	MOV		A,#LAST_TIME_EE_ADD_H
   307  0000AA   1F13(1)  	MOV		MAC_H,A
   308  0000AB   2DFE(1)  	MOV		A,#LAST_TIME_EE_ADD_L
   309  0000AC   1F14(1)  	MOV		MAC_L,A
   310  0000AD   1E0E(1)  	MOV		A,ADDRESSH
   311  0000AE   1F0C(1)  	MOV		DATAH,A
   312  0000AF   1E0F(1)  	MOV		A,ADDRESSL
   313  0000B0   1F0D(1)  	MOV		DATAL,A
   314  0000B1   C157(2)  	CALL		DATA_TO_EEPROM_FUN
   315  0000B2   2D1F(1)  	MOV			A,#LIVE_TIME_ADD_H
   316  0000B3   1F13(1)  	MOV			MAC_H,A
   317  0000B4   2DFC(1)  	MOV			A,#LIVE_TIME_ADD_L
   318  0000B5   1F14(1)  	MOV			MAC_L,A
   319  0000B6   C157(2)  	CALL		DATA_TO_EEPROM_FUN
   320  0000B7   4106(1)  	BCLR		RESET_FLAG
   321  0000B8             ;******************************************
   322  0000B8             FRONT_DELAY_MODE:
   323  0000B8   6FDF(1)  	B0BSET		FGIE
   324  0000B9   C316(2)  	CALL		SET_LOW_POWER_FUN
   325  0000BA             ;DELAY WAIT_FOR_SEAVAL_MINITE_FUN
   326  0000BA             ;/////////////////////////////////////////	
   327  0000BA   1E15(1)  	MOV   	A,FRONT_DELAY
   328  0000BB   1F10(1)  	MOV		CRCT1,A
   329  0000BC             FRONT_DELAY_LOOP:
   330  0000BC             	GreenMode
   331  0000BC   6CCA(1)  		B0BSET	FCPUM1
   332  0000BD   0000(1)  		NOP
   333  0000BE   0000(1)  		NOP
   334  0000BF   5407(1+S)  	BTS0	NOT_QUICK_MODE_FLAG
   335  0000C0   C30C(2)  	CALL	SET_EE_TM_FUN
   336  0000C1   5207(1+S)  	BTS0	NOT_UPLOAD_FLAG
   337  0000C2   C316(2)  	CALL	SET_LOW_POWER_FUN
   338  0000C3   5B06(1+S)  	BTS1	TIME_FLAG
   339  0000C4   80BC(2)  	JMP		FRONT_DELAY_LOOP
   340  0000C5   4306(1)  	BCLR	TIME_FLAG
   341  0000C6   2610(1+S)  	DECMS	CRCT1
   342  0000C7   80BC(2)  	JMP		FRONT_DELAY_LOOP
   343  0000C8             	;///////////////////////////
   344  0000C8   4207(1)  	BCLR		NOT_UPLOAD_FLAG
   345  0000C9   4307(1)  	BCLR		HAVE_UPLOAD_FLAG
   346  0000CA             ;//////////////////////////////////////
   347  0000CA             MAIN:
   348  0000CA             	;close tc0 interrupt until the recording finished 
   349  0000CA             	GreenMode
   350  0000CA   6CCA(1)  		B0BSET	FCPUM1
   351  0000CB   0000(1)  		NOP
   352  0000CC   0000(1)  		NOP
   353  0000CD             	
   354  0000CD             JUST_I2CSLAVE_MODE:
   355  0000CD   5806(1+S)  	BTS1	READTM_FLAG
   356  0000CE   8111(2)  	JMP		JUST_UPLOAD_MODE
   357  0000CF   5506(1+S)  	BTS0	FILLOUT_FLAG
   358  0000D0   8124(2)  	JMP		MEM_FILLOUT_MODE
   359  0000D1   7CC9(1+S)  	B0BTS1	FT0IEN
   360  0000D2   8111(2)  	JMP		JUST_UPLOAD_MODE
   361  0000D3             ;*****START TM I2C SLAVE MODE***********
   362  0000D3             I2CSLAVE_MODE:
   363  0000D3   4006(1)  	BCLR 	READTM_FLAG
   364  0000D4   59D1(1+S)  	BTS1	VDDF
   365  0000D5   8102(2)  	JMP		ADDRESS_CHANGE
   366  0000D6   67DF(1)  	B0BCLR 	FGIE
   367  0000D7   64D2(1)  	B0BCLR		IC_IDLE
   368  0000D8   6CC5(1)  	B0BSET	VTM_CONT
   369  0000D9   6BD2(1)  	B0BSET	S_TM_EE_IO
   370  0000DA   60D0(1)  	B0BCLR	VSR_IO
   371  0000DB   2D34(1)  	MOV		A,#TM_DATA_H
   372  0000DC   1F13(1)  	MOV		MAC_H,A
   373  0000DD   2D00(1)  	MOV		A,#TM_DATA_L
   374  0000DE   1F14(1)  	MOV		MAC_L,A
   375  0000DF   C1BA(2)  	CALL	GET_DATA_FROM_TM_FUN
   376  0000E0   64D5(1)  	B0BCLR		VTM_IO
   377  0000E1   C2C3(2)  	CALL		DELAY_SHORT
   378  0000E2   63D2(1)  	B0BCLR		S_TM_EE_IO
   379  0000E3   64C5(1)  	B0BCLR		VTM_CONT
   380  0000E4   C2C3(2)  	CALL		DELAY_SHORT
   381  0000E5   1E0E(1)  	MOV		A,ADDRESSH
   382  0000E6   1F13(1)  	MOV		MAC_H,A
   383  0000E7   1E0F(1)  	MOV		A,ADDRESSL
   384  0000E8   1F14(1)  	MOV		MAC_L,A
   385  0000E9   C157(2)  	CALL		DATA_TO_EEPROM_FUN
   386  0000EA   2D1F(1)  	MOV		A,#LAST_TIME_EE_ADD_H
   387  0000EB   1F13(1)  	MOV		MAC_H,A
   388  0000EC   2DFE(1)  	MOV		A,#LAST_TIME_EE_ADD_L
   389  0000ED   1F14(1)  	MOV		MAC_L,A
   390  0000EE   1E0E(1)  	MOV		A,ADDRESSH
   391  0000EF   1F0C(1)  	MOV		DATAH,A
   392  0000F0   1E0F(1)  	MOV		A,ADDRESSL
   393  0000F1   1F0D(1)  	MOV		DATAL,A
   394  0000F2   C157(2)  	CALL		DATA_TO_EEPROM_FUN
   395  0000F3   74C8(1+S)  	B0BTS0		FT0IRQ
   396  0000F4   1608(1+S)  	INCMS		TIMEH
   397  0000F5   64C8(1)  	B0BCLR		FT0IRQ
   398  0000F6   6FDF(1)  	B0BSET		FGIE
   399  0000F7   2D78(1)  	MOV			A,#TIME_GAP
   400  0000F8   0708(1+S)  	CMPRS		A,TIMEH
   401  0000F9   8102(2)  	JMP			ADDRESS_CHANGE
   402  0000FA   2B08(1)  	CLR			TIMEH
   403  0000FB   4B06(1)  	BSET		TIME_FLAG
   404  0000FC   1609(1+S)  	INCMS		TIMEG
   405  0000FD   1E16(1)  	MOV			A,TIME_DELAY_GAP
   406  0000FE   0709(1+S)  	CMPRS		A,TIMEG
   407  0000FF   8102(2)  	JMP			ADDRESS_CHANGE
   408  000100   2B09(1)  	CLR			TIMEG
   409  000101   4806(1)  	BSET		READTM_FLAG
   410  000102             ADDRESS_CHANGE:
   411  000102   6CD2(1)  	B0BSET		IC_IDLE
   412  000103   2D02(1)  	MOV			A,#0X02
   413  000104   130F(1)  	ADD			ADDRESSL,A
   414  000105   2D00(1)  	MOV			A,#0X00
   415  000106   110E(1)  	ADC			ADDRESSH,A
   416  000107   2D1F(1)  	MOV			A,#MAX_MEMH
   417  000108   070E(1+S)  	CMPRS		A,ADDRESSH
   418  000109   80CD(2)  	JMP			JUST_I2CSLAVE_MODE
   419  00010A   2DF0(1)  	MOV			A,#MAX_MEML
   420  00010B   070F(1+S)  	CMPRS		A,ADDRESSL
   421  00010C   80CD(2)  	JMP			JUST_I2CSLAVE_MODE
   422  00010D   4D06(1)  	BSET		FILLOUT_FLAG
   423  00010E   67D8(1)  	B0BCLR		FT0ENB
   424  00010F   64C9(1)  	B0BCLR		FT0IEN
   425  000110   8124(2)  	JMP			MEM_FILLOUT_MODE
   426  000111             ;*****************************************
   427  000111             JUST_UPLOAD_MODE:
   428  000111   62C2(1)  	B0BCLR		CLED_CONT
   429  000112   C2C3(2)  	CALL		DELAY_SHORT
   430  000113   C2C3(2)  	CALL		DELAY_SHORT
   431  000114   7AD2(1+S)  	B0BTS1		CLED_IO
   432  000115   8141(2)  	JMP			RESET_MODE
   433  000116   5206(1+S)  	BTS0		TM_EE_FLAG
   434  000117   811E(2)  	JMP			END_TM_EE_MODE
   435  000118   51D1(1+S)  	BTS0		VDDF
   436  000119   8124(2)  	JMP			MEM_FILLOUT_MODE
   437  00011A             TM_EE_MODE:
   438  00011A   4307(1)  	BCLR		HAVE_UPLOAD_FLAG
   439  00011B   5206(1+S)  	BTS0		TM_EE_FLAG
   440  00011C   811E(2)  	JMP			END_TM_EE_MODE
   441  00011D   C30C(2)  	CALL		SET_EE_TM_FUN
   442  00011E             END_TM_EE_MODE:
   443  00011E             	;BTS0		FILLOUT_FLAG
   444  00011E             	;JMP			MEM_FILLOUT_MODE	
   445  00011E   59D1(1+S)  	BTS1		VDDF
   446  00011F   8124(2)  	JMP			MEM_FILLOUT_MODE
   447  000120   C316(2)  	CALL		SET_LOW_POWER_FUN
   448  000121   5506(1+S)  	BTS0		FILLOUT_FLAG
   449  000122   8124(2)  	JMP			MEM_FILLOUT_MODE
   450  000123             	;we should keep rtc function 
   451  000123   8138(2)  	JMP		ON_LED_MODE
   452  000124             ;*************************************
   453  000124             MEM_FILLOUT_MODE:
   454  000124   5D06(1+S)  	BTS1	FILLOUT_FLAG
   455  000125   8138(2)  	JMP		ON_LED_MODE
   456  000126   79D1(1+S)  	B0BTS1	VDDF
   457  000127   812B(2)  	JMP		$+4
   458  000128   5206(1+S)  	BTS0	TM_EE_FLAG
   459  000129   C316(2)  	CALL	SET_LOW_POWER_FUN
   460  00012A   812D(2)  	JMP		$+3
   461  00012B   5A06(1+S)  	BTS1	TM_EE_FLAG
   462  00012C   C30C(2)  	CALL	SET_EE_TM_FUN
   463  00012D   7FD8(1+S)  	B0BTS1		FT0ENB
   464  00012E   8133(2)  	JMP			$+5
   465  00012F   2BD9(1)  	CLR			T0C
   466  000130   64C8(1)  	B0BCLR		FT0IRQ
   467  000131   64C9(1)  	B0BCLR		FT0IEN
   468  000132   67D8(1)  	B0BCLR		FT0ENB
   469  000133             	SleepMode
   470  000133   6BCA(1)  		B0BSET	FCPUM0
   471  000134             END_FILLOUT_MODE:
   472  000134   6AC2(1)  	B0BSET		CLED_CONT
   473  000135   6AD2(1)  	B0BSET		CLED_IO
   474  000136   C2BE(2)  	CALL		DELAY_MINI
   475  000137   8111(2)  	JMP		JUST_UPLOAD_MODE
   476  000138             ON_LED_MODE:
   477  000138   6AC2(1)  	B0BSET	CLED_CONT
   478  000139   6AD2(1)  	B0BSET	CLED_IO
   479  00013A   5107(1+S)  	BTS0	READ_LED_FLAG
   480  00013B   C146(2)  	CALL	READ_LED_FUN
   481  00013C   4107(1)  	BCLR   	READ_LED_FLAG
   482  00013D   6AD2(1)  	B0BSET	CLED_IO
   483  00013E   5506(1+S)  	BTS0	FILLOUT_FLAG
   484  00013F   8111(2)  	JMP		JUST_UPLOAD_MODE
   485  000140   80CA(2)  	JMP		MAIN
   486  000141             RESET_MODE:
   487  000141   4906(1)  	BSET	RESET_FLAG
   488  000142   4506(1)  	BCLR	FILLOUT_FLAG
   489  000143   2B08(1)  	CLR		TIMEH
   490  000144   2B09(1)  	CLR		TIMEG
   491  000145   8038(2)  	JMP		STATE_INITIAL
   492  000146             	
   493  000146             ;******************************************************************************	
   494  000146             READ_LED_FUN:
   495  000146   2D01(1)     	MOV  	   	A,#1
   496  000147   1F05(1)     	MOV  	   	TLC2,A
   497  000148             LED_MODEL1:	
   498  000148   6AD2(1)     	B0BSET   	CLED_IO
   499  000149   C2D3(2)     	CALL   	   	DELAY_LED
   500  00014A   62D2(1)     	B0BCLR   	CLED_IO
   501  00014B   C2D3(2)     	CALL   	   	DELAY_LED
   502  00014C   2605(1+S)     	DECMS   	TLC2
   503  00014D   8148(2)     	JMP   	   	LED_MODEL1
   504  00014E   0E00(2)     	RET
   505  00014F             ;*******************************************************
   506  00014F             ;***************************************
   507  00014F             	
   508  00014F             	
   509  00014F             	
   510  00014F             	
   511  00014F             	
   512  00014F             	
   513  00014F             	
   514  00014F             	
   515  00014F             	
   516  00014F             	
   517  00014F             	
   518  00014F             	
   519  00014F             	
   520  00014F             	
   521  00014F             	
   522  00014F             	
   523  00014F             CLRRAM:
   524  00014F             	
   525  00014F   2B84(1)  	CLR			Y
   526  000150   2D2F(1)  	MOV			A,#END_RAM_ADDR
   527  000151   2F83(1)  	B0MOV		Z,A
   528  000152             CLRRAM10:
   529  000152   2BE7(1)  	CLR			@YZ
   530  000153   2683(1+S)  	DECMS		Z
   531  000154   8152(2)  	JMP			CLRRAM10
   532  000155   2BE7(1)  	CLR			@YZ
   533  000156   0E00(2)  	RET
   534  000157             ;***********************************
   535  000157             ;***************************************
   536  000157             ;*************WRITE TMEPERATURE INTO EEPROM*************
   537  000157             ;*************RECORDING ADDRESS THE LAST TIME STORAGE THE TMPERATURE VALUE************
   538  000157             ;**************************************
   539  000157             DATA_TO_EEPROM_FUN:
   540  000157   6DC2(1)  	B0BSET		SDA_CONT
   541  000158   6DD2(1)  	B0BSET		SDA_IO
   542  000159   68C2(1)  	B0BSET		SCL_CONT
   543  00015A   68D2(1)  	B0BSET		SCL_IO
   544  00015B   1E14(1)  	MOV			A,MAC_L
   545  00015C   1F11(1)  	MOV			CRCT2,A
   546  00015D   1E0C(1)  	MOV			A,DATAH
   547  00015E   1F10(1)  	MOV			CRCT1,A
   548  00015F   2D02(1)  	MOV			A,#0X02
   549  000160   1F05(1)  	MOV			TLC2,A
   550  000161             MOVE_DATA_TO_EEPROM:
   551  000161   C236(2)  	CALL		I2C_START_EE
   552  000162   2DA0(1)  	MOV			A,#EEW_ADD
   553  000163   1F0A(1)  	MOV			DATA_IN,A
   554  000164   C287(2)  	CALL		EEADDRESS_ASK
   555  000165   1E13(1)  	MOV			A,MAC_H
   556  000166   1F0A(1)  	MOV			DATA_IN,A
   557  000167   C287(2)  	CALL		EEADDRESS_ASK
   558  000168   1E11(1)  	MOV			A,CRCT2
   559  000169   1F0A(1)  	MOV			DATA_IN,A
   560  00016A   C287(2)  	CALL		EEADDRESS_ASK
   561  00016B   C2BE(2)  	CALL		DELAY_MINI
   562  00016C   1E10(1)  	MOV			A,CRCT1
   563  00016D   1F0A(1)  	MOV			DATA_IN,A
   564  00016E   C287(2)  	CALL		EEADDRESS_ASK
   565  00016F   C23C(2)  	CALL		I2C_END_EE
   566  000170             	
   567  000170   C2C9(2)  	CALL		DELAY_LONG
   568  000171   2D01(1)  	MOV			A,#0X01
   569  000172   1311(1)  	ADD			CRCT2,A
   570  000173   1E0D(1)  	MOV			A,DATAL
   571  000174   1F10(1)  	MOV			CRCT1,A
   572  000175   2605(1+S)  	DECMS		TLC2
   573  000176   8161(2)  	JMP			MOVE_DATA_TO_EEPROM
   574  000177             ;*********************************************
   575  000177   60C2(1)  	B0BCLR		SCL_CONT
   576  000178   0E00(2)  	RET
   577  000179             ;**************************************
   578  000179             PUT_DATA_INTO_TM_FUN:
   579  000179   68C2(1)  	B0BSET	SCL_CONT
   580  00017A   69C2(1)  	B0BSET	SDATA_CONT
   581  00017B   61D2(1)  	B0BCLR	SDATA_IO
   582  00017C   60D2(1)  	B0BCLR	SCL_IO
   583  00017D   C2C9(2)  	CALL 	DELAY_LONG
   584  00017E   C2C9(2)  	CALL 	DELAY_LONG
   585  00017F   6CD5(1)  	B0BSET 	VTM_IO
   586  000180   C2C9(2)  	CALL 	DELAY_LONG
   587  000181             	;CALL	DELAY_LONG
   588  000181             START_TMI2C_S:
   589  000181   2D04(1)  	MOV 	A,#0X04
   590  000182   1F03(1)  	MOV 	TLC0,A
   591  000183             LOOP_1_S:
   592  000183   68D2(1)  	B0BSET 	SCL_IO
   593  000184   C2BE(2)  	CALL	DELAY_MINI;13US
   594  000185   C2BD(2)  	CALL	CALL_DELAY
   595  000186   60D2(1)  	B0BCLR 	SCL_IO
   596  000187   C2BE(2)  	CALL 	DELAY_MINI
   597  000188   2603(1+S)  	DECMS  	TLC0
   598  000189   8183(2)  	JMP 	LOOP_1_S
   599  00018A   41D2(1)  	BCLR 	SDATA_IO
   600  00018B   C2C9(2)  	CALL	DELAY_LONG
   601  00018C   C2C9(2)  	CALL	DELAY_LONG
   602  00018D   2D04(1)  	MOV 	A,#4
   603  00018E   2F03(1)  	B0MOV 	TLC0,A
   604  00018F             LOOP_2_S:
   605  00018F   60D2(1)  	B0BCLR 	SCL_IO
   606  000190   C2BE(2)  	CALL	DELAY_MINI
   607  000191   C2BD(2)  	CALL	CALL_DELAY
   608  000192   68D2(1)  	B0BSET 	SCL_IO
   609  000193   C2BE(2)  	CALL	DELAY_MINI
   610  000194   2603(1+S)  	DECMS 	TLC0
   611  000195   818F(2)  	JMP 	LOOP_2_S
   612  000196   C2C3(2)  	CALL	DELAY_SHORT
   613  000197   2D14(1)  	MOV 	A,#20
   614  000198   2F03(1)  	B0MOV 	TLC0,A
   615  000199   49D2(1)  	BSET 	SDATA_IO
   616  00019A             WAIT_TM_INIT_S:
   617  00019A   C2C9(2)  	CALL 		DELAY_LONG
   618  00019B   2603(1+S)  	DECMS 		TLC0
   619  00019C   819A(2)  	JMP 		WAIT_TM_INIT_S
   620  00019D             ;**************START*****************************
   621  00019D   C243(2)  	CALL		I2C_START_TM
   622  00019E             ;***********************************************
   623  00019E   2D3C(1)  	MOV 		A,#TMW_ADD
   624  00019F   1F0A(1)  	MOV 		DATA_IN,A
   625  0001A0   C251(2)  	CALL 		TMADDRESS_ASK
   626  0001A1   5507(1+S)  	BTS0		TM_I2C_EEROR
   627  0001A2   81B4(2)  	JMP			END_TM_S
   628  0001A3   2D2F(1)  	MOV 		A,#WRITE_TM_ADD_H
   629  0001A4   1F0A(1)  	MOV 		DATA_IN,A
   630  0001A5   C251(2)  	CALL 		TMADDRESS_ASK
   631  0001A6   2D00(1)  	MOV 		A,#WRITE_TM_ADD_L
   632  0001A7   1F0A(1)  	MOV 		DATA_IN,A
   633  0001A8   C251(2)  	CALL 		TMADDRESS_ASK
   634  0001A9   C2C9(2)  	CALL		DELAY_LONG
   635  0001AA   1E0C(1)  	MOV 		A,DATAH
   636  0001AB   1F0A(1)  	MOV 		DATA_IN,A
   637  0001AC   C251(2)  	CALL 		TMADDRESS_ASK
   638  0001AD   1E0D(1)  	MOV 		A,DATAL
   639  0001AE   1F0A(1)  	MOV 		DATA_IN,A
   640  0001AF   C251(2)  	CALL 		TMADDRESS_ASK
   641  0001B0   C2C3(2)  	CALL		DELAY_SHORT
   642  0001B1             ;**************END*******************************
   643  0001B1   C249(2)  	CALL		I2C_END_TM
   644  0001B2   C2C3(2)  	CALL		DELAY_SHORT
   645  0001B3   61D2(1)  	B0BCLR		SDATA_IO
   646  0001B4             END_TM_S:
   647  0001B4   4507(1)  	BCLR		TM_I2C_EEROR
   648  0001B5   64D5(1)  	B0BCLR 		VTM_IO
   649  0001B6   61C2(1)  	B0BCLR		SDATA_CONT
   650  0001B7   60C2(1)  	B0BCLR		SCL_CONT
   651  0001B8   C2C3(2)  	CALL 		DELAY_SHORT
   652  0001B9   0E00(2)  	RET
   653  0001BA             ;*******************************************
   654  0001BA             ;*****************************************
   655  0001BA             GET_DATA_FROM_TM_FUN:
   656  0001BA   2D0F(1)  	MOV		A,#0X0F
   657  0001BB   1F12(1)  	MOV		COUNT,A
   658  0001BC             TM_I2C_WORK_LOOP:
   659  0001BC   68C2(1)  	B0BSET	SCL_CONT
   660  0001BD   69C2(1)  	B0BSET	SDATA_CONT
   661  0001BE   61D2(1)  	B0BCLR	SDATA_IO
   662  0001BF   60D2(1)  	B0BCLR	SCL_IO
   663  0001C0   C2C9(2)  	CALL 	DELAY_LONG
   664  0001C1   C2C9(2)  	CALL 	DELAY_LONG
   665  0001C2   6CD5(1)  	B0BSET 	VTM_IO
   666  0001C3   C2C9(2)  	CALL 	DELAY_LONG
   667  0001C4             	;CALL	DELAY_LONG
   668  0001C4             START_TMI2C:
   669  0001C4   2D04(1)  	MOV 	A,#0X04
   670  0001C5   1F03(1)  	MOV 	TLC0,A
   671  0001C6             LOOP_1:
   672  0001C6   68D2(1)  	B0BSET 	SCL_IO
   673  0001C7   C2BE(2)  	CALL	DELAY_MINI;13US
   674  0001C8   C2BD(2)  	CALL	CALL_DELAY
   675  0001C9   60D2(1)  	B0BCLR 	SCL_IO
   676  0001CA   C2BE(2)  	CALL 	DELAY_MINI
   677  0001CB   2603(1+S)  	DECMS  	TLC0
   678  0001CC   81C6(2)  	JMP 	LOOP_1
   679  0001CD   2D28(1)  	MOV 	A,#40
   680  0001CE   2F03(1)  	B0MOV 	TLC0,A
   681  0001CF   41D2(1)  	BCLR 	SDATA_IO
   682  0001D0   C2C9(2)  	CALL	DELAY_LONG
   683  0001D1             	;CALL	DELAY_SHORT
   684  0001D1   2D04(1)  	MOV 	A,#4
   685  0001D2   2F03(1)  	B0MOV 	TLC0,A
   686  0001D3             LOOP_2:
   687  0001D3   60D2(1)  	B0BCLR 	SCL_IO
   688  0001D4   C2BE(2)  	CALL	DELAY_MINI
   689  0001D5   C2BD(2)  	CALL	CALL_DELAY
   690  0001D6   68D2(1)  	B0BSET 	SCL_IO
   691  0001D7   C2BE(2)  	CALL	DELAY_MINI
   692  0001D8   2603(1+S)  	DECMS 	TLC0
   693  0001D9   81D3(2)  	JMP 	LOOP_2
   694  0001DA   C2C3(2)  	CALL	DELAY_SHORT
   695  0001DB   2D05(1)  	MOV 	A,#5
   696  0001DC   2F03(1)  	B0MOV 	TLC0,A
   697  0001DD   49D2(1)  	BSET 	SDATA_IO
   698  0001DE             WAIT_TM_INIT:
   699  0001DE   C2C9(2)  	CALL 		DELAY_LONG
   700  0001DF   2603(1+S)  	DECMS 		TLC0
   701  0001E0   81DE(2)  	JMP 		WAIT_TM_INIT
   702  0001E1             ;**************START*****************************
   703  0001E1   C243(2)  	CALL		I2C_START_TM
   704  0001E2             ;***********************************************
   705  0001E2   2D3D(1)  	MOV 		A,#TMR_ADD
   706  0001E3   1F0A(1)  	MOV 		DATA_IN,A
   707  0001E4   C251(2)  	CALL 		TMADDRESS_ASK
   708  0001E5   5507(1+S)  	BTS0		TM_I2C_EEROR
   709  0001E6   8205(2)  	JMP			END_TM
   710  0001E7   1E13(1)  	MOV 		A,MAC_H
   711  0001E8   1F0A(1)  	MOV 		DATA_IN,A
   712  0001E9   C251(2)  	CALL 		TMADDRESS_ASK
   713  0001EA   1E14(1)  	MOV 		A,MAC_L
   714  0001EB   1F0A(1)  	MOV 		DATA_IN,A
   715  0001EC   C251(2)  	CALL 		TMADDRESS_ASK
   716  0001ED   61C2(1)  	B0BCLR		SDATA_CONT
   717  0001EE   C2C9(2)  	CALL 		DELAY_LONG
   718  0001EF   4706(1)  	BCLR 		ASK_FLAG
   719  0001F0   C26B(2)  	CALL 		TMDATA_ASK
   720  0001F1   1E0B(1)  	MOV 		A,DATA_OUT
   721  0001F2   1F0C(1)  	MOV 		DATAH,A
   722  0001F3   4F06(1)  	BSET 		ASK_FLAG
   723  0001F4   C26B(2)  	CALL 		TMDATA_ASK
   724  0001F5   1E0B(1)  	MOV 		A,DATA_OUT
   725  0001F6   1F0D(1)  	MOV 		DATAL,A		
   726  0001F7             ;**************END*******************************
   727  0001F7   C249(2)  	CALL		I2C_END_TM
   728  0001F8   C2C3(2)  	CALL		DELAY_SHORT
   729  0001F9   61D2(1)  	B0BCLR		SDATA_IO
   730  0001FA   2612(1+S)  	DECMS		COUNT
   731  0001FB   81FD(2)  	JMP			$+2
   732  0001FC   8205(2)  	JMP			END_TM
   733  0001FD   64D5(1)  	B0BCLR 		VTM_IO
   734  0001FE   2D00(1)  	MOV			A,#0X00
   735  0001FF   070C(1+S)  	CMPRS		A,DATAH
   736  000200   8204(2)  	JMP			$+4
   737  000201   070D(1+S)  	CMPRS		A,DATAL
   738  000202   8204(2)  	JMP			$+2
   739  000203   81BC(2)  	JMP			TM_I2C_WORK_LOOP
   740  000204   4907(1)  	BSET		READ_LED_FLAG
   741  000205             END_TM:
   742  000205   4507(1)  	BCLR		TM_I2C_EEROR
   743  000206   64D5(1)  	B0BCLR 		VTM_IO
   744  000207   61C2(1)  	B0BCLR		SDATA_CONT
   745  000208   60C2(1)  	B0BCLR		SCL_CONT
   746  000209   C2C3(2)  	CALL 		DELAY_SHORT
   747  00020A   0E00(2)  	RET
   748  00020B             ;*******************************************
   749  00020B             ;***********************************************************
   750  00020B             ;*********************************************************
   751  00020B             GET_DATA_FROM_EE_FUN:
   752  00020B   68C2(1)  	B0BSET		SCL_CONT
   753  00020C   6DC2(1)  	B0BSET		SDA_CONT
   754  00020D   6DD2(1)  	B0BSET		SDA_IO
   755  00020E   68D2(1)  	B0BSET		SCL_IO
   756  00020F   C2C3(2)  	CALL		DELAY_SHORT
   757  000210   C236(2)  	CALL		I2C_START_EE
   758  000211   2DA0(1)  	MOV			A,#EEW_ADD
   759  000212   1F0A(1)  	MOV			DATA_IN,A
   760  000213   C287(2)  	CALL		EEADDRESS_ASK
   761  000214   1E13(1)  	MOV			A,MAC_H
   762  000215   1F0A(1)  	MOV			DATA_IN,A
   763  000216   C287(2)  	CALL		EEADDRESS_ASK
   764  000217   1E14(1)  	MOV			A,MAC_L
   765  000218   1F0A(1)  	MOV			DATA_IN,A
   766  000219   C287(2)  	CALL		EEADDRESS_ASK
   767  00021A   6DD2(1)  	B0BSET		SDA_IO
   768  00021B   C2C3(2)  	CALL		DELAY_SHORT
   769  00021C   68D2(1)  	B0BSET		SCL_IO
   770  00021D   C2C3(2)  	CALL		DELAY_SHORT
   771  00021E   C236(2)  	CALL		I2C_START_EE
   772  00021F   C2C3(2)  	CALL		DELAY_SHORT
   773  000220   2DA1(1)  	MOV			A,#EER_ADD
   774  000221   1F0A(1)  	MOV			DATA_IN,A
   775  000222   C287(2)  	CALL		EEADDRESS_ASK
   776  000223   65C2(1)  	B0BCLR		SDA_CONT
   777  000224   4706(1)  	BCLR		ASK_FLAG
   778  000225   C2A1(2)  	CALL		EEDATA_ASK
   779  000226   1E0B(1)  	MOV			A,DATA_OUT
   780  000227   1F0E(1)  	MOV			ADDRESSH,A
   781  000228   65C2(1)  	B0BCLR		SDA_CONT
   782  000229   C2BE(2)  	CALL		DELAY_MINI
   783  00022A   4F06(1)  	BSET		ASK_FLAG
   784  00022B   C2A1(2)  	CALL		EEDATA_ASK
   785  00022C   1E0B(1)  	MOV			A,DATA_OUT
   786  00022D   1F0F(1)  	MOV			ADDRESSL,A
   787  00022E   C23C(2)  	CALL		I2C_END_EE
   788  00022F             ;*************************************
   789  00022F   C2C3(2)  	CALL		DELAY_SHORT
   790  000230   60C2(1)  	B0BCLR		SCL_CONT
   791  000231   0E00(2)  	RET
   792  000232             ;************************************************
   793  000232             I2C_EEROR:
   794  000232             	;open interrupt
   795  000232             	;SleepMode
   796  000232   4606(1)  	BCLR	I2CERROR_FLAG
   797  000233   54D5(1+S)  	BTS0	VTM_IO
   798  000234   4D07(1)  	BSET	TM_I2C_EEROR
   799  000235   0E00(2)  	RET
   800  000236             I2C_START_EE:
   801  000236   C2BE(2)  	CALL		DELAY_MINI
   802  000237   65D2(1)  	B0BCLR 		SDA_IO
   803  000238   C2BE(2)  	CALL 		DELAY_MINI
   804  000239   60D2(1)  	B0BCLR 		SCL_IO
   805  00023A   C2BE(2)  	CALL 		DELAY_MINI
   806  00023B   0E00(2)  	RET
   807  00023C             I2C_END_EE:
   808  00023C   65D2(1)  	B0BCLR 		SDA_IO
   809  00023D   C2BE(2)  	CALL 		DELAY_MINI
   810  00023E   68D2(1)  	B0BSET 		SCL_IO
   811  00023F   C2BE(2)  	CALL 		DELAY_MINI
   812  000240   6DD2(1)  	B0BSET 		SDA_IO
   813  000241   C2BE(2)  	CALL		DELAY_MINI
   814  000242   0E00(2)  	RET
   815  000243             I2C_START_TM:
   816  000243   C2BE(2)  	CALL		DELAY_MINI
   817  000244   61D2(1)  	B0BCLR 		SDATA_IO
   818  000245   C2BE(2)  	CALL 		DELAY_MINI
   819  000246   60D2(1)  	B0BCLR 		SCL_IO
   820  000247   C2BE(2)  	CALL 		DELAY_MINI
   821  000248   0E00(2)  	RET
   822  000249             I2C_END_TM:
   823  000249   61D2(1)  	B0BCLR 		SDATA_IO
   824  00024A   C2BE(2)  	CALL 		DELAY_MINI
   825  00024B   60D2(1)  	B0BCLR		SCL_IO
   826  00024C   C2BE(2)  	CALL		DELAY_MINI
   827  00024D   69D2(1)  	B0BSET 		SDATA_IO
   828  00024E   C2BE(2)  	CALL		DELAY_MINI
   829  00024F   68D2(1)  	B0BSET 		SCL_IO
   830  000250   0E00(2)  	RET
   831  000251             TMADDRESS_ASK:
   832  000251   2D08(1)  	MOV 		A,#8
   833  000252   1F02(1)  	MOV 		TIMEOUT,A
   834  000253             TMADDRESS_LOOP:
   835  000253   570A(1+S)  	BTS0		DATA_IN.7
   836  000254   8258(2)  	JMP 		MD_1
   837  000255   71D2(1+S)  	B0BTS0 		SDATA_IO
   838  000256   61D2(1)  	B0BCLR		SDATA_IO
   839  000257   825A(2)  	JMP 		NEXT_1
   840  000258             MD_1:
   841  000258   79D2(1+S)  	B0BTS1 		SDATA_IO
   842  000259   69D2(1)  	B0BSET		SDATA_IO
   843  00025A             NEXT_1:
   844  00025A   C2BE(2)  	CALL		DELAY_MINI
   845  00025B   68D2(1)  	B0BSET 		SCL_IO
   846  00025C   C2BE(2)  	CALL		DELAY_MINI
   847  00025D   0B0A(1)  	RLCM 		DATA_IN
   848  00025E   60D2(1)  	B0BCLR 		SCL_IO
   849  00025F   2602(1+S)  	DECMS 		TIMEOUT
   850  000260   8253(2)  	JMP 		TMADDRESS_LOOP
   851  000261             	
   852  000261   61C2(1)  	B0BCLR 		SDATA_CONT
   853  000262   C2BE(2)  	CALL		DELAY_MINI
   854  000263   68D2(1)  	B0BSET 		SCL_IO
   855  000264   C2BD(2)  	CALL 		CALL_DELAY
   856  000265   71D2(1+S)  	B0BTS0 		SDATA_IO
   857  000266   C232(2)  	CALL		I2C_EEROR
   858  000267   C2BE(2)  	CALL		DELAY_MINI
   859  000268   40D2(1)  	BCLR 		SCL_IO
   860  000269   49C2(1)  	BSET 		SDATA_CONT
   861  00026A   0E00(2)  	RET
   862  00026B             ;**********************TM_READING_DATA********************************
   863  00026B             TMDATA_ASK:
   864  00026B   61C2(1)  	B0BCLR 		SDATA_CONT
   865  00026C   2D08(1)  	MOV 		A,#8
   866  00026D   1F02(1)  	MOV 		TIMEOUT,A
   867  00026E             TMDATA_LOOP:
   868  00026E   2D09(1)  	MOV 		A,#9
   869  00026F   1F03(1)  	MOV 		TLC0,A
   870  000270   C2BE(2)  	CALL		DELAY_MINI
   871  000271   48D2(1)  	BSET 		SCL_IO
   872  000272   C2BD(2)  	CALL 		CALL_DELAY
   873  000273   71D2(1+S)  	B0BTS0 		SDATA_IO
   874  000274   480B(1)  	BSET 		DATA_OUT.0
   875  000275   79D2(1+S)  	B0BTS1 		SDATA_IO
   876  000276   400B(1)  	BCLR 		DATA_OUT.0
   877  000277   0B0B(1)  	RLCM 		DATA_OUT
   878  000278   C2BE(2)  	CALL		DELAY_MINI
   879  000279   60D2(1)  	B0BCLR 		SCL_IO
   880  00027A   2602(1+S)  	DECMS 		TIMEOUT
   881  00027B   826E(2)  	JMP 		TMDATA_LOOP
   882  00027C   69C2(1)  	B0BSET 		SDATA_CONT
   883  00027D   5706(1+S)  	BTS0 		ASK_FLAG
   884  00027E   69D2(1)  	B0BSET 		SDATA_IO
   885  00027F   5F06(1+S)  	BTS1 		ASK_FLAG
   886  000280   61D2(1)  	B0BCLR 		SDATA_IO
   887  000281   090B(1)  	RRCM 		DATA_OUT
   888  000282   C2BE(2)  	CALL		DELAY_MINI
   889  000283   48D2(1)  	BSET 		SCL_IO
   890  000284   C2BE(2)  	CALL		DELAY_MINI
   891  000285   40D2(1)  	BCLR		SCL_IO	
   892  000286   0E00(2)  	RET
   893  000287             ;******************************************************
   894  000287             EEADDRESS_ASK:
   895  000287   2D08(1)  	MOV 		A,#8
   896  000288   1F02(1)  	MOV 		TIMEOUT,A
   897  000289             EEADDRESS_LOOP:
   898  000289   570A(1+S)  	BTS0		DATA_IN.7
   899  00028A   828E(2)  	JMP 		EEMD_1
   900  00028B   75D2(1+S)  	B0BTS0 		SDA_IO
   901  00028C   65D2(1)  	B0BCLR		SDA_IO
   902  00028D   8290(2)  	JMP 		EENEXT_1
   903  00028E             EEMD_1:
   904  00028E   7DD2(1+S)  	B0BTS1 		SDA_IO
   905  00028F   6DD2(1)  	B0BSET		SDA_IO
   906  000290             EENEXT_1:
   907  000290   C2BE(2)  	CALL		DELAY_MINI
   908  000291   68D2(1)  	B0BSET 		SCL_IO
   909  000292   C2BE(2)  	CALL		DELAY_MINI
   910  000293   0B0A(1)  	RLCM 		DATA_IN
   911  000294   60D2(1)  	B0BCLR 		SCL_IO
   912  000295   2602(1+S)  	DECMS 		TIMEOUT
   913  000296   8289(2)  	JMP 		EEADDRESS_LOOP
   914  000297             	
   915  000297   65C2(1)  	B0BCLR 		SDA_CONT
   916  000298   C2BE(2)  	CALL		DELAY_MINI
   917  000299   68D2(1)  	B0BSET 		SCL_IO
   918  00029A   C2BD(2)  	CALL 		CALL_DELAY
   919  00029B   75D2(1+S)  	B0BTS0 		SDA_IO
   920  00029C   C232(2)  	CALL		I2C_EEROR
   921  00029D   C2BE(2)  	CALL		DELAY_MINI
   922  00029E   40D2(1)  	BCLR 		SCL_IO
   923  00029F   4DC2(1)  	BSET 		SDA_CONT
   924  0002A0   0E00(2)  	RET
   925  0002A1             ;****************************************
   926  0002A1             EEDATA_ASK:
   927  0002A1   65C2(1)  	B0BCLR 		SDA_CONT
   928  0002A2   2D08(1)  	MOV 		A,#8
   929  0002A3   1F02(1)  	MOV 		TIMEOUT,A
   930  0002A4             EEDATA_LOOP:
   931  0002A4   2D09(1)  	MOV 		A,#9
   932  0002A5   1F03(1)  	MOV 		TLC0,A
   933  0002A6   C2BE(2)  	CALL		DELAY_MINI
   934  0002A7   48D2(1)  	BSET 		SCL_IO
   935  0002A8   C2BD(2)  	CALL 		CALL_DELAY
   936  0002A9   75D2(1+S)  	B0BTS0 		SDA_IO
   937  0002AA   480B(1)  	BSET 		DATA_OUT.0
   938  0002AB   7DD2(1+S)  	B0BTS1 		SDA_IO
   939  0002AC   400B(1)  	BCLR 		DATA_OUT.0
   940  0002AD   0B0B(1)  	RLCM 		DATA_OUT
   941  0002AE   C2BE(2)  	CALL		DELAY_MINI
   942  0002AF   60D2(1)  	B0BCLR 		SCL_IO
   943  0002B0   2602(1+S)  	DECMS 		TIMEOUT
   944  0002B1   82A4(2)  	JMP 		EEDATA_LOOP
   945  0002B2             	
   946  0002B2   6DC2(1)  	B0BSET 		SDA_CONT
   947  0002B3   5706(1+S)  	BTS0 		ASK_FLAG
   948  0002B4   6DD2(1)  	B0BSET 		SDA_IO
   949  0002B5   5F06(1+S)  	BTS1 		ASK_FLAG
   950  0002B6   65D2(1)  	B0BCLR 		SDA_IO
   951  0002B7   090B(1)  	RRCM 		DATA_OUT
   952  0002B8   C2BE(2)  	CALL		DELAY_MINI
   953  0002B9   48D2(1)  	BSET 		SCL_IO
   954  0002BA   C2BE(2)  	CALL		DELAY_MINI
   955  0002BB   40D2(1)  	BCLR		SCL_IO	
   956  0002BC   0E00(2)  	RET
   957  0002BD             ;*********************delay*****************
   958  0002BD             CALL_DELAY:
   959  0002BD   0E00(2)  	RET
   960  0002BE             DELAY_MINI:;13US
   961  0002BE   2D05(1)  	MOV		A,#0X05
   962  0002BF   1F00(1)  	MOV		DELAYTIME1,A
   963  0002C0             DELAY0:
   964  0002C0   2600(1+S)  	DECMS	DELAYTIME1
   965  0002C1   82C0(2)  	JMP		DELAY0
   966  0002C2   0E00(2)  	RET
   967  0002C3             	
   968  0002C3             DELAY_SHORT:		;50US FOR 0.5US/INSTRUCTION
   969  0002C3   2D63(1)  	MOV		A,#0X63
   970  0002C4   1F00(1)  	MOV		DELAYTIME1,A
   971  0002C5             DELAY1:
   972  0002C5   0000(1)  	NOP
   973  0002C6   2600(1+S)  	DECMS	DELAYTIME1
   974  0002C7   82C5(2)  	JMP		DELAY1
   975  0002C8   0E00(2)  	RET
   976  0002C9             DELAY_LONG:	;>=5MS
   977  0002C9             ;WAIT_FOR_A_LONG_WHILE
   978  0002C9   2D0A(1)  	MOV		A,#0X0A
   979  0002CA   2F00(1)  	B0MOV	DELAYTIME1,A
   980  0002CB             DELAY2_1:
   981  0002CB   2DC7(1)  	MOV		A,#0XC7
   982  0002CC   1F01(1)  	MOV		DELAYTIME2,A
   983  0002CD             DELAY2_2:
   984  0002CD   0000(1)  	NOP
   985  0002CE   2601(1+S)  	DECMS	DELAYTIME2
   986  0002CF   82CD(2)  	JMP		DELAY2_2	
   987  0002D0   2600(1+S)  	DECMS	DELAYTIME1
   988  0002D1   82CB(2)  	JMP		DELAY2_1
   989  0002D2   0E00(2)  	RET		
   990  0002D3             DELAY_LED:		;0.2S
   991  0002D3             ;WAIT_FOR_DEEP_DARK_FANTASY
   992  0002D3   2DFF(1)  	MOV		A,#0XFF
   993  0002D4   1F01(1)  	MOV		DELAYTIME2,A
   994  0002D5             DELAY3_1:
   995  0002D5   2DFF(1)  	MOV		A,#0XFF
   996  0002D6   1F00(1)  	MOV		DELAYTIME1,A
   997  0002D7             DELAY3_2:
   998  0002D7   0000(1)  	NOP
   999  0002D8   0000(1)  	NOP
  1000  0002D9   2600(1+S)  	DECMS		DELAYTIME1
  1001  0002DA   82D7(2)  	JMP			DELAY3_2
  1002  0002DB   2601(1+S)  	DECMS		DELAYTIME2
  1003  0002DC   82D5(2)  	JMP			DELAY3_1
  1004  0002DD   0E00(2)  	RET
  1005  0002DE             OPEN_TC0_INT_FUN:
  1006  0002DE   6BDA(1)  	B0BSET	FTC0CKS	;	OUTSIDE INPUT ACCIDENT
  1007  0002DF   6ADA(1)  	B0BSET	FALOAD0 ;
  1008  0002E0   2DFD(1)  	MOV		A,#0XFD
  1009  0002E1   2FCD(1)  	B0MOV	TC0R,A
  1010  0002E2   2FDB(1)  	B0MOV	TC0C,A
  1011  0002E3   65C8(1)  	B0BCLR	FTC0IRQ
  1012  0002E4   6DC9(1)  	B0BSET	FTC0IEN
  1013  0002E5   6FDA(1)  	B0BSET	FTC0ENB
  1014  0002E6   0E00(2)  	RET
  1015  0002E7             SYS_INIT_FUN:
  1016  0002E7   2D3D(1)  	MOV			A,#0X3D
  1017  0002E8   2FC2(1)  	B0MOV		P2M,A
  1018  0002E9   2D35(1)  	MOV			A,#0X35
  1019  0002EA   2FD2(1)  	B0MOV		P2,A
  1020  0002EB             	;up resistor for p2.1
  1021  0002EB             	;MOV			A,#0X02
  1022  0002EB             	;B0MOV		P2UR,A
  1023  0002EB   2D01(1)  	MOV			A,#0X01
  1024  0002EC   2FC1(1)  	B0MOV		P1M,A
  1025  0002ED   2BD1(1)  	CLR			P1
  1026  0002EE   68B8(1)  	B0BSET		VSR_CONT
  1027  0002EF   60D0(1)  	B0BCLR		VSR_IO
  1028  0002F0   68C1(1)  	B0BSET		S_VDD_VCC_CONT
  1029  0002F1   60D1(1)  	B0BCLR		S_VDD_VCC_IO
  1030  0002F2   6CC5(1)  	B0BSET		VTM_CONT
  1031  0002F3   64D5(1)  	B0BCLR		VTM_IO
  1032  0002F4   2D03(1)  	MOV			A,#0X03
  1033  0002F5   1F10(1)  	MOV			CRCT1,A
  1034  0002F6             SYS_INIT_LED:
  1035  0002F6   62D2(1)  	B0BCLR		CLED_IO
  1036  0002F7   C2D3(2)  	CALL		DELAY_LED	
  1037  0002F8   6AD2(1)  	B0BSET		CLED_IO
  1038  0002F9   C2D3(2)  	CALL		DELAY_LED
  1039  0002FA   2610(1+S)  	DECMS		CRCT1
  1040  0002FB   82F6(2)  	JMP			SYS_INIT_LED
  1041  0002FC             ;************T0_INIT_START************************************
  1042  0002FC   2D00(1)  	MOV			A,#0X00
  1043  0002FD   2FD8(1)  	B0MOV		T0M,A	
  1044  0002FE   68D8(1)  	B0BSET		FT0TB	; T0 = Fcpu/256,PERIOD TIME IS 2S
  1045  0002FF   2BD9(1)  	CLR			T0C
  1046  000300   64C8(1)  	B0BCLR		FT0IRQ
  1047  000301   6CC9(1)  	B0BSET		FT0IEN
  1048  000302   6FD8(1)  	B0BSET		FT0ENB
  1049  000303             ;*****************TC0_INIT_START*****************
  1050  000303   2BDA(1)  	CLR			TC0M
  1051  000304   2BDB(1)  	CLR			TC0C
  1052  000305   65C8(1)  	B0BCLR		FTC0IRQ
  1053  000306   65C9(1)  	B0BCLR		FTC0IEN
  1054  000307   67DA(1)  	B0BCLR		FTC0ENB
  1055  000308             ;************************OPEN P1.1WEEK UP FUNCTION*********************
  1056  000308   2D02(1)  	MOV			A,#0X02
  1057  000309   2FC0(1)  	B0MOV		P1W,A
  1058  00030A   C2BE(2)  	CALL		DELAY_MINI
  1059  00030B   0E00(2)  	RET
  1060  00030C             ;//////////////////////////////////////////////////
  1061  00030C             SET_EE_TM_FUN:
  1062  00030C   65C2(1)  	B0BCLR		SDA_CONT
  1063  00030D   64C5(1)  	B0BCLR		VTM_CONT
  1064  00030E   60C2(1)  	B0BCLR		SCL_CONT
  1065  00030F   61C2(1)  	B0BCLR		SDATA_CONT
  1066  000310   68D0(1)  	B0BSET		VSR_IO
  1067  000311   6BD2(1)  	B0BSET		S_TM_EE_IO
  1068  000312   4A06(1)  	BSET		TM_EE_FLAG
  1069  000313   64D2(1)  	B0BCLR	IC_IDLE
  1070  000314   4407(1)  	BCLR	NOT_QUICK_MODE_FLAG
  1071  000315   0E00(2)  	RET
  1072  000316             ;////////////////////////////////////////
  1073  000316             ;////////////SET LOW POWER
  1074  000316             SET_LOW_POWER_FUN:
  1075  000316             ;****************************************
  1076  000316   64C5(1)  	B0BCLR		VTM_CONT
  1077  000317   63D2(1)  	B0BCLR		S_TM_EE_IO
  1078  000318   60D0(1)  	B0BCLR		VSR_IO
  1079  000319   4206(1)  	BCLR		TM_EE_FLAG
  1080  00031A   6CD2(1)  	B0BSET	IC_IDLE
  1081  00031B   0E00(2)  	RET
  1082  00031C             ;/////////////////////////////////////////	
  1083  00031C             ;*******************************************
  1084  00031C             	ENDP
