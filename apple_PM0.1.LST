     1  000000             CHIP		SN8P2501D
     2  000000             //{{SONIX_CODE_OPTION
     3  000000             	.Code_Option	Noise_Filter	Enable
     4  000000             	.Code_Option	Reset_Pin	P11
     5  000000             	.Code_Option	Watch_Dog	Disable
     6  000000             	.Code_Option	High_Clk	IHRC_RTC	;
     7  000000             	.Code_Option	Fcpu		#3     ; Fcpu = Fosc/8
     8  000000             	.Code_Option	Security	Enable
     9  000000             	.Code_Option	LVD		LVD_L		;
    10  000000             //}}SONIX_CODE_OPTION
    11  000000             
    12  E 0000002F         	END_RAM_ADDR	EQU	0X2F
    13  E 000000A1         	EER_ADD			EQU	0XA1	;10100001B
    14  E 000000A0         	EEW_ADD			EQU	0XA0	;10100000B
    15  E 00000030         	RAM_COUNT		EQU	48
    16  E 00000034         	TM_DATA_H		EQU	0X34	;ADDR OF THE TEMPEATURE	OF TM
    17  E 00000000         	TM_DATA_L		EQU	0X00
    18  E 0000002F         	WRITE_TM_ADD_H	EQU	0X2F	;Where mcu want to wirte something into tm
    19  E 00000000         	WRITE_TM_ADD_L	EQU	0X00
    20  E 00000078         	TIME_GAP		EQU	0X78	;0X78
    21  E 00000001         	T0_TDR			EQU	0X01
    22  E 0000003D         	TMR_ADD 		EQU	0X3D
    23  E 0000003C         	TMW_ADD			EQU	0X3C
    24  E 0000001F         	MAX_MEMH		EQU	0X1F
    25  E 000000F0         	MAX_MEML		EQU	0XF0
    26  E 0000001F         	LAST_TIME_EE_ADD_H EQU 0X1F
    27  E 000000FE         	LAST_TIME_EE_ADD_L EQU 0XFE
    28  E 0000001F         	LIVE_TIME_ADD_H		EQU	0X1F
    29  E 000000FC         	LIVE_TIME_ADD_L		EQU	0XFC
    30  E 00000001         	DEFAULT_FRONT_TIME_DELAY	EQU	0X01
    31  E 00000001         	DEFAULT_TIME_GAP	EQU	0X01
    32  E 00000030         	TM_INITIAL_TIME_ADD_H	EQU 0X30
    33  E 00000000         	TM_INITIAL_TIME_ADD_L	EQU 0X00
    34  E 00000031         	TM_TIME_H		EQU	0X31
    35  E 00000000         	TM_TIME_L		EQU	0X00
    36  E 0000001F         	EE_DELAY_ADD_H	EQU	0X1F
    37  E 000000F8         	EE_GAP_ADD_L	EQU	0XF8
    38  E 0000001F         	EE_INITIAL_TIME_ADD_H	EQU	0X1F
    39  E 000000FA         	EE_INITIAL_TIME_ADD_L	EQU	0XFA
    40  E 00000001         	WRITE_FLAG_H	EQU 0X01
    41  E 00000000         	WRITE_FLAG_L	EQU	0X00
    42  E 00000002         	DEFAULT_GAP_TIME_FLAGH EQU 0X02
    43  E 00000000         	DEFAULT_GAP_TIME_FLAGL EQU	0X00
    44  000000             .DATA
    45  000000             			ORG	0H
    46  0000 D             	DELAYTIME1	DS	1
    47  0001 D             	DELAYTIME2	DS	1
    48  0002 D             	TIMEOUT		DS	1
    49  0003 D             	TLC0		DS	1
    50  0004 D             	TLC1		DS	1
    51  0005 D             	TLC2		DS	1
    52  0006 D             	FLAG1		DS	1
    53  0007 D             	FLAG2		DS	1
    54  0008 D             	TIMEH		DS	1
    55  0009 D             	TIMEG		DS	1
    56  000A D             	DATA_IN		DS	1
    57  000B D             	DATA_OUT	DS	1
    58  000C D             	DATAH		DS	1
    59  000D D             	DATAL		DS	1
    60  000E D             	ADDRESSH	DS	1
    61  000F D             	ADDRESSL	DS	1
    62  0010 D             	CRCT1		DS	1
    63  0011 D             	CRCT2		DS	1
    64  0012 D             	COUNT		DS	1
    65  0013 D             	MAC_H		DS	1
    66  0014 D             	MAC_L		DS	1
    67  0015 D             	FRONT_DELAY	DS	1
    68  0016 D             	TIME_DELAY_GAP	DS	1
    69  0017 D             	STARTADDRH		DS	1
    70  0018 D             	STARTADDRL		DS	1
    71  0019 D             	INITIAL_TIMEH	DS	1
    72  001A D             	INITIAL_TIMEL	DS	1
    73  00001B             ;**************BIT_VARIABLES_DEFINNITIONS*******
    74  E 00000006         	READTM_FLAG	EQU	FLAG1.0
    75  E 00030006         	TIME_FLAG	EQU	FLAG1.3
    76  E 00010006         	RESET_FLAG	EQU	FLAG1.1
    77  E 00020006         	TM_EE_FLAG	EQU FLAG1.2
    78  E 00040006         	DEFAULT_GAP_FLAG	EQU	FLAG1.4
    79  E 00050006         	FILLOUT_FLAG	EQU	FLAG1.5
    80  E 00060006         	I2CERROR_FLAG	EQU	FLAG1.6
    81  E 00070006         	ASK_FLAG	EQU	FLAG1.7
    82  E 00010007         	READ_LED_FLAG	EQU	FLAG2.1
    83  E 00020007         	NOT_UPLOAD_FLAG	EQU	FLAG2.2
    84  E 00030007         	HAVE_UPLOAD_FLAG EQU FLAG2.3
    85  E 00040007         	NOT_QUICK_MODE_FLAG EQU FLAG2.4
    86  E 00050007         	TM_I2C_EEROR	EQU FLAG2.5
    87  E 000200D2         	CLED_IO			EQU	P2.2
    88  E 000100D2         	SDATA_IO		EQU	P2.1
    89  E 000000D2         	SCL_IO			EQU	P2.0
    90  E 000300D2         	S_TM_EE_IO		EQU	P2.3
    91  E 000400D2         	IC_IDLE	EQU	P2.4
    92  E 000500D2         	SDA_IO			EQU	P2.5
    93  E 000400D5         	VTM_IO			EQU	P5.4
    94  E 000000D0         	VSR_IO			EQU	P0.0
    95  E 000200C2         	CLED_CONT		EQU	P2M.2
    96  E 000100C2         	SDATA_CONT		EQU	P2M.1
    97  E 000000C2         	SCL_CONT		EQU	P2M.0
    98  E 000300C2         	S_TM_EE_CONT	EQU	P2M.3
    99  E 000500C2         	SDA_CONT		EQU	P2M.5
   100  E 000400C5         	VTM_CONT		EQU	P5M.4
   101  E 000000B8         	VSR_CONT		EQU	P0M.0
   102  00001B             ;***************************************
   103  E 000100D1         	VDDF			EQU	P1.1
   104  E 000000D1         	S_VDD_VCC_IO		EQU	P1.0
   105  E 000000C1         	S_VDD_VCC_CONT		EQU	P1M.0
   106  00001B             ;*************CODE_SECTION**********************	
   107  000000             .CODE
   108  000000             
   109  000000             		ORG	0
   110  000000   8030(2)  	JMP		START
   111  000008             		ORG	8H
   112  000008   8009(2)  	JMP		INT_SERVICE
   113  000009             INT_SERVICE:
   114  000009             ;KEEP ACC AND PFLAG
   115  000009   0400(1)  	PUSH
   116  00000A             ;T0 INTERRUPT
   117  00000A             JUST_T0:
   118  00000A   74C9(1+S)  	B0BTS0	FT0IEN
   119  00000B   7CC8(1+S)  	B0BTS1	FT0IRQ
   120  00000C   8025(2)  	JMP		JUST_TC0
   121  00000D   64C8(1)  	B0BCLR	FT0IRQ
   122  00000E             ;T0 INTERRUPT SERVISE PROGRESS
   123  00000E   71D1(1+S)  	B0BTS0	VDDF
   124  00000F   4A07(1)  	BSET 	NOT_UPLOAD_FLAG
   125  000010   71D1(1+S)  	B0BTS0	VDDF
   126  000011   4307(1)  	BCLR    HAVE_UPLOAD_FLAG
   127  000012             ;///////////////////////////////
   128  000012   5B07(1+S)  	BTS1	HAVE_UPLOAD_FLAG
   129  000013   8016(2)  	JMP		$+3
   130  000014   79D1(1+S)  	B0BTS1	VDDF
   131  000015   4C07(1)  	BSET	NOT_QUICK_MODE_FLAG
   132  000016   79D1(1+S)  	B0BTS1	VDDF
   133  000017   4B07(1)  	BSET    HAVE_UPLOAD_FLAG
   134  000018             ;//////////////////////////////////
   135  000018   1608(1+S)  	INCMS	TIMEH ;TIMEH=TIMEH+1,
   136  000019   2D78(1)  	MOV		A,#TIME_GAP
   137  00001A   0708(1+S)  	CMPRS	A,TIMEH
   138  00001B   802E(2)  	JMP		EXIT_INT
   139  00001C   2B08(1)  	CLR		TIMEH
   140  00001D   4B06(1)  	BSET	TIME_FLAG
   141  00001E   1609(1+S)  	INCMS	TIMEG
   142  00001F   1E16(1)  	MOV		A,TIME_DELAY_GAP
   143  000020   0709(1+S)  	CMPRS	A,TIMEG
   144  000021   802E(2)  	JMP		EXIT_INT
   145  000022   2B09(1)  	CLR		TIMEG
   146  000023   4806(1)  	BSET	READTM_FLAG
   147  000024   802E(2)  	JMP		EXIT_INT
   148  000025             JUST_TC0:
   149  000025   75C9(1+S)  	B0BTS0	FTC0IEN
   150  000026   7DC8(1+S)  	B0BTS1	FTC0IRQ
   151  000027   802A(2)  	JMP		JUST_INT0
   152  000028   65C8(1)  	B0BCLR	FTC0IRQ
   153  000029             ;TC0 INTERRUPT SERVICE PROGRESS
   154  000029   802E(2)  	JMP		EXIT_INT
   155  00002A             JUST_INT0:
   156  00002A   70C9(1+S)  	B0BTS0	FP00IEN
   157  00002B   78C8(1+S)  	B0BTS1	FP00IRQ
   158  00002C   802E(2)  	JMP EXIT_INT
   159  00002D   60C8(1)  	B0BCLR	FP00IRQ
   160  00002E             ;INT0 INTERRUPT SERVISE PROGRESS
   161  00002E             EXIT_INT:
   162  00002E   0500(1)  	POP
   163  00002F   0F00(2)  	RETI
   164  000030             ;*********************************************************
   165  000030             ;***********************STARRT**********************
   166  000030             START:
   167  000030   2D7F(1)  	MOV		A,#07FH
   168  000031   2FDF(1)  	B0MOV		STKP,A		;DISABLE GLOBAL INTERRUPT
   169  000032   2B86(1)  	CLR		PFLAG
   170  000033   2D00(1)  	MOV		A,#00H
   171  000034   2FCA(1)  	B0MOV		OSCM,A
   172  000035   2D5A(1)  	MOV		A,#0X5A
   173  000036   2FCC(1)  	B0MOV		WDTR,A	
   174  000037   C145(2)  	CALL		CLRRAM
   175  000038             STATE_INITIAL:
   176  000038   C2DD(2)  	CALL		SYS_INIT_FUN
   177  000039   67DF(1)  	B0BCLR		FGIE
   178  00003A             GET_TIME_INITIAL:
   179  00003A             ;******************************************
   180  00003A   2D01(1)  	MOV		A,#DEFAULT_FRONT_TIME_DELAY
   181  00003B   1F15(1)  	MOV		FRONT_DELAY,A
   182  00003C   2D01(1)  	MOV		A,#DEFAULT_TIME_GAP
   183  00003D   1F16(1)  	MOV		TIME_DELAY_GAP,A
   184  00003E   6BD2(1)  	B0BSET	S_TM_EE_IO
   185  00003F   64D2(1)  	B0BCLR	IC_IDLE
   186  000040             ;Get initial time from tm
   187  000040   2D30(1)  	MOV		A,#TM_INITIAL_TIME_ADD_H
   188  000041   1F13(1)  	MOV		MAC_H,A
   189  000042   2D00(1)  	MOV		A,#TM_INITIAL_TIME_ADD_L
   190  000043   1F14(1)  	MOV		MAC_L,A
   191  000044   C1B0(2)  	CALL	GET_DATA_FROM_TM_FUN
   192  000045   1E0C(1)  	MOV		A,DATAH
   193  000046   0600(1+S)  	CMPRS	A,#0X00
   194  000047   1F19(1)  	MOV		INITIAL_TIMEH,A
   195  000048   1E0D(1)  	MOV		A,DATAL
   196  000049   0600(1+S)  	CMPRS	A,#0X00
   197  00004A   1F1A(1)  	MOV		INITIAL_TIMEL,A
   198  00004B   C2B9(2)  	CALL	DELAY_SHORT
   199  00004C             ;GET TIME DELAY AND GAP FROM TM
   200  00004C   2D31(1)  	MOV		A,#TM_TIME_H
   201  00004D   1F13(1)  	MOV		MAC_H,A
   202  00004E   2D00(1)  	MOV		A,#TM_TIME_L
   203  00004F   1F14(1)  	MOV		MAC_L,A
   204  000050   C1B0(2)  	CALL	GET_DATA_FROM_TM_FUN
   205  000051             ;the 2bit in front of DATAH is useness
   206  000051   2D3F(1)  	MOV		A,#0X3F
   207  000052   290C(1)  	AND		DATAH,A
   208  000053   1E0C(1)  	MOV			A,DATAH
   209  000054   0600(1+S)  	CMPRS		A,#0X00
   210  000055   1F15(1)  	MOV			FRONT_DELAY,A
   211  000056   1E0D(1)  	MOV			A,DATAL
   212  000057   0600(1+S)  	CMPRS		A,#0X00
   213  000058   1F16(1)  	MOV			TIME_DELAY_GAP,A		
   214  000059   63D2(1)  	B0BCLR		S_TM_EE_IO
   215  00005A   C2BF(2)  	CALL		DELAY_LONG
   216  00005B             ;*******************************************
   217  00005B             GET_INITIAL_DATA_FROM_EE:
   218  00005B             ;*******************************************
   219  00005B   2D1F(1)  	MOV			A,#LAST_TIME_EE_ADD_H
   220  00005C   1F13(1)  	MOV			MAC_H,A
   221  00005D   2DFE(1)  	MOV			A,#LAST_TIME_EE_ADD_L
   222  00005E   1F14(1)  	MOV			MAC_L,A
   223  00005F   5106(1+S)  	BTS0		RESET_FLAG
   224  000060   809A(2)  	JMP			RESET_EEPROM
   225  000061   C201(2)  	CALL		GET_DATA_FROM_EE_FUN
   226  000062   1E0F(1)  	MOV			A,ADDRESSL
   227  000063   1F18(1)  	MOV			STARTADDRL,A
   228  000064   1E0E(1)  	MOV			A,ADDRESSH
   229  000065   1F17(1)  	MOV			STARTADDRH,A
   230  000066   1E0E(1)  	MOV			A,ADDRESSH
   231  000067   06FF(1+S)  	CMPRS		A,#0XFF
   232  000068   806B(2)  	JMP			$+3
   233  000069   2B17(1)  	CLR			STARTADDRH
   234  00006A   2B18(1)  	CLR			STARTADDRL
   235  00006B   C2BF(2)  	CALL		DELAY_LONG
   236  00006C   2D1F(1)  	MOV			A,#LIVE_TIME_ADD_H
   237  00006D   1F13(1)  	MOV			MAC_H,A
   238  00006E   2DFC(1)  	MOV			A,#LIVE_TIME_ADD_L
   239  00006F   1F14(1)  	MOV			MAC_L,A
   240  000070   C201(2)  	CALL		GET_DATA_FROM_EE_FUN
   241  000071             ;;;;;;;;;;;;;;LAST READ TM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   242  000071   6BD2(1)  	B0BSET		S_TM_EE_IO
   243  000072   60D0(1)  	B0BCLR		VSR_IO
   244  000073   2D34(1)  	MOV			A,#TM_DATA_H
   245  000074   1F13(1)  	MOV			MAC_H,A
   246  000075   2D00(1)  	MOV			A,#TM_DATA_L
   247  000076   1F14(1)  	MOV			MAC_L,A
   248  000077   C1B0(2)  	CALL		GET_DATA_FROM_TM_FUN
   249  000078   64D5(1)  	B0BCLR		VTM_IO
   250  000079   C2B9(2)  	CALL		DELAY_SHORT
   251  00007A   63D2(1)  	B0BCLR		S_TM_EE_IO
   252  00007B   64C5(1)  	B0BCLR		VTM_CONT
   253  00007C             ;/////////////////WRITE TO EE//////////////////////////////
   254  00007C             WRITE_INITIAL_DATA_TO_EE:
   255  00007C             ;///////////INITIAL TIME/////////////////////
   256  00007C   64D5(1)  	B0BCLR		VTM_IO
   257  00007D   C2B9(2)  	CALL		DELAY_SHORT
   258  00007E   64C5(1)  	B0BCLR		VTM_CONT
   259  00007F   C2B9(2)  	CALL		DELAY_SHORT
   260  000080   2D1F(1)  	MOV		A,#EE_INITIAL_TIME_ADD_H
   261  000081   1F13(1)  	MOV		MAC_H,A
   262  000082   2DFA(1)  	MOV		A,#EE_INITIAL_TIME_ADD_L
   263  000083   1F14(1)  	MOV		MAC_L,A
   264  000084   1E19(1)  	MOV		A,INITIAL_TIMEH
   265  000085   1F0C(1)  	MOV		DATAH,A
   266  000086   1E1A(1)  	MOV		A,INITIAL_TIMEL
   267  000087   1F0D(1)  	MOV		DATAL,A
   268  000088   C14D(2)  	CALL		DATA_TO_EEPROM_FUN
   269  000089   C2BF(2)  	CALL	DELAY_LONG
   270  00008A   2D1F(1)  	MOV		A,#EE_DELAY_ADD_H
   271  00008B   1F13(1)  	MOV		MAC_H,A
   272  00008C   2DF8(1)  	MOV		A,#EE_GAP_ADD_L
   273  00008D   1F14(1)  	MOV		MAC_L,A
   274  00008E   1E15(1)  	MOV		A,FRONT_DELAY
   275  00008F   1F0C(1)  	MOV		DATAH,A
   276  000090   1E16(1)  	MOV		A,TIME_DELAY_GAP
   277  000091   1F0D(1)  	MOV		DATAL,A
   278  000092   C14D(2)  	CALL		DATA_TO_EEPROM_FUN
   279  000093   C2BF(2)  	CALL	DELAY_LONG
   280  000094             SET_WRITE_EE_START_ADD:
   281  000094   1E17(1)  	MOV			A,STARTADDRH
   282  000095   1F0E(1)  	MOV			ADDRESSH,A
   283  000096   1E18(1)  	MOV			A,STARTADDRL
   284  000097   1F0F(1)  	MOV			ADDRESSL,A
   285  000098             	
   286  000098   5906(1+S)  	BTS1		RESET_FLAG
   287  000099   80BB(2)  	JMP			FRONT_DELAY_MODE
   288  00009A             RESET_EEPROM:
   289  00009A   44D2(1)  	BCLR	IC_IDLE
   290  00009B   2DFF(1)  	MOV		A,#0XFF
   291  00009C   1F0C(1)  	MOV		DATAH,A
   292  00009D   2DFF(1)  	MOV		A,#0XFF
   293  00009E   1F0D(1)  	MOV		DATAL,A
   294  00009F   2D00(1)  	MOV		A,#0X00
   295  0000A0   1F13(1)  	MOV		MAC_H,A
   296  0000A1             RESET_EE_LOOP_H:
   297  0000A1   2D00(1)  	MOV		A,#0X00
   298  0000A2   1F14(1)  	MOV		MAC_L,A
   299  0000A3             RESET_EE_LOOP_L:
   300  0000A3   C14D(2)  	CALL		DATA_TO_EEPROM_FUN
   301  0000A4   1614(1+S)  	INCMS	MAC_L
   302  0000A5   80A3(2)  	JMP		RESET_EE_LOOP_L
   303  0000A6   1613(1+S)  	INCMS	MAC_H
   304  0000A7   1E13(1)  	MOV		A,MAC_H
   305  0000A8   0620(1+S)  	CMPRS	A,#0X20
   306  0000A9   80A1(2)  	JMP		RESET_EE_LOOP_H
   307  0000AA   2B0F(1)  	CLR		ADDRESSL
   308  0000AB   2B0E(1)  	CLR		ADDRESSH
   309  0000AC   2D1F(1)  	MOV		A,#LAST_TIME_EE_ADD_H
   310  0000AD   1F13(1)  	MOV		MAC_H,A
   311  0000AE   2DFE(1)  	MOV		A,#LAST_TIME_EE_ADD_L
   312  0000AF   1F14(1)  	MOV		MAC_L,A
   313  0000B0   1E0E(1)  	MOV		A,ADDRESSH
   314  0000B1   1F0C(1)  	MOV		DATAH,A
   315  0000B2   1E0F(1)  	MOV		A,ADDRESSL
   316  0000B3   1F0D(1)  	MOV		DATAL,A
   317  0000B4   C14D(2)  	CALL		DATA_TO_EEPROM_FUN
   318  0000B5   2D1F(1)  	MOV			A,#LIVE_TIME_ADD_H
   319  0000B6   1F13(1)  	MOV			MAC_H,A
   320  0000B7   2DFC(1)  	MOV			A,#LIVE_TIME_ADD_L
   321  0000B8   1F14(1)  	MOV			MAC_L,A
   322  0000B9   C14D(2)  	CALL		DATA_TO_EEPROM_FUN
   323  0000BA   4106(1)  	BCLR		RESET_FLAG
   324  0000BB             ;******************************************
   325  0000BB             FRONT_DELAY_MODE:
   326  0000BB   6FDF(1)  	B0BSET		FGIE
   327  0000BC   C30C(2)  	CALL		SET_LOW_POWER_FUN
   328  0000BD             ;DELAY
   329  0000BD   C312(2)  	CALL		WAIT_FOR_SEAVAL_MINITE_FUN
   330  0000BE             	;///////////////////////////
   331  0000BE   4207(1)  	BCLR		NOT_UPLOAD_FLAG
   332  0000BF   4307(1)  	BCLR		HAVE_UPLOAD_FLAG
   333  0000C0             ;//////////////////////////////////////
   334  0000C0             MAIN:
   335  0000C0             	;close tc0 interrupt until the recording finished 
   336  0000C0             	GreenMode
   337  0000C0   6CCA(1)  		B0BSET	FCPUM1
   338  0000C1   0000(1)  		NOP
   339  0000C2   0000(1)  		NOP
   340  0000C3             	
   341  0000C3             JUST_I2CSLAVE_MODE:
   342  0000C3   5806(1+S)  	BTS1	READTM_FLAG
   343  0000C4   8107(2)  	JMP		JUST_UPLOAD_MODE
   344  0000C5   5506(1+S)  	BTS0	FILLOUT_FLAG
   345  0000C6   811A(2)  	JMP		MEM_FILLOUT_MODE
   346  0000C7   7CC9(1+S)  	B0BTS1	FT0IEN
   347  0000C8   8107(2)  	JMP		JUST_UPLOAD_MODE
   348  0000C9             ;*****START TM I2C SLAVE MODE***********
   349  0000C9             I2CSLAVE_MODE:
   350  0000C9   4006(1)  	BCLR 	READTM_FLAG
   351  0000CA   59D1(1+S)  	BTS1	VDDF
   352  0000CB   80F8(2)  	JMP		ADDRESS_CHANGE
   353  0000CC   67DF(1)  	B0BCLR 	FGIE
   354  0000CD   64D2(1)  	B0BCLR		IC_IDLE
   355  0000CE   6CC5(1)  	B0BSET	VTM_CONT
   356  0000CF   6BD2(1)  	B0BSET	S_TM_EE_IO
   357  0000D0   60D0(1)  	B0BCLR	VSR_IO
   358  0000D1   2D34(1)  	MOV		A,#TM_DATA_H
   359  0000D2   1F13(1)  	MOV		MAC_H,A
   360  0000D3   2D00(1)  	MOV		A,#TM_DATA_L
   361  0000D4   1F14(1)  	MOV		MAC_L,A
   362  0000D5   C1B0(2)  	CALL	GET_DATA_FROM_TM_FUN
   363  0000D6   64D5(1)  	B0BCLR		VTM_IO
   364  0000D7   C2B9(2)  	CALL		DELAY_SHORT
   365  0000D8   63D2(1)  	B0BCLR		S_TM_EE_IO
   366  0000D9   64C5(1)  	B0BCLR		VTM_CONT
   367  0000DA   C2B9(2)  	CALL		DELAY_SHORT
   368  0000DB   1E0E(1)  	MOV		A,ADDRESSH
   369  0000DC   1F13(1)  	MOV		MAC_H,A
   370  0000DD   1E0F(1)  	MOV		A,ADDRESSL
   371  0000DE   1F14(1)  	MOV		MAC_L,A
   372  0000DF   C14D(2)  	CALL		DATA_TO_EEPROM_FUN
   373  0000E0   2D1F(1)  	MOV		A,#LAST_TIME_EE_ADD_H
   374  0000E1   1F13(1)  	MOV		MAC_H,A
   375  0000E2   2DFE(1)  	MOV		A,#LAST_TIME_EE_ADD_L
   376  0000E3   1F14(1)  	MOV		MAC_L,A
   377  0000E4   1E0E(1)  	MOV		A,ADDRESSH
   378  0000E5   1F0C(1)  	MOV		DATAH,A
   379  0000E6   1E0F(1)  	MOV		A,ADDRESSL
   380  0000E7   1F0D(1)  	MOV		DATAL,A
   381  0000E8   C14D(2)  	CALL		DATA_TO_EEPROM_FUN
   382  0000E9   74C8(1+S)  	B0BTS0		FT0IRQ
   383  0000EA   1608(1+S)  	INCMS		TIMEH
   384  0000EB   64C8(1)  	B0BCLR		FT0IRQ
   385  0000EC   6FDF(1)  	B0BSET		FGIE
   386  0000ED   2D78(1)  	MOV			A,#TIME_GAP
   387  0000EE   0708(1+S)  	CMPRS		A,TIMEH
   388  0000EF   80F8(2)  	JMP			ADDRESS_CHANGE
   389  0000F0   2B08(1)  	CLR			TIMEH
   390  0000F1   4B06(1)  	BSET		TIME_FLAG
   391  0000F2   1609(1+S)  	INCMS		TIMEG
   392  0000F3   1E16(1)  	MOV			A,TIME_DELAY_GAP
   393  0000F4   0709(1+S)  	CMPRS		A,TIMEG
   394  0000F5   80F8(2)  	JMP			ADDRESS_CHANGE
   395  0000F6   2B09(1)  	CLR			TIMEG
   396  0000F7   4806(1)  	BSET		READTM_FLAG
   397  0000F8             ADDRESS_CHANGE:
   398  0000F8   6CD2(1)  	B0BSET		IC_IDLE
   399  0000F9   2D02(1)  	MOV			A,#0X02
   400  0000FA   130F(1)  	ADD			ADDRESSL,A
   401  0000FB   2D00(1)  	MOV			A,#0X00
   402  0000FC   110E(1)  	ADC			ADDRESSH,A
   403  0000FD   2D1F(1)  	MOV			A,#MAX_MEMH
   404  0000FE   070E(1+S)  	CMPRS		A,ADDRESSH
   405  0000FF   80C3(2)  	JMP			JUST_I2CSLAVE_MODE
   406  000100   2DF0(1)  	MOV			A,#MAX_MEML
   407  000101   070F(1+S)  	CMPRS		A,ADDRESSL
   408  000102   80C3(2)  	JMP			JUST_I2CSLAVE_MODE
   409  000103   4D06(1)  	BSET		FILLOUT_FLAG
   410  000104   67D8(1)  	B0BCLR		FT0ENB
   411  000105   64C9(1)  	B0BCLR		FT0IEN
   412  000106   811A(2)  	JMP			MEM_FILLOUT_MODE
   413  000107             ;*****************************************
   414  000107             JUST_UPLOAD_MODE:
   415  000107   62C2(1)  	B0BCLR		CLED_CONT
   416  000108   C2B9(2)  	CALL		DELAY_SHORT
   417  000109   C2B9(2)  	CALL		DELAY_SHORT
   418  00010A   7AD2(1+S)  	B0BTS1		CLED_IO
   419  00010B   8137(2)  	JMP			RESET_MODE
   420  00010C   5206(1+S)  	BTS0		TM_EE_FLAG
   421  00010D   8114(2)  	JMP			END_TM_EE_MODE
   422  00010E   51D1(1+S)  	BTS0		VDDF
   423  00010F   811A(2)  	JMP			MEM_FILLOUT_MODE
   424  000110             TM_EE_MODE:
   425  000110   4307(1)  	BCLR		HAVE_UPLOAD_FLAG
   426  000111   5206(1+S)  	BTS0		TM_EE_FLAG
   427  000112   8114(2)  	JMP			END_TM_EE_MODE
   428  000113   C302(2)  	CALL		SET_EE_TM_FUN
   429  000114             END_TM_EE_MODE:
   430  000114             	;BTS0		FILLOUT_FLAG
   431  000114             	;JMP			MEM_FILLOUT_MODE	
   432  000114   59D1(1+S)  	BTS1		VDDF
   433  000115   811A(2)  	JMP			MEM_FILLOUT_MODE
   434  000116   C30C(2)  	CALL		SET_LOW_POWER_FUN
   435  000117   5506(1+S)  	BTS0		FILLOUT_FLAG
   436  000118   811A(2)  	JMP			MEM_FILLOUT_MODE
   437  000119             	;we should keep rtc function 
   438  000119   812E(2)  	JMP		ON_LED_MODE
   439  00011A             ;*************************************
   440  00011A             MEM_FILLOUT_MODE:
   441  00011A   5D06(1+S)  	BTS1	FILLOUT_FLAG
   442  00011B   812E(2)  	JMP		ON_LED_MODE
   443  00011C   79D1(1+S)  	B0BTS1	VDDF
   444  00011D   8121(2)  	JMP		$+4
   445  00011E   5206(1+S)  	BTS0	TM_EE_FLAG
   446  00011F   C30C(2)  	CALL	SET_LOW_POWER_FUN
   447  000120   8123(2)  	JMP		$+3
   448  000121   5A06(1+S)  	BTS1	TM_EE_FLAG
   449  000122   C302(2)  	CALL	SET_EE_TM_FUN
   450  000123   7FD8(1+S)  	B0BTS1		FT0ENB
   451  000124   8129(2)  	JMP			$+5
   452  000125   2BD9(1)  	CLR			T0C
   453  000126   64C8(1)  	B0BCLR		FT0IRQ
   454  000127   64C9(1)  	B0BCLR		FT0IEN
   455  000128   67D8(1)  	B0BCLR		FT0ENB
   456  000129             	SleepMode
   457  000129   6BCA(1)  		B0BSET	FCPUM0
   458  00012A             END_FILLOUT_MODE:
   459  00012A   6AC2(1)  	B0BSET		CLED_CONT
   460  00012B   6AD2(1)  	B0BSET		CLED_IO
   461  00012C   C2B4(2)  	CALL		DELAY_MINI
   462  00012D   8107(2)  	JMP		JUST_UPLOAD_MODE
   463  00012E             ON_LED_MODE:
   464  00012E   6AC2(1)  	B0BSET	CLED_CONT
   465  00012F   6AD2(1)  	B0BSET	CLED_IO
   466  000130   5107(1+S)  	BTS0	READ_LED_FLAG
   467  000131   C13C(2)  	CALL	READ_LED_FUN
   468  000132   4107(1)  	BCLR   	READ_LED_FLAG
   469  000133   6AD2(1)  	B0BSET	CLED_IO
   470  000134   5506(1+S)  	BTS0	FILLOUT_FLAG
   471  000135   8107(2)  	JMP		JUST_UPLOAD_MODE
   472  000136   80C0(2)  	JMP		MAIN
   473  000137             RESET_MODE:
   474  000137   4906(1)  	BSET	RESET_FLAG
   475  000138   4506(1)  	BCLR	FILLOUT_FLAG
   476  000139   2B08(1)  	CLR		TIMEH
   477  00013A   2B09(1)  	CLR		TIMEG
   478  00013B   8038(2)  	JMP		STATE_INITIAL
   479  00013C             	
   480  00013C             ;******************************************************************************	
   481  00013C             READ_LED_FUN:
   482  00013C   2D01(1)     	MOV  	   	A,#1
   483  00013D   1F05(1)     	MOV  	   	TLC2,A
   484  00013E             LED_MODEL1:	
   485  00013E   6AD2(1)     	B0BSET   	CLED_IO
   486  00013F   C2C9(2)     	CALL   	   	DELAY_LED
   487  000140   62D2(1)     	B0BCLR   	CLED_IO
   488  000141   C2C9(2)     	CALL   	   	DELAY_LED
   489  000142   2605(1+S)     	DECMS   	TLC2
   490  000143   813E(2)     	JMP   	   	LED_MODEL1
   491  000144   0E00(2)     	RET
   492  000145             ;*******************************************************
   493  000145             ;***************************************
   494  000145             	
   495  000145             	
   496  000145             	
   497  000145             	
   498  000145             	
   499  000145             	
   500  000145             	
   501  000145             	
   502  000145             	
   503  000145             	
   504  000145             	
   505  000145             	
   506  000145             	
   507  000145             	
   508  000145             	
   509  000145             	
   510  000145             CLRRAM:
   511  000145             	
   512  000145   2B84(1)  	CLR			Y
   513  000146   2D2F(1)  	MOV			A,#END_RAM_ADDR
   514  000147   2F83(1)  	B0MOV		Z,A
   515  000148             CLRRAM10:
   516  000148   2BE7(1)  	CLR			@YZ
   517  000149   2683(1+S)  	DECMS		Z
   518  00014A   8148(2)  	JMP			CLRRAM10
   519  00014B   2BE7(1)  	CLR			@YZ
   520  00014C   0E00(2)  	RET
   521  00014D             ;***********************************
   522  00014D             ;***************************************
   523  00014D             ;*************WRITE TMEPERATURE INTO EEPROM*************
   524  00014D             ;*************RECORDING ADDRESS THE LAST TIME STORAGE THE TMPERATURE VALUE************
   525  00014D             ;**************************************
   526  00014D             DATA_TO_EEPROM_FUN:
   527  00014D   6DC2(1)  	B0BSET		SDA_CONT
   528  00014E   6DD2(1)  	B0BSET		SDA_IO
   529  00014F   68C2(1)  	B0BSET		SCL_CONT
   530  000150   68D2(1)  	B0BSET		SCL_IO
   531  000151   1E14(1)  	MOV			A,MAC_L
   532  000152   1F11(1)  	MOV			CRCT2,A
   533  000153   1E0C(1)  	MOV			A,DATAH
   534  000154   1F10(1)  	MOV			CRCT1,A
   535  000155   2D02(1)  	MOV			A,#0X02
   536  000156   1F05(1)  	MOV			TLC2,A
   537  000157             MOVE_DATA_TO_EEPROM:
   538  000157   C22C(2)  	CALL		I2C_START_EE
   539  000158   2DA0(1)  	MOV			A,#EEW_ADD
   540  000159   1F0A(1)  	MOV			DATA_IN,A
   541  00015A   C27D(2)  	CALL		EEADDRESS_ASK
   542  00015B   1E13(1)  	MOV			A,MAC_H
   543  00015C   1F0A(1)  	MOV			DATA_IN,A
   544  00015D   C27D(2)  	CALL		EEADDRESS_ASK
   545  00015E   1E11(1)  	MOV			A,CRCT2
   546  00015F   1F0A(1)  	MOV			DATA_IN,A
   547  000160   C27D(2)  	CALL		EEADDRESS_ASK
   548  000161   C2B4(2)  	CALL		DELAY_MINI
   549  000162   1E10(1)  	MOV			A,CRCT1
   550  000163   1F0A(1)  	MOV			DATA_IN,A
   551  000164   C27D(2)  	CALL		EEADDRESS_ASK
   552  000165   C232(2)  	CALL		I2C_END_EE
   553  000166             	
   554  000166   C2BF(2)  	CALL		DELAY_LONG
   555  000167   2D01(1)  	MOV			A,#0X01
   556  000168   1311(1)  	ADD			CRCT2,A
   557  000169   1E0D(1)  	MOV			A,DATAL
   558  00016A   1F10(1)  	MOV			CRCT1,A
   559  00016B   2605(1+S)  	DECMS		TLC2
   560  00016C   8157(2)  	JMP			MOVE_DATA_TO_EEPROM
   561  00016D             ;*********************************************
   562  00016D   60C2(1)  	B0BCLR		SCL_CONT
   563  00016E   0E00(2)  	RET
   564  00016F             ;**************************************
   565  00016F             PUT_DATA_INTO_TM_FUN:
   566  00016F   68C2(1)  	B0BSET	SCL_CONT
   567  000170   69C2(1)  	B0BSET	SDATA_CONT
   568  000171   61D2(1)  	B0BCLR	SDATA_IO
   569  000172   60D2(1)  	B0BCLR	SCL_IO
   570  000173   C2BF(2)  	CALL 	DELAY_LONG
   571  000174   C2BF(2)  	CALL 	DELAY_LONG
   572  000175   6CD5(1)  	B0BSET 	VTM_IO
   573  000176   C2BF(2)  	CALL 	DELAY_LONG
   574  000177             	;CALL	DELAY_LONG
   575  000177             START_TMI2C_S:
   576  000177   2D04(1)  	MOV 	A,#0X04
   577  000178   1F03(1)  	MOV 	TLC0,A
   578  000179             LOOP_1_S:
   579  000179   68D2(1)  	B0BSET 	SCL_IO
   580  00017A   C2B4(2)  	CALL	DELAY_MINI;13US
   581  00017B   C2B3(2)  	CALL	CALL_DELAY
   582  00017C   60D2(1)  	B0BCLR 	SCL_IO
   583  00017D   C2B4(2)  	CALL 	DELAY_MINI
   584  00017E   2603(1+S)  	DECMS  	TLC0
   585  00017F   8179(2)  	JMP 	LOOP_1_S
   586  000180   41D2(1)  	BCLR 	SDATA_IO
   587  000181   C2BF(2)  	CALL	DELAY_LONG
   588  000182   C2BF(2)  	CALL	DELAY_LONG
   589  000183   2D04(1)  	MOV 	A,#4
   590  000184   2F03(1)  	B0MOV 	TLC0,A
   591  000185             LOOP_2_S:
   592  000185   60D2(1)  	B0BCLR 	SCL_IO
   593  000186   C2B4(2)  	CALL	DELAY_MINI
   594  000187   C2B3(2)  	CALL	CALL_DELAY
   595  000188   68D2(1)  	B0BSET 	SCL_IO
   596  000189   C2B4(2)  	CALL	DELAY_MINI
   597  00018A   2603(1+S)  	DECMS 	TLC0
   598  00018B   8185(2)  	JMP 	LOOP_2_S
   599  00018C   C2B9(2)  	CALL	DELAY_SHORT
   600  00018D   2D14(1)  	MOV 	A,#20
   601  00018E   2F03(1)  	B0MOV 	TLC0,A
   602  00018F   49D2(1)  	BSET 	SDATA_IO
   603  000190             WAIT_TM_INIT_S:
   604  000190   C2BF(2)  	CALL 		DELAY_LONG
   605  000191   2603(1+S)  	DECMS 		TLC0
   606  000192   8190(2)  	JMP 		WAIT_TM_INIT_S
   607  000193             ;**************START*****************************
   608  000193   C239(2)  	CALL		I2C_START_TM
   609  000194             ;***********************************************
   610  000194   2D3C(1)  	MOV 		A,#TMW_ADD
   611  000195   1F0A(1)  	MOV 		DATA_IN,A
   612  000196   C247(2)  	CALL 		TMADDRESS_ASK
   613  000197   5507(1+S)  	BTS0		TM_I2C_EEROR
   614  000198   81AA(2)  	JMP			END_TM_S
   615  000199   2D2F(1)  	MOV 		A,#WRITE_TM_ADD_H
   616  00019A   1F0A(1)  	MOV 		DATA_IN,A
   617  00019B   C247(2)  	CALL 		TMADDRESS_ASK
   618  00019C   2D00(1)  	MOV 		A,#WRITE_TM_ADD_L
   619  00019D   1F0A(1)  	MOV 		DATA_IN,A
   620  00019E   C247(2)  	CALL 		TMADDRESS_ASK
   621  00019F   C2BF(2)  	CALL		DELAY_LONG
   622  0001A0   1E0C(1)  	MOV 		A,DATAH
   623  0001A1   1F0A(1)  	MOV 		DATA_IN,A
   624  0001A2   C247(2)  	CALL 		TMADDRESS_ASK
   625  0001A3   1E0D(1)  	MOV 		A,DATAL
   626  0001A4   1F0A(1)  	MOV 		DATA_IN,A
   627  0001A5   C247(2)  	CALL 		TMADDRESS_ASK
   628  0001A6   C2B9(2)  	CALL		DELAY_SHORT
   629  0001A7             ;**************END*******************************
   630  0001A7   C23F(2)  	CALL		I2C_END_TM
   631  0001A8   C2B9(2)  	CALL		DELAY_SHORT
   632  0001A9   61D2(1)  	B0BCLR		SDATA_IO
   633  0001AA             END_TM_S:
   634  0001AA   4507(1)  	BCLR		TM_I2C_EEROR
   635  0001AB   64D5(1)  	B0BCLR 		VTM_IO
   636  0001AC   61C2(1)  	B0BCLR		SDATA_CONT
   637  0001AD   60C2(1)  	B0BCLR		SCL_CONT
   638  0001AE   C2B9(2)  	CALL 		DELAY_SHORT
   639  0001AF   0E00(2)  	RET
   640  0001B0             ;*******************************************
   641  0001B0             ;*****************************************
   642  0001B0             GET_DATA_FROM_TM_FUN:
   643  0001B0   2D0F(1)  	MOV		A,#0X0F
   644  0001B1   1F12(1)  	MOV		COUNT,A
   645  0001B2             TM_I2C_WORK_LOOP:
   646  0001B2   68C2(1)  	B0BSET	SCL_CONT
   647  0001B3   69C2(1)  	B0BSET	SDATA_CONT
   648  0001B4   61D2(1)  	B0BCLR	SDATA_IO
   649  0001B5   60D2(1)  	B0BCLR	SCL_IO
   650  0001B6   C2BF(2)  	CALL 	DELAY_LONG
   651  0001B7   C2BF(2)  	CALL 	DELAY_LONG
   652  0001B8   6CD5(1)  	B0BSET 	VTM_IO
   653  0001B9   C2BF(2)  	CALL 	DELAY_LONG
   654  0001BA             	;CALL	DELAY_LONG
   655  0001BA             START_TMI2C:
   656  0001BA   2D04(1)  	MOV 	A,#0X04
   657  0001BB   1F03(1)  	MOV 	TLC0,A
   658  0001BC             LOOP_1:
   659  0001BC   68D2(1)  	B0BSET 	SCL_IO
   660  0001BD   C2B4(2)  	CALL	DELAY_MINI;13US
   661  0001BE   C2B3(2)  	CALL	CALL_DELAY
   662  0001BF   60D2(1)  	B0BCLR 	SCL_IO
   663  0001C0   C2B4(2)  	CALL 	DELAY_MINI
   664  0001C1   2603(1+S)  	DECMS  	TLC0
   665  0001C2   81BC(2)  	JMP 	LOOP_1
   666  0001C3   2D28(1)  	MOV 	A,#40
   667  0001C4   2F03(1)  	B0MOV 	TLC0,A
   668  0001C5   41D2(1)  	BCLR 	SDATA_IO
   669  0001C6   C2BF(2)  	CALL	DELAY_LONG
   670  0001C7             	;CALL	DELAY_SHORT
   671  0001C7   2D04(1)  	MOV 	A,#4
   672  0001C8   2F03(1)  	B0MOV 	TLC0,A
   673  0001C9             LOOP_2:
   674  0001C9   60D2(1)  	B0BCLR 	SCL_IO
   675  0001CA   C2B4(2)  	CALL	DELAY_MINI
   676  0001CB   C2B3(2)  	CALL	CALL_DELAY
   677  0001CC   68D2(1)  	B0BSET 	SCL_IO
   678  0001CD   C2B4(2)  	CALL	DELAY_MINI
   679  0001CE   2603(1+S)  	DECMS 	TLC0
   680  0001CF   81C9(2)  	JMP 	LOOP_2
   681  0001D0   C2B9(2)  	CALL	DELAY_SHORT
   682  0001D1   2D05(1)  	MOV 	A,#5
   683  0001D2   2F03(1)  	B0MOV 	TLC0,A
   684  0001D3   49D2(1)  	BSET 	SDATA_IO
   685  0001D4             WAIT_TM_INIT:
   686  0001D4   C2BF(2)  	CALL 		DELAY_LONG
   687  0001D5   2603(1+S)  	DECMS 		TLC0
   688  0001D6   81D4(2)  	JMP 		WAIT_TM_INIT
   689  0001D7             ;**************START*****************************
   690  0001D7   C239(2)  	CALL		I2C_START_TM
   691  0001D8             ;***********************************************
   692  0001D8   2D3D(1)  	MOV 		A,#TMR_ADD
   693  0001D9   1F0A(1)  	MOV 		DATA_IN,A
   694  0001DA   C247(2)  	CALL 		TMADDRESS_ASK
   695  0001DB   5507(1+S)  	BTS0		TM_I2C_EEROR
   696  0001DC   81FB(2)  	JMP			END_TM
   697  0001DD   1E13(1)  	MOV 		A,MAC_H
   698  0001DE   1F0A(1)  	MOV 		DATA_IN,A
   699  0001DF   C247(2)  	CALL 		TMADDRESS_ASK
   700  0001E0   1E14(1)  	MOV 		A,MAC_L
   701  0001E1   1F0A(1)  	MOV 		DATA_IN,A
   702  0001E2   C247(2)  	CALL 		TMADDRESS_ASK
   703  0001E3   61C2(1)  	B0BCLR		SDATA_CONT
   704  0001E4   C2BF(2)  	CALL 		DELAY_LONG
   705  0001E5   4706(1)  	BCLR 		ASK_FLAG
   706  0001E6   C261(2)  	CALL 		TMDATA_ASK
   707  0001E7   1E0B(1)  	MOV 		A,DATA_OUT
   708  0001E8   1F0C(1)  	MOV 		DATAH,A
   709  0001E9   4F06(1)  	BSET 		ASK_FLAG
   710  0001EA   C261(2)  	CALL 		TMDATA_ASK
   711  0001EB   1E0B(1)  	MOV 		A,DATA_OUT
   712  0001EC   1F0D(1)  	MOV 		DATAL,A		
   713  0001ED             ;**************END*******************************
   714  0001ED   C23F(2)  	CALL		I2C_END_TM
   715  0001EE   C2B9(2)  	CALL		DELAY_SHORT
   716  0001EF   61D2(1)  	B0BCLR		SDATA_IO
   717  0001F0   2612(1+S)  	DECMS		COUNT
   718  0001F1   81F3(2)  	JMP			$+2
   719  0001F2   81FB(2)  	JMP			END_TM
   720  0001F3   64D5(1)  	B0BCLR 		VTM_IO
   721  0001F4   2D00(1)  	MOV			A,#0X00
   722  0001F5   070C(1+S)  	CMPRS		A,DATAH
   723  0001F6   81FA(2)  	JMP			$+4
   724  0001F7   070D(1+S)  	CMPRS		A,DATAL
   725  0001F8   81FA(2)  	JMP			$+2
   726  0001F9   81B2(2)  	JMP			TM_I2C_WORK_LOOP
   727  0001FA   4907(1)  	BSET		READ_LED_FLAG
   728  0001FB             END_TM:
   729  0001FB   4507(1)  	BCLR		TM_I2C_EEROR
   730  0001FC   64D5(1)  	B0BCLR 		VTM_IO
   731  0001FD   61C2(1)  	B0BCLR		SDATA_CONT
   732  0001FE   60C2(1)  	B0BCLR		SCL_CONT
   733  0001FF   C2B9(2)  	CALL 		DELAY_SHORT
   734  000200   0E00(2)  	RET
   735  000201             ;*******************************************
   736  000201             ;***********************************************************
   737  000201             ;*********************************************************
   738  000201             GET_DATA_FROM_EE_FUN:
   739  000201   68C2(1)  	B0BSET		SCL_CONT
   740  000202   6DC2(1)  	B0BSET		SDA_CONT
   741  000203   6DD2(1)  	B0BSET		SDA_IO
   742  000204   68D2(1)  	B0BSET		SCL_IO
   743  000205   C2B9(2)  	CALL		DELAY_SHORT
   744  000206   C22C(2)  	CALL		I2C_START_EE
   745  000207   2DA0(1)  	MOV			A,#EEW_ADD
   746  000208   1F0A(1)  	MOV			DATA_IN,A
   747  000209   C27D(2)  	CALL		EEADDRESS_ASK
   748  00020A   1E13(1)  	MOV			A,MAC_H
   749  00020B   1F0A(1)  	MOV			DATA_IN,A
   750  00020C   C27D(2)  	CALL		EEADDRESS_ASK
   751  00020D   1E14(1)  	MOV			A,MAC_L
   752  00020E   1F0A(1)  	MOV			DATA_IN,A
   753  00020F   C27D(2)  	CALL		EEADDRESS_ASK
   754  000210   6DD2(1)  	B0BSET		SDA_IO
   755  000211   C2B9(2)  	CALL		DELAY_SHORT
   756  000212   68D2(1)  	B0BSET		SCL_IO
   757  000213   C2B9(2)  	CALL		DELAY_SHORT
   758  000214   C22C(2)  	CALL		I2C_START_EE
   759  000215   C2B9(2)  	CALL		DELAY_SHORT
   760  000216   2DA1(1)  	MOV			A,#EER_ADD
   761  000217   1F0A(1)  	MOV			DATA_IN,A
   762  000218   C27D(2)  	CALL		EEADDRESS_ASK
   763  000219   65C2(1)  	B0BCLR		SDA_CONT
   764  00021A   4706(1)  	BCLR		ASK_FLAG
   765  00021B   C297(2)  	CALL		EEDATA_ASK
   766  00021C   1E0B(1)  	MOV			A,DATA_OUT
   767  00021D   1F0E(1)  	MOV			ADDRESSH,A
   768  00021E   65C2(1)  	B0BCLR		SDA_CONT
   769  00021F   C2B4(2)  	CALL		DELAY_MINI
   770  000220   4F06(1)  	BSET		ASK_FLAG
   771  000221   C297(2)  	CALL		EEDATA_ASK
   772  000222   1E0B(1)  	MOV			A,DATA_OUT
   773  000223   1F0F(1)  	MOV			ADDRESSL,A
   774  000224   C232(2)  	CALL		I2C_END_EE
   775  000225             ;*************************************
   776  000225   C2B9(2)  	CALL		DELAY_SHORT
   777  000226   60C2(1)  	B0BCLR		SCL_CONT
   778  000227   0E00(2)  	RET
   779  000228             ;************************************************
   780  000228             I2C_EEROR:
   781  000228             	;open interrupt
   782  000228             	;SleepMode
   783  000228   4606(1)  	BCLR	I2CERROR_FLAG
   784  000229   54D5(1+S)  	BTS0	VTM_IO
   785  00022A   4D07(1)  	BSET	TM_I2C_EEROR
   786  00022B   0E00(2)  	RET
   787  00022C             I2C_START_EE:
   788  00022C   C2B4(2)  	CALL		DELAY_MINI
   789  00022D   65D2(1)  	B0BCLR 		SDA_IO
   790  00022E   C2B4(2)  	CALL 		DELAY_MINI
   791  00022F   60D2(1)  	B0BCLR 		SCL_IO
   792  000230   C2B4(2)  	CALL 		DELAY_MINI
   793  000231   0E00(2)  	RET
   794  000232             I2C_END_EE:
   795  000232   65D2(1)  	B0BCLR 		SDA_IO
   796  000233   C2B4(2)  	CALL 		DELAY_MINI
   797  000234   68D2(1)  	B0BSET 		SCL_IO
   798  000235   C2B4(2)  	CALL 		DELAY_MINI
   799  000236   6DD2(1)  	B0BSET 		SDA_IO
   800  000237   C2B4(2)  	CALL		DELAY_MINI
   801  000238   0E00(2)  	RET
   802  000239             I2C_START_TM:
   803  000239   C2B4(2)  	CALL		DELAY_MINI
   804  00023A   61D2(1)  	B0BCLR 		SDATA_IO
   805  00023B   C2B4(2)  	CALL 		DELAY_MINI
   806  00023C   60D2(1)  	B0BCLR 		SCL_IO
   807  00023D   C2B4(2)  	CALL 		DELAY_MINI
   808  00023E   0E00(2)  	RET
   809  00023F             I2C_END_TM:
   810  00023F   61D2(1)  	B0BCLR 		SDATA_IO
   811  000240   C2B4(2)  	CALL 		DELAY_MINI
   812  000241   60D2(1)  	B0BCLR		SCL_IO
   813  000242   C2B4(2)  	CALL		DELAY_MINI
   814  000243   69D2(1)  	B0BSET 		SDATA_IO
   815  000244   C2B4(2)  	CALL		DELAY_MINI
   816  000245   68D2(1)  	B0BSET 		SCL_IO
   817  000246   0E00(2)  	RET
   818  000247             TMADDRESS_ASK:
   819  000247   2D08(1)  	MOV 		A,#8
   820  000248   1F02(1)  	MOV 		TIMEOUT,A
   821  000249             TMADDRESS_LOOP:
   822  000249   570A(1+S)  	BTS0		DATA_IN.7
   823  00024A   824E(2)  	JMP 		MD_1
   824  00024B   71D2(1+S)  	B0BTS0 		SDATA_IO
   825  00024C   61D2(1)  	B0BCLR		SDATA_IO
   826  00024D   8250(2)  	JMP 		NEXT_1
   827  00024E             MD_1:
   828  00024E   79D2(1+S)  	B0BTS1 		SDATA_IO
   829  00024F   69D2(1)  	B0BSET		SDATA_IO
   830  000250             NEXT_1:
   831  000250   C2B4(2)  	CALL		DELAY_MINI
   832  000251   68D2(1)  	B0BSET 		SCL_IO
   833  000252   C2B4(2)  	CALL		DELAY_MINI
   834  000253   0B0A(1)  	RLCM 		DATA_IN
   835  000254   60D2(1)  	B0BCLR 		SCL_IO
   836  000255   2602(1+S)  	DECMS 		TIMEOUT
   837  000256   8249(2)  	JMP 		TMADDRESS_LOOP
   838  000257             	
   839  000257   61C2(1)  	B0BCLR 		SDATA_CONT
   840  000258   C2B4(2)  	CALL		DELAY_MINI
   841  000259   68D2(1)  	B0BSET 		SCL_IO
   842  00025A   C2B3(2)  	CALL 		CALL_DELAY
   843  00025B   71D2(1+S)  	B0BTS0 		SDATA_IO
   844  00025C   C228(2)  	CALL		I2C_EEROR
   845  00025D   C2B4(2)  	CALL		DELAY_MINI
   846  00025E   40D2(1)  	BCLR 		SCL_IO
   847  00025F   49C2(1)  	BSET 		SDATA_CONT
   848  000260   0E00(2)  	RET
   849  000261             ;**********************TM_READING_DATA********************************
   850  000261             TMDATA_ASK:
   851  000261   61C2(1)  	B0BCLR 		SDATA_CONT
   852  000262   2D08(1)  	MOV 		A,#8
   853  000263   1F02(1)  	MOV 		TIMEOUT,A
   854  000264             TMDATA_LOOP:
   855  000264   2D09(1)  	MOV 		A,#9
   856  000265   1F03(1)  	MOV 		TLC0,A
   857  000266   C2B4(2)  	CALL		DELAY_MINI
   858  000267   48D2(1)  	BSET 		SCL_IO
   859  000268   C2B3(2)  	CALL 		CALL_DELAY
   860  000269   71D2(1+S)  	B0BTS0 		SDATA_IO
   861  00026A   480B(1)  	BSET 		DATA_OUT.0
   862  00026B   79D2(1+S)  	B0BTS1 		SDATA_IO
   863  00026C   400B(1)  	BCLR 		DATA_OUT.0
   864  00026D   0B0B(1)  	RLCM 		DATA_OUT
   865  00026E   C2B4(2)  	CALL		DELAY_MINI
   866  00026F   60D2(1)  	B0BCLR 		SCL_IO
   867  000270   2602(1+S)  	DECMS 		TIMEOUT
   868  000271   8264(2)  	JMP 		TMDATA_LOOP
   869  000272   69C2(1)  	B0BSET 		SDATA_CONT
   870  000273   5706(1+S)  	BTS0 		ASK_FLAG
   871  000274   69D2(1)  	B0BSET 		SDATA_IO
   872  000275   5F06(1+S)  	BTS1 		ASK_FLAG
   873  000276   61D2(1)  	B0BCLR 		SDATA_IO
   874  000277   090B(1)  	RRCM 		DATA_OUT
   875  000278   C2B4(2)  	CALL		DELAY_MINI
   876  000279   48D2(1)  	BSET 		SCL_IO
   877  00027A   C2B4(2)  	CALL		DELAY_MINI
   878  00027B   40D2(1)  	BCLR		SCL_IO	
   879  00027C   0E00(2)  	RET
   880  00027D             ;******************************************************
   881  00027D             EEADDRESS_ASK:
   882  00027D   2D08(1)  	MOV 		A,#8
   883  00027E   1F02(1)  	MOV 		TIMEOUT,A
   884  00027F             EEADDRESS_LOOP:
   885  00027F   570A(1+S)  	BTS0		DATA_IN.7
   886  000280   8284(2)  	JMP 		EEMD_1
   887  000281   75D2(1+S)  	B0BTS0 		SDA_IO
   888  000282   65D2(1)  	B0BCLR		SDA_IO
   889  000283   8286(2)  	JMP 		EENEXT_1
   890  000284             EEMD_1:
   891  000284   7DD2(1+S)  	B0BTS1 		SDA_IO
   892  000285   6DD2(1)  	B0BSET		SDA_IO
   893  000286             EENEXT_1:
   894  000286   C2B4(2)  	CALL		DELAY_MINI
   895  000287   68D2(1)  	B0BSET 		SCL_IO
   896  000288   C2B4(2)  	CALL		DELAY_MINI
   897  000289   0B0A(1)  	RLCM 		DATA_IN
   898  00028A   60D2(1)  	B0BCLR 		SCL_IO
   899  00028B   2602(1+S)  	DECMS 		TIMEOUT
   900  00028C   827F(2)  	JMP 		EEADDRESS_LOOP
   901  00028D             	
   902  00028D   65C2(1)  	B0BCLR 		SDA_CONT
   903  00028E   C2B4(2)  	CALL		DELAY_MINI
   904  00028F   68D2(1)  	B0BSET 		SCL_IO
   905  000290   C2B3(2)  	CALL 		CALL_DELAY
   906  000291   75D2(1+S)  	B0BTS0 		SDA_IO
   907  000292   C228(2)  	CALL		I2C_EEROR
   908  000293   C2B4(2)  	CALL		DELAY_MINI
   909  000294   40D2(1)  	BCLR 		SCL_IO
   910  000295   4DC2(1)  	BSET 		SDA_CONT
   911  000296   0E00(2)  	RET
   912  000297             ;****************************************
   913  000297             EEDATA_ASK:
   914  000297   65C2(1)  	B0BCLR 		SDA_CONT
   915  000298   2D08(1)  	MOV 		A,#8
   916  000299   1F02(1)  	MOV 		TIMEOUT,A
   917  00029A             EEDATA_LOOP:
   918  00029A   2D09(1)  	MOV 		A,#9
   919  00029B   1F03(1)  	MOV 		TLC0,A
   920  00029C   C2B4(2)  	CALL		DELAY_MINI
   921  00029D   48D2(1)  	BSET 		SCL_IO
   922  00029E   C2B3(2)  	CALL 		CALL_DELAY
   923  00029F   75D2(1+S)  	B0BTS0 		SDA_IO
   924  0002A0   480B(1)  	BSET 		DATA_OUT.0
   925  0002A1   7DD2(1+S)  	B0BTS1 		SDA_IO
   926  0002A2   400B(1)  	BCLR 		DATA_OUT.0
   927  0002A3   0B0B(1)  	RLCM 		DATA_OUT
   928  0002A4   C2B4(2)  	CALL		DELAY_MINI
   929  0002A5   60D2(1)  	B0BCLR 		SCL_IO
   930  0002A6   2602(1+S)  	DECMS 		TIMEOUT
   931  0002A7   829A(2)  	JMP 		EEDATA_LOOP
   932  0002A8             	
   933  0002A8   6DC2(1)  	B0BSET 		SDA_CONT
   934  0002A9   5706(1+S)  	BTS0 		ASK_FLAG
   935  0002AA   6DD2(1)  	B0BSET 		SDA_IO
   936  0002AB   5F06(1+S)  	BTS1 		ASK_FLAG
   937  0002AC   65D2(1)  	B0BCLR 		SDA_IO
   938  0002AD   090B(1)  	RRCM 		DATA_OUT
   939  0002AE   C2B4(2)  	CALL		DELAY_MINI
   940  0002AF   48D2(1)  	BSET 		SCL_IO
   941  0002B0   C2B4(2)  	CALL		DELAY_MINI
   942  0002B1   40D2(1)  	BCLR		SCL_IO	
   943  0002B2   0E00(2)  	RET
   944  0002B3             ;*********************delay*****************
   945  0002B3             CALL_DELAY:
   946  0002B3   0E00(2)  	RET
   947  0002B4             DELAY_MINI:;13US
   948  0002B4   2D05(1)  	MOV		A,#0X05
   949  0002B5   1F00(1)  	MOV		DELAYTIME1,A
   950  0002B6             DELAY0:
   951  0002B6   2600(1+S)  	DECMS	DELAYTIME1
   952  0002B7   82B6(2)  	JMP		DELAY0
   953  0002B8   0E00(2)  	RET
   954  0002B9             	
   955  0002B9             DELAY_SHORT:		;50US FOR 0.5US/INSTRUCTION
   956  0002B9   2D63(1)  	MOV		A,#0X63
   957  0002BA   1F00(1)  	MOV		DELAYTIME1,A
   958  0002BB             DELAY1:
   959  0002BB   0000(1)  	NOP
   960  0002BC   2600(1+S)  	DECMS	DELAYTIME1
   961  0002BD   82BB(2)  	JMP		DELAY1
   962  0002BE   0E00(2)  	RET
   963  0002BF             DELAY_LONG:	;>=5MS
   964  0002BF             ;WAIT_FOR_A_LONG_WHILE
   965  0002BF   2D0A(1)  	MOV		A,#0X0A
   966  0002C0   2F00(1)  	B0MOV	DELAYTIME1,A
   967  0002C1             DELAY2_1:
   968  0002C1   2DC7(1)  	MOV		A,#0XC7
   969  0002C2   1F01(1)  	MOV		DELAYTIME2,A
   970  0002C3             DELAY2_2:
   971  0002C3   0000(1)  	NOP
   972  0002C4   2601(1+S)  	DECMS	DELAYTIME2
   973  0002C5   82C3(2)  	JMP		DELAY2_2	
   974  0002C6   2600(1+S)  	DECMS	DELAYTIME1
   975  0002C7   82C1(2)  	JMP		DELAY2_1
   976  0002C8   0E00(2)  	RET		
   977  0002C9             DELAY_LED:		;0.2S
   978  0002C9             ;WAIT_FOR_DEEP_DARK_FANTASY
   979  0002C9   2DFF(1)  	MOV		A,#0XFF
   980  0002CA   1F01(1)  	MOV		DELAYTIME2,A
   981  0002CB             DELAY3_1:
   982  0002CB   2DFF(1)  	MOV		A,#0XFF
   983  0002CC   1F00(1)  	MOV		DELAYTIME1,A
   984  0002CD             DELAY3_2:
   985  0002CD   0000(1)  	NOP
   986  0002CE   0000(1)  	NOP
   987  0002CF   2600(1+S)  	DECMS		DELAYTIME1
   988  0002D0   82CD(2)  	JMP			DELAY3_2
   989  0002D1   2601(1+S)  	DECMS		DELAYTIME2
   990  0002D2   82CB(2)  	JMP			DELAY3_1
   991  0002D3   0E00(2)  	RET
   992  0002D4             OPEN_TC0_INT_FUN:
   993  0002D4   6BDA(1)  	B0BSET	FTC0CKS	;	OUTSIDE INPUT ACCIDENT
   994  0002D5   6ADA(1)  	B0BSET	FALOAD0 ;
   995  0002D6   2DFD(1)  	MOV		A,#0XFD
   996  0002D7   2FCD(1)  	B0MOV	TC0R,A
   997  0002D8   2FDB(1)  	B0MOV	TC0C,A
   998  0002D9   65C8(1)  	B0BCLR	FTC0IRQ
   999  0002DA   6DC9(1)  	B0BSET	FTC0IEN
  1000  0002DB   6FDA(1)  	B0BSET	FTC0ENB
  1001  0002DC   0E00(2)  	RET
  1002  0002DD             SYS_INIT_FUN:
  1003  0002DD   2D3D(1)  	MOV			A,#0X3D
  1004  0002DE   2FC2(1)  	B0MOV		P2M,A
  1005  0002DF   2D35(1)  	MOV			A,#0X35
  1006  0002E0   2FD2(1)  	B0MOV		P2,A
  1007  0002E1             	;up resistor for p2.1
  1008  0002E1             	;MOV			A,#0X02
  1009  0002E1             	;B0MOV		P2UR,A
  1010  0002E1   2D01(1)  	MOV			A,#0X01
  1011  0002E2   2FC1(1)  	B0MOV		P1M,A
  1012  0002E3   2BD1(1)  	CLR			P1
  1013  0002E4   68B8(1)  	B0BSET		VSR_CONT
  1014  0002E5   60D0(1)  	B0BCLR		VSR_IO
  1015  0002E6   68C1(1)  	B0BSET		S_VDD_VCC_CONT
  1016  0002E7   60D1(1)  	B0BCLR		S_VDD_VCC_IO
  1017  0002E8   6CC5(1)  	B0BSET		VTM_CONT
  1018  0002E9   64D5(1)  	B0BCLR		VTM_IO
  1019  0002EA   2D03(1)  	MOV			A,#0X03
  1020  0002EB   1F10(1)  	MOV			CRCT1,A
  1021  0002EC             SYS_INIT_LED:
  1022  0002EC   62D2(1)  	B0BCLR		CLED_IO
  1023  0002ED   C2C9(2)  	CALL		DELAY_LED	
  1024  0002EE   6AD2(1)  	B0BSET		CLED_IO
  1025  0002EF   C2C9(2)  	CALL		DELAY_LED
  1026  0002F0   2610(1+S)  	DECMS		CRCT1
  1027  0002F1   82EC(2)  	JMP			SYS_INIT_LED
  1028  0002F2             ;************T0_INIT_START************************************
  1029  0002F2   2D00(1)  	MOV			A,#0X00
  1030  0002F3   2FD8(1)  	B0MOV		T0M,A	
  1031  0002F4   68D8(1)  	B0BSET		FT0TB	; T0 = Fcpu/256,PERIOD TIME IS 2S
  1032  0002F5   2BD9(1)  	CLR			T0C
  1033  0002F6   64C8(1)  	B0BCLR		FT0IRQ
  1034  0002F7   6CC9(1)  	B0BSET		FT0IEN
  1035  0002F8   6FD8(1)  	B0BSET		FT0ENB
  1036  0002F9             ;*****************TC0_INIT_START*****************
  1037  0002F9   2BDA(1)  	CLR			TC0M
  1038  0002FA   2BDB(1)  	CLR			TC0C
  1039  0002FB   65C8(1)  	B0BCLR		FTC0IRQ
  1040  0002FC   65C9(1)  	B0BCLR		FTC0IEN
  1041  0002FD   67DA(1)  	B0BCLR		FTC0ENB
  1042  0002FE             ;************************OPEN P1.1WEEK UP FUNCTION*********************
  1043  0002FE   2D02(1)  	MOV			A,#0X02
  1044  0002FF   2FC0(1)  	B0MOV		P1W,A
  1045  000300   C2B4(2)  	CALL		DELAY_MINI
  1046  000301   0E00(2)  	RET
  1047  000302             ;//////////////////////////////////////////////////
  1048  000302             SET_EE_TM_FUN:
  1049  000302   65C2(1)  	B0BCLR		SDA_CONT
  1050  000303   64C5(1)  	B0BCLR		VTM_CONT
  1051  000304   60C2(1)  	B0BCLR		SCL_CONT
  1052  000305   61C2(1)  	B0BCLR		SDATA_CONT
  1053  000306   68D0(1)  	B0BSET		VSR_IO
  1054  000307   6BD2(1)  	B0BSET		S_TM_EE_IO
  1055  000308   4A06(1)  	BSET		TM_EE_FLAG
  1056  000309   64D2(1)  	B0BCLR	IC_IDLE
  1057  00030A   4407(1)  	BCLR	NOT_QUICK_MODE_FLAG
  1058  00030B   0E00(2)  	RET
  1059  00030C             ;////////////////////////////////////////
  1060  00030C             ;////////////SET LOW POWER
  1061  00030C             SET_LOW_POWER_FUN:
  1062  00030C             ;****************************************
  1063  00030C   64C5(1)  	B0BCLR		VTM_CONT
  1064  00030D   63D2(1)  	B0BCLR		S_TM_EE_IO
  1065  00030E   60D0(1)  	B0BCLR		VSR_IO
  1066  00030F   4206(1)  	BCLR		TM_EE_FLAG
  1067  000310   6CD2(1)  	B0BSET	IC_IDLE
  1068  000311   0E00(2)  	RET
  1069  000312             ;/////////////////////////////////////////	
  1070  000312             WAIT_FOR_SEAVAL_MINITE_FUN:
  1071  000312   1E15(1)  	MOV   	A,FRONT_DELAY
  1072  000313   1F10(1)  	MOV		CRCT1,A
  1073  000314             	GreenMode
  1074  000314   6CCA(1)  		B0BSET	FCPUM1
  1075  000315   0000(1)  		NOP
  1076  000316   0000(1)  		NOP
  1077  000317   5407(1+S)  	BTS0	NOT_QUICK_MODE_FLAG
  1078  000318   C302(2)  	CALL	SET_EE_TM_FUN
  1079  000319   5207(1+S)  	BTS0	NOT_UPLOAD_FLAG
  1080  00031A   C30C(2)  	CALL	SET_LOW_POWER_FUN
  1081  00031B   5B06(1+S)  	BTS1	TIME_FLAG
  1082  00031C   8316(2)  	JMP		$-6
  1083  00031D   4306(1)  	BCLR	TIME_FLAG
  1084  00031E   2610(1+S)  	DECMS	CRCT1
  1085  00031F   8316(2)  	JMP		$-9
  1086  000320   0E00(2)  	RET
  1087  000321             ;*******************************************
  1088  000321             	ENDP
