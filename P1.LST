     1  000000             CHIP		SN8P2501D
     2  000000             //{{SONIX_CODE_OPTION
     3  000000             	.Code_Option	Noise_Filter	Enable
     4  000000             	.Code_Option	Reset_Pin	P11
     5  000000             	.Code_Option	Watch_Dog	Disable
     6  000000             	.Code_Option	High_Clk	IHRC_RTC	;
     7  000000             	.Code_Option	Fcpu		#3     ; Fcpu = Fosc/8
     8  000000             	.Code_Option	Security	Enable
     9  000000             	.Code_Option	LVD		LVD_L		;
    10  000000             //}}SONIX_CODE_OPTION
    11  000000             
    12  E 0000002F         	END_RAM_ADDR	EQU	0X2F
    13  E 000000A1         	EER_ADD			EQU	0XA1	;10100001B
    14  E 000000A0         	EEW_ADD			EQU	0XA0	;10100000B
    15  E 00000030         	RAM_COUNT		EQU	48
    16  E 00000034         	TM_DATA_H		EQU	0X34	;ADDR OF THE TEMPEATURE	OF TM
    17  E 00000000         	TM_DATA_L		EQU	0X00
    18  E 00000078         	TIME_GAP		EQU	0X78	;0X78
    19  E 00000001         	T0_TDR			EQU	0X01
    20  E 0000003D         	TMR_ADD 		EQU	0X3D
    21  E 0000003C         	TMW_ADD			EQU	0X3C
    22  E 0000001F         	MAX_MEMH		EQU	0X1F
    23  E 000000F0         	MAX_MEML		EQU	0XF0
    24  E 0000001F         	LAST_TIME_EE_ADD_H EQU 0X1F
    25  E 000000FE         	LAST_TIME_EE_ADD_L EQU 0XFE
    26  E 0000001F         	LIVE_TIME_ADD_H		EQU	0X1F
    27  E 000000FC         	LIVE_TIME_ADD_L		EQU	0XFC
    28  E 00000001         	DEFAULT_FRONT_TIME_DELAY	EQU	0X01
    29  E 00000001         	DEFAULT_TIME_GAP	EQU	0X01
    30  E 0000002E         	TM_TIME_H		EQU	0X2E
    31  E 00000000         	TM_TIME_L		EQU	0X00
    32  E 0000002F         	WRITE_TM_ADD_H	EQU	0X2F
    33  E 00000000         	WRITE_TM_ADD_L	EQU	0X00
    34  E 00000001         	WRITE_FLAG_H	EQU 0X01
    35  E 00000000         	WRITE_FLAG_L	EQU	0X00
    36  E 00000002         	DEFAULT_GAP_TIME_FLAGH EQU 0X02
    37  E 00000000         	DEFAULT_GAP_TIME_FLAGL EQU	0X00
    38  000000             .DATA
    39  000000             			ORG	0H
    40  0000 D             	DELAYTIME1	DS	1
    41  0001 D             	DELAYTIME2	DS	1
    42  0002 D             	TIMEOUT		DS	1
    43  0003 D             	TLC0		DS	1
    44  0004 D             	TLC1		DS	1
    45  0005 D             	TLC2		DS	1
    46  0006 D             	FLAG1		DS	1
    47  0007 D             	FLAG2		DS	1
    48  0008 D             	TIMEH		DS	1
    49  0009 D             	TIMEG		DS	1
    50  000A D             	DATA_IN		DS	1
    51  000B D             	DATA_OUT	DS	1
    52  000C D             	DATAH		DS	1
    53  000D D             	DATAL		DS	1
    54  000E D             	ADDRESSH	DS	1
    55  000F D             	ADDRESSL	DS	1
    56  0010 D             	CRCT1		DS	1
    57  0011 D             	CRCT2		DS	1
    58  0012 D             	COUNT		DS	1
    59  0013 D             	MAC_H		DS	1
    60  0014 D             	MAC_L		DS	1
    61  0015 D             	FRONT_DELAY	DS	1
    62  0016 D             	TIME_DELAY_GAP	DS	1
    63  0017 D             	STARTADDRH		DS	1
    64  0018 D             	STARTADDRL		DS	1
    65  000019             ;**************BIT_VARIABLES_DEFINNITIONS*******
    66  E 00000006         	READTM_FLAG	EQU	FLAG1.0
    67  E 00030006         	TIME_FLAG	EQU	FLAG1.3
    68  E 00010006         	RESET_FLAG	EQU	FLAG1.1
    69  E 00020006         	TM_EE_FLAG	EQU FLAG1.2
    70  E 00040006         	DEFAULT_GAP_FLAG	EQU	FLAG1.4
    71  E 00050006         	FILLOUT_FLAG	EQU	FLAG1.5
    72  E 00060006         	I2CERROR_FLAG	EQU	FLAG1.6
    73  E 00070006         	ASK_FLAG	EQU	FLAG1.7
    74  E 00010007         	READ_LED_FLAG	EQU	FLAG2.1
    75  E 00020007         	NOT_UPLOAD_FLAG	EQU	FLAG2.2
    76  E 00030007         	HAVE_UPLOAD_FLAG EQU FLAG2.3
    77  E 00050007         	TM_I2C_EEROR	EQU FLAG2.5
    78  E 000200D2         	CLED_IO			EQU	P2.2
    79  E 000100D2         	SDATA_IO		EQU	P2.1
    80  E 000000D2         	SCL_IO			EQU	P2.0
    81  E 000300D2         	S_TM_EE_IO		EQU	P2.3
    82  E 000400D2         	PUSH_V_SENSOR_GND	EQU	P2.4
    83  E 000500D2         	SDA_IO			EQU	P2.5
    84  E 000400D5         	VTM_IO			EQU	P5.4
    85  E 000000D0         	VSR_IO			EQU	P0.0
    86  E 000200C2         	CLED_CONT		EQU	P2M.2
    87  E 000100C2         	SDATA_CONT		EQU	P2M.1
    88  E 000000C2         	SCL_CONT		EQU	P2M.0
    89  E 000300C2         	S_TM_EE_CONT	EQU	P2M.3
    90  E 000500C2         	SDA_CONT		EQU	P2M.5
    91  E 000400C5         	VTM_CONT		EQU	P5M.4
    92  E 000000B8         	VSR_CONT		EQU	P0M.0
    93  000019             ;***************************************
    94  E 000100D1         	VDDF			EQU	P1.1
    95  E 000000D1         	S_VDD_VCC_IO		EQU	P1.0
    96  E 000000C1         	S_VDD_VCC_CONT		EQU	P1M.0
    97  000019             ;*************CODE_SECTION**********************	
    98  000000             .CODE
    99  000000             
   100  000000             		ORG	0
   101  000000   802A(2)  	JMP		START
   102  000008             		ORG	8H
   103  000008   8009(2)  	JMP		INT_SERVICE
   104  000009             INT_SERVICE:
   105  000009             ;KEEP ACC AND PFLAG
   106  000009   0400(1)  	PUSH
   107  00000A             ;T0 INTERRUPT
   108  00000A             JUST_T0:
   109  00000A   74C9(1+S)  	B0BTS0	FT0IEN
   110  00000B   7CC8(1+S)  	B0BTS1	FT0IRQ
   111  00000C   801F(2)  	JMP		JUST_TC0
   112  00000D   64C8(1)  	B0BCLR	FT0IRQ
   113  00000E             ;T0 INTERRUPT SERVISE PROGRESS
   114  00000E   51D1(1+S)  	BTS0	VDDF
   115  00000F   4A07(1)  	BSET 	NOT_UPLOAD_FLAG
   116  000010   59D1(1+S)  	BTS1	VDDF
   117  000011   4B07(1)  	BSET    HAVE_UPLOAD_FLAG
   118  000012   1608(1+S)  	INCMS	TIMEH ;TIMEH=TIMEH+1,
   119  000013   2D78(1)  	MOV		A,#TIME_GAP
   120  000014   0708(1+S)  	CMPRS	A,TIMEH
   121  000015   8028(2)  	JMP		EXIT_INT
   122  000016   2B08(1)  	CLR		TIMEH
   123  000017   4B06(1)  	BSET	TIME_FLAG
   124  000018   1609(1+S)  	INCMS	TIMEG
   125  000019   1E16(1)  	MOV		A,TIME_DELAY_GAP
   126  00001A   0709(1+S)  	CMPRS	A,TIMEG
   127  00001B   8028(2)  	JMP		EXIT_INT
   128  00001C   2B09(1)  	CLR		TIMEG
   129  00001D   4806(1)  	BSET	READTM_FLAG
   130  00001E   8028(2)  	JMP		EXIT_INT
   131  00001F             JUST_TC0:
   132  00001F   75C9(1+S)  	B0BTS0	FTC0IEN
   133  000020   7DC8(1+S)  	B0BTS1	FTC0IRQ
   134  000021   8024(2)  	JMP		JUST_INT0
   135  000022   65C8(1)  	B0BCLR	FTC0IRQ
   136  000023             ;TC0 INTERRUPT SERVICE PROGRESS
   137  000023   8028(2)  	JMP		EXIT_INT
   138  000024             JUST_INT0:
   139  000024   70C9(1+S)  	B0BTS0	FP00IEN
   140  000025   78C8(1+S)  	B0BTS1	FP00IRQ
   141  000026   8028(2)  	JMP EXIT_INT
   142  000027   60C8(1)  	B0BCLR	FP00IRQ
   143  000028             ;INT0 INTERRUPT SERVISE PROGRESS
   144  000028             EXIT_INT:
   145  000028   0500(1)  	POP
   146  000029   0F00(2)  	RETI
   147  00002A             ;*********************************************************
   148  00002A             ;***********************STARRT**********************
   149  00002A             START:
   150  00002A   2D7F(1)  	MOV		A,#07FH
   151  00002B   2FDF(1)  	B0MOV		STKP,A		;DISABLE GLOBAL INTERRUPT
   152  00002C   2B86(1)  	CLR		PFLAG
   153  00002D   2D00(1)  	MOV		A,#00H
   154  00002E   2FCA(1)  	B0MOV		OSCM,A
   155  00002F   2D5A(1)  	MOV		A,#0X5A
   156  000030   2FCC(1)  	B0MOV		WDTR,A	
   157  000031   C13A(2)  	CALL		CLRRAM
   158  000032             STATE_INITIAL:
   159  000032   C2D2(2)  	CALL		SYS_INIT_FUN
   160  000033   67DF(1)  	B0BCLR		FGIE
   161  000034             GET_TIME_GAP:
   162  000034             ;******************************************
   163  000034   2D01(1)  	MOV		A,#DEFAULT_FRONT_TIME_DELAY
   164  000035   1F15(1)  	MOV		FRONT_DELAY,A
   165  000036   2D01(1)  	MOV		A,#DEFAULT_TIME_GAP
   166  000037   1F16(1)  	MOV		TIME_DELAY_GAP,A
   167  000038   6BD2(1)  	B0BSET	S_TM_EE_IO
   168  000039   6CD2(1)  	B0BSET	PUSH_V_SENSOR_GND
   169  00003A   2D2E(1)  	MOV		A,#TM_TIME_H
   170  00003B   1F13(1)  	MOV		MAC_H,A
   171  00003C   2D00(1)  	MOV		A,#TM_TIME_L
   172  00003D   1F14(1)  	MOV		MAC_L,A
   173  00003E   C1A5(2)  	CALL	GET_DATA_FROM_TM_FUN
   174  00003F   1E0C(1)  	MOV			A,DATAH
   175  000040   0600(1+S)  	CMPRS		A,#0X00
   176  000041   1F15(1)  	MOV			FRONT_DELAY,A
   177  000042   1E0D(1)  	MOV			A,DATAL
   178  000043   0600(1+S)  	CMPRS		A,#0X00
   179  000044   1F16(1)  	MOV			TIME_DELAY_GAP,A		
   180  000045   63D2(1)  	B0BCLR		S_TM_EE_IO
   181  000046   C2B4(2)  	CALL		DELAY_LONG
   182  000047             ;*******************************************
   183  000047             WRITE_FLAG_TO_TM:
   184  000047   6BD2(1)  	B0BSET		S_TM_EE_IO
   185  000048   2D01(1)  	MOV			A,#WRITE_FLAG_H
   186  000049   1F0C(1)  	MOV			DATAH,A
   187  00004A   2D00(1)  	MOV			A,#WRITE_FLAG_L
   188  00004B   1F0D(1)  	MOV			DATAL,A
   189  00004C   5107(1+S)  	BTS0		READ_LED_FLAG
   190  00004D   8052(2)  	JMP			$+5
   191  00004E   2D02(1)  	MOV			A,#DEFAULT_GAP_TIME_FLAGH
   192  00004F   1F0C(1)  	MOV			DATAH,A
   193  000050   2D00(1)  	MOV			A,#DEFAULT_GAP_TIME_FLAGL
   194  000051   1F0D(1)  	MOV			DATAL,A
   195  000052   C164(2)  	CALL		PUT_DATA_INTO_TM_FUN
   196  000053   63D2(1)  	B0BCLR		S_TM_EE_IO
   197  000054   C2AE(2)  	CALL		DELAY_SHORT
   198  000055             ;*******************************************
   199  000055   2D1F(1)  	MOV			A,#LAST_TIME_EE_ADD_H
   200  000056   1F13(1)  	MOV			MAC_H,A
   201  000057   2DFE(1)  	MOV			A,#LAST_TIME_EE_ADD_L
   202  000058   1F14(1)  	MOV			MAC_L,A
   203  000059   5106(1+S)  	BTS0		RESET_FLAG
   204  00005A   807F(2)  	JMP			RESET_EEPROM
   205  00005B   C1F6(2)  	CALL		GET_DATA_FROM_EE_FUN
   206  00005C   1E0F(1)  	MOV			A,ADDRESSL
   207  00005D   1F18(1)  	MOV			STARTADDRL,A
   208  00005E   1E0E(1)  	MOV			A,ADDRESSH
   209  00005F   1F17(1)  	MOV			STARTADDRH,A
   210  000060   1E0E(1)  	MOV			A,ADDRESSH
   211  000061   06FF(1+S)  	CMPRS		A,#0XFF
   212  000062   8065(2)  	JMP			$+3
   213  000063   2B17(1)  	CLR			STARTADDRH
   214  000064   2B18(1)  	CLR			STARTADDRL
   215  000065   C2B4(2)  	CALL		DELAY_LONG
   216  000066   2D1F(1)  	MOV			A,#LIVE_TIME_ADD_H
   217  000067   1F13(1)  	MOV			MAC_H,A
   218  000068   2DFC(1)  	MOV			A,#LIVE_TIME_ADD_L
   219  000069   1F14(1)  	MOV			MAC_L,A
   220  00006A   C1F6(2)  	CALL		GET_DATA_FROM_EE_FUN
   221  00006B   1E0E(1)  	MOV			A,ADDRESSH
   222  00006C   06FF(1+S)  	CMPRS		A,#0XFF
   223  00006D   806F(2)  	JMP			$+2
   224  00006E   8072(2)  	JMP			$+4
   225  00006F   160F(1+S)  	INCMS		ADDRESSL
   226  000070   160E(1+S)  	INCMS		ADDRESSH
   227  000071   8074(2)  	JMP			$+3
   228  000072   2B0F(1)  	CLR			ADDRESSL
   229  000073   2B0E(1)  	CLR			ADDRESSH
   230  000074   1E0F(1)  	MOV			A,ADDRESSL
   231  000075   1F0D(1)  	MOV			DATAL,A
   232  000076   1E0E(1)  	MOV			A,ADDRESSH
   233  000077   1F0C(1)  	MOV			DATAH,A
   234  000078   C142(2)  	CALL		DATA_TO_EEPROM_FUN
   235  000079   1E17(1)  	MOV			A,STARTADDRH
   236  00007A   1F0E(1)  	MOV			ADDRESSH,A
   237  00007B   1E18(1)  	MOV			A,STARTADDRL
   238  00007C   1F0F(1)  	MOV			ADDRESSL,A
   239  00007D   5906(1+S)  	BTS1		RESET_FLAG
   240  00007E   809F(2)  	JMP			READ_TM_FLAG_MODE
   241  00007F             RESET_EEPROM:
   242  00007F   2DFF(1)  	MOV		A,#0XFF
   243  000080   1F0C(1)  	MOV		DATAH,A
   244  000081   2DFF(1)  	MOV		A,#0XFF
   245  000082   1F0D(1)  	MOV		DATAL,A
   246  000083   2D00(1)  	MOV		A,#0X00
   247  000084   1F13(1)  	MOV		MAC_H,A
   248  000085             RESET_EE_LOOP_H:
   249  000085   2D00(1)  	MOV		A,#0X00
   250  000086   1F14(1)  	MOV		MAC_L,A
   251  000087             RESET_EE_LOOP_L:
   252  000087   C142(2)  	CALL		DATA_TO_EEPROM_FUN
   253  000088   1614(1+S)  	INCMS	MAC_L
   254  000089   8087(2)  	JMP		RESET_EE_LOOP_L
   255  00008A   1613(1+S)  	INCMS	MAC_H
   256  00008B   1E13(1)  	MOV		A,MAC_H
   257  00008C   0620(1+S)  	CMPRS	A,#0X20
   258  00008D   8085(2)  	JMP		RESET_EE_LOOP_H
   259  00008E   2B0F(1)  	CLR		ADDRESSL
   260  00008F   2B0E(1)  	CLR		ADDRESSH
   261  000090   2D1F(1)  	MOV		A,#LAST_TIME_EE_ADD_H
   262  000091   1F13(1)  	MOV		MAC_H,A
   263  000092   2DFE(1)  	MOV		A,#LAST_TIME_EE_ADD_L
   264  000093   1F14(1)  	MOV		MAC_L,A
   265  000094   1E0E(1)  	MOV		A,ADDRESSH
   266  000095   1F0C(1)  	MOV		DATAH,A
   267  000096   1E0F(1)  	MOV		A,ADDRESSL
   268  000097   1F0D(1)  	MOV		DATAL,A
   269  000098   C142(2)  	CALL		DATA_TO_EEPROM_FUN
   270  000099   2D1F(1)  	MOV			A,#LIVE_TIME_ADD_H
   271  00009A   1F13(1)  	MOV			MAC_H,A
   272  00009B   2DFC(1)  	MOV			A,#LIVE_TIME_ADD_L
   273  00009C   1F14(1)  	MOV			MAC_L,A
   274  00009D   C142(2)  	CALL		DATA_TO_EEPROM_FUN
   275  00009E   4106(1)  	BCLR		RESET_FLAG
   276  00009F             ;******************************************
   277  00009F             READ_TM_FLAG_MODE:
   278  00009F   71D1(1+S)  	B0BTS0	VDDF
   279  0000A0             	SleepMode
   280  0000A0   6BCA(1)  		B0BSET	FCPUM0
   281  0000A1   2D02(1)  	MOV			A,#0X02
   282  0000A2   1F10(1)  	MOV			CRCT1,A
   283  0000A3             SYS_INIT_LED_S:
   284  0000A3   62D2(1)  	B0BCLR		CLED_IO
   285  0000A4   C2BE(2)  	CALL		DELAY_LED	
   286  0000A5   6AD2(1)  	B0BSET		CLED_IO
   287  0000A6   C2BE(2)  	CALL		DELAY_LED
   288  0000A7   2610(1+S)  	DECMS		CRCT1
   289  0000A8   80A3(2)  	JMP			SYS_INIT_LED_S
   290  0000A9             
   291  0000A9             FRONT_DELAY_MODE:
   292  0000A9   6FDF(1)  	B0BSET		FGIE
   293  0000AA   C300(2)  	CALL		SET_LOW_POWER_FUN
   294  0000AB             ;DELAY
   295  0000AB   C308(2)  	CALL		WAIT_FOR_SEAVAL_MINITE_FUN
   296  0000AC             	;///////////////////////////
   297  0000AC   4207(1)  	BCLR		NOT_UPLOAD_FLAG
   298  0000AD   4307(1)  	BCLR		HAVE_UPLOAD_FLAG
   299  0000AE             ;//////////////////////////////////////
   300  0000AE             MAIN:
   301  0000AE             	;close tc0 interrupt until the recording finished 
   302  0000AE             	GreenMode
   303  0000AE   6CCA(1)  		B0BSET	FCPUM1
   304  0000AF   0000(1)  		NOP
   305  0000B0   0000(1)  		NOP
   306  0000B1             	
   307  0000B1             JUST_I2CSLAVE_MODE:
   308  0000B1   5806(1+S)  	BTS1	READTM_FLAG
   309  0000B2   8100(2)  	JMP		JUST_UPLOAD_MODE
   310  0000B3   5506(1+S)  	BTS0	FILLOUT_FLAG
   311  0000B4   8113(2)  	JMP		MEM_FILLOUT_MODE
   312  0000B5   7CC9(1+S)  	B0BTS1	FT0IEN
   313  0000B6   8100(2)  	JMP		JUST_UPLOAD_MODE
   314  0000B7             ;*****START TM I2C SLAVE MODE***********
   315  0000B7             I2CSLAVE_MODE:
   316  0000B7   4006(1)  	BCLR 	READTM_FLAG
   317  0000B8             ;//////////////////////////////////////
   318  0000B8   7DD2(1+S)  	B0BTS1		SDA_IO
   319  0000B9   80F2(2)  	JMP			ADDRESS_CHANGE
   320  0000BA   6DC2(1)  	B0BSET		SDA_CONT
   321  0000BB   65D2(1)  	B0BCLR		SDA_IO
   322  0000BC   68C2(1)  	B0BSET		SCL_CONT
   323  0000BD   60D2(1)  	B0BCLR		SCL_IO
   324  0000BE   C2B4(2)  	CALL		DELAY_LONG
   325  0000BF   71D1(1+S)  	B0BTS0		VDDF
   326  0000C0   4A07(1)  	BSET		NOT_UPLOAD_FLAG
   327  0000C1   65C2(1)  	B0BCLR		SDA_CONT
   328  0000C2   60C2(1)  	B0BCLR		SCL_CONT
   329  0000C3             ;/////////////////////////////////////////
   330  0000C3   5A07(1+S)  	BTS1		NOT_UPLOAD_FLAG
   331  0000C4   80F2(2)  	JMP		ADDRESS_CHANGE
   332  0000C5   4207(1)  	BCLR		NOT_UPLOAD_FLAG
   333  0000C6   67DF(1)  	B0BCLR 	FGIE
   334  0000C7   6CC5(1)  	B0BSET	VTM_CONT
   335  0000C8   6BD2(1)  	B0BSET	S_TM_EE_IO
   336  0000C9   60D0(1)  	B0BCLR	VSR_IO
   337  0000CA   6CD2(1)  	B0BSET	PUSH_V_SENSOR_GND
   338  0000CB   2D34(1)  	MOV		A,#TM_DATA_H
   339  0000CC   1F13(1)  	MOV		MAC_H,A
   340  0000CD   2D00(1)  	MOV		A,#TM_DATA_L
   341  0000CE   1F14(1)  	MOV		MAC_L,A
   342  0000CF   C1A5(2)  	CALL	GET_DATA_FROM_TM_FUN
   343  0000D0   64D5(1)  	B0BCLR		VTM_IO
   344  0000D1   C2AE(2)  	CALL		DELAY_SHORT
   345  0000D2   63D2(1)  	B0BCLR		S_TM_EE_IO
   346  0000D3   64C5(1)  	B0BCLR		VTM_CONT
   347  0000D4   C2AE(2)  	CALL		DELAY_SHORT
   348  0000D5   1E0E(1)  	MOV		A,ADDRESSH
   349  0000D6   1F13(1)  	MOV		MAC_H,A
   350  0000D7   1E0F(1)  	MOV		A,ADDRESSL
   351  0000D8   1F14(1)  	MOV		MAC_L,A
   352  0000D9   C142(2)  	CALL		DATA_TO_EEPROM_FUN
   353  0000DA   2D1F(1)  	MOV		A,#LAST_TIME_EE_ADD_H
   354  0000DB   1F13(1)  	MOV		MAC_H,A
   355  0000DC   2DFE(1)  	MOV		A,#LAST_TIME_EE_ADD_L
   356  0000DD   1F14(1)  	MOV		MAC_L,A
   357  0000DE   1E0E(1)  	MOV		A,ADDRESSH
   358  0000DF   1F0C(1)  	MOV		DATAH,A
   359  0000E0   1E0F(1)  	MOV		A,ADDRESSL
   360  0000E1   1F0D(1)  	MOV		DATAL,A
   361  0000E2   C142(2)  	CALL		DATA_TO_EEPROM_FUN
   362  0000E3   74C8(1+S)  	B0BTS0		FT0IRQ
   363  0000E4   1608(1+S)  	INCMS		TIMEH
   364  0000E5   64C8(1)  	B0BCLR		FT0IRQ
   365  0000E6   6FDF(1)  	B0BSET		FGIE
   366  0000E7   2D78(1)  	MOV			A,#TIME_GAP
   367  0000E8   0708(1+S)  	CMPRS		A,TIMEH
   368  0000E9   80F2(2)  	JMP			ADDRESS_CHANGE
   369  0000EA   2B08(1)  	CLR			TIMEH
   370  0000EB   4B06(1)  	BSET		TIME_FLAG
   371  0000EC   1609(1+S)  	INCMS		TIMEG
   372  0000ED   1E16(1)  	MOV			A,TIME_DELAY_GAP
   373  0000EE   0709(1+S)  	CMPRS		A,TIMEG
   374  0000EF   80F2(2)  	JMP			ADDRESS_CHANGE
   375  0000F0   2B09(1)  	CLR			TIMEG
   376  0000F1   4806(1)  	BSET		READTM_FLAG
   377  0000F2             ADDRESS_CHANGE:
   378  0000F2   2D02(1)  	MOV			A,#0X02
   379  0000F3   130F(1)  	ADD			ADDRESSL,A
   380  0000F4   2D00(1)  	MOV			A,#0X00
   381  0000F5   110E(1)  	ADC			ADDRESSH,A
   382  0000F6   2D1F(1)  	MOV			A,#MAX_MEMH
   383  0000F7   070E(1+S)  	CMPRS		A,ADDRESSH
   384  0000F8   80B1(2)  	JMP			JUST_I2CSLAVE_MODE
   385  0000F9   2DF0(1)  	MOV			A,#MAX_MEML
   386  0000FA   070F(1+S)  	CMPRS		A,ADDRESSL
   387  0000FB   80B1(2)  	JMP			JUST_I2CSLAVE_MODE
   388  0000FC   4D06(1)  	BSET		FILLOUT_FLAG
   389  0000FD   67D8(1)  	B0BCLR		FT0ENB
   390  0000FE   64C9(1)  	B0BCLR		FT0IEN
   391  0000FF   8113(2)  	JMP			MEM_FILLOUT_MODE
   392  000100             ;*****************************************
   393  000100             JUST_UPLOAD_MODE:
   394  000100   62C2(1)  	B0BCLR		CLED_CONT
   395  000101   C2AE(2)  	CALL		DELAY_SHORT
   396  000102   C2AE(2)  	CALL		DELAY_SHORT
   397  000103   7AD2(1+S)  	B0BTS1		CLED_IO
   398  000104   812C(2)  	JMP			RESET_MODE
   399  000105   5206(1+S)  	BTS0		TM_EE_FLAG
   400  000106   810D(2)  	JMP			END_TM_EE_MODE
   401  000107   5B07(1+S)  	BTS1		HAVE_UPLOAD_FLAG
   402  000108   8113(2)  	JMP			MEM_FILLOUT_MODE
   403  000109             TM_EE_MODE:
   404  000109   4307(1)  	BCLR		HAVE_UPLOAD_FLAG
   405  00010A   5206(1+S)  	BTS0		TM_EE_FLAG
   406  00010B   810D(2)  	JMP			END_TM_EE_MODE
   407  00010C   C2F7(2)  	CALL		SET_EE_TM_FUN
   408  00010D             END_TM_EE_MODE:
   409  00010D             	;BTS0		FILLOUT_FLAG
   410  00010D             	;JMP			MEM_FILLOUT_MODE	
   411  00010D   59D1(1+S)  	BTS1		VDDF
   412  00010E   8113(2)  	JMP			MEM_FILLOUT_MODE
   413  00010F   C300(2)  	CALL		SET_LOW_POWER_FUN
   414  000110   5506(1+S)  	BTS0		FILLOUT_FLAG
   415  000111   8113(2)  	JMP			MEM_FILLOUT_MODE
   416  000112             	;we should keep rtc function 
   417  000112   8123(2)  	JMP		ON_LED_MODE
   418  000113             ;*************************************
   419  000113             MEM_FILLOUT_MODE:
   420  000113   5D06(1+S)  	BTS1	FILLOUT_FLAG
   421  000114   8123(2)  	JMP		ON_LED_MODE
   422  000115   79D1(1+S)  	B0BTS1	VDDF	
   423  000116   C2F7(2)  	CALL	SET_EE_TM_FUN
   424  000117   C300(2)  	CALL	SET_LOW_POWER_FUN
   425  000118   7FD8(1+S)  	B0BTS1		FT0ENB
   426  000119   811E(2)  	JMP			$+5
   427  00011A   2BD9(1)  	CLR			T0C
   428  00011B   64C8(1)  	B0BCLR		FT0IRQ
   429  00011C   64C9(1)  	B0BCLR		FT0IEN
   430  00011D   67D8(1)  	B0BCLR		FT0ENB
   431  00011E             	SleepMode
   432  00011E   6BCA(1)  		B0BSET	FCPUM0
   433  00011F             END_FILLOUT_MODE:
   434  00011F   6AC2(1)  	B0BSET		CLED_CONT
   435  000120   6AD2(1)  	B0BSET		CLED_IO
   436  000121   C2A9(2)  	CALL		DELAY_MINI
   437  000122   8100(2)  	JMP		JUST_UPLOAD_MODE
   438  000123             ON_LED_MODE:
   439  000123   6AC2(1)  	B0BSET	CLED_CONT
   440  000124   6AD2(1)  	B0BSET	CLED_IO
   441  000125   5107(1+S)  	BTS0	READ_LED_FLAG
   442  000126   C131(2)  	CALL	READ_LED_FUN
   443  000127   4107(1)  	BCLR   	READ_LED_FLAG
   444  000128   6AD2(1)  	B0BSET	CLED_IO
   445  000129   5506(1+S)  	BTS0	FILLOUT_FLAG
   446  00012A   8100(2)  	JMP		JUST_UPLOAD_MODE
   447  00012B   80AE(2)  	JMP		MAIN
   448  00012C             RESET_MODE:
   449  00012C   4906(1)  	BSET	RESET_FLAG
   450  00012D   4506(1)  	BCLR	FILLOUT_FLAG
   451  00012E   2B08(1)  	CLR		TIMEH
   452  00012F   2B09(1)  	CLR		TIMEG
   453  000130   8032(2)  	JMP		STATE_INITIAL
   454  000131             	
   455  000131             ;******************************************************************************	
   456  000131             READ_LED_FUN:
   457  000131   2D01(1)     	MOV  	   	A,#1
   458  000132   1F05(1)     	MOV  	   	TLC2,A
   459  000133             LED_MODEL1:	
   460  000133   6AD2(1)     	B0BSET   	CLED_IO
   461  000134   C2BE(2)     	CALL   	   	DELAY_LED
   462  000135   62D2(1)     	B0BCLR   	CLED_IO
   463  000136   C2BE(2)     	CALL   	   	DELAY_LED
   464  000137   2605(1+S)     	DECMS   	TLC2
   465  000138   8133(2)     	JMP   	   	LED_MODEL1
   466  000139   0E00(2)     	RET
   467  00013A             ;*******************************************************
   468  00013A             ;***************************************
   469  00013A             	
   470  00013A             	
   471  00013A             	
   472  00013A             	
   473  00013A             	
   474  00013A             	
   475  00013A             	
   476  00013A             	
   477  00013A             	
   478  00013A             	
   479  00013A             	
   480  00013A             	
   481  00013A             	
   482  00013A             	
   483  00013A             	
   484  00013A             	
   485  00013A             CLRRAM:
   486  00013A             	
   487  00013A   2B84(1)  	CLR			Y
   488  00013B   2D2F(1)  	MOV			A,#END_RAM_ADDR
   489  00013C   2F83(1)  	B0MOV		Z,A
   490  00013D             CLRRAM10:
   491  00013D   2BE7(1)  	CLR			@YZ
   492  00013E   2683(1+S)  	DECMS		Z
   493  00013F   813D(2)  	JMP			CLRRAM10
   494  000140   2BE7(1)  	CLR			@YZ
   495  000141   0E00(2)  	RET
   496  000142             ;***********************************
   497  000142             ;***************************************
   498  000142             ;*************WRITE TMEPERATURE INTO EEPROM*************
   499  000142             ;*************RECORDING ADDRESS THE LAST TIME STORAGE THE TMPERATURE VALUE************
   500  000142             ;**************************************
   501  000142             DATA_TO_EEPROM_FUN:
   502  000142   6DC2(1)  	B0BSET		SDA_CONT
   503  000143   6DD2(1)  	B0BSET		SDA_IO
   504  000144   68C2(1)  	B0BSET		SCL_CONT
   505  000145   68D2(1)  	B0BSET		SCL_IO
   506  000146   1E14(1)  	MOV			A,MAC_L
   507  000147   1F11(1)  	MOV			CRCT2,A
   508  000148   1E0C(1)  	MOV			A,DATAH
   509  000149   1F10(1)  	MOV			CRCT1,A
   510  00014A   2D02(1)  	MOV			A,#0X02
   511  00014B   1F05(1)  	MOV			TLC2,A
   512  00014C             MOVE_DATA_TO_EEPROM:
   513  00014C   C221(2)  	CALL		I2C_START_EE
   514  00014D   2DA0(1)  	MOV			A,#EEW_ADD
   515  00014E   1F0A(1)  	MOV			DATA_IN,A
   516  00014F   C272(2)  	CALL		EEADDRESS_ASK
   517  000150   1E13(1)  	MOV			A,MAC_H
   518  000151   1F0A(1)  	MOV			DATA_IN,A
   519  000152   C272(2)  	CALL		EEADDRESS_ASK
   520  000153   1E11(1)  	MOV			A,CRCT2
   521  000154   1F0A(1)  	MOV			DATA_IN,A
   522  000155   C272(2)  	CALL		EEADDRESS_ASK
   523  000156   C2A9(2)  	CALL		DELAY_MINI
   524  000157   1E10(1)  	MOV			A,CRCT1
   525  000158   1F0A(1)  	MOV			DATA_IN,A
   526  000159   C272(2)  	CALL		EEADDRESS_ASK
   527  00015A   C227(2)  	CALL		I2C_END_EE
   528  00015B             	
   529  00015B   C2B4(2)  	CALL		DELAY_LONG
   530  00015C   2D01(1)  	MOV			A,#0X01
   531  00015D   1311(1)  	ADD			CRCT2,A
   532  00015E   1E0D(1)  	MOV			A,DATAL
   533  00015F   1F10(1)  	MOV			CRCT1,A
   534  000160   2605(1+S)  	DECMS		TLC2
   535  000161   814C(2)  	JMP			MOVE_DATA_TO_EEPROM
   536  000162             ;*********************************************
   537  000162   60C2(1)  	B0BCLR		SCL_CONT
   538  000163   0E00(2)  	RET
   539  000164             ;**************************************
   540  000164             PUT_DATA_INTO_TM_FUN:
   541  000164   68C2(1)  	B0BSET	SCL_CONT
   542  000165   69C2(1)  	B0BSET	SDATA_CONT
   543  000166   61D2(1)  	B0BCLR	SDATA_IO
   544  000167   60D2(1)  	B0BCLR	SCL_IO
   545  000168   C2B4(2)  	CALL 	DELAY_LONG
   546  000169   C2B4(2)  	CALL 	DELAY_LONG
   547  00016A   6CD5(1)  	B0BSET 	VTM_IO
   548  00016B   C2B4(2)  	CALL 	DELAY_LONG
   549  00016C             	;CALL	DELAY_LONG
   550  00016C             START_TMI2C_S:
   551  00016C   2D04(1)  	MOV 	A,#0X04
   552  00016D   1F03(1)  	MOV 	TLC0,A
   553  00016E             LOOP_1_S:
   554  00016E   68D2(1)  	B0BSET 	SCL_IO
   555  00016F   C2A9(2)  	CALL	DELAY_MINI;13US
   556  000170   C2A8(2)  	CALL	CALL_DELAY
   557  000171   60D2(1)  	B0BCLR 	SCL_IO
   558  000172   C2A9(2)  	CALL 	DELAY_MINI
   559  000173   2603(1+S)  	DECMS  	TLC0
   560  000174   816E(2)  	JMP 	LOOP_1_S
   561  000175   41D2(1)  	BCLR 	SDATA_IO
   562  000176   C2B4(2)  	CALL	DELAY_LONG
   563  000177   C2B4(2)  	CALL	DELAY_LONG
   564  000178   2D04(1)  	MOV 	A,#4
   565  000179   2F03(1)  	B0MOV 	TLC0,A
   566  00017A             LOOP_2_S:
   567  00017A   60D2(1)  	B0BCLR 	SCL_IO
   568  00017B   C2A9(2)  	CALL	DELAY_MINI
   569  00017C   C2A8(2)  	CALL	CALL_DELAY
   570  00017D   68D2(1)  	B0BSET 	SCL_IO
   571  00017E   C2A9(2)  	CALL	DELAY_MINI
   572  00017F   2603(1+S)  	DECMS 	TLC0
   573  000180   817A(2)  	JMP 	LOOP_2_S
   574  000181   C2AE(2)  	CALL	DELAY_SHORT
   575  000182   2D14(1)  	MOV 	A,#20
   576  000183   2F03(1)  	B0MOV 	TLC0,A
   577  000184   49D2(1)  	BSET 	SDATA_IO
   578  000185             WAIT_TM_INIT_S:
   579  000185   C2B4(2)  	CALL 		DELAY_LONG
   580  000186   2603(1+S)  	DECMS 		TLC0
   581  000187   8185(2)  	JMP 		WAIT_TM_INIT_S
   582  000188             ;**************START*****************************
   583  000188   C22E(2)  	CALL		I2C_START_TM
   584  000189             ;***********************************************
   585  000189   2D3C(1)  	MOV 		A,#TMW_ADD
   586  00018A   1F0A(1)  	MOV 		DATA_IN,A
   587  00018B   C23C(2)  	CALL 		TMADDRESS_ASK
   588  00018C   5507(1+S)  	BTS0		TM_I2C_EEROR
   589  00018D   819F(2)  	JMP			END_TM_S
   590  00018E   2D2F(1)  	MOV 		A,#WRITE_TM_ADD_H
   591  00018F   1F0A(1)  	MOV 		DATA_IN,A
   592  000190   C23C(2)  	CALL 		TMADDRESS_ASK
   593  000191   2D00(1)  	MOV 		A,#WRITE_TM_ADD_L
   594  000192   1F0A(1)  	MOV 		DATA_IN,A
   595  000193   C23C(2)  	CALL 		TMADDRESS_ASK
   596  000194   C2B4(2)  	CALL		DELAY_LONG
   597  000195   1E0C(1)  	MOV 		A,DATAH
   598  000196   1F0A(1)  	MOV 		DATA_IN,A
   599  000197   C23C(2)  	CALL 		TMADDRESS_ASK
   600  000198   1E0D(1)  	MOV 		A,DATAL
   601  000199   1F0A(1)  	MOV 		DATA_IN,A
   602  00019A   C23C(2)  	CALL 		TMADDRESS_ASK
   603  00019B   C2AE(2)  	CALL		DELAY_SHORT
   604  00019C             ;**************END*******************************
   605  00019C   C234(2)  	CALL		I2C_END_TM
   606  00019D   C2BE(2)  	CALL		DELAY_LED
   607  00019E   61D2(1)  	B0BCLR		SDATA_IO
   608  00019F             END_TM_S:
   609  00019F   4507(1)  	BCLR		TM_I2C_EEROR
   610  0001A0   64D5(1)  	B0BCLR 		VTM_IO
   611  0001A1   61C2(1)  	B0BCLR		SDATA_CONT
   612  0001A2   60C2(1)  	B0BCLR		SCL_CONT
   613  0001A3   C2AE(2)  	CALL 		DELAY_SHORT
   614  0001A4   0E00(2)  	RET
   615  0001A5             ;*******************************************
   616  0001A5             ;*****************************************
   617  0001A5             GET_DATA_FROM_TM_FUN:
   618  0001A5   2D0F(1)  	MOV		A,#0X0F
   619  0001A6   1F12(1)  	MOV		COUNT,A
   620  0001A7             TM_I2C_WORK_LOOP:
   621  0001A7   68C2(1)  	B0BSET	SCL_CONT
   622  0001A8   69C2(1)  	B0BSET	SDATA_CONT
   623  0001A9   61D2(1)  	B0BCLR	SDATA_IO
   624  0001AA   60D2(1)  	B0BCLR	SCL_IO
   625  0001AB   C2B4(2)  	CALL 	DELAY_LONG
   626  0001AC   C2B4(2)  	CALL 	DELAY_LONG
   627  0001AD   6CD5(1)  	B0BSET 	VTM_IO
   628  0001AE   C2B4(2)  	CALL 	DELAY_LONG
   629  0001AF             	;CALL	DELAY_LONG
   630  0001AF             START_TMI2C:
   631  0001AF   2D04(1)  	MOV 	A,#0X04
   632  0001B0   1F03(1)  	MOV 	TLC0,A
   633  0001B1             LOOP_1:
   634  0001B1   68D2(1)  	B0BSET 	SCL_IO
   635  0001B2   C2A9(2)  	CALL	DELAY_MINI;13US
   636  0001B3   C2A8(2)  	CALL	CALL_DELAY
   637  0001B4   60D2(1)  	B0BCLR 	SCL_IO
   638  0001B5   C2A9(2)  	CALL 	DELAY_MINI
   639  0001B6   2603(1+S)  	DECMS  	TLC0
   640  0001B7   81B1(2)  	JMP 	LOOP_1
   641  0001B8   2D28(1)  	MOV 	A,#40
   642  0001B9   2F03(1)  	B0MOV 	TLC0,A
   643  0001BA   41D2(1)  	BCLR 	SDATA_IO
   644  0001BB   C2B4(2)  	CALL	DELAY_LONG
   645  0001BC             	;CALL	DELAY_SHORT
   646  0001BC   2D04(1)  	MOV 	A,#4
   647  0001BD   2F03(1)  	B0MOV 	TLC0,A
   648  0001BE             LOOP_2:
   649  0001BE   60D2(1)  	B0BCLR 	SCL_IO
   650  0001BF   C2A9(2)  	CALL	DELAY_MINI
   651  0001C0   C2A8(2)  	CALL	CALL_DELAY
   652  0001C1   68D2(1)  	B0BSET 	SCL_IO
   653  0001C2   C2A9(2)  	CALL	DELAY_MINI
   654  0001C3   2603(1+S)  	DECMS 	TLC0
   655  0001C4   81BE(2)  	JMP 	LOOP_2
   656  0001C5   C2AE(2)  	CALL	DELAY_SHORT
   657  0001C6   2D0A(1)  	MOV 	A,#10
   658  0001C7   2F03(1)  	B0MOV 	TLC0,A
   659  0001C8   49D2(1)  	BSET 	SDATA_IO
   660  0001C9             WAIT_TM_INIT:
   661  0001C9   C2B4(2)  	CALL 		DELAY_LONG
   662  0001CA   2603(1+S)  	DECMS 		TLC0
   663  0001CB   81C9(2)  	JMP 		WAIT_TM_INIT
   664  0001CC             ;**************START*****************************
   665  0001CC   C22E(2)  	CALL		I2C_START_TM
   666  0001CD             ;***********************************************
   667  0001CD   2D3D(1)  	MOV 		A,#TMR_ADD
   668  0001CE   1F0A(1)  	MOV 		DATA_IN,A
   669  0001CF   C23C(2)  	CALL 		TMADDRESS_ASK
   670  0001D0   5507(1+S)  	BTS0		TM_I2C_EEROR
   671  0001D1   81F0(2)  	JMP			END_TM
   672  0001D2   1E13(1)  	MOV 		A,MAC_H
   673  0001D3   1F0A(1)  	MOV 		DATA_IN,A
   674  0001D4   C23C(2)  	CALL 		TMADDRESS_ASK
   675  0001D5   1E14(1)  	MOV 		A,MAC_L
   676  0001D6   1F0A(1)  	MOV 		DATA_IN,A
   677  0001D7   C23C(2)  	CALL 		TMADDRESS_ASK
   678  0001D8   61C2(1)  	B0BCLR		SDATA_CONT
   679  0001D9   C2B4(2)  	CALL 		DELAY_LONG
   680  0001DA   4706(1)  	BCLR 		ASK_FLAG
   681  0001DB   C256(2)  	CALL 		TMDATA_ASK
   682  0001DC   1E0B(1)  	MOV 		A,DATA_OUT
   683  0001DD   1F0C(1)  	MOV 		DATAH,A
   684  0001DE   4F06(1)  	BSET 		ASK_FLAG
   685  0001DF   C256(2)  	CALL 		TMDATA_ASK
   686  0001E0   1E0B(1)  	MOV 		A,DATA_OUT
   687  0001E1   1F0D(1)  	MOV 		DATAL,A		
   688  0001E2             ;**************END*******************************
   689  0001E2   C234(2)  	CALL		I2C_END_TM
   690  0001E3   C2AE(2)  	CALL		DELAY_SHORT
   691  0001E4   61D2(1)  	B0BCLR		SDATA_IO
   692  0001E5   2612(1+S)  	DECMS		COUNT
   693  0001E6   81E8(2)  	JMP			$+2
   694  0001E7   81F0(2)  	JMP			END_TM
   695  0001E8   64D5(1)  	B0BCLR 		VTM_IO
   696  0001E9   2D00(1)  	MOV			A,#0X00
   697  0001EA   070C(1+S)  	CMPRS		A,DATAH
   698  0001EB   81EF(2)  	JMP			$+4
   699  0001EC   070D(1+S)  	CMPRS		A,DATAL
   700  0001ED   81EF(2)  	JMP			$+2
   701  0001EE   81A7(2)  	JMP			TM_I2C_WORK_LOOP
   702  0001EF   4907(1)  	BSET		READ_LED_FLAG
   703  0001F0             END_TM:
   704  0001F0   4507(1)  	BCLR		TM_I2C_EEROR
   705  0001F1   64D5(1)  	B0BCLR 		VTM_IO
   706  0001F2   61C2(1)  	B0BCLR		SDATA_CONT
   707  0001F3   60C2(1)  	B0BCLR		SCL_CONT
   708  0001F4   C2AE(2)  	CALL 		DELAY_SHORT
   709  0001F5   0E00(2)  	RET
   710  0001F6             ;*******************************************
   711  0001F6             ;***********************************************************
   712  0001F6             ;*********************************************************
   713  0001F6             GET_DATA_FROM_EE_FUN:
   714  0001F6   68C2(1)  	B0BSET		SCL_CONT
   715  0001F7   6DC2(1)  	B0BSET		SDA_CONT
   716  0001F8   6DD2(1)  	B0BSET		SDA_IO
   717  0001F9   68D2(1)  	B0BSET		SCL_IO
   718  0001FA   C2AE(2)  	CALL		DELAY_SHORT
   719  0001FB   C221(2)  	CALL		I2C_START_EE
   720  0001FC   2DA0(1)  	MOV			A,#EEW_ADD
   721  0001FD   1F0A(1)  	MOV			DATA_IN,A
   722  0001FE   C272(2)  	CALL		EEADDRESS_ASK
   723  0001FF   1E13(1)  	MOV			A,MAC_H
   724  000200   1F0A(1)  	MOV			DATA_IN,A
   725  000201   C272(2)  	CALL		EEADDRESS_ASK
   726  000202   1E14(1)  	MOV			A,MAC_L
   727  000203   1F0A(1)  	MOV			DATA_IN,A
   728  000204   C272(2)  	CALL		EEADDRESS_ASK
   729  000205   6DD2(1)  	B0BSET		SDA_IO
   730  000206   C2AE(2)  	CALL		DELAY_SHORT
   731  000207   68D2(1)  	B0BSET		SCL_IO
   732  000208   C2AE(2)  	CALL		DELAY_SHORT
   733  000209   C221(2)  	CALL		I2C_START_EE
   734  00020A   C2AE(2)  	CALL		DELAY_SHORT
   735  00020B   2DA1(1)  	MOV			A,#EER_ADD
   736  00020C   1F0A(1)  	MOV			DATA_IN,A
   737  00020D   C272(2)  	CALL		EEADDRESS_ASK
   738  00020E   65C2(1)  	B0BCLR		SDA_CONT
   739  00020F   4706(1)  	BCLR		ASK_FLAG
   740  000210   C28C(2)  	CALL		EEDATA_ASK
   741  000211   1E0B(1)  	MOV			A,DATA_OUT
   742  000212   1F0E(1)  	MOV			ADDRESSH,A
   743  000213   65C2(1)  	B0BCLR		SDA_CONT
   744  000214   C2A9(2)  	CALL		DELAY_MINI
   745  000215   4F06(1)  	BSET		ASK_FLAG
   746  000216   C28C(2)  	CALL		EEDATA_ASK
   747  000217   1E0B(1)  	MOV			A,DATA_OUT
   748  000218   1F0F(1)  	MOV			ADDRESSL,A
   749  000219   C227(2)  	CALL		I2C_END_EE
   750  00021A             ;*************************************
   751  00021A   C2AE(2)  	CALL		DELAY_SHORT
   752  00021B   60C2(1)  	B0BCLR		SCL_CONT
   753  00021C   0E00(2)  	RET
   754  00021D             ;************************************************
   755  00021D             I2C_EEROR:
   756  00021D             	;open interrupt
   757  00021D             	;SleepMode
   758  00021D   4606(1)  	BCLR	I2CERROR_FLAG
   759  00021E   54D5(1+S)  	BTS0	VTM_IO
   760  00021F   4D07(1)  	BSET	TM_I2C_EEROR
   761  000220   0E00(2)  	RET
   762  000221             I2C_START_EE:
   763  000221   C2A9(2)  	CALL		DELAY_MINI
   764  000222   65D2(1)  	B0BCLR 		SDA_IO
   765  000223   C2A9(2)  	CALL 		DELAY_MINI
   766  000224   60D2(1)  	B0BCLR 		SCL_IO
   767  000225   C2A9(2)  	CALL 		DELAY_MINI
   768  000226   0E00(2)  	RET
   769  000227             I2C_END_EE:
   770  000227   65D2(1)  	B0BCLR 		SDA_IO
   771  000228   C2A9(2)  	CALL 		DELAY_MINI
   772  000229   68D2(1)  	B0BSET 		SCL_IO
   773  00022A   C2A9(2)  	CALL 		DELAY_MINI
   774  00022B   6DD2(1)  	B0BSET 		SDA_IO
   775  00022C   C2A9(2)  	CALL		DELAY_MINI
   776  00022D   0E00(2)  	RET
   777  00022E             I2C_START_TM:
   778  00022E   C2A9(2)  	CALL		DELAY_MINI
   779  00022F   61D2(1)  	B0BCLR 		SDATA_IO
   780  000230   C2A9(2)  	CALL 		DELAY_MINI
   781  000231   60D2(1)  	B0BCLR 		SCL_IO
   782  000232   C2A9(2)  	CALL 		DELAY_MINI
   783  000233   0E00(2)  	RET
   784  000234             I2C_END_TM:
   785  000234   61D2(1)  	B0BCLR 		SDATA_IO
   786  000235   C2A9(2)  	CALL 		DELAY_MINI
   787  000236   60D2(1)  	B0BCLR		SCL_IO
   788  000237   C2A9(2)  	CALL		DELAY_MINI
   789  000238   69D2(1)  	B0BSET 		SDATA_IO
   790  000239   C2A9(2)  	CALL		DELAY_MINI
   791  00023A   68D2(1)  	B0BSET 		SCL_IO
   792  00023B   0E00(2)  	RET
   793  00023C             TMADDRESS_ASK:
   794  00023C   2D08(1)  	MOV 		A,#8
   795  00023D   1F02(1)  	MOV 		TIMEOUT,A
   796  00023E             TMADDRESS_LOOP:
   797  00023E   570A(1+S)  	BTS0		DATA_IN.7
   798  00023F   8243(2)  	JMP 		MD_1
   799  000240   71D2(1+S)  	B0BTS0 		SDATA_IO
   800  000241   61D2(1)  	B0BCLR		SDATA_IO
   801  000242   8245(2)  	JMP 		NEXT_1
   802  000243             MD_1:
   803  000243   79D2(1+S)  	B0BTS1 		SDATA_IO
   804  000244   69D2(1)  	B0BSET		SDATA_IO
   805  000245             NEXT_1:
   806  000245   C2A9(2)  	CALL		DELAY_MINI
   807  000246   68D2(1)  	B0BSET 		SCL_IO
   808  000247   C2A9(2)  	CALL		DELAY_MINI
   809  000248   0B0A(1)  	RLCM 		DATA_IN
   810  000249   60D2(1)  	B0BCLR 		SCL_IO
   811  00024A   2602(1+S)  	DECMS 		TIMEOUT
   812  00024B   823E(2)  	JMP 		TMADDRESS_LOOP
   813  00024C             	
   814  00024C   61C2(1)  	B0BCLR 		SDATA_CONT
   815  00024D   C2A9(2)  	CALL		DELAY_MINI
   816  00024E   68D2(1)  	B0BSET 		SCL_IO
   817  00024F   C2A8(2)  	CALL 		CALL_DELAY
   818  000250   71D2(1+S)  	B0BTS0 		SDATA_IO
   819  000251   C21D(2)  	CALL		I2C_EEROR
   820  000252   C2A9(2)  	CALL		DELAY_MINI
   821  000253   40D2(1)  	BCLR 		SCL_IO
   822  000254   49C2(1)  	BSET 		SDATA_CONT
   823  000255   0E00(2)  	RET
   824  000256             ;**********************TM_READING_DATA********************************
   825  000256             TMDATA_ASK:
   826  000256   61C2(1)  	B0BCLR 		SDATA_CONT
   827  000257   2D08(1)  	MOV 		A,#8
   828  000258   1F02(1)  	MOV 		TIMEOUT,A
   829  000259             TMDATA_LOOP:
   830  000259   2D09(1)  	MOV 		A,#9
   831  00025A   1F03(1)  	MOV 		TLC0,A
   832  00025B   C2A9(2)  	CALL		DELAY_MINI
   833  00025C   48D2(1)  	BSET 		SCL_IO
   834  00025D   C2A8(2)  	CALL 		CALL_DELAY
   835  00025E   71D2(1+S)  	B0BTS0 		SDATA_IO
   836  00025F   480B(1)  	BSET 		DATA_OUT.0
   837  000260   79D2(1+S)  	B0BTS1 		SDATA_IO
   838  000261   400B(1)  	BCLR 		DATA_OUT.0
   839  000262   0B0B(1)  	RLCM 		DATA_OUT
   840  000263   C2A9(2)  	CALL		DELAY_MINI
   841  000264   60D2(1)  	B0BCLR 		SCL_IO
   842  000265   2602(1+S)  	DECMS 		TIMEOUT
   843  000266   8259(2)  	JMP 		TMDATA_LOOP
   844  000267   69C2(1)  	B0BSET 		SDATA_CONT
   845  000268   5706(1+S)  	BTS0 		ASK_FLAG
   846  000269   69D2(1)  	B0BSET 		SDATA_IO
   847  00026A   5F06(1+S)  	BTS1 		ASK_FLAG
   848  00026B   61D2(1)  	B0BCLR 		SDATA_IO
   849  00026C   090B(1)  	RRCM 		DATA_OUT
   850  00026D   C2A9(2)  	CALL		DELAY_MINI
   851  00026E   48D2(1)  	BSET 		SCL_IO
   852  00026F   C2A9(2)  	CALL		DELAY_MINI
   853  000270   40D2(1)  	BCLR		SCL_IO	
   854  000271   0E00(2)  	RET
   855  000272             ;******************************************************
   856  000272             EEADDRESS_ASK:
   857  000272   2D08(1)  	MOV 		A,#8
   858  000273   1F02(1)  	MOV 		TIMEOUT,A
   859  000274             EEADDRESS_LOOP:
   860  000274   570A(1+S)  	BTS0		DATA_IN.7
   861  000275   8279(2)  	JMP 		EEMD_1
   862  000276   75D2(1+S)  	B0BTS0 		SDA_IO
   863  000277   65D2(1)  	B0BCLR		SDA_IO
   864  000278   827B(2)  	JMP 		EENEXT_1
   865  000279             EEMD_1:
   866  000279   7DD2(1+S)  	B0BTS1 		SDA_IO
   867  00027A   6DD2(1)  	B0BSET		SDA_IO
   868  00027B             EENEXT_1:
   869  00027B   C2A9(2)  	CALL		DELAY_MINI
   870  00027C   68D2(1)  	B0BSET 		SCL_IO
   871  00027D   C2A9(2)  	CALL		DELAY_MINI
   872  00027E   0B0A(1)  	RLCM 		DATA_IN
   873  00027F   60D2(1)  	B0BCLR 		SCL_IO
   874  000280   2602(1+S)  	DECMS 		TIMEOUT
   875  000281   8274(2)  	JMP 		EEADDRESS_LOOP
   876  000282             	
   877  000282   65C2(1)  	B0BCLR 		SDA_CONT
   878  000283   C2A9(2)  	CALL		DELAY_MINI
   879  000284   68D2(1)  	B0BSET 		SCL_IO
   880  000285   C2A8(2)  	CALL 		CALL_DELAY
   881  000286   75D2(1+S)  	B0BTS0 		SDA_IO
   882  000287   C21D(2)  	CALL		I2C_EEROR
   883  000288   C2A9(2)  	CALL		DELAY_MINI
   884  000289   40D2(1)  	BCLR 		SCL_IO
   885  00028A   4DC2(1)  	BSET 		SDA_CONT
   886  00028B   0E00(2)  	RET
   887  00028C             ;****************************************
   888  00028C             EEDATA_ASK:
   889  00028C   65C2(1)  	B0BCLR 		SDA_CONT
   890  00028D   2D08(1)  	MOV 		A,#8
   891  00028E   1F02(1)  	MOV 		TIMEOUT,A
   892  00028F             EEDATA_LOOP:
   893  00028F   2D09(1)  	MOV 		A,#9
   894  000290   1F03(1)  	MOV 		TLC0,A
   895  000291   C2A9(2)  	CALL		DELAY_MINI
   896  000292   48D2(1)  	BSET 		SCL_IO
   897  000293   C2A8(2)  	CALL 		CALL_DELAY
   898  000294   75D2(1+S)  	B0BTS0 		SDA_IO
   899  000295   480B(1)  	BSET 		DATA_OUT.0
   900  000296   7DD2(1+S)  	B0BTS1 		SDA_IO
   901  000297   400B(1)  	BCLR 		DATA_OUT.0
   902  000298   0B0B(1)  	RLCM 		DATA_OUT
   903  000299   C2A9(2)  	CALL		DELAY_MINI
   904  00029A   60D2(1)  	B0BCLR 		SCL_IO
   905  00029B   2602(1+S)  	DECMS 		TIMEOUT
   906  00029C   828F(2)  	JMP 		EEDATA_LOOP
   907  00029D             	
   908  00029D   6DC2(1)  	B0BSET 		SDA_CONT
   909  00029E   5706(1+S)  	BTS0 		ASK_FLAG
   910  00029F   6DD2(1)  	B0BSET 		SDA_IO
   911  0002A0   5F06(1+S)  	BTS1 		ASK_FLAG
   912  0002A1   65D2(1)  	B0BCLR 		SDA_IO
   913  0002A2   090B(1)  	RRCM 		DATA_OUT
   914  0002A3   C2A9(2)  	CALL		DELAY_MINI
   915  0002A4   48D2(1)  	BSET 		SCL_IO
   916  0002A5   C2A9(2)  	CALL		DELAY_MINI
   917  0002A6   40D2(1)  	BCLR		SCL_IO	
   918  0002A7   0E00(2)  	RET
   919  0002A8             ;*********************delay*****************
   920  0002A8             CALL_DELAY:
   921  0002A8   0E00(2)  	RET
   922  0002A9             DELAY_MINI:;13US
   923  0002A9   2D05(1)  	MOV		A,#0X05
   924  0002AA   1F00(1)  	MOV		DELAYTIME1,A
   925  0002AB             DELAY0:
   926  0002AB   2600(1+S)  	DECMS	DELAYTIME1
   927  0002AC   82AB(2)  	JMP		DELAY0
   928  0002AD   0E00(2)  	RET
   929  0002AE             	
   930  0002AE             DELAY_SHORT:		;50US FOR 0.5US/INSTRUCTION
   931  0002AE   2D63(1)  	MOV		A,#0X63
   932  0002AF   1F00(1)  	MOV		DELAYTIME1,A
   933  0002B0             DELAY1:
   934  0002B0   0000(1)  	NOP
   935  0002B1   2600(1+S)  	DECMS	DELAYTIME1
   936  0002B2   82B0(2)  	JMP		DELAY1
   937  0002B3   0E00(2)  	RET
   938  0002B4             DELAY_LONG:	;>=5MS
   939  0002B4             ;WAIT_FOR_A_LONG_WHILE
   940  0002B4   2D0A(1)  	MOV		A,#0X0A
   941  0002B5   2F00(1)  	B0MOV	DELAYTIME1,A
   942  0002B6             DELAY2_1:
   943  0002B6   2DC7(1)  	MOV		A,#0XC7
   944  0002B7   1F01(1)  	MOV		DELAYTIME2,A
   945  0002B8             DELAY2_2:
   946  0002B8   0000(1)  	NOP
   947  0002B9   2601(1+S)  	DECMS	DELAYTIME2
   948  0002BA   82B8(2)  	JMP		DELAY2_2	
   949  0002BB   2600(1+S)  	DECMS	DELAYTIME1
   950  0002BC   82B6(2)  	JMP		DELAY2_1
   951  0002BD   0E00(2)  	RET		
   952  0002BE             DELAY_LED:		;0.2S
   953  0002BE             ;WAIT_FOR_DEEP_DARK_FANTASY
   954  0002BE   2DFF(1)  	MOV		A,#0XFF
   955  0002BF   1F01(1)  	MOV		DELAYTIME2,A
   956  0002C0             DELAY3_1:
   957  0002C0   2DFF(1)  	MOV		A,#0XFF
   958  0002C1   1F00(1)  	MOV		DELAYTIME1,A
   959  0002C2             DELAY3_2:
   960  0002C2   0000(1)  	NOP
   961  0002C3   0000(1)  	NOP
   962  0002C4   2600(1+S)  	DECMS		DELAYTIME1
   963  0002C5   82C2(2)  	JMP			DELAY3_2
   964  0002C6   2601(1+S)  	DECMS		DELAYTIME2
   965  0002C7   82C0(2)  	JMP			DELAY3_1
   966  0002C8   0E00(2)  	RET
   967  0002C9             OPEN_TC0_INT_FUN:
   968  0002C9   6BDA(1)  	B0BSET	FTC0CKS	;	OUTSIDE INPUT ACCIDENT
   969  0002CA   6ADA(1)  	B0BSET	FALOAD0 ;
   970  0002CB   2DFD(1)  	MOV		A,#0XFD
   971  0002CC   2FCD(1)  	B0MOV	TC0R,A
   972  0002CD   2FDB(1)  	B0MOV	TC0C,A
   973  0002CE   65C8(1)  	B0BCLR	FTC0IRQ
   974  0002CF   6DC9(1)  	B0BSET	FTC0IEN
   975  0002D0   6FDA(1)  	B0BSET	FTC0ENB
   976  0002D1   0E00(2)  	RET
   977  0002D2             SYS_INIT_FUN:
   978  0002D2   2D3D(1)  	MOV			A,#0X3D
   979  0002D3   2FC2(1)  	B0MOV		P2M,A
   980  0002D4   2D35(1)  	MOV			A,#0X35
   981  0002D5   2FD2(1)  	B0MOV		P2,A
   982  0002D6             	;up resistor for p2.1
   983  0002D6             	;MOV			A,#0X02
   984  0002D6             	;B0MOV		P2UR,A
   985  0002D6   2D01(1)  	MOV			A,#0X01
   986  0002D7   2FC1(1)  	B0MOV		P1M,A
   987  0002D8   2BD1(1)  	CLR			P1
   988  0002D9   68B8(1)  	B0BSET		VSR_CONT
   989  0002DA   60D0(1)  	B0BCLR		VSR_IO
   990  0002DB   68C1(1)  	B0BSET		S_VDD_VCC_CONT
   991  0002DC   60D1(1)  	B0BCLR		S_VDD_VCC_IO
   992  0002DD   6CC5(1)  	B0BSET		VTM_CONT
   993  0002DE   64D5(1)  	B0BCLR		VTM_IO
   994  0002DF   2D03(1)  	MOV			A,#0X03
   995  0002E0   1F10(1)  	MOV			CRCT1,A
   996  0002E1             SYS_INIT_LED:
   997  0002E1   62D2(1)  	B0BCLR		CLED_IO
   998  0002E2   C2BE(2)  	CALL		DELAY_LED	
   999  0002E3   6AD2(1)  	B0BSET		CLED_IO
  1000  0002E4   C2BE(2)  	CALL		DELAY_LED
  1001  0002E5   2610(1+S)  	DECMS		CRCT1
  1002  0002E6   82E1(2)  	JMP			SYS_INIT_LED
  1003  0002E7             ;************T0_INIT_START************************************
  1004  0002E7   2D00(1)  	MOV			A,#0X00
  1005  0002E8   2FD8(1)  	B0MOV		T0M,A	
  1006  0002E9   68D8(1)  	B0BSET		FT0TB	; T0 = Fcpu/256,PERIOD TIME IS 2S
  1007  0002EA   2BD9(1)  	CLR			T0C
  1008  0002EB   64C8(1)  	B0BCLR		FT0IRQ
  1009  0002EC   6CC9(1)  	B0BSET		FT0IEN
  1010  0002ED   6FD8(1)  	B0BSET		FT0ENB
  1011  0002EE             ;*****************TC0_INIT_START*****************
  1012  0002EE   2BDA(1)  	CLR			TC0M
  1013  0002EF   2BDB(1)  	CLR			TC0C
  1014  0002F0   65C8(1)  	B0BCLR		FTC0IRQ
  1015  0002F1   65C9(1)  	B0BCLR		FTC0IEN
  1016  0002F2   67DA(1)  	B0BCLR		FTC0ENB
  1017  0002F3             ;************************OPEN P1.1WEEK UP FUNCTION*********************
  1018  0002F3   2D02(1)  	MOV			A,#0X02
  1019  0002F4   2FC0(1)  	B0MOV		P1W,A
  1020  0002F5   C2A9(2)  	CALL		DELAY_MINI
  1021  0002F6   0E00(2)  	RET
  1022  0002F7             ;//////////////////////////////////////////////////
  1023  0002F7             SET_EE_TM_FUN:
  1024  0002F7   65C2(1)  	B0BCLR		SDA_CONT
  1025  0002F8   64C5(1)  	B0BCLR		VTM_CONT
  1026  0002F9   60C2(1)  	B0BCLR		SCL_CONT
  1027  0002FA   61C2(1)  	B0BCLR		SDATA_CONT
  1028  0002FB   64D2(1)  	B0BCLR		PUSH_V_SENSOR_GND
  1029  0002FC   68D0(1)  	B0BSET		VSR_IO
  1030  0002FD   6BD2(1)  	B0BSET		S_TM_EE_IO
  1031  0002FE   6A06(1)  	B0BSET		TM_EE_FLAG
  1032  0002FF   0E00(2)  	RET
  1033  000300             ;////////////////////////////////////////
  1034  000300             ;////////////SET LOW POWER
  1035  000300             SET_LOW_POWER_FUN:
  1036  000300   64D2(1)  	B0BCLR	PUSH_V_SENSOR_GND
  1037  000301             ;****************************************
  1038  000301   6DD2(1)  	B0BSET		SDA_IO
  1039  000302   68D2(1)  	B0BSET		SCL_IO
  1040  000303   64C5(1)  	B0BCLR		VTM_CONT
  1041  000304   63D2(1)  	B0BCLR		S_TM_EE_IO
  1042  000305   60D0(1)  	B0BCLR		VSR_IO
  1043  000306   6206(1)  	B0BCLR		TM_EE_FLAG
  1044  000307   0E00(2)  	RET
  1045  000308             ;/////////////////////////////////////////	
  1046  000308             WAIT_FOR_SEAVAL_MINITE_FUN:
  1047  000308   1E15(1)  	MOV   	A,FRONT_DELAY
  1048  000309   1F10(1)  	MOV		CRCT1,A
  1049  00030A             	GreenMode
  1050  00030A   6CCA(1)  		B0BSET	FCPUM1
  1051  00030B   0000(1)  		NOP
  1052  00030C   0000(1)  		NOP
  1053  00030D   5307(1+S)  	BTS0	HAVE_UPLOAD_FLAG
  1054  00030E   C2F7(2)  	CALL	SET_EE_TM_FUN
  1055  00030F   5207(1+S)  	BTS0	NOT_UPLOAD_FLAG
  1056  000310   C300(2)  	CALL	SET_LOW_POWER_FUN
  1057  000311   5B06(1+S)  	BTS1	TIME_FLAG
  1058  000312   830C(2)  	JMP		$-6
  1059  000313   4306(1)  	BCLR	TIME_FLAG
  1060  000314   2610(1+S)  	DECMS	CRCT1
  1061  000315   830C(2)  	JMP		$-9
  1062  000316   0E00(2)  	RET
  1063  000317             ;*******************************************
  1064  000317             	ENDP
